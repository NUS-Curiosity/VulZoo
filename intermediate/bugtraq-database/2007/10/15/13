
Date: Sun, 14 Oct 2007 05:04:57 +0200
From: "KJK::Hyperion" <hackbunny@...tpj.org>
To: full-disclosure@...ts.grok.org.uk
Cc: bugtraq@...urityfocus.com
Subject: Third-party patch for CVE-2007-3896 (Internet Explorer 7 invalid
 URI handling) available

KJK::Hyperion ha scritto:
> Since this issue is a great big rats nest, I promise a third-party patch
> for it by tomorrow. Deal?

And "tomorrow" turned out to be "whenever it's done". Here is it, have a
temporary, third-party patch for CVE-2007-3896, by yours truly:

<http://spacebunny.xepher.net/hack/shellexecutefiasco/>

----

ShellExecuteFiasco - third-party patch for CVE-2007-3896
Copyright (C) 2007 KJK::Hyperion <hackbunny@...tpj.org>
<http://spacebunny.xepher.net/>


ABOUT
-----
This is an unofficial, third-party patch for vulnerability CVE-2007-3896
[1], intended to protect supported Microsoft operating systems until an
official patch is released, and unsupported systems as well. You only
need this patch if you have Internet Explorer 7 on any operating system
older than Windows Vista, and only until Microsoft releases an official
fix.

The present patch is dramatically under-tested and it has underwent no
quality assurance procedure whatsoever, so please deploy with the
greatest care. It has a very good chance of misbehaving and making your
system unusable; should this happen, rebooting in safe mode with command
prompt might make it possible to uninstall it, or it might as well not.

The patch consists of a ShellExecuteEx hook [2] that prevents the
execution of malformed URLs and enforces normalization of valid URLs.
Programs registering custom URL schemes might not like, support or even
know about normalized URLs: this patch will interfere with any such
program to the point of unusability. The normalization proper is
performed by Internet Explorer's low-level internet engine, which could
mangle unknown URL schemes or otherwise act unpredictably when presented
with abnormal input.

Notes
[1] <URL:http://www.microsoft.com/technet/security/advisory/943521.mspx>
[2] <URL:http://msdn2.microsoft.com/en-us/library/bb775101.aspx>


INSTALLATION
------------
 1. Copy shellexecutefiasco.dll anywhere; %windir%\system32 will do.
 2. Run the command:
     A. "regsvr32 <full path to shellexecutefiasco.dll>" or "regsvr32 /n
        /i:s <full path to shellexecutefiasco.dll>" to install for all
        users
     B. "regsvr32 /n /i:u <full path to shellexecutefiasco.dll>" to
        install for the current user only.
 3. A message box will report whether the installation was successful.

You need to be a privileged user to install this patch.


UNINSTALLATION
--------------
 1. Run the command "regsvr32 /u <full path to shellexecutefiasco.dll>".
 2. A message box will report whether the uninstallation was successful.
 3. Delete shellexecutefiasco.dll.

You need to be a privileged user to fully uninstall this patch.


LICENSE
-------
The patch is released as open source under the following license:

Copyright (c) 2007 KJK::Hyperion

Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

-- 
KJK:: HYPE
      RION

