
Date: Wed, 07 Feb 2007 14:26:29 -0500
From: iDefense Labs <labs-no-reply@...fense.com>
To: vulnwatch@...nwatch.org,  full-disclosure@...ts.grok.org.uk, 
	bugtraq@...urityfocus.com
Subject: iDefense Security Advisory 02.07.07: Trend Micro
 TmComm Local Privilege Escalation Vulnerability

Trend Micro TmComm Local Privilege Escalation Vulnerability

iDefense Security Advisory 02.07.07
http://labs.idefense.com/intelligence/vulnerabilities/
Feb 07, 2007

I. BACKGROUND

The Trend Micro AntiVirus scan engine is widely relied upon to provide
AntiVirus capabilities to desktop, server, and gateway systems. The engine
is licensed to several of Trend Micro's OEM partners. More information is
available on Trend Micro's web site at the following URL.

http://www.trendmicro.com/

II. DESCRIPTION

Local exploitation of an input validation vulnerability within version
1.5.0.1052 of TmComm.sys as included with Trend Micro's AntiVirus engine
could allow an attacker execute arbitrary code in kernel context.

This vulnerability specifically exists due to insecure permissions on the
\\.\TmComm DOS device interface. The permissions on this device allows
"Everyone" write access. This could allow a locally logged in user to
access functionality via IOCTLs which was designed for privileged use
only.

Additionally, the IOCTL handlers for this DOS device interface do not
validate addresses passed to them. As such, it is possible to overwrite
arbitrary memory or execute attacker-supplied code in the context of the
kernel (RING 0).

III. ANALYSIS

Exploitation allows an attacker to elevate privileges by overwriting
arbitrary system memory or executing code within kernel context.

IV. DETECTION

iDefense has confirmed the existence of this vulnerability in our
vulnerability lab. The configuration at verification time was as follows:

 * Trend Micro's PC-Cillin Internet Security 2007
 * TmComm.sys version 1.5.0.1052
 * VsapiNI.sys (scan engine) version 3.320.0.1003

All products using Trend Micro's scan engine should be considered
vulnerable.

V. WORKAROUND

Removing write permissions for "Everyone" appears to prevent access to the
vulnerable code. iDefense confirmed that the virus scanning engine was
still able to detect viruses. Although no side effects were witnessed in
Lab tests, normal functionality may be hindered.

VI. VENDOR RESPONSE

"To address this vulnerability, Trend Micro recommends to customers to
update their Anti-Rootkit Common Module to version 1.600-1052.

Products that are set to Automatic Update will be updated immediately.

Manual Updating can also be performed by using the product's "Update
Now" function."

More information is available in Trend Micro's knowledge base at the link
shown below.

http://esupport.trendmicro.com/support/viewxml.do?ContentID=EN-1034432&id=EN-1034432

VII. CVE INFORMATION

A Mitre Corp. Common Vulnerabilities and Exposures (CVE) number has not
been assigned yet.

VIII. DISCLOSURE TIMELINE

01/17/2007  Initial vendor notification
01/19/2007  Initial vendor response
02/07/2007  Coordinated public disclosure

IX. CREDIT

This vulnerability was reported to iDefense by Ruben Santamarta of
reversemode.com.

Get paid for vulnerability research
http://labs.idefense.com/methodology/vulnerability/vcp.php

Free tools, research and upcoming events
http://labs.idefense.com/

X. LEGAL NOTICES

Copyright Â© 2006 iDefense, Inc.

Permission is granted for the redistribution of this alert electronically.
It may not be edited in any way without the express written consent of
iDefense. If you wish to reprint the whole or any part of this alert in
any other medium other than electronically, please e-mail
customerservice@...fense.com for permission.

Disclaimer: The information in the advisory is believed to be accurate at
the time of publishing based on currently available information. Use of
the information constitutes acceptance for use in an AS IS condition.
There are no warranties with regard to this information. Neither the
author nor the publisher accepts any liability for any direct, indirect,
or consequential loss or damage arising from use of, or reliance on, this
information.

_______________________________________________
Full-Disclosure - We believe in it.
Charter: http://lists.grok.org.uk/full-disclosure-charter.html
Hosted and sponsored by Secunia - http://secunia.com/
