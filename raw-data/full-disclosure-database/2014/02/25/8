
Date: Mon, 24 Feb 2014 21:39:37 -0400
From: Pedro Luis Karrasquillo <peter_toyota@...mail.com>
To: "full-disclosure@...ts.grok.org.uk" <full-disclosure@...ts.grok.org.uk>
Subject:  MS 2k8 DNS server trivial DDoS contributor

Microsoft has responded to my report to secure@...rosoft.com and I can now disclose what I found.




There is a minor bug on the MS Server 2008 DNS service that responds 
with the list of all root servers when queried for non-authoritative 
domains, EVEN when recursion is set to OFF. This allows a malicious 
party to spoof the source ip on a udp DNS request to any MS Server 2008 
DNS and elicit a 533 byte response to a victim, making the server a 
contributor to coordinated Distributed Denial of Service attacks. The 
response contains the default list of root DNS servers.


Version tested: MS DNS on MS Server 2008 R2 version 6.1.7601.17514 

Server is Authoritative to only one .com domain. 

Config Parameters:

DNS Recursion set to "disable"
Enable Round Robin
Enable Netmask Ordering
Secure Cache against pollution


And My Mitigation steps:

Remove all root DNS servers listed on the "Root Hints" tab.


This will not negatively affect the DNS functionality of the server 
when deployed only as an authoritative server for a specific domain.






Although RFC1034 
on page 21 does allow the DNS to reply with the list of root servers (if
 configured) as a response option, ultimately it is preferable for it to
 mimic the behavior of BIND and not respond at all under these test 
conditions, to discourage abuse from malicious entities.


More details with images and packet captures and MS responses, in my web file http://pe.l√∫ka.com/


Pedro
CCNP, CCDA, CCNA-Security, SANS GPEN
...But mostly a curious guy.

 		 	   		  
Content of type "text/html" skipped

_______________________________________________
Full-Disclosure - We believe in it.
Charter: http://lists.grok.org.uk/full-disclosure-charter.html
Hosted and sponsored by Secunia - http://secunia.com/
