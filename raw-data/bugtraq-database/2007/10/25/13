
Date: Thu, 25 Oct 2007 12:54:02 -0400
From: iDefense Labs <labs-no-reply@...fense.com>
To: vulnwatch@...nwatch.org, full-disclosure@...ts.grok.org.uk,
	bugtraq@...urityfocus.com
Subject: iDefense Security Advisory 10.25.07: Trend Micro Tmxpflt.sys IOCTL
 0xa0284403 Buffer Overflow Vulnerability

Trend Micro Tmxpflt.sys IOCTL 0xa0284403 Buffer Overflow Vulnerability

iDefense Security Advisory 10.25.07
http://labs.idefense.com/intelligence/vulnerabilities/
Oct 25, 2007

I. BACKGROUND

The Trend Micro AntiVirus scan engine provides AntiVirus capabilities to
desktop, server, and gateway systems. The engine is licensed to several
of Trend Micro's OEM partners. More information is available on Trend
Micro's web site at the following URL.

http://www.trendmicro.com/

II. DESCRIPTION

Local exploitation of a buffer overflow vulnerability within
Tmxpflt.sys, as included with Trend Micro Inc.'s AntiVirus engine,
could allow an attacker to execute arbitrary code in kernel context.

This vulnerability specifically exists due to insecure permissions on
the "\\.\Tmfilter" DOS device interface. The permissions on this device
allow "Everyone" write access. This allows a locally logged-in user to
access functionality intended for privileged use only.

Additionally, the IOCTL handler of this DOS device interface for IOCTL
0xa0284403 does not validate the length of attacker-supplied content
when copying to a fixed-size buffer. As such, it is possible to execute
attacker-supplied code in the context of the kernel.

III. ANALYSIS

Exploitation allows an attacker to elevate their privileges by
overwriting arbitrary system memory or executing code within kernel
context. In order to exploit this vulnerability, an attacker would need
the ability to open a handle to the "\\.\Tmfilter" DOS device interface.

IV. DETECTION

iDefense Labs has confirmed the existence of this vulnerability in
following Trend Micro Products:

  Trend Micro's PC-Cillin Internet Security 2007
  Tmxpflt.sys version 8.320.1004 and 8.500.0.1002

All products using Trend Micro's scan engine such as Trend Micro
ServerProtect, Trend Micro OfficeScan are also suspected to be
vulnerable.

V. WORKAROUND

Removing write permissions for "Everyone" prevents unprivileged access
to the vulnerable code. iDefense confirmed that the virus scanning
engine was still able to detect viruses. Although no side effects were
witnessed during Lab tests, normal functionality may be disrupted.

VI. VENDOR RESPONSE

Trend Micro has addressed this vulnerability with the release of version
8.550-1001 of their scan engine. For more information, visit the
following URL.

http://esupport.trendmicro.com/support/viewxml.do?ContentID=1035793

VII. CVE INFORMATION

The Common Vulnerabilities and Exposures (CVE) project has assigned the
name CVE-2007-4277 to this issue. This is a candidate for inclusion in
the CVE list (http://cve.mitre.org/), which standardizes names for
security problems.

VIII. DISCLOSURE TIMELINE

08/06/2007  Initial vendor notification
08/06/2007  Initial vendor response
10/25/2007  Coordinated public disclosure

IX. CREDIT

This vulnerability was reported to iDefense by Rubén Santamarta of
reversemode.com.

Get paid for vulnerability research
http://labs.idefense.com/methodology/vulnerability/vcp.php

Free tools, research and upcoming events
http://labs.idefense.com/

X. LEGAL NOTICES

Copyright © 2007 iDefense, Inc.

Permission is granted for the redistribution of this alert
electronically. It may not be edited in any way without the express
written consent of iDefense. If you wish to reprint the whole or any
part of this alert in any other medium other than electronically,
please e-mail customerservice@...fense.com for permission.

Disclaimer: The information in the advisory is believed to be accurate
at the time of publishing based on currently available information. Use
of the information constitutes acceptance for use in an AS IS condition.
 There are no warranties with regard to this information. Neither the
author nor the publisher accepts any liability for any direct,
indirect, or consequential loss or damage arising from use of, or
reliance on, this information.
