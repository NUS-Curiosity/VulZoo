
Date: Thu, 23 Jun 2005 20:39:58 -0400
From: "iDEFENSE Labs" <labs-no-reply@...fense.com>
To: <bugtraq@...urityfocus.com>, <vulnwatch@...nwatch.org>,
	<full-disclosure@...ts.grok.org.uk>
Subject: iDEFENSE Security Advisory 06.23.05: RealNetworks
	RealPlayer RealText Parsing Heap Overflow Vulnerability


RealNetworks RealPlayer RealText Parsing Heap Overflow Vulnerability

iDEFENSE Security Advisory 06.23.05
www.idefense.com/application/poi/display?id=250&type=vulnerabilities
June 23, 2005

I. BACKGROUND

RealPlayer is an application for playing various media formats,
developed by RealNetworks Inc. For more information, visit
http://www.real.com/.

II. DESCRIPTION

Remote exploitation of a heap-based buffer overflow vulnerability in the

RealText file format parser within various versions of RealNetworks 
Inc.'s RealPlayer could allow attackers to execute arbitrary code.

The vulnerability specifically exists because of a string copying 
operating into a fixed size heap buffer using the sprintf function. The 
following function from /datatype/text/realtext/fileformat/rtffplin.cpp 
is the offending code:

STDMETHODIMP CRealTextFileFormat::ReadDone()
[...]
                 if (pErrorMessages)
                 {
                    const char* pFilename = "[rt file]";
                    if(m_pFileObject)
                    {
                         m_pFileObject->GetFilename(pFilename);
                    }
                    char* pTmp;
                    pTmp = new char[256];
                    sprintf(pTmp,  /* Flawfinder: ignore */

                     "Version in \"%s\" is not recognized installed"

                     " RealText file format",pFilename);
                    pErrorMessages->Report(HXLOG_ERR,
                                      HXR_INVALID_VERSION,
                                      0, (const char*) pTmp, NULL);
                    HX_RELEASE(pErrorMessages);
                    delete [] pTmp;
                 }
[...]

The variable pTmp points to 256 bytes of space on the heap. pFilename is

a string pointer that points to data supplied in the RealText stream. 
When the sprintf is executed, the data is copied into the 256 byte heap 
buffer without any length checking, thus allowing a heap overflow to 
occur. Once the heap is overflown, an attacker can eventually write to 
arbitrary locations in memory, allowing for the execution of arbitrary 
code.

III. ANALYSIS

Exploitation allows for arbitrary code execution as the user who opened 
the RealMedia file.

Exploitation requires an attacker to craft a malicious RealMedia file 
that uses RealText and convince a user to open it. An attacker could 
also force a web browser to refresh and automatically load the RealMedia

file from a normal web page under the attacker's control. In default 
installations of RealPlayer under Windows XP, Internet Explorer will not

prompt the user for an action when encountering most RealMedia files. It

will open the file without delay, thus providing an effective method of 
exploitation.

IV. DETECTION

iDEFENSE Labs has confirmed that RealNetworks' RealPlayer 10.5 
6.0.12.1056 on Windows and RealPlayer 10 and 10.0.1.436 on Linux are 
vulnerable. It is suspected that previous versions of RealPlayer are 
also vulnerable. It is also suspected that RealOne player is vulnerable.

V. WORKAROUND

Although there is no way to completely protect yourself from this
vulnerability, aside from removing the RealPlayer software, the
following actions may be taken to minimize risk for automated
exploitation.

Disable ActiveX controls and plugins, if not necessary for daily
operations, using the following steps: 

1. In IE, click on Tools and select Internet Options from the drop-down
   menu.
2. Click the Security tab and the Custom Level button.
3. Under ActiveX Controls and Plugins, then Run Activex Controls and
   Plugins, click the Disable radio button.

VI. VENDOR RESPONSE

The vendor has addressed this issue in the following security advisory:

   http://service.real.com/help/faq/security/050623_player/EN/

VII. CVE INFORMATION

The Common Vulnerabilities and Exposures (CVE) project has assigned the
name CAN-2005-1277 to this issue. This is a candidate for inclusion in
the CVE list (http://cve.mitre.org), which standardizes names for
security problems.

VIII. DISCLOSURE TIMELINE

04/26/2005  Initial vendor notification
04/26/2005  Initial vendor response
06/23/2005  Coordinated public disclosure

IX. CREDIT

The discoverer of this vulnerability wishes to remain anonymous.

Get paid for vulnerability research
http://www.idefense.com/poi/teams/vcp.jsp

Free tools, research and upcoming events
http://labs.idefense.com

X. LEGAL NOTICES

Copyright (c) 2005 iDEFENSE, Inc.

Permission is granted for the redistribution of this alert
electronically. It may not be edited in any way without the express
written consent of iDEFENSE. If you wish to reprint the whole or any
part of this alert in any other medium other than electronically, please
email customerservice@...fense.com for permission.

Disclaimer: The information in the advisory is believed to be accurate
at the time of publishing based on currently available information. Use
of the information constitutes acceptance for use in an AS IS condition.
There are no warranties with regard to this information. Neither the
author nor the publisher accepts any liability for any direct, indirect,
or consequential loss or damage arising from use of, or reliance on,
this information.
_______________________________________________
Full-Disclosure - We believe in it.
Charter: http://lists.grok.org.uk/full-disclosure-charter.html
Hosted and sponsored by Secunia - http://secunia.com/


