
Date: Thu, 30 Dec 2004 15:56:41 +0100
From: Albert Puigsech Galicia <ripe@...9ezine.org>
To: bugtraq@...urityfocus.com
Subject: 7a69Adv#17 - Internet Explorer FTP download path disclosure

<NOTE FOR BUGTRAQ MODERATOR>

Excuseme if you have recibed this mail reapeated, but I had some problems on 
my mail server some days ago, and I have sent this mail 3 or 4 times. 
Sorry :)

Delete this note to post to the list. Thank's you.

</NOTE FOR BUGTRAQ MODERATOR>


- ------------------------------------------------------------------
       7a69ezine Advisories                      7a69Adv#17
- ------------------------------------------------------------------
  http://www.7a69ezine.org                            [23/12/2004]
- ------------------------------------------------------------------

Title:        Internet Explorer FTP download path disclosure

Author:       Albert Puigsech Galicia - <ripe@...9ezine.org>

Software:     Microsoft Internet Explorer

Versions:     >= 6.0.3790.0

Remote:       yes

Exploit:      yes

Severity:     Medium-High

- ------------------------------------------------------------------



I. Introduction.

 Internet Explorer is a well-known HTTP browser, and like others it can use 
more protocols, for example FTP. The security historial of this navigator is 
really cool and we are glad for the excelent work done by Microsoft. We love 
your (in)security features.



II. Description.

 When you save a file from an FTP server to a local folder it is saved on 
'local_folder/file_name', consequently if the name of the file contains 
'../', the real destination of the file changes. Despite it is imposible to 
create a file with '../' characters an FTP server can reply a LIST request 
with this char on filenames, so a malicious FTP server can modify the folder 
where the downloaded file will be stored.

 Of the three possible ways of downloading a file only two are affected by 
this bug; the left-click and save-as procedure and dragging the file. The one 
that is unaffected is the double-click procedure.


 
III. Exploit

 You can use the very-tiny and malicious FTP server attached in this mail to 
check the vulnerability. It's easy to use './ftpd-iexpl localfile 
remotefile', where localfile is a file on the FTP server and localfile is the 
path where the will be stored on the attacked system. If you try to overwrite 
a file the Internet Explorer show a confirmation message, so is better for 
explotation purposes to create new files, but It's not a problem to execute 
arbitrari code because you can create, for example, startup files on 'C:
\Documents and settings\All Users\Start menu\Programs\Start' that will be 
executed after next user login.

 However Internet Explorer shows the complete name of the file, including the 
'../' characters so It's unlikely that it will not arise suspicions, but you 
can put the malicious file into a FTP folder and waiting for victim dragging 
the folder.



IV. Patch

 Don't use Internet Explorer and turn to Firefox world.


V. Timeline

06/12/2004  -  Bug discovered
23/12/2004  -  Advisor released
25/12/2004  -  Noel; uoh! ouh! ouh!


VI. Extra data

 You can find more 7a69ezine advisories on this following link:

    http://www.7a69ezine.org/avisos/propios [spanish info]

View attachment "ftpd-iexpl.c" of type "text/x-csrc" (3351 bytes)
