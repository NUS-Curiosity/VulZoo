
Date: 25 Jul 2005 20:30:41 -0000
From: kozan@...instructors.com
To: bugtraq@...urityfocus.com
Subject: Ares FileShare 1.1 'Long Searched String' Buffer Overflow
    Vulnerability


Ares FileShare 1.1 'Long Searched String' Buffer Overflow Vulnerability



I. BACKGROUND

Ares Fileshare is one of the most popular P2P application around the world. 
With Ares Fileshare you can connect to several established P2P-networks, 
which will yield more search results with less effort. One of the beauties 
with Ares Fileshare is that you don't have to share files in order to search 
and download, in other words -- you'll be started within seconds.

More information can be found at the following link:




II. DESCRIPTION

Remote and/or exploitation of a buffer overflow vulnerability in Ares FileShare
could allow execution of arbitrary code.

A specially crafted .conf file (ares.conf - configuration file of Ares FileShare)
containing long searched strings history information or entering a long string 
for Search can cause Ares FileShare to overwrite stack space.

No checks are made on the length of data being copied, When a string data is longer 
than 1065 bytes (1066 or longer), allowing the return address on the stack to be 
overwritten (in UNICODE).



III. ANALYSIS

Successful exploitation allows remote and/or local attackers to execute arbitrary
code in the context of the target user that opened the malicious configuration file
or entering specially crafted search data.

After this when user starts Ares FileShare program and selects this malicious
entry from Search Listbox, buffer overflow occurs.

An example malicious ares.conf file is that contains long searc history data:

history = AAAAA.....[ A x 1065 bytes (where the EIP starts in UNICODE) ]AA...\r\n

The data that is written onto the stack is in the form: 0x00410041

41s in hexadecimal = 'A's are controlled by the input. While this
tends to make exploitation more difficult, it does not prevent it, as it
may be possible for an attacker to cause controlled data to be put into
a memory location matching the required format.



IV. DETECTION

Ares FileShare 1.1 is vulnerable. Earlier versions strongly might be 
vulnerable to this issue.



V. WORKAROUND

User awareness is the best method of defense against this class of
attack. Users must be wary when opening files from untrusted sources.

When possible, run client software, as regular user accounts with
limited access to system resources. This may limit the immediate
consequences of client-side vulnerabilities.



Discovered by Kozan
Credits to ATmaCA
Web: www.spyinstructors.com
Mail: kozan@...instructors.com


