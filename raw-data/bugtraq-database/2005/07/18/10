
Date: Mon, 18 Jul 2005 09:36:19 -0700
From: Security Alert <secure@...hs.cup.hp.com>
To: bugtraq@...urityfocus.com
Subject: HPSBTU01210 SSRT4743, SSRT4884 rev.0 - HP Tru64 UNIX TCP/IP remote Denial of Service (DoS)


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

HP SECURITY BULLETIN

HPSBTU01210     REVISION: 0

SSRT4743, SSRT4884 rev.0 - HP Tru64 UNIX TCP/IP remote Denial of
                           Service (DoS)

NOTICE:
There are no restrictions for distribution of this Security
Bulletin provided that it remains complete and intact.

The information in this Security Bulletin should be acted upon
as soon as possible.

INITIAL RELEASE:
15 July 2005

POTENTIAL SECURITY IMPACT:
Remote Denial of Service (DoS)

SOURCE:
Hewlett-Packard Company
HP Software Security Response Team

VULNERABILITY SUMMARY:
Several potential security vulnerabilities have been identified
in the HP Tru64 UNIX TCP/IP including ICMP, and Initial Sequence
Number generation (ISNs). These exploits could result in a remote
Denial of Service (DoS) from network throughput reduction for
TCP connections, the reset of TCP connections, or TCP spoofing.

REFERENCES:
CERT CA-2001-09, NISCC Vulnerability Advisory VU#498440 VU#532967,
CAN-2004-0790 CAN-2004-0791 CAN-2004-1060 CAN-2001-0328

SUPPORTED SOFTWARE VERSIONS*:  ONLY impacted versions are listed.
HP Tru64 UNIX 5.1B-3
HP Tru64 UNIX 5.1B-2/PK4
HP Tru64 UNIX 5.1A PK
HP Tru64 UNIX 4.0G PK4
HP Tru64 UNIX 4.0F PK8

BACKGROUND:

Special Instructions for the Customer

The Internet Control Message Protocol (ICMP) (RFC 792) is used in
the Internet Architecture to perform fault-isolation and recovery
(RFC816), which is the group of actions that hosts and routers
take to determine if a network failure has occurred.

The industry standard TCP specification (RFC 793) has a
vulnerability whereby ICMP packets can be used to perform a
variety of attacks such as blind connection reset attacks and
blind throughput-reduction attacks. Blind connection reset
attacks can be triggered by an attacker sending forged ICMP
"Destination Unreachable, host unreachable" packets or ICMP
"Destination Unreachable, port unreachable" packets.  Blind
throughput-reduction attacks can be caused by an attacker sending
a forged ICMP type 4 (Source Quench) packet.

Path MTU Discovery (RFC 1191) describes a technique for
dynamically discovering the MTU (maximum transmission unit) of an
arbitrary internet path.  This protocol uses ICMP packets from
the router to discover the MTU for a TCP connection path.  An
attacker can reduce the throughput of a TCP connection by sending
forged ICMP packets (or their IPv6 counterpart) to the
discovering host, causing an incorrect Path MTU setting.

HP has addressed these potential vulnerabilities by providing a
new kernel tunable in Tru64 UNIX V5.1B and 5.1A,
icmp_tcpseqcheck. In Tru64 4.0F and 4.0G, HP has introduced two
new kernel tunables, icmp_tcpseqcheck and icmp_rejectcodemask.
The icmp_rejectcodemask tunable is already available in Tru64
UNIX V5.1B and 5.1A.

icmp_tcpseqcheck

The icmp_tcpseqcheck variable mitigates ICMP attacks against TCP
by checking that the TCP sequence number contained in the payload
of the ICMP error message is within the range of the data already
sent but not yet acknowledged. An ICMP error message that does
not pass this check is discarded. This behavior protects TCP
against spoofed ICMP packets.

Set the tunable as follows:

  icmp_tcpseqcheck=1 (default)

    Provides a level of protection that reduces the possibility
    of considering a spoofed ICMP packet as valid
    to one in two raised to the thirty-second power.

  icmp_tcpseqcheck=0

    Retains existing behavior, i.e., accepts all ICMP packets

icmp_rejectcodemask

In the Requirements for IP Version 4 Routers (RFC 1812), research
suggests that the use of ICMP Source Quench packets is an
ineffective (and unfair) antidote for congestion. Thus, HP
recommends completely ignoring ICMP Source Quench packets using
the icmp_rejectcodemask tunable. The icmp_rejectcodemask is a
bitmask that designates the ICMP codes that the system should
reject. For example, to reject ICMP Source Quench packets,
set the mask bit position for the ICMP_SOURCEQUENCH code 4,
which is two to the 4th power = 16 (0x10 hex).
The icmp_rejectcodemask tunable can be used to reject any
ICMP packet type, or multiple masks can be combined to reject
more than one type.

Note: the ICMP type codes are defined in
      "/usr/include/netinet/ip_icmp.h".

  Set the tunable as follows:

    icmp_rejectcodemask = 0x10

      Rejects ICMP Source Quench packets

    icmp_rejectcodemask = 0 (default)

      Retains existing behavior, i.e., accepts all ICMP packets

Adjusting the variables

The ICMP sequence check variable (icmp_tcpseqcheck) can be
adjusted using the sysconfig and sysconfigdb commands:

# sysconfig -q inet icmp_tcpseqcheck
inet:
icmp_tcpseqcheck = 1
# sysconfig -r inet icmp_tcpseqcheck=0
icmp_tcpseqcheck: reconfigured
# sysconfig -q inet icmp_tcpseqcheck
inet:
icmp_tcpseqcheck = 0
# sysconfig -q inet icmp_tcpseqcheck > /tmp/icmp_tcpseqcheck_merge
# sysconfigdb -m -f /tmp/icmp_tcpseqcheck_merge inet
# sysconfigdb -l inet

inet:
      icmp_tcpseqcheck = 1

Similarly, the icmp_rejectcodemask variable can be adjusted using
the sysconfig and sysconfigdb commands:

# sysconfig -q inet icmp_rejectcodemask
inet:
icmp_rejectcodemask = 0
# sysconfig -r inet icmp_rejectcodemask=0x10
icmp_rejectcodemask: reconfigured
# sysconfig -q inet icmp_rejectcodemask
inet:
icmp_rejectcodemask = 16
# sysconfig -q inet icmp_rejectcodemask
   > /tmp/icmp_rejectcodemask_merge
# sysconfigdb -m -f /tmp/icmp_rejectcodemask_merge inet
# sysconfigdb -l inet

inet:
        icmp_rejectcodemask = 16

RESOLUTION:

Until the corrections are available in a mainstream
release patch kit, HP is releasing the following Early Release
Patch (ERP) kits publicly for use by any customer.

The ERP kits use dupatch to install and will not install over
any installed Customer Specific Patches (CSPs) that have file
intersections with the ERPs. Contact your service provider for
assistance if the ERP installation is blocked by any of your
installed CSPs.

The fixes contained in the ERP kits are scheduled to be
available in the following mainstream patch kits:

    HP Tru64 Unix 5.1B-4

Early Release Patches

The ERPs deliver the following file:

/sys/BINARY/inet.mod

HP Tru64 UNIX 5.1B-3 ERP Kit Name:
   T64KIT0025925-V51BB26-ES-20050628
Kit Location:
  http://www.itrc.hp.com/service/patch/patchDetail.do?
  patchid=T64KIT0025925-V51BB26-ES-20050628
MD5 checksum: 129251787a426320af16cd584b982027

HP Tru64 UNIX 5.1B-2/PK4 ERP Kit Name:
  T64KIT0025924-V51BB25-ES-20050628
Kit Location:
  http://www.itrc.hp.com/service/patch/patchDetail.do?
  patchid=T64KIT0025924-V51BB25-ES-20050628
MD5 checksum: 5fcc77a6876db6d10ef07ac96e11b3af

HP Tru64 UNIX 5.1A PK6 ERP Kit Name:
  T64KIT0025922-V51AB24-ES-20050628
Kit Location:
  http://www.itrc.hp.com/service/patch/patchDetail.do?
  patchid=T64KIT0025922-V51AB24-ES-20050628
MD5 checksum: 7c373b35c95945651a1cfda96bf71421

HP Tru64 UNIX 4.0G PK4 ERP Kit Name:
  T64KIT0025920-V40GB22-ES-20050628
Kit Location:
  http://www.itrc.hp.com/service/patch/patchDetail.do?
  patchid=T64KIT0025920-V40GB22-ES-20050628
MD5 checksum: 13849fd555239d75d300d1cb46dc995f

HP Tru64 UNIX 4.0F PK8 ERP Kit Name:
  DUXKIT0025921-V40FB22-ES-20050628
Kit Location:
  http://www.itrc.hp.com/service/patch/patchDetail.do?
  patchid=T64KIT0025920-V40GB22-ES-20050628
MD5 checksum: 743b614d39f185802701b7f2dd14ffa5

MD5 checksums are available from the ITRC patch database main
page:
   http://www.itrc.hp.com/service/patch/mainPage.do
- From the patch database main page, click Tru64 UNIX,
then click verifying MD5 checksums under useful links.

General ITRC Patch Page:
http://www.itrc.hp.com/service/patch/mainPage



SUPPORT: For further information, contact normal HP Services
support channel.

REPORT: To report a potential security vulnerability with any HP
supported product, send Email to: security-alert@...com. It is
strongly recommended that security related information being
communicated to HP be encrypted using PGP, especially exploit
information. To obtain the security-alert PGP key please send an
e-mail message to security-alert@...com with the Subject of
'get key' (no quotes).

SUBSCRIBE: To initiate a subscription to receive future HP
Security Bulletins via Email:

http://h30046.www3.hp.com/driverAlertProfile.php?regioncode=NA&
langcode=USENG&jumpid=in_SC-GEN__driverITRC&topiccode=ITRC

On the web page: ITRC security bulletins and patch sign-up
Under Step1: your IRTC security bulletins and patches
     - check ALL categories for which alerts are required and
       continue.
Under Step2: your IRTC operating systems
     - verify your operating system selections are checked and
       save.

To update an existing subscription:
http://h30046.www3.hp.com/subSignIn.php

Log in on the web page
  Subscriber's choice for Business: sign-in.
On the Web page:
 Subscriber's Choice: your profile summary
   - use Edit Profile to update appropriate sections.

To review previously published Security Bulletins visit:
http://itrc.hp.com/service/cki/secBullArchive.do

* The Software Product Category that this Security Bulletin
  relates to is represented by the 5th and 6th characters of the
  Bulletin number:
    GN = HP General SW,
    MA = HP Management Agents,
    MI = Misc. 3rd party SW,
    MP = HP MPE/iX,
    NS = HP NonStop Servers,
    OV = HP OpenVMS,
    PI = HP Printing & Imaging,
    ST = HP Storage SW,
    TL = HP Trusted Linux,
    TU = HP Tru64 UNIX,
    UX = HP-UX,
    VV = HP Virtual Vault

System management and security procedures must be reviewed
frequently to maintain system integrity. HP is continually
reviewing and enhancing the security features of software products
to provide customers with current secure solutions.

"HP is broadly distributing this Security Bulletin in order to
bring to the attention of users of the affected HP products the
important security information contained in this Bulletin. HP
recommends that all users determine the applicability of this
information to their individual situations and take appropriate
action. HP does not warrant that this information is necessarily
accurate or complete for all user situations and, consequently, HP
will not be responsible for any damages resulting from user's use
or disregard of the information provided in this Bulletin. To the
extent permitted by law, HP disclaims all warranties, either
express or implied, including the warranties of merchantability
and fitness for a particular purpose, title and non-infringement."


(c)Copyright 2005 Hewlett-Packard Development Company, L.P.
Hewlett-Packard Company shall not be liable for technical or
editorial errors or omissions contained herein. The information
provided is provided "as is" without warranty of any kind. To the
extent permitted by law, neither HP nor its affiliates,
subcontractors or suppliers will be liable for incidental, special
or consequential damages including downtime cost; lost profits;
damages relating to the procurement of substitute products or
services; or damages for loss of data, or software restoration.
The information in this document is subject to change without
notice. Hewlett-Packard Company and the names of Hewlett-Packard
products referenced herein are trademarks of Hewlett-Packard
Company in the United States and other countries. Other product
and company names mentioned herein may be trademarks of their
respective owners.

-----BEGIN PGP SIGNATURE-----
Version: PGP 8.1

iQA/AwUBQtuSLuAfOvwtKn1ZEQJXrwCgpDVfLyXvXZd3sF6bswgQ3DLz5jcAoNt2
As7Gf9BY697IdlYjIlmrirG1
=143G
-----END PGP SIGNATURE-----



