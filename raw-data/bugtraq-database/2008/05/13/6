
Date: Mon, 12 May 2008 18:39:32 -0400
From: iDefense Labs <labs-no-reply@...fense.com>
To: vulnwatch@...nwatch.org, full-disclosure@...ts.grok.org.uk,
	bugtraq@...urityfocus.com
Subject: iDefense Security Advisory 05.12.08: Microsoft Windows I2O Filter
 Utility Driver (i2omgmt.sys) Local Privilege Escalation Vulnerability

iDefense Security Advisory 05.12.08
http://labs.idefense.com/intelligence/vulnerabilities/
May 12, 2008

I. BACKGROUND

Intelligent Input/Output (I2O) is a defunct computer input/output (I/O)
specification. i2omgmt.sys is a Windows driver for the I2O Utility
Filter. For more background information about I2O, see following
website.

http://en.wikipedia.org/wiki/I2O

II. DESCRIPTION

Local exploitation of an input validation vulnerability within version
5.1.2600.2180 of i2omgmt.sys, as included with Microsoft Corp's Windows
XP operating system, could allow an attacker to execute arbitrary code
in the context of the kernel.

This vulnerability specifically exists due to insecure permissions on
the \\.\I2OExc device interface. The permissions on this device allow
"Everyone" write access. This could allow a locally logged-in user to
access functionality designed for privileged use only.

Additionally, the IOCTL handlers for this device interface do not
properly validate user-mode buffer passed to them, so an attacker can
supply a fake DeviceObject pointer to a user-mode address. As such, it
is possible to overwrite arbitrary memory or execute attacker-supplied
code in the context of the kernel.

III. ANALYSIS

Exploitation allows an attacker to elevate privileges by overwriting
arbitrary system memory or executing code within kernel context. An
attacker needs to log-in to the target machine to exploit this
vulnerability.

This driver is related to I2O protocol and RAID devices. It is not
present by default on every Windows installation. However, iDefense
found this driver loaded on several systems we tested.

IV. DETECTION

iDefense has confirmed the existence of this vulnerability in
i2omgmt.sys version 5.1.2600.2180 as installed on some Windows XP SP2
systems. All other Windows releases with this driver, including
previous versions, are suspected to be vulnerable.

V. WORKAROUND

Removing write permissions for "Everyone" appears to prevent access to
the vulnerable code. Although no side effects were witnessed in lab
tests, normal functionality may be hindered.

VI. VENDOR RESPONSE

Microsoft has addressed this issue within Windows XP Service Pack 3. To
obtain Microsoft XP Service Pack 3, visit the following URL.

http://www.microsoft.com/downloads/details.aspx?FamilyID=5b33b5a8-5e76-401f-be08-1e1555d4f3d4

VII. CVE INFORMATION

The Common Vulnerabilities and Exposures (CVE) project has assigned the
name CVE-2008-0322 to this issue. This is a candidate for inclusion in
the CVE list (http://cve.mitre.org/), which standardizes names for
security problems.

VIII. DISCLOSURE TIMELINE

03/20/2007  Initial vendor notification
03/20/2007  Initial vendor response
05/12/2008  Coordinated public disclosure

IX. CREDIT

This vulnerability was reported to iDefense by Rubén Santamarta of
reversemode.com.

Get paid for vulnerability research
http://labs.idefense.com/methodology/vulnerability/vcp.php

Free tools, research and upcoming events
http://labs.idefense.com/

X. LEGAL NOTICES

Copyright © 2008 iDefense, Inc.

Permission is granted for the redistribution of this alert
electronically. It may not be edited in any way without the express
written consent of iDefense. If you wish to reprint the whole or any
part of this alert in any other medium other than electronically,
please e-mail customerservice@...fense.com for permission.

Disclaimer: The information in the advisory is believed to be accurate
at the time of publishing based on currently available information. Use
of the information constitutes acceptance for use in an AS IS condition.
 There are no warranties with regard to this information. Neither the
author nor the publisher accepts any liability for any direct,
indirect, or consequential loss or damage arising from use of, or
reliance on, this information.
