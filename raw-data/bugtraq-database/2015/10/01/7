
Date: Thu, 1 Oct 2015 08:55:42 GMT
From: matthias.deeg@...s.de
To: bugtraq@...urityfocus.com
Subject: [SYSS-2015-004] Kaspersky Small Office Security - Use of One-Way
 Hash withouth a Salt

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

Advisory ID: SYSS-2015-004
Product: Kaspersky Small Office Security (KSOS)
Vendor: Kaspersky Lab ZAO
Affected Version(s): 13.0.4.233
Tested Version(s): 13.0.4.233
Vulnerability Type: Use of a One-Way Hash without a Salt (CWE-759)
Risk Level: Low
Solution Status: Fixed
Vendor Notification: 2015-02-19
Solution Date: 2015-10-01
Public Disclosure: 2015-10-01
CVE Reference: Not yet assigned
Authors of Advisory: Matthias Deeg and Sven Freund (SySS GmbH)

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Overview:

Kaspersky Small Office Security is an endpoint protection software
with many features like malware protection, defences against phishing
attacks and exploits, data encryption and data backup functionality.

The vendor Kaspersky describes the product as follows (see [1]):

"Kaspersky Small Office Security delivers business-grade protection 
technologies that are designed to be simple to install, configure and
run. The solution protects your Windows-based PCs & file servers and 
Android smartphones and tablets to safeguard your online banking
transactions, your business data and the information your customers
entrust to you."

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Vulnerability Details:

The SySS GmbH found out that the administrator password for protecting
different functions of the Kaspersky Small Office Security software,
like managing backups or stopping protection services, is stored as
raw, unsalted MD5 hash value in the Windows registry.

The used registry value

"HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\KasperskyLab\protected\KSOS13\settings\OPEP"

is by default readable by every user.

The use of the cryptographic one-way hash function MD5 without using a 
salt for storing sensitive data like admin passwords allows an attacker
with access to this data to perform efficient password guessing attacks
using pre-computed dictionaries, for instance rainbow tables.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Proof of Concept (PoC):

The configured admin password is stored as raw, unsalted MD5 hash value
of the UTF-16 (wide char) string representation of the set password.

For instance, it can be read using the following command:

C:\Users\SySS>reg query HKLM\SOFTWARE\Wow6432Node\KasperskyLab\protected\KSOS13\settings /v OPEP

HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\KasperskyLab\protected\KSOS13\settings
    OPEP    REG_SZ    CFB37E7C04BEA837D23005199B1CD62B


The read string in this example is a raw, unsalted MD5 hash value of the
UTF-16 string "syss", as the following output illustrates:

$ echo -en "s\x00y\x00s\x00s\x00" | md5sum
cfb37e7c04bea837d23005199b1cd62b  -

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Solution:

According to information by Kaspersky, the described security issue has
been fixed in newer software releases.

Please contact the manufacturer for further information or support.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Disclosure Timeline:

2015-02-19: Vulnerability reported to manufacturer
2015-02-19: Manufacturer acknowledges e-mail with SySS security advisory          
2015-03-17: Rescheduling of the publication date in agreement with the
            manufacturer
2015-04-14: Rescheduling of the publication date in agreement with the
            manufacturer
2015-09-28: SySS asks for further information about software fix
2015-10-01: Public release of security advisory on agreed publication
            date
 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

References:

[1] Product Web site for Kaspersky Small Office Security
    http://www.kaspersky.com/small-office-security
[2] SySS Security Advisory SYSS-2015-004
    https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2015-004.txt
[3] SySS Responsible Disclosure Policy
    https://www.syss.de/en/news/responsible-disclosure-policy/

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Credits:

This security vulnerability was found by Matthias Deeg and Sven Freund
of the SySS GmbH.

E-Mail: matthias.deeg (at) syss.de
Public Key: https://www.syss.de/fileadmin/dokumente/Materialien/PGPKeys/Matthias_Deeg.asc
Key fingerprint = D1F0 A035 F06C E675 CDB9 0514 D9A4 BF6A 34AD 4DAB

E-Mail: sven.freund (at) syss.de
Public Key: https://www.syss.de/fileadmin/dokumente/Materialien/PGPKeys/Sven_Freund.asc
Key fingerprint = DCDB 7627 C1E3 9CE8 62DF 2666 8A5F A853 415D 46DC

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Disclaimer:

The information provided in this security advisory is provided "as is" 
and without warranty of any kind. Details of this security advisory may 
be updated in order to provide as accurate information as possible. The
latest version of this security advisory is available on the SySS Web 
site.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Copyright:

Creative Commons - Attribution (by) - Version 3.0
URL: http://creativecommons.org/licenses/by/3.0/deed.en

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2

iQIcBAEBCgAGBQJWDPBuAAoJENmkv2o0rU2rRFIP+weEAxWDmXzKGBMTXH7ROkrV
a+Y9kAs+1g3fHIddnjEF4kjnWLa9UB+kxiymR/FLykFNjcMNpAR9ySl3werpd/sF
kGTCXSYruivppd+/cBWyJ5cpB1W92qHBeYvh/g3aDE+ha9eXnDegAcXPQI9CSc7d
QmlCa4yLO1xZjsb9ZCne+GtCvZ1AHxsLvEJtbKqAIMYJlLx2x9ZuISrEg4H8yxwH
ezcn0ZuN8nVCFXqYzZI/esyJgTbE0aI+seEZu2NZZE74h4fqHdiLP2AQP6S2lhW9
FTo366G79sICsyXO3r60USnUCpporCHxY5w5zZJSZSQ/CK1H7xn8zAsrsXeqcqqC
OR0hf2hD+ulFTsIi7EHCPPG0kQ9MbxJf52GYhYZAQxvsu6s5B3WrdA8uxeZuzDFg
aNFwnz6Hb3dafrNGZX1LB8mS6I2JKcQ6iIjRi6AbdxWI1hYdpFT/+2fS1O8ZoSI4
6JCyMgDYEM7WBtHJ5kPi/GJfvKoaB/+kInesX3gq4mGhk0ZlSXKLdWZQAwMtLfI0
jCmTX/I9PFereKO541xuOwwFZ9V+goYnZNVtmNv77XzoTSAP5L6T6TPf1t++gjIB
WW1SGwjJ2pKLc0vwppCva9SC4dtEk8GPQDhi35j62Xz/4uPQx/7Ab8E6ysCcUEIw
MUduyOUfUhdpn9UFpnwf
=WSQd
-----END PGP SIGNATURE-----
