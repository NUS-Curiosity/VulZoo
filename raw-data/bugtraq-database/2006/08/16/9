
Date: 16 Aug 2006 16:56:03 -0000
From: pedantic1@...il.com
To: bugtraq@...urityfocus.com
Subject: MS Terminal Server application session breakout

Author: Bill Littlejohn
http://wklpc.blogspot.com/2006/08/easy-ms-terminal-server-desktop-hack.html

There is a vulnerability in Microsoft Terminal Server when an application is specified for the user instead of a full Windows Desktop. It is possible to easily cause an error in explorer.exe and to gain access to a full Desktop.
This is an issue for anyone publishing applications through TS to domain users who also logon to full desktops either on the TS or on another machine.

Tested on:
Windows 2000 server SP4 TS in an NT4 domain
Windows 2003 server SP2 TS in 2003 server AD domain

Microsoft has confirmed this to be a feature and has said they will not be fixing it.
The workaround given is to apply the steps in the TS lockdown article at http://support.microsoft.com/default.aspx?scid=kb;en-us;278295

Note that this workaround can only be applied to a TS in a full Active Directory domain.

Simple test: (Note that there are other ways to exploit this)
1. Set your user to run notepad.exe when logging onto the Terminal Server.
2. Logon to TS as that user. Marvel at notepad.exe.
3. Press [ctlr]+O to open file.
4. Right-click on some folder and choose "Explore".
5. Notice the neat error message, taskbar, and Desktop that's now available.
