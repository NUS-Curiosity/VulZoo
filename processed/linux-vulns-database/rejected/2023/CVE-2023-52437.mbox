From bippy-03f60121d1f8 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>
Subject: CVE-2023-52437: Revert "md/raid5: Wait for MD_SB_CHANGE_PENDING in raid5d"
Message-Id: <2024022009-subsoil-halt-4b28@gregkh>
Content-Length: 3230
Lines: 75
X-Developer-Signature: v=1; a=openpgp-sha256; l=3306;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=2OvkIRA/2AHv1IUtGNVX4MOsDe6oHwvtBA+M3Jpb9TI=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDKlXPiy8yii76oN1pZJS2EwWB+VSmzeL2X5Xf/bz5EkJk
 Lf9X8jYEcvCIMjEICumyPJlG8/R/RWHFL0MbU/DzGFlAhnCwMUpABO5/4Rhntp02Sqejdf2ZHx7
 VSdkF74vyU/cmmGenr5QmXfNWU2XI3Jc6db/HDeyTbkKAA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

Revert "md/raid5: Wait for MD_SB_CHANGE_PENDING in raid5d"

This reverts commit 5e2cf333b7bd5d3e62595a44d598a254c697cd74.

That commit introduced the following race and can cause system hung.

 md_write_start:             raid5d:
 // mddev->in_sync == 1
 set "MD_SB_CHANGE_PENDING"
                            // running before md_write_start wakeup it
                             waiting "MD_SB_CHANGE_PENDING" cleared
                             >>>>>>>>> hung
 wakeup mddev->thread
 ...
 waiting "MD_SB_CHANGE_PENDING" cleared
 >>>> hung, raid5d should clear this flag
 but get hung by same flag.

The issue reverted commit fixing is fixed by last patch in a new way.

The Linux kernel CVE team has assigned CVE-2023-52437 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.15.75 with commit 9e86dffd0b02 and fixed in 5.15.148 with commit 84c39986fe6d
	Issue introduced in 6.1 with commit 5e2cf333b7bd and fixed in 6.1.74 with commit bed0acf330b2
	Issue introduced in 6.1 with commit 5e2cf333b7bd and fixed in 6.1.75 with commit cfa468382858
	Issue introduced in 6.1 with commit 5e2cf333b7bd and fixed in 6.6.13 with commit e16a0bbdb7e5
	Issue introduced in 6.1 with commit 5e2cf333b7bd and fixed in 6.6.14 with commit aab69ef76970
	Issue introduced in 6.1 with commit 5e2cf333b7bd and fixed in 6.7.1 with commit 0de40f76d567
	Issue introduced in 6.1 with commit 5e2cf333b7bd and fixed in 6.7.2 with commit 87165c64fe1a
	Issue introduced in 6.1 with commit 5e2cf333b7bd and fixed in 6.8-rc1 with commit bed9e27baf52

Please see https://www.kernel.org or a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-52437
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/md/raid5.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/84c39986fe6dd77aa15f08712339f5d4eb7dbe27
	https://git.kernel.org/stable/c/bed0acf330b2c50c688f6d9cfbcac2aa57a8e613
	https://git.kernel.org/stable/c/cfa46838285814c3a27faacf7357f0a65bb5d152
	https://git.kernel.org/stable/c/e16a0bbdb7e590a6607b0d82915add738c03c069
	https://git.kernel.org/stable/c/aab69ef769707ad987ff905d79e0bd6591812580
	https://git.kernel.org/stable/c/0de40f76d567133b871cd6ad46bb87afbce46983
	https://git.kernel.org/stable/c/87165c64fe1a98bbab7280c58df3c83be2c98478
	https://git.kernel.org/stable/c/bed9e27baf52a09b7ba2a3714f1e24e17ced386d
