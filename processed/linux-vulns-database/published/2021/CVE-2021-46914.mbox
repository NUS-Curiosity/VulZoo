From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2021-46914: ixgbe: fix unbalanced device enable/disable in suspend/resume

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ixgbe: fix unbalanced device enable/disable in suspend/resume

pci_disable_device() called in __ixgbe_shutdown() decreases
dev->enable_cnt by 1. pci_enable_device_mem() which increases
dev->enable_cnt by 1, was removed from ixgbe_resume() in commit
6f82b2558735 ("ixgbe: use generic power management"). This caused
unbalanced increase/decrease. So add pci_enable_device_mem() back.

Fix the following call trace.

  ixgbe 0000:17:00.1: disabling already-disabled device
  Call Trace:
   __ixgbe_shutdown+0x10a/0x1e0 [ixgbe]
   ixgbe_suspend+0x32/0x70 [ixgbe]
   pci_pm_suspend+0x87/0x160
   ? pci_pm_freeze+0xd0/0xd0
   dpm_run_callback+0x42/0x170
   __device_suspend+0x114/0x460
   async_suspend+0x1f/0xa0
   async_run_entry_fn+0x3c/0xf0
   process_one_work+0x1dd/0x410
   worker_thread+0x34/0x3f0
   ? cancel_delayed_work+0x90/0x90
   kthread+0x14c/0x170
   ? kthread_park+0x90/0x90
   ret_from_fork+0x1f/0x30

The Linux kernel CVE team has assigned CVE-2021-46914 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.9 with commit 6f82b25587354ce7c9c42e0b53d8b0770b900847 and fixed in 5.10.32 with commit be07581aacae7cd0a073afae8e8862032f794309
	Issue introduced in 5.9 with commit 6f82b25587354ce7c9c42e0b53d8b0770b900847 and fixed in 5.11.16 with commit f1b4be4a753caa4056496f679d70550d0c11a264
	Issue introduced in 5.9 with commit 6f82b25587354ce7c9c42e0b53d8b0770b900847 and fixed in 5.12 with commit debb9df311582c83fe369baa35fa4b92e8a9c58a

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2021-46914
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/ethernet/intel/ixgbe/ixgbe_main.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/be07581aacae7cd0a073afae8e8862032f794309
	https://git.kernel.org/stable/c/f1b4be4a753caa4056496f679d70550d0c11a264
	https://git.kernel.org/stable/c/debb9df311582c83fe369baa35fa4b92e8a9c58a
