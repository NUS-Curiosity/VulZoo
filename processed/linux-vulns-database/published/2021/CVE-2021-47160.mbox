From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2021-47160: net: dsa: mt7530: fix VLAN traffic leaks

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

net: dsa: mt7530: fix VLAN traffic leaks

PCR_MATRIX field was set to all 1's when VLAN filtering is enabled, but
was not reset when it is disabled, which may cause traffic leaks:

	ip link add br0 type bridge vlan_filtering 1
	ip link add br1 type bridge vlan_filtering 1
	ip link set swp0 master br0
	ip link set swp1 master br1
	ip link set br0 type bridge vlan_filtering 0
	ip link set br1 type bridge vlan_filtering 0
	# traffic in br0 and br1 will start leaking to each other

As port_bridge_{add,del} have set up PCR_MATRIX properly, remove the
PCR_MATRIX write from mt7530_port_set_vlan_aware.

The Linux kernel CVE team has assigned CVE-2021-47160 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.16 with commit 83163f7dca5684816d01c8ccf4857aa74801e7b7 and fixed in 4.19.193 with commit ae389812733b1b1e8e07fcc238e41db166b5c78d
	Issue introduced in 4.16 with commit 83163f7dca5684816d01c8ccf4857aa74801e7b7 and fixed in 5.4.124 with commit 4fe4e1f48ba119bdbc7c897c83b04ba0d08f5488
	Issue introduced in 4.16 with commit 83163f7dca5684816d01c8ccf4857aa74801e7b7 and fixed in 5.10.42 with commit b91117b66fe875723a4e79ec6263526fffdb44d2
	Issue introduced in 4.16 with commit 83163f7dca5684816d01c8ccf4857aa74801e7b7 and fixed in 5.12.9 with commit 82ae35b6c14feae5f216913d5b433e143c756d4e
	Issue introduced in 4.16 with commit 83163f7dca5684816d01c8ccf4857aa74801e7b7 and fixed in 5.13 with commit 474a2ddaa192777522a7499784f1d60691cd831a

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2021-47160
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/dsa/mt7530.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/ae389812733b1b1e8e07fcc238e41db166b5c78d
	https://git.kernel.org/stable/c/4fe4e1f48ba119bdbc7c897c83b04ba0d08f5488
	https://git.kernel.org/stable/c/b91117b66fe875723a4e79ec6263526fffdb44d2
	https://git.kernel.org/stable/c/82ae35b6c14feae5f216913d5b433e143c756d4e
	https://git.kernel.org/stable/c/474a2ddaa192777522a7499784f1d60691cd831a
