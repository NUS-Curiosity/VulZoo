From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2021-47651: soc: qcom: rpmpd: Check for null return of devm_kcalloc

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

soc: qcom: rpmpd: Check for null return of devm_kcalloc

Because of the possible failure of the allocation, data->domains might
be NULL pointer and will cause the dereference of the NULL pointer
later.
Therefore, it might be better to check it and directly return -ENOMEM
without releasing data manually if fails, because the comment of the
devm_kmalloc() says "Memory allocated with this function is
automatically freed on driver detach.".

The Linux kernel CVE team has assigned CVE-2021-47651 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.1 with commit bbe3a66c3f5a65fb3d702351bac2a6033944d389 and fixed in 5.4.189 with commit 755dbc3d73789ac9f0017c729abf5e4b153bf799
	Issue introduced in 5.1 with commit bbe3a66c3f5a65fb3d702351bac2a6033944d389 and fixed in 5.10.110 with commit b5d6eba71997b6d661935d2b15094ac7f9f6132d
	Issue introduced in 5.1 with commit bbe3a66c3f5a65fb3d702351bac2a6033944d389 and fixed in 5.15.33 with commit 724376c30af5a57686b223dbcd6188e07d2a1de2
	Issue introduced in 5.1 with commit bbe3a66c3f5a65fb3d702351bac2a6033944d389 and fixed in 5.16.19 with commit 84b89fa877ad576e9ee8130f412cfd592f274508
	Issue introduced in 5.1 with commit bbe3a66c3f5a65fb3d702351bac2a6033944d389 and fixed in 5.17.2 with commit 31b5124d742969ea8bf7a1360596f548ca23e770
	Issue introduced in 5.1 with commit bbe3a66c3f5a65fb3d702351bac2a6033944d389 and fixed in 5.18 with commit 5a811126d38f9767a20cc271b34db7c8efc5a46c

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2021-47651
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/soc/qcom/rpmpd.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/755dbc3d73789ac9f0017c729abf5e4b153bf799
	https://git.kernel.org/stable/c/b5d6eba71997b6d661935d2b15094ac7f9f6132d
	https://git.kernel.org/stable/c/724376c30af5a57686b223dbcd6188e07d2a1de2
	https://git.kernel.org/stable/c/84b89fa877ad576e9ee8130f412cfd592f274508
	https://git.kernel.org/stable/c/31b5124d742969ea8bf7a1360596f548ca23e770
	https://git.kernel.org/stable/c/5a811126d38f9767a20cc271b34db7c8efc5a46c
