From bippy-851b3ed3d212 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2021-47006: ARM: 9064/1: hw_breakpoint: Do not directly check the event's overflow_handler hook

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ARM: 9064/1: hw_breakpoint: Do not directly check the event's overflow_handler hook

The commit 1879445dfa7b ("perf/core: Set event's default
::overflow_handler()") set a default event->overflow_handler in
perf_event_alloc(), and replace the check event->overflow_handler with
is_default_overflow_handler(), but one is missing.

Currently, the bp->overflow_handler can not be NULL. As a result,
enable_single_step() is always not invoked.

Comments from Zhen Lei:

 https://patchwork.kernel.org/project/linux-arm-kernel/patch/20210207105934.2001-1-thunder.leizhen@huawei.com/

The Linux kernel CVE team has assigned CVE-2021-47006 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.7 with commit 1879445dfa7b and fixed in 4.9.269 with commit 555a70f7fff0
	Issue introduced in 4.7 with commit 1879445dfa7b and fixed in 4.14.233 with commit ed1f67465327
	Issue introduced in 4.7 with commit 1879445dfa7b and fixed in 4.19.191 with commit a9938d6d78a2
	Issue introduced in 4.7 with commit 1879445dfa7b and fixed in 5.4.120 with commit 3ed8832aeaa9
	Issue introduced in 4.7 with commit 1879445dfa7b and fixed in 5.10.38 with commit 630146203108
	Issue introduced in 4.7 with commit 1879445dfa7b and fixed in 5.11.22 with commit 7eeacc6728c5
	Issue introduced in 4.7 with commit 1879445dfa7b and fixed in 5.12.5 with commit dabe299425b1
	Issue introduced in 4.7 with commit 1879445dfa7b and fixed in 5.13 with commit a506bd575629

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2021-47006
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	arch/arm/kernel/hw_breakpoint.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/555a70f7fff03bd669123487905c47ae27dbdaac
	https://git.kernel.org/stable/c/ed1f67465327cec4457bb988775245b199da86e6
	https://git.kernel.org/stable/c/a9938d6d78a238d6ab8de57a4d3dcf77adceb9bb
	https://git.kernel.org/stable/c/3ed8832aeaa9a37b0fc386bb72ff604352567c80
	https://git.kernel.org/stable/c/630146203108bf6b8934eec0dfdb3e46dcb917de
	https://git.kernel.org/stable/c/7eeacc6728c5478e3c01bc82a1f08958eaa12366
	https://git.kernel.org/stable/c/dabe299425b1a53a69461fed7ac8922ea6733a25
	https://git.kernel.org/stable/c/a506bd5756290821a4314f502b4bafc2afcf5260
