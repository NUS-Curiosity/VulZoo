From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-45029: i2c: tegra: Do not mark ACPI devices as irq safe

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

i2c: tegra: Do not mark ACPI devices as irq safe

On ACPI machines, the tegra i2c module encounters an issue due to a
mutex being called inside a spinlock. This leads to the following bug:

	BUG: sleeping function called from invalid context at kernel/locking/mutex.c:585
	...

	Call trace:
	__might_sleep
	__mutex_lock_common
	mutex_lock_nested
	acpi_subsys_runtime_resume
	rpm_resume
	tegra_i2c_xfer

The problem arises because during __pm_runtime_resume(), the spinlock
&dev->power.lock is acquired before rpm_resume() is called. Later,
rpm_resume() invokes acpi_subsys_runtime_resume(), which relies on
mutexes, triggering the error.

To address this issue, devices on ACPI are now marked as not IRQ-safe,
considering the dependency of acpi_subsys_runtime_resume() on mutexes.

The Linux kernel CVE team has assigned CVE-2024-45029 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.17 with commit bd2fdedbf2bac27f4a2ac16b84ab9b9e5f67006c and fixed in 6.1.107 with commit a89aef1e6cc43fa019a58080ed05c839e6c77876
	Issue introduced in 5.17 with commit bd2fdedbf2bac27f4a2ac16b84ab9b9e5f67006c and fixed in 6.6.48 with commit 6861faf4232e4b78878f2de1ed3ee324ddae2287
	Issue introduced in 5.17 with commit bd2fdedbf2bac27f4a2ac16b84ab9b9e5f67006c and fixed in 6.10.7 with commit 2853e1376d8161b04c9ff18ba82b43f08a049905
	Issue introduced in 5.17 with commit bd2fdedbf2bac27f4a2ac16b84ab9b9e5f67006c and fixed in 6.11 with commit 14d069d92951a3e150c0a81f2ca3b93e54da913b

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-45029
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/i2c/busses/i2c-tegra.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/a89aef1e6cc43fa019a58080ed05c839e6c77876
	https://git.kernel.org/stable/c/6861faf4232e4b78878f2de1ed3ee324ddae2287
	https://git.kernel.org/stable/c/2853e1376d8161b04c9ff18ba82b43f08a049905
	https://git.kernel.org/stable/c/14d069d92951a3e150c0a81f2ca3b93e54da913b
