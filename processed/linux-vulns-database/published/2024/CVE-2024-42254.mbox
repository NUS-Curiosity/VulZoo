From bippy-c9c4e1df01b2 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-42254: io_uring: fix error pbuf checking
Message-Id: <2024080819-CVE-2024-42254-7566@gregkh>
Content-Length: 2363
Lines: 63
X-Developer-Signature: v=1; a=openpgp-sha256; l=2427;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=A/W9fZxxg0Pmzl8OlDZBqI0Oz3Zsg4J7SivAwhkQPXI=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDGlb2vo7ryekJcywd/k5yfbB00k820sYD25jMbKudc8wU
 XATvOfcEcvCIMjEICumyPJlG8/R/RWHFL0MbU/DzGFlAhnCwMUpABPRkmFYcOmIcJmow7m9L84e
 z9sftOi33AvRnQwLLu9tmSwX3lKtd9yEifWbsfBkl7o+AA==
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

io_uring: fix error pbuf checking

Syz reports a problem, which boils down to NULL vs IS_ERR inconsistent
error handling in io_alloc_pbuf_ring().

KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]
RIP: 0010:__io_remove_buffers+0xac/0x700 io_uring/kbuf.c:341
Call Trace:
 <TASK>
 io_put_bl io_uring/kbuf.c:378 [inline]
 io_destroy_buffers+0x14e/0x490 io_uring/kbuf.c:392
 io_ring_ctx_free+0xa00/0x1070 io_uring/io_uring.c:2613
 io_ring_exit_work+0x80f/0x8a0 io_uring/io_uring.c:2844
 process_one_work kernel/workqueue.c:3231 [inline]
 process_scheduled_works+0xa2c/0x1830 kernel/workqueue.c:3312
 worker_thread+0x86d/0xd40 kernel/workqueue.c:3390
 kthread+0x2f0/0x390 kernel/kthread.c:389
 ret_from_fork+0x4b/0x80 arch/x86/kernel/process.c:147
 ret_from_fork_asm+0x1a/0x30 arch/x86/entry/entry_64.S:244

The Linux kernel CVE team has assigned CVE-2024-42254 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.10 with commit 87585b05757d and fixed in 6.10.1 with commit 68d19af95a35
	Issue introduced in 6.10 with commit 87585b05757d and fixed in 6.11-rc1 with commit bcc87d978b83

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-42254
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	io_uring/kbuf.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/68d19af95a353f5e2b021602180b65b303eba99d
	https://git.kernel.org/stable/c/bcc87d978b834c298bbdd9c52454c5d0a946e97e
