From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-56625: can: dev: can_set_termination(): allow sleeping GPIOs

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

can: dev: can_set_termination(): allow sleeping GPIOs

In commit 6e86a1543c37 ("can: dev: provide optional GPIO based
termination support") GPIO based termination support was added.

For no particular reason that patch uses gpiod_set_value() to set the
GPIO. This leads to the following warning, if the systems uses a
sleeping GPIO, i.e. behind an I2C port expander:

| WARNING: CPU: 0 PID: 379 at /drivers/gpio/gpiolib.c:3496 gpiod_set_value+0x50/0x6c
| CPU: 0 UID: 0 PID: 379 Comm: ip Not tainted 6.11.0-20241016-1 #1 823affae360cc91126e4d316d7a614a8bf86236c

Replace gpiod_set_value() by gpiod_set_value_cansleep() to allow the
use of sleeping GPIOs.

The Linux kernel CVE team has assigned CVE-2024-56625 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.15 with commit 6e86a1543c378f2e8837ad88f361b7bf606c80f7 and fixed in 5.15.174 with commit faa0a1975a6fbce30616775216606eb8d6388ea1
	Issue introduced in 5.15 with commit 6e86a1543c378f2e8837ad88f361b7bf606c80f7 and fixed in 6.1.120 with commit 46637a608fb1ee871a0ad8bf70d917d5d95ac251
	Issue introduced in 5.15 with commit 6e86a1543c378f2e8837ad88f361b7bf606c80f7 and fixed in 6.6.66 with commit 1ac442f25c19953d2f33b92549628b0aeac83db6
	Issue introduced in 5.15 with commit 6e86a1543c378f2e8837ad88f361b7bf606c80f7 and fixed in 6.12.5 with commit 3b0c5bb437d31a9864f633b85cbc42d2f6c51c96
	Issue introduced in 5.15 with commit 6e86a1543c378f2e8837ad88f361b7bf606c80f7 and fixed in 6.13 with commit ee1dfbdd8b4b6de85e96ae2059dc9c1bdb6b49b5

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-56625
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/can/dev/dev.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/faa0a1975a6fbce30616775216606eb8d6388ea1
	https://git.kernel.org/stable/c/46637a608fb1ee871a0ad8bf70d917d5d95ac251
	https://git.kernel.org/stable/c/1ac442f25c19953d2f33b92549628b0aeac83db6
	https://git.kernel.org/stable/c/3b0c5bb437d31a9864f633b85cbc42d2f6c51c96
	https://git.kernel.org/stable/c/ee1dfbdd8b4b6de85e96ae2059dc9c1bdb6b49b5
