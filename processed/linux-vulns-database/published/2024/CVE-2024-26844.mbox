From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-26844: block: Fix WARNING in _copy_from_iter

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

block: Fix WARNING in _copy_from_iter

Syzkaller reports a warning in _copy_from_iter because an
iov_iter is supposedly used in the wrong direction. The reason
is that syzcaller managed to generate a request with
a transfer direction of SG_DXFER_TO_FROM_DEV. This instructs
the kernel to copy user buffers into the kernel, read into
the copied buffers and then copy the data back to user space.

Thus the iovec is used in both directions.

Detect this situation in the block layer and construct a new
iterator with the correct direction for the copy-in.

The Linux kernel CVE team has assigned CVE-2024-26844 to this issue.


Affected and fixed versions
===========================

	Fixed in 6.1.80 with commit 8fc80874103a5c20aebdc2401361aa01c817f75b
	Fixed in 6.6.19 with commit 0f1bae071de9967602807472921829a54b2e5956
	Fixed in 6.7.7 with commit cbaf9be337f7da25742acfce325119e3395b1f1b
	Fixed in 6.8 with commit 13f3956eb5681a4045a8dfdef48df5dc4d9f58a6

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-26844
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	block/blk-map.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/8fc80874103a5c20aebdc2401361aa01c817f75b
	https://git.kernel.org/stable/c/0f1bae071de9967602807472921829a54b2e5956
	https://git.kernel.org/stable/c/cbaf9be337f7da25742acfce325119e3395b1f1b
	https://git.kernel.org/stable/c/13f3956eb5681a4045a8dfdef48df5dc4d9f58a6
