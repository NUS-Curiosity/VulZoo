From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-35936: btrfs: handle chunk tree lookup error in btrfs_relocate_sys_chunks()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

btrfs: handle chunk tree lookup error in btrfs_relocate_sys_chunks()

The unhandled case in btrfs_relocate_sys_chunks() loop is a corruption,
as it could be caused only by two impossible conditions:

- at first the search key is set up to look for a chunk tree item, with
  offset -1, this is an inexact search and the key->offset will contain
  the correct offset upon a successful search, a valid chunk tree item
  cannot have an offset -1

- after first successful search, the found_key corresponds to a chunk
  item, the offset is decremented by 1 before the next loop, it's
  impossible to find a chunk item there due to alignment and size
  constraints

The Linux kernel CVE team has assigned CVE-2024-35936 to this issue.


Affected and fixed versions
===========================

	Fixed in 4.19.312 with commit bebd9e0ff90034875c5dfe4bd514fd7055fc7a89
	Fixed in 5.4.274 with commit 576164bd01bd795f8b09fb194b493103506b33c9
	Fixed in 5.10.215 with commit 87299cdaae757f3f41212146cfb5b3af416b8385
	Fixed in 5.15.155 with commit d1ffa4ae2d591fdd40471074e79954ec45f147f7
	Fixed in 6.1.86 with commit 36c2a2863bc3896243eb724dc3fd4cf9aea633f2
	Fixed in 6.6.27 with commit 0d23b34c68c46cd225b55868bc8a269e3134816d
	Fixed in 6.8.6 with commit 1f9212cdbd005bc55f2b7422e7b560d9c02bd1da
	Fixed in 6.9 with commit 7411055db5ce64f836aaffd422396af0075fdc99

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-35936
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/btrfs/volumes.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/bebd9e0ff90034875c5dfe4bd514fd7055fc7a89
	https://git.kernel.org/stable/c/576164bd01bd795f8b09fb194b493103506b33c9
	https://git.kernel.org/stable/c/87299cdaae757f3f41212146cfb5b3af416b8385
	https://git.kernel.org/stable/c/d1ffa4ae2d591fdd40471074e79954ec45f147f7
	https://git.kernel.org/stable/c/36c2a2863bc3896243eb724dc3fd4cf9aea633f2
	https://git.kernel.org/stable/c/0d23b34c68c46cd225b55868bc8a269e3134816d
	https://git.kernel.org/stable/c/1f9212cdbd005bc55f2b7422e7b560d9c02bd1da
	https://git.kernel.org/stable/c/7411055db5ce64f836aaffd422396af0075fdc99
