From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-26830: i40e: Do not allow untrusted VF to remove administratively set MAC

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

i40e: Do not allow untrusted VF to remove administratively set MAC

Currently when PF administratively sets VF's MAC address and the VF
is put down (VF tries to delete all MACs) then the MAC is removed
from MAC filters and primary VF MAC is zeroed.

Do not allow untrusted VF to remove primary MAC when it was set
administratively by PF.

Reproducer:
1) Create VF
2) Set VF interface up
3) Administratively set the VF's MAC
4) Put VF interface down

[root@host ~]# echo 1 > /sys/class/net/enp2s0f0/device/sriov_numvfs
[root@host ~]# ip link set enp2s0f0v0 up
[root@host ~]# ip link set enp2s0f0 vf 0 mac fe:6c:b5:da:c7:7d
[root@host ~]# ip link show enp2s0f0
23: enp2s0f0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000
    link/ether 3c:ec:ef:b7:dd:04 brd ff:ff:ff:ff:ff:ff
    vf 0     link/ether fe:6c:b5:da:c7:7d brd ff:ff:ff:ff:ff:ff, spoof checking on, link-state auto, trust off
[root@host ~]# ip link set enp2s0f0v0 down
[root@host ~]# ip link show enp2s0f0
23: enp2s0f0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000
    link/ether 3c:ec:ef:b7:dd:04 brd ff:ff:ff:ff:ff:ff
    vf 0     link/ether 00:00:00:00:00:00 brd ff:ff:ff:ff:ff:ff, spoof checking on, link-state auto, trust off

The Linux kernel CVE team has assigned CVE-2024-26830 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.14 with commit 700bbf6c1f9e4ab055528d5ab4ac5815fe4a6c1b and fixed in 6.1.79 with commit 1c981792e4ccbc134b468797acdd7781959e6893
	Issue introduced in 3.14 with commit 700bbf6c1f9e4ab055528d5ab4ac5815fe4a6c1b and fixed in 6.6.18 with commit be147926140ac48022c9605d7ab0a67387e4b404
	Issue introduced in 3.14 with commit 700bbf6c1f9e4ab055528d5ab4ac5815fe4a6c1b and fixed in 6.7.6 with commit d250a81ba813a93563be68072c563aa1e346346d
	Issue introduced in 3.14 with commit 700bbf6c1f9e4ab055528d5ab4ac5815fe4a6c1b and fixed in 6.8 with commit 73d9629e1c8c1982f13688c4d1019c3994647ccc

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-26830
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/1c981792e4ccbc134b468797acdd7781959e6893
	https://git.kernel.org/stable/c/be147926140ac48022c9605d7ab0a67387e4b404
	https://git.kernel.org/stable/c/d250a81ba813a93563be68072c563aa1e346346d
	https://git.kernel.org/stable/c/73d9629e1c8c1982f13688c4d1019c3994647ccc
