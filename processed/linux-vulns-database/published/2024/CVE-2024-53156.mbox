From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-53156: wifi: ath9k: add range check for conn_rsp_epid in htc_connect_service()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

wifi: ath9k: add range check for conn_rsp_epid in htc_connect_service()

I found the following bug in my fuzzer:

  UBSAN: array-index-out-of-bounds in drivers/net/wireless/ath/ath9k/htc_hst.c:26:51
  index 255 is out of range for type 'htc_endpoint [22]'
  CPU: 0 UID: 0 PID: 8 Comm: kworker/0:0 Not tainted 6.11.0-rc6-dirty #14
  Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
  Workqueue: events request_firmware_work_func
  Call Trace:
   <TASK>
   dump_stack_lvl+0x180/0x1b0
   __ubsan_handle_out_of_bounds+0xd4/0x130
   htc_issue_send.constprop.0+0x20c/0x230
   ? _raw_spin_unlock_irqrestore+0x3c/0x70
   ath9k_wmi_cmd+0x41d/0x610
   ? mark_held_locks+0x9f/0xe0
   ...

Since this bug has been confirmed to be caused by insufficient verification
of conn_rsp_epid, I think it would be appropriate to add a range check for
conn_rsp_epid to htc_connect_service() to prevent the bug from occurring.

The Linux kernel CVE team has assigned CVE-2024-53156 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 4.19.325 with commit 5f177fb9d01355ac183e65ad8909ea8ef734e0cf
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 5.4.287 with commit cb480ae80fd4d0f1ac9e107ce799183beee5124b
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 5.10.231 with commit c941af142200d975dd3be632aeb490f4cb91dae4
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 5.15.174 with commit 8965db7fe2e913ee0802b05fc94c6d6aa74e0596
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 6.1.120 with commit 70eae50d2156cb6e078d0d78809b49bf2f4c7540
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 6.6.64 with commit b6551479daf2bfa80bfd5d9016b02a810e508bfb
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 6.11.11 with commit 3fe99b9690b99606d3743c9961ebee865cfa1ab8
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 6.12.2 with commit bc981179ab5d1a2715f35e3db4e4bb822bacc849
	Issue introduced in 2.6.35 with commit fb9987d0f748c983bb795a86f47522313f701a08 and fixed in 6.13 with commit 8619593634cbdf5abf43f5714df49b04e4ef09ab

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-53156
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/wireless/ath/ath9k/htc_hst.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/5f177fb9d01355ac183e65ad8909ea8ef734e0cf
	https://git.kernel.org/stable/c/cb480ae80fd4d0f1ac9e107ce799183beee5124b
	https://git.kernel.org/stable/c/c941af142200d975dd3be632aeb490f4cb91dae4
	https://git.kernel.org/stable/c/8965db7fe2e913ee0802b05fc94c6d6aa74e0596
	https://git.kernel.org/stable/c/70eae50d2156cb6e078d0d78809b49bf2f4c7540
	https://git.kernel.org/stable/c/b6551479daf2bfa80bfd5d9016b02a810e508bfb
	https://git.kernel.org/stable/c/3fe99b9690b99606d3743c9961ebee865cfa1ab8
	https://git.kernel.org/stable/c/bc981179ab5d1a2715f35e3db4e4bb822bacc849
	https://git.kernel.org/stable/c/8619593634cbdf5abf43f5714df49b04e4ef09ab
