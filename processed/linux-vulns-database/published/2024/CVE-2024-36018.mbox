From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-36018: nouveau/uvmm: fix addr/range calcs for remap operations

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

nouveau/uvmm: fix addr/range calcs for remap operations

dEQP-VK.sparse_resources.image_rebind.2d_array.r64i.128_128_8
was causing a remap operation like the below.

op_remap: prev: 0000003fffed0000 00000000000f0000 00000000a5abd18a 0000000000000000
op_remap: next:
op_remap: unmap: 0000003fffed0000 0000000000100000 0
op_map: map: 0000003ffffc0000 0000000000010000 000000005b1ba33c 00000000000e0000

This was resulting in an unmap operation from 0x3fffed0000+0xf0000, 0x100000
which was corrupting the pagetables and oopsing the kernel.

Fixes the prev + unmap range calcs to use start/end and map back to addr/range.

The Linux kernel CVE team has assigned CVE-2024-36018 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 6.6 with commit b88baab828713ce0b49b185444b2ee83bed373a8 and fixed in 6.6.26 with commit 692a51bebf4552bdf0a79ccd68d291182a26a569
	Issue introduced in 6.6 with commit b88baab828713ce0b49b185444b2ee83bed373a8 and fixed in 6.8.5 with commit 0c16020d2b69a602c8ae6a1dd2aac9a3023249d6
	Issue introduced in 6.6 with commit b88baab828713ce0b49b185444b2ee83bed373a8 and fixed in 6.9 with commit be141849ec00ef39935bf169c0f194ac70bf85ce

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-36018
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/nouveau/nouveau_uvmm.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/692a51bebf4552bdf0a79ccd68d291182a26a569
	https://git.kernel.org/stable/c/0c16020d2b69a602c8ae6a1dd2aac9a3023249d6
	https://git.kernel.org/stable/c/be141849ec00ef39935bf169c0f194ac70bf85ce
