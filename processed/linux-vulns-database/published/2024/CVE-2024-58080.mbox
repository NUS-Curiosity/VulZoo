From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-58080: clk: qcom: dispcc-sm6350: Add missing parent_map for a clock

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

clk: qcom: dispcc-sm6350: Add missing parent_map for a clock

If a clk_rcg2 has a parent, it should also have parent_map defined,
otherwise we'll get a NULL pointer dereference when calling clk_set_rate
like the following:

  [    3.388105] Call trace:
  [    3.390664]  qcom_find_src_index+0x3c/0x70 (P)
  [    3.395301]  qcom_find_src_index+0x1c/0x70 (L)
  [    3.399934]  _freq_tbl_determine_rate+0x48/0x100
  [    3.404753]  clk_rcg2_determine_rate+0x1c/0x28
  [    3.409387]  clk_core_determine_round_nolock+0x58/0xe4
  [    3.421414]  clk_core_round_rate_nolock+0x48/0xfc
  [    3.432974]  clk_core_round_rate_nolock+0xd0/0xfc
  [    3.444483]  clk_core_set_rate_nolock+0x8c/0x300
  [    3.455886]  clk_set_rate+0x38/0x14c

Add the parent_map property for the clock where it's missing and also
un-inline the parent_data as well to keep the matching parent_map and
parent_data together.

The Linux kernel CVE team has assigned CVE-2024-58080 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.18 with commit 837519775f1d3945e3d4019641f7120d58325059 and fixed in 6.1.129 with commit 3daca9050857220726732ad9d4a8512069386f46
	Issue introduced in 5.18 with commit 837519775f1d3945e3d4019641f7120d58325059 and fixed in 6.6.78 with commit 3ad28517385e2821e8e43388d6a0b3e1ba0bc3ab
	Issue introduced in 5.18 with commit 837519775f1d3945e3d4019641f7120d58325059 and fixed in 6.12.14 with commit 2dba8d5d423fa5f6f3a687aa6e0da5808f69091b
	Issue introduced in 5.18 with commit 837519775f1d3945e3d4019641f7120d58325059 and fixed in 6.13.3 with commit a1f15808adfd77268eac7fefce5378ad9fedbfba
	Issue introduced in 5.18 with commit 837519775f1d3945e3d4019641f7120d58325059 and fixed in 6.14-rc1 with commit d4cdb196f182d2fbe336c968228be00d8c3fed05

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-58080
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/clk/qcom/dispcc-sm6350.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/3daca9050857220726732ad9d4a8512069386f46
	https://git.kernel.org/stable/c/3ad28517385e2821e8e43388d6a0b3e1ba0bc3ab
	https://git.kernel.org/stable/c/2dba8d5d423fa5f6f3a687aa6e0da5808f69091b
	https://git.kernel.org/stable/c/a1f15808adfd77268eac7fefce5378ad9fedbfba
	https://git.kernel.org/stable/c/d4cdb196f182d2fbe336c968228be00d8c3fed05
