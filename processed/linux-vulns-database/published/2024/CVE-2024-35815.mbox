From bippy-d175d3acf727 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-35815: fs/aio: Check IOCB_AIO_RW before the struct aio_kiocb conversion

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

fs/aio: Check IOCB_AIO_RW before the struct aio_kiocb conversion

The first kiocb_set_cancel_fn() argument may point at a struct kiocb
that is not embedded inside struct aio_kiocb. With the current code,
depending on the compiler, the req->ki_ctx read happens either before
the IOCB_AIO_RW test or after that test. Move the req->ki_ctx read such
that it is guaranteed that the IOCB_AIO_RW test happens first.

The Linux kernel CVE team has assigned CVE-2024-35815 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.19.308 with commit 337b543e274f and fixed in 4.19.312 with commit 10ca82aff584
	Issue introduced in 5.4.270 with commit b4eea7a05ee0 and fixed in 5.4.274 with commit 396dbbc18963
	Issue introduced in 5.10.211 with commit ea1cd64d59f2 and fixed in 5.10.215 with commit 94eb0293703c
	Issue introduced in 5.15.150 with commit d7b6fa97ec89 and fixed in 5.15.154 with commit a71cba07783a
	Issue introduced in 6.1.80 with commit 18f614369def and fixed in 6.1.84 with commit 18d5fc3c16cc
	Issue introduced in 6.6.19 with commit e7e23fc5d5fe and fixed in 6.6.24 with commit c01ed748847f
	Issue introduced in 6.7.7 with commit 1dc7d74fe456 and fixed in 6.7.12 with commit 5c43d0041e3a

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-35815
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/aio.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/10ca82aff58434e122c7c757cf0497c335f993f3
	https://git.kernel.org/stable/c/396dbbc18963648e9d1a4edbb55cfe08fa374d50
	https://git.kernel.org/stable/c/94eb0293703ced580f05dfbe5a57da5931e9aee2
	https://git.kernel.org/stable/c/a71cba07783abc76b547568b6452cd1dd9981410
	https://git.kernel.org/stable/c/18d5fc3c16cc317bd0e5f5dabe0660df415cadb7
	https://git.kernel.org/stable/c/c01ed748847fe8b810d86efc229b9e6c7fafa01e
	https://git.kernel.org/stable/c/5c43d0041e3a05c6c41c318b759fff16d2384596
	https://git.kernel.org/stable/c/961ebd120565cb60cebe21cb634fbc456022db4a
