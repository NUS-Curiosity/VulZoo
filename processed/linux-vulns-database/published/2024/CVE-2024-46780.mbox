From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-46780: nilfs2: protect references to superblock parameters exposed in sysfs

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

nilfs2: protect references to superblock parameters exposed in sysfs

The superblock buffers of nilfs2 can not only be overwritten at runtime
for modifications/repairs, but they are also regularly swapped, replaced
during resizing, and even abandoned when degrading to one side due to
backing device issues.  So, accessing them requires mutual exclusion using
the reader/writer semaphore "nilfs->ns_sem".

Some sysfs attribute show methods read this superblock buffer without the
necessary mutual exclusion, which can cause problems with pointer
dereferencing and memory access, so fix it.

The Linux kernel CVE team has assigned CVE-2024-46780 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.17 with commit da7141fb78db915680616e15677539fc8140cf53 and fixed in 4.19.322 with commit b90beafac05931cbfcb6b1bd4f67c1923f47040e
	Issue introduced in 3.17 with commit da7141fb78db915680616e15677539fc8140cf53 and fixed in 5.4.284 with commit ba97ba173f9625d5f34a986088979eae8b80d38e
	Issue introduced in 3.17 with commit da7141fb78db915680616e15677539fc8140cf53 and fixed in 5.10.226 with commit 157c0d94b4c40887329418c70ef4edd1a8d6b4ed
	Issue introduced in 3.17 with commit da7141fb78db915680616e15677539fc8140cf53 and fixed in 5.15.167 with commit b14e7260bb691d7f563f61da07d61e3c8b59a614
	Issue introduced in 3.17 with commit da7141fb78db915680616e15677539fc8140cf53 and fixed in 6.1.110 with commit 19cfeba0e4b8eda51484fcf8cf7d150418e1d880
	Issue introduced in 3.17 with commit da7141fb78db915680616e15677539fc8140cf53 and fixed in 6.6.51 with commit 8c6e43b3d5f109cf9c61bc188fcc8175404e924f
	Issue introduced in 3.17 with commit da7141fb78db915680616e15677539fc8140cf53 and fixed in 6.10.10 with commit 962562d4c70c5cdeb4e955d63ff2017c4eca1aad
	Issue introduced in 3.17 with commit da7141fb78db915680616e15677539fc8140cf53 and fixed in 6.11 with commit 683408258917541bdb294cd717c210a04381931e

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-46780
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/nilfs2/sysfs.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/b90beafac05931cbfcb6b1bd4f67c1923f47040e
	https://git.kernel.org/stable/c/ba97ba173f9625d5f34a986088979eae8b80d38e
	https://git.kernel.org/stable/c/157c0d94b4c40887329418c70ef4edd1a8d6b4ed
	https://git.kernel.org/stable/c/b14e7260bb691d7f563f61da07d61e3c8b59a614
	https://git.kernel.org/stable/c/19cfeba0e4b8eda51484fcf8cf7d150418e1d880
	https://git.kernel.org/stable/c/8c6e43b3d5f109cf9c61bc188fcc8175404e924f
	https://git.kernel.org/stable/c/962562d4c70c5cdeb4e955d63ff2017c4eca1aad
	https://git.kernel.org/stable/c/683408258917541bdb294cd717c210a04381931e
