From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-43866: net/mlx5: Always drain health in shutdown callback

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

net/mlx5: Always drain health in shutdown callback

There is no point in recovery during device shutdown. if health
work started need to wait for it to avoid races and NULL pointer
access.

Hence, drain health WQ on shutdown callback.

The Linux kernel CVE team has assigned CVE-2024-43866 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.14 with commit d2aa060d40fa060e963f9a356d43481e43ba3dac and fixed in 6.1.113 with commit 5005e2e159b300c1b8c6820a1e13a62eb0127b9b
	Issue introduced in 4.14 with commit d2aa060d40fa060e963f9a356d43481e43ba3dac and fixed in 6.6.45 with commit 6b6c2ebd83f2bf97e8f221479372aaca97a4a9b2
	Issue introduced in 4.14 with commit d2aa060d40fa060e963f9a356d43481e43ba3dac and fixed in 6.10.4 with commit 6048dec754554a1303d632be6042d3feb3295285
	Issue introduced in 4.14 with commit d2aa060d40fa060e963f9a356d43481e43ba3dac and fixed in 6.11 with commit 1b75da22ed1e6171e261bc9265370162553d5393
	Issue introduced in 4.13.16 with commit 63d10e93df94c93bdeac87a9401696b1edadb7ed

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-43866
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/net/ethernet/mellanox/mlx5/core/main.c
	drivers/net/ethernet/mellanox/mlx5/core/sf/dev/driver.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/5005e2e159b300c1b8c6820a1e13a62eb0127b9b
	https://git.kernel.org/stable/c/6b6c2ebd83f2bf97e8f221479372aaca97a4a9b2
	https://git.kernel.org/stable/c/6048dec754554a1303d632be6042d3feb3295285
	https://git.kernel.org/stable/c/1b75da22ed1e6171e261bc9265370162553d5393
