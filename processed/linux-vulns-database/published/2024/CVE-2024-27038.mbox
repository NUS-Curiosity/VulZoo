From bippy-d175d3acf727 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-27038: clk: Fix clk_core_get NULL dereference

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

clk: Fix clk_core_get NULL dereference

It is possible for clk_core_get to dereference a NULL in the following
sequence:

clk_core_get()
    of_clk_get_hw_from_clkspec()
        __of_clk_get_hw_from_provider()
            __clk_get_hw()

__clk_get_hw() can return NULL which is dereferenced by clk_core_get() at
hw->core.

Prior to commit dde4eff47c82 ("clk: Look for parents with clkdev based
clk_lookups") the check IS_ERR_OR_NULL() was performed which would have
caught the NULL.

Reading the description of this function it talks about returning NULL but
that cannot be so at the moment.

Update the function to check for hw before dereferencing it and return NULL
if hw is NULL.

The Linux kernel CVE team has assigned CVE-2024-27038 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.2 with commit dde4eff47c82 and fixed in 5.4.273 with commit d7ae7d126568
	Issue introduced in 5.2 with commit dde4eff47c82 and fixed in 5.10.214 with commit 239174535dba
	Issue introduced in 5.2 with commit dde4eff47c82 and fixed in 5.15.153 with commit 0efb9ef6fb95
	Issue introduced in 5.2 with commit dde4eff47c82 and fixed in 6.1.83 with commit a8b2b26fdd01
	Issue introduced in 5.2 with commit dde4eff47c82 and fixed in 6.6.23 with commit a5d9b1aa61b4
	Issue introduced in 5.2 with commit dde4eff47c82 and fixed in 6.7.11 with commit c554badcae9c
	Issue introduced in 5.2 with commit dde4eff47c82 and fixed in 6.8.2 with commit 6f073b24a9e2
	Issue introduced in 5.2 with commit dde4eff47c82 and fixed in 6.9 with commit e97fe4901e0f

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-27038
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/clk/clk.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/d7ae7d1265686b55832a445b1db8cdd69738ac07
	https://git.kernel.org/stable/c/239174535dba11f7b83de0eaaa27909024f8c185
	https://git.kernel.org/stable/c/0efb9ef6fb95384ba631d6819e66f10392aabfa2
	https://git.kernel.org/stable/c/a8b2b26fdd011ebe36d68a9a321ca45801685959
	https://git.kernel.org/stable/c/a5d9b1aa61b401867b9066d54086b3e4ee91f8ed
	https://git.kernel.org/stable/c/c554badcae9c45b737a22d23454170c6020b90e6
	https://git.kernel.org/stable/c/6f073b24a9e2becd25ac4505a9780a87e621bb51
	https://git.kernel.org/stable/c/e97fe4901e0f59a0bfd524578fe3768f8ca42428
