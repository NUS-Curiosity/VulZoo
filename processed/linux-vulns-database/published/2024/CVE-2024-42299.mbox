From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-42299: fs/ntfs3: Update log->page_{mask,bits} if log->page_size changed

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

fs/ntfs3: Update log->page_{mask,bits} if log->page_size changed

If an NTFS file system is mounted to another system with different
PAGE_SIZE from the original system, log->page_size will change in
log_replay(), but log->page_{mask,bits} don't change correspondingly.
This will cause a panic because "u32 bytes = log->page_size - page_off"
will get a negative value in the later read_log_page().

The Linux kernel CVE team has assigned CVE-2024-42299 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.15 with commit b46acd6a6a627d876898e1c84d3f84902264b445 and fixed in 5.15.165 with commit 0484adcb5fbcadd9ba0fd4485c42630f72e97da9
	Issue introduced in 5.15 with commit b46acd6a6a627d876898e1c84d3f84902264b445 and fixed in 6.1.103 with commit b90ceffdc975502bc085ce8e79c6adeff05f9521
	Issue introduced in 5.15 with commit b46acd6a6a627d876898e1c84d3f84902264b445 and fixed in 6.6.44 with commit 2cac0df3324b5e287d8020bc0708f7d2dec88a6f
	Issue introduced in 5.15 with commit b46acd6a6a627d876898e1c84d3f84902264b445 and fixed in 6.10.3 with commit 0a4ae2644e2a3b3b219aad9639fb2b0691d08420
	Issue introduced in 5.15 with commit b46acd6a6a627d876898e1c84d3f84902264b445 and fixed in 6.11 with commit 2fef55d8f78383c8e6d6d4c014b9597375132696

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-42299
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/ntfs3/fslog.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/0484adcb5fbcadd9ba0fd4485c42630f72e97da9
	https://git.kernel.org/stable/c/b90ceffdc975502bc085ce8e79c6adeff05f9521
	https://git.kernel.org/stable/c/2cac0df3324b5e287d8020bc0708f7d2dec88a6f
	https://git.kernel.org/stable/c/0a4ae2644e2a3b3b219aad9639fb2b0691d08420
	https://git.kernel.org/stable/c/2fef55d8f78383c8e6d6d4c014b9597375132696
