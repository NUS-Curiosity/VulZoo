From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-53127: Revert "mmc: dw_mmc: Fix IDMAC operation with pages bigger than 4K"

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

Revert "mmc: dw_mmc: Fix IDMAC operation with pages bigger than 4K"

The commit 8396c793ffdf ("mmc: dw_mmc: Fix IDMAC operation with pages
bigger than 4K") increased the max_req_size, even for 4K pages, causing
various issues:
- Panic booting the kernel/rootfs from an SD card on Rockchip RK3566
- Panic booting the kernel/rootfs from an SD card on StarFive JH7100
- "swiotlb buffer is full" and data corruption on StarFive JH7110

At this stage no fix have been found, so it's probably better to just
revert the change.

This reverts commit 8396c793ffdf28bb8aee7cfe0891080f8cab7890.

The Linux kernel CVE team has assigned CVE-2024-53127 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.19.322 with commit 32bd402f6760d57127d58a9888553b2db574bba6 and fixed in 4.19.325 with commit 00bff71745bc3583bd5ca59be91e0ee1d27f1944
	Issue introduced in 5.4.284 with commit b9ee16a20d9976686185d7e59cd006c328b6a1e0 and fixed in 5.4.287 with commit 47693ba35bccaa16efa465159a1c12d78258349e
	Issue introduced in 5.10.226 with commit 2793f423893579b35dc1fc24dd7c1ce58fa0345a and fixed in 5.10.231 with commit 938c13740f8b555986e53c0fcbaf00dcd1fabd4c
	Issue introduced in 5.15.167 with commit 9d715a234dd8f01af970b78ae2144a2fd3ead21c and fixed in 5.15.174 with commit f701eb601470bfc0a551913ce5f6ebaa770f0ce0
	Issue introduced in 6.1.110 with commit 373f8f5b087f010dddae3306a79c6fdd5c2f8953 and fixed in 6.1.119 with commit 8f9416147d7ed414109d3501f1cb3d7a1735b25a
	Issue introduced in 6.6.51 with commit 5b4bf3948875064a9adcda4b52b59e0520a8c576 and fixed in 6.6.63 with commit 56de724c58c07a7ca3aac027cfd2ccb184ed9e4e
	Issue introduced in 6.11 with commit 8396c793ffdf28bb8aee7cfe0891080f8cab7890 and fixed in 6.11.10 with commit a4685366f07448420badb710ff5c12aaaadf63ad
	Issue introduced in 6.11 with commit 8396c793ffdf28bb8aee7cfe0891080f8cab7890 and fixed in 6.12 with commit 1635e407a4a64d08a8517ac59ca14ad4fc785e75
	Issue introduced in 6.10.10 with commit 5b1ef10f7d49f3320b0faa894204259e590ce588

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-53127
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/mmc/host/dw_mmc.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/00bff71745bc3583bd5ca59be91e0ee1d27f1944
	https://git.kernel.org/stable/c/47693ba35bccaa16efa465159a1c12d78258349e
	https://git.kernel.org/stable/c/938c13740f8b555986e53c0fcbaf00dcd1fabd4c
	https://git.kernel.org/stable/c/f701eb601470bfc0a551913ce5f6ebaa770f0ce0
	https://git.kernel.org/stable/c/8f9416147d7ed414109d3501f1cb3d7a1735b25a
	https://git.kernel.org/stable/c/56de724c58c07a7ca3aac027cfd2ccb184ed9e4e
	https://git.kernel.org/stable/c/a4685366f07448420badb710ff5c12aaaadf63ad
	https://git.kernel.org/stable/c/1635e407a4a64d08a8517ac59ca14ad4fc785e75
