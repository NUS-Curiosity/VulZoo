From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-43904: drm/amd/display: Add null checks for 'stream' and 'plane' before dereferencing

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

drm/amd/display: Add null checks for 'stream' and 'plane' before dereferencing

This commit adds null checks for the 'stream' and 'plane' variables in
the dcn30_apply_idle_power_optimizations function. These variables were
previously assumed to be null at line 922, but they were used later in
the code without checking if they were null. This could potentially lead
to a null pointer dereference, which would cause a crash.

The null checks ensure that 'stream' and 'plane' are not null before
they are used, preventing potential crashes.

Fixes the below static smatch checker:
drivers/gpu/drm/amd/amdgpu/../display/dc/hwss/dcn30/dcn30_hwseq.c:938 dcn30_apply_idle_power_optimizations() error: we previously assumed 'stream' could be null (see line 922)
drivers/gpu/drm/amd/amdgpu/../display/dc/hwss/dcn30/dcn30_hwseq.c:940 dcn30_apply_idle_power_optimizations() error: we previously assumed 'plane' could be null (see line 922)

The Linux kernel CVE team has assigned CVE-2024-43904 to this issue.


Affected and fixed versions
===========================

	Fixed in 6.1.116 with commit 5e84eda48ffb2363437db44bbd0235594f8a58f9
	Fixed in 6.6.60 with commit 10c20d79d59cadfe572480d98cec271a89ffb024
	Fixed in 6.10.5 with commit 16a8a2a839d19c4cf7253642b493ffb8eee1d857
	Fixed in 6.11 with commit 15c2990e0f0108b9c3752d7072a97d45d4283aea

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-43904
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/amd/display/dc/hwss/dcn30/dcn30_hwseq.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/5e84eda48ffb2363437db44bbd0235594f8a58f9
	https://git.kernel.org/stable/c/10c20d79d59cadfe572480d98cec271a89ffb024
	https://git.kernel.org/stable/c/16a8a2a839d19c4cf7253642b493ffb8eee1d857
	https://git.kernel.org/stable/c/15c2990e0f0108b9c3752d7072a97d45d4283aea
