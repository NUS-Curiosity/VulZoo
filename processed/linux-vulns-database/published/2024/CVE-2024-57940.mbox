From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-57940: exfat: fix the infinite loop in exfat_readdir()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

exfat: fix the infinite loop in exfat_readdir()

If the file system is corrupted so that a cluster is linked to
itself in the cluster chain, and there is an unused directory
entry in the cluster, 'dentry' will not be incremented, causing
condition 'dentry < max_dentries' unable to prevent an infinite
loop.

This infinite loop causes s_lock not to be released, and other
tasks will hang, such as exfat_sync_fs().

This commit stops traversing the cluster chain when there is unused
directory entry in the cluster to avoid this infinite loop.

The Linux kernel CVE team has assigned CVE-2024-57940 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.7 with commit ca06197382bde0a3bc20215595d1c9ce20c6e341 and fixed in 5.10.234 with commit d8cfbb8723bd3d3222f360227a1cc15227189ca6
	Issue introduced in 5.7 with commit ca06197382bde0a3bc20215595d1c9ce20c6e341 and fixed in 5.15.177 with commit 28c21f0ac5293a4bf19b3e0e32005d6dd31a6c17
	Issue introduced in 5.7 with commit ca06197382bde0a3bc20215595d1c9ce20c6e341 and fixed in 6.1.125 with commit 31beabd0f47f8c3ed9965ba861c9e5b252d4920a
	Issue introduced in 5.7 with commit ca06197382bde0a3bc20215595d1c9ce20c6e341 and fixed in 6.6.72 with commit dc1d7afceb982e8f666e70a582e6b5aa806de063
	Issue introduced in 5.7 with commit ca06197382bde0a3bc20215595d1c9ce20c6e341 and fixed in 6.12.10 with commit d9ea94f5cd117d56e573696d0045ab3044185a15
	Issue introduced in 5.7 with commit ca06197382bde0a3bc20215595d1c9ce20c6e341 and fixed in 6.13 with commit fee873761bd978d077d8c55334b4966ac4cb7b59

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-57940
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/exfat/dir.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/d8cfbb8723bd3d3222f360227a1cc15227189ca6
	https://git.kernel.org/stable/c/28c21f0ac5293a4bf19b3e0e32005d6dd31a6c17
	https://git.kernel.org/stable/c/31beabd0f47f8c3ed9965ba861c9e5b252d4920a
	https://git.kernel.org/stable/c/dc1d7afceb982e8f666e70a582e6b5aa806de063
	https://git.kernel.org/stable/c/d9ea94f5cd117d56e573696d0045ab3044185a15
	https://git.kernel.org/stable/c/fee873761bd978d077d8c55334b4966ac4cb7b59
