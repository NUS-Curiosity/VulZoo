From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-50192: irqchip/gic-v4: Don't allow a VMOVP on a dying VPE

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

irqchip/gic-v4: Don't allow a VMOVP on a dying VPE

Kunkun Jiang reported that there is a small window of opportunity for
userspace to force a change of affinity for a VPE while the VPE has already
been unmapped, but the corresponding doorbell interrupt still visible in
/proc/irq/.

Plug the race by checking the value of vmapp_count, which tracks whether
the VPE is mapped ot not, and returning an error in this case.

This involves making vmapp_count common to both GICv4.1 and its v4.0
ancestor.

The Linux kernel CVE team has assigned CVE-2024-50192 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.6 with commit 64edfaa9a2342a3ce34f8cb982c2c2df84db4de3 and fixed in 5.10.228 with commit b7d7b7fc876f836f40bf48a87e07ea18756ba196
	Issue introduced in 5.6 with commit 64edfaa9a2342a3ce34f8cb982c2c2df84db4de3 and fixed in 5.15.169 with commit 755b9532c885b8761fb135fedcd705e21e61cccb
	Issue introduced in 5.6 with commit 64edfaa9a2342a3ce34f8cb982c2c2df84db4de3 and fixed in 6.1.114 with commit 64b12b061c5488e2d69e67c4eaae5da64fd30bfe
	Issue introduced in 5.6 with commit 64edfaa9a2342a3ce34f8cb982c2c2df84db4de3 and fixed in 6.6.58 with commit 01282ab5182f85e42234df2ff42f0ce790f465ff
	Issue introduced in 5.6 with commit 64edfaa9a2342a3ce34f8cb982c2c2df84db4de3 and fixed in 6.11.5 with commit d960505a869e66184fff97fb334980a5b797c7c6
	Issue introduced in 5.6 with commit 64edfaa9a2342a3ce34f8cb982c2c2df84db4de3 and fixed in 6.12 with commit 1442ee0011983f0c5c4b92380e6853afb513841a

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-50192
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/irqchip/irq-gic-v3-its.c
	include/linux/irqchip/arm-gic-v4.h


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/b7d7b7fc876f836f40bf48a87e07ea18756ba196
	https://git.kernel.org/stable/c/755b9532c885b8761fb135fedcd705e21e61cccb
	https://git.kernel.org/stable/c/64b12b061c5488e2d69e67c4eaae5da64fd30bfe
	https://git.kernel.org/stable/c/01282ab5182f85e42234df2ff42f0ce790f465ff
	https://git.kernel.org/stable/c/d960505a869e66184fff97fb334980a5b797c7c6
	https://git.kernel.org/stable/c/1442ee0011983f0c5c4b92380e6853afb513841a
