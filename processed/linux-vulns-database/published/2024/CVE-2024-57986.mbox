From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-57986: HID: core: Fix assumption that Resolution Multipliers must be in Logical Collections

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

HID: core: Fix assumption that Resolution Multipliers must be in Logical Collections

A report in 2019 by the syzbot fuzzer was found to be connected to two
errors in the HID core associated with Resolution Multipliers.  One of
the errors was fixed by commit ea427a222d8b ("HID: core: Fix deadloop
in hid_apply_multiplier."), but the other has not been fixed.

This error arises because hid_apply_multipler() assumes that every
Resolution Multiplier control is contained in a Logical Collection,
i.e., there's no way the routine can ever set multiplier_collection to
NULL.  This is in spite of the fact that the function starts with a
big comment saying:

	 * "The Resolution Multiplier control must be contained in the same
	 * Logical Collection as the control(s) to which it is to be applied.
	   ...
	 *  If no Logical Collection is
	 * defined, the Resolution Multiplier is associated with all
	 * controls in the report."
	 * HID Usage Table, v1.12, Section 4.3.1, p30
	 *
	 * Thus, search from the current collection upwards until we find a
	 * logical collection...

The comment and the code overlook the possibility that none of the
collections found may be a Logical Collection.

The fix is to set the multiplier_collection pointer to NULL if the
collection found isn't a Logical Collection.

The Linux kernel CVE team has assigned CVE-2024-57986 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.0 with commit 5a4abb36f312cf83206b1b7d1308ba47cba0b3cc and fixed in 5.4.291 with commit 3a002e4029230d9a6be89f869b2328b258612f5c
	Issue introduced in 5.0 with commit 5a4abb36f312cf83206b1b7d1308ba47cba0b3cc and fixed in 5.10.235 with commit 05dd7d10675b540b8b7b31035c0a8abb6e6f3b88
	Issue introduced in 5.0 with commit 5a4abb36f312cf83206b1b7d1308ba47cba0b3cc and fixed in 5.15.179 with commit a32ea3f982b389ea43a41ce77b6fb70d74006d9b
	Issue introduced in 5.0 with commit 5a4abb36f312cf83206b1b7d1308ba47cba0b3cc and fixed in 6.1.129 with commit bebf542e8d7c44a18a95f306b1b5dc160c823506
	Issue introduced in 5.0 with commit 5a4abb36f312cf83206b1b7d1308ba47cba0b3cc and fixed in 6.6.76 with commit ed3d3883476423f337aac0f22c521819b3f1e970
	Issue introduced in 5.0 with commit 5a4abb36f312cf83206b1b7d1308ba47cba0b3cc and fixed in 6.12.13 with commit ebaeca33d32c8bdb705a8c88267737a456f354b1
	Issue introduced in 5.0 with commit 5a4abb36f312cf83206b1b7d1308ba47cba0b3cc and fixed in 6.13.2 with commit a5498f1f864ea26f4c613c77f54409c776a95a90
	Issue introduced in 5.0 with commit 5a4abb36f312cf83206b1b7d1308ba47cba0b3cc and fixed in 6.14-rc1 with commit 64f2657b579343cf923aa933f08074e6258eb07b

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-57986
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/hid/hid-core.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/3a002e4029230d9a6be89f869b2328b258612f5c
	https://git.kernel.org/stable/c/05dd7d10675b540b8b7b31035c0a8abb6e6f3b88
	https://git.kernel.org/stable/c/a32ea3f982b389ea43a41ce77b6fb70d74006d9b
	https://git.kernel.org/stable/c/bebf542e8d7c44a18a95f306b1b5dc160c823506
	https://git.kernel.org/stable/c/ed3d3883476423f337aac0f22c521819b3f1e970
	https://git.kernel.org/stable/c/ebaeca33d32c8bdb705a8c88267737a456f354b1
	https://git.kernel.org/stable/c/a5498f1f864ea26f4c613c77f54409c776a95a90
	https://git.kernel.org/stable/c/64f2657b579343cf923aa933f08074e6258eb07b
