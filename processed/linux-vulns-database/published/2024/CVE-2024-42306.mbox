From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-42306: udf: Avoid using corrupted block bitmap buffer

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

udf: Avoid using corrupted block bitmap buffer

When the filesystem block bitmap is corrupted, we detect the corruption
while loading the bitmap and fail the allocation with error. However the
next allocation from the same bitmap will notice the bitmap buffer is
already loaded and tries to allocate from the bitmap with mixed results
(depending on the exact nature of the bitmap corruption). Fix the
problem by using BH_verified bit to indicate whether the bitmap is valid
or not.

The Linux kernel CVE team has assigned CVE-2024-42306 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.4.257 with commit 7648ea9896b31aff38830d81188f5b7a1773e4a8 and fixed in 5.4.282 with commit cae9e59cc41683408b70b9ab569f8654866ba914
	Issue introduced in 5.10.195 with commit 4ac54312f623c6d2ca30c36c1ef530c11f5aff64 and fixed in 5.10.224 with commit 2199e157a465aaf98294d3932797ecd7fce942d5
	Issue introduced in 5.15.132 with commit 099bf90d7fc4622da9fd4727f6d318a0f12d10be and fixed in 5.15.165 with commit 6a43e3c210df6c5f00570f4be49a897677dbcb64
	Issue introduced in 6.1.53 with commit 6ac8f2c8362afd2baa8e7b9c946597589e587d22 and fixed in 6.1.103 with commit 271cab2ca00652bc984e269cf1208699a1e09cdd
	Issue introduced in 6.3 with commit 1e0d4adf17e7ef03281d7b16555e7c1508c8ed2d and fixed in 6.6.44 with commit 57053b3bcf3403b80db6f65aba284d7dfe7326af
	Issue introduced in 6.3 with commit 1e0d4adf17e7ef03281d7b16555e7c1508c8ed2d and fixed in 6.10.3 with commit 8ca170c39eca7cad6e0cfeb24e351d8f8eddcd65
	Issue introduced in 6.3 with commit 1e0d4adf17e7ef03281d7b16555e7c1508c8ed2d and fixed in 6.11 with commit a90d4471146de21745980cba51ce88e7926bcc4f
	Issue introduced in 4.14.326 with commit f862a9049c3f6e73a5504a1ac10ffd5bc253ab55
	Issue introduced in 4.19.295 with commit 4622cc1b6d86013e01c56b60b092b5e4726c8e52

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-42306
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	fs/udf/balloc.c
	fs/udf/super.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/cae9e59cc41683408b70b9ab569f8654866ba914
	https://git.kernel.org/stable/c/2199e157a465aaf98294d3932797ecd7fce942d5
	https://git.kernel.org/stable/c/6a43e3c210df6c5f00570f4be49a897677dbcb64
	https://git.kernel.org/stable/c/271cab2ca00652bc984e269cf1208699a1e09cdd
	https://git.kernel.org/stable/c/57053b3bcf3403b80db6f65aba284d7dfe7326af
	https://git.kernel.org/stable/c/8ca170c39eca7cad6e0cfeb24e351d8f8eddcd65
	https://git.kernel.org/stable/c/a90d4471146de21745980cba51ce88e7926bcc4f
