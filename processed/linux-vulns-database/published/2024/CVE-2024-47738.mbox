From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-47738: wifi: mac80211: don't use rate mask for offchannel TX either

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

wifi: mac80211: don't use rate mask for offchannel TX either

Like the commit ab9177d83c04 ("wifi: mac80211: don't use rate mask for
scanning"), ignore incorrect settings to avoid no supported rate warning
reported by syzbot.

The syzbot did bisect and found cause is commit 9df66d5b9f45 ("cfg80211:
fix default HE tx bitrate mask in 2G band"), which however corrects
bitmask of HE MCS and recognizes correctly settings of empty legacy rate
plus HE MCS rate instead of returning -EINVAL.

As suggestions [1], follow the change of SCAN TX to consider this case of
offchannel TX as well.

[1] https://lore.kernel.org/linux-wireless/6ab2dc9c3afe753ca6fdcdd1421e7a1f47e87b84.camel@sipsolutions.net/T/#m2ac2a6d2be06a37c9c47a3d8a44b4f647ed4f024

The Linux kernel CVE team has assigned CVE-2024-47738 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.14 with commit 9df66d5b9f45c39b3925d16e8947cc10009b186d and fixed in 6.1.113 with commit aafca50e71dc8f3192a5bfb325135a7908f3ef9e
	Issue introduced in 5.14 with commit 9df66d5b9f45c39b3925d16e8947cc10009b186d and fixed in 6.6.54 with commit d54455a3a965feb547711aff7afd2ca5deadb99c
	Issue introduced in 5.14 with commit 9df66d5b9f45c39b3925d16e8947cc10009b186d and fixed in 6.10.13 with commit 3565ef215101ffadb5fe5394c70b1fca51376b25
	Issue introduced in 5.14 with commit 9df66d5b9f45c39b3925d16e8947cc10009b186d and fixed in 6.11.2 with commit 43897111481b679508711d3ca881c4c6593e9247
	Issue introduced in 5.14 with commit 9df66d5b9f45c39b3925d16e8947cc10009b186d and fixed in 6.12 with commit e7a7ef9a0742dbd0818d5b15fba2c5313ace765b
	Issue introduced in 5.10.51 with commit 1b728869a13470e4c25e8faf0dbb95a009c6850b
	Issue introduced in 5.12.18 with commit ccedf8163fa66f2db85d863a43f056ac69a5fef5
	Issue introduced in 5.13.3 with commit 5924678a442d0f5ebf33ebb76b470e68414f1318

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-47738
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	include/net/mac80211.h
	net/mac80211/offchannel.c
	net/mac80211/rate.c
	net/mac80211/scan.c
	net/mac80211/tx.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/aafca50e71dc8f3192a5bfb325135a7908f3ef9e
	https://git.kernel.org/stable/c/d54455a3a965feb547711aff7afd2ca5deadb99c
	https://git.kernel.org/stable/c/3565ef215101ffadb5fe5394c70b1fca51376b25
	https://git.kernel.org/stable/c/43897111481b679508711d3ca881c4c6593e9247
	https://git.kernel.org/stable/c/e7a7ef9a0742dbd0818d5b15fba2c5313ace765b
