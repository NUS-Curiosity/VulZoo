From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-38591: RDMA/hns: Fix deadlock on SRQ async events.

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

RDMA/hns: Fix deadlock on SRQ async events.

xa_lock for SRQ table may be required in AEQ. Use xa_store_irq()/
xa_erase_irq() to avoid deadlock.

The Linux kernel CVE team has assigned CVE-2024-38591 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.0 with commit 81fce6291d9999cee692e4118134a8c850b60857 and fixed in 5.10.234 with commit 605889754ee68aacf7c381938fcd5eb654e71822
	Issue introduced in 5.0 with commit 81fce6291d9999cee692e4118134a8c850b60857 and fixed in 5.15.161 with commit 4a3be1a0ffe04c085dd7f79be97c91b0c786df3d
	Issue introduced in 5.0 with commit 81fce6291d9999cee692e4118134a8c850b60857 and fixed in 6.1.93 with commit 756ddbe665ea7f9416951bd76731b174d136eea0
	Issue introduced in 5.0 with commit 81fce6291d9999cee692e4118134a8c850b60857 and fixed in 6.6.33 with commit 22c915af31bd84ffaa46145e317f53333f94a868
	Issue introduced in 5.0 with commit 81fce6291d9999cee692e4118134a8c850b60857 and fixed in 6.8.12 with commit 72dc542f0d8977e7d41d610db6bb65c47cad43e9
	Issue introduced in 5.0 with commit 81fce6291d9999cee692e4118134a8c850b60857 and fixed in 6.9.3 with commit d271e66abac5c7eb8de345b9b44d89f777437a4c
	Issue introduced in 5.0 with commit 81fce6291d9999cee692e4118134a8c850b60857 and fixed in 6.10 with commit b46494b6f9c19f141114a57729e198698f40af37

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-38591
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/infiniband/hw/hns/hns_roce_main.c
	drivers/infiniband/hw/hns/hns_roce_srq.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/605889754ee68aacf7c381938fcd5eb654e71822
	https://git.kernel.org/stable/c/4a3be1a0ffe04c085dd7f79be97c91b0c786df3d
	https://git.kernel.org/stable/c/756ddbe665ea7f9416951bd76731b174d136eea0
	https://git.kernel.org/stable/c/22c915af31bd84ffaa46145e317f53333f94a868
	https://git.kernel.org/stable/c/72dc542f0d8977e7d41d610db6bb65c47cad43e9
	https://git.kernel.org/stable/c/d271e66abac5c7eb8de345b9b44d89f777437a4c
	https://git.kernel.org/stable/c/b46494b6f9c19f141114a57729e198698f40af37
