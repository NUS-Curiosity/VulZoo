From bippy-c9c4e1df01b2 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2024-42244: USB: serial: mos7840: fix crash on resume
Message-Id: <2024080741-CVE-2024-42244-2346@gregkh>
Content-Length: 3042
Lines: 71
X-Developer-Signature: v=1; a=openpgp-sha256; l=3114;
 i=gregkh@linuxfoundation.org; h=from:subject:message-id;
 bh=9KVVfHmJYANB7NYFvkKiAca/l2Pjegov4M570XcuqcM=;
 b=owGbwMvMwCRo6H6F97bub03G02pJDGmb+xN3LfVsKFy+p9q2ZFveJdODz4pF3ST3n++Zk1A7M
 Sz3hkZoRywLgyATg6yYIsuXbTxH91ccUvQytD0NM4eVCWQIAxenAEykPZdhnuW1gy/euPdvPeyj
 c21++ENJE4nN7gwLti7timF6/PSPVfORZVONjjVaabLoAQA=
X-Developer-Key: i=gregkh@linuxfoundation.org; a=openpgp;
 fpr=F4B60CC5BF78C2214A313DCB3147D40DDB2DFB29

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

USB: serial: mos7840: fix crash on resume

Since commit c49cfa917025 ("USB: serial: use generic method if no
alternative is provided in usb serial layer"), USB serial core calls the
generic resume implementation when the driver has not provided one.

This can trigger a crash on resume with mos7840 since support for
multiple read URBs was added back in 2011. Specifically, both port read
URBs are now submitted on resume for open ports, but the context pointer
of the second URB is left set to the core rather than mos7840 port
structure.

Fix this by implementing dedicated suspend and resume functions for
mos7840.

Tested with Delock 87414 USB 2.0 to 4x serial adapter.

[ johan: analyse crash and rewrite commit message; set busy flag on
         resume; drop bulk-in check; drop unnecessary usb_kill_urb() ]

The Linux kernel CVE team has assigned CVE-2024-42244 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.3 with commit d83b405383c9 and fixed in 5.10.222 with commit 932a86a711c7
	Issue introduced in 3.3 with commit d83b405383c9 and fixed in 5.15.163 with commit b14aa5673e0a
	Issue introduced in 3.3 with commit d83b405383c9 and fixed in 6.1.100 with commit 1094ed500987
	Issue introduced in 3.3 with commit d83b405383c9 and fixed in 6.6.41 with commit 5ae6a64f1821
	Issue introduced in 3.3 with commit d83b405383c9 and fixed in 6.9.10 with commit 553e67dec846
	Issue introduced in 3.3 with commit d83b405383c9 and fixed in 6.10 with commit c15a688e4998

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-42244
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/usb/serial/mos7840.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/932a86a711c722b45ed47ba2103adca34d225b33
	https://git.kernel.org/stable/c/b14aa5673e0a8077ff4b74f0bb260735e7d5e6a4
	https://git.kernel.org/stable/c/1094ed500987e67a9d18b0f95e1812f1cc720856
	https://git.kernel.org/stable/c/5ae6a64f18211851c8df6b4221381c438b9a7348
	https://git.kernel.org/stable/c/553e67dec846323b5575e78a776cf594c13f98c4
	https://git.kernel.org/stable/c/c15a688e49987385baa8804bf65d570e362f8576
