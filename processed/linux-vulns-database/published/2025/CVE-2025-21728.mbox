From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-21728: bpf: Send signals asynchronously if !preemptible

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

bpf: Send signals asynchronously if !preemptible

BPF programs can execute in all kinds of contexts and when a program
running in a non-preemptible context uses the bpf_send_signal() kfunc,
it will cause issues because this kfunc can sleep.
Change `irqs_disabled()` to `!preemptible()`.

The Linux kernel CVE team has assigned CVE-2025-21728 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.4.33 with commit fd29a0242f86b2d95ad666aa9f92a3d0f7bfdab6 and fixed in 5.4.291 with commit feba1308bc5e8e04cee751d39fae8a9b407a9034
	Issue introduced in 5.6 with commit 1bc7896e9ef44fd77858b3ef0b8a6840be3a4494 and fixed in 5.10.235 with commit ce51eab2070e295d298f42a2f1db269cd1b56d55
	Issue introduced in 5.6 with commit 1bc7896e9ef44fd77858b3ef0b8a6840be3a4494 and fixed in 5.15.179 with commit e306eaaa3d78b462db5f5b11e0171f9d2b6ca3f4
	Issue introduced in 5.6 with commit 1bc7896e9ef44fd77858b3ef0b8a6840be3a4494 and fixed in 6.1.129 with commit be42a09fe898635b0093c0c8dac1bfabe225c240
	Issue introduced in 5.6 with commit 1bc7896e9ef44fd77858b3ef0b8a6840be3a4494 and fixed in 6.6.76 with commit eeef8e65041a031bd8a747a392c14b76a123a12c
	Issue introduced in 5.6 with commit 1bc7896e9ef44fd77858b3ef0b8a6840be3a4494 and fixed in 6.12.13 with commit 78b97783496b454435639937db3303e900a24d3f
	Issue introduced in 5.6 with commit 1bc7896e9ef44fd77858b3ef0b8a6840be3a4494 and fixed in 6.13.2 with commit 092fc76b7ab4163e008f9cde596a58dad2108260
	Issue introduced in 5.6 with commit 1bc7896e9ef44fd77858b3ef0b8a6840be3a4494 and fixed in 6.14-rc1 with commit 87c544108b612512b254c8f79aa5c0a8546e2cc4
	Issue introduced in 5.5.18 with commit 7930d01afb7281edd9782971e0cca6fe587c7a7b

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-21728
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	kernel/trace/bpf_trace.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/feba1308bc5e8e04cee751d39fae8a9b407a9034
	https://git.kernel.org/stable/c/ce51eab2070e295d298f42a2f1db269cd1b56d55
	https://git.kernel.org/stable/c/e306eaaa3d78b462db5f5b11e0171f9d2b6ca3f4
	https://git.kernel.org/stable/c/be42a09fe898635b0093c0c8dac1bfabe225c240
	https://git.kernel.org/stable/c/eeef8e65041a031bd8a747a392c14b76a123a12c
	https://git.kernel.org/stable/c/78b97783496b454435639937db3303e900a24d3f
	https://git.kernel.org/stable/c/092fc76b7ab4163e008f9cde596a58dad2108260
	https://git.kernel.org/stable/c/87c544108b612512b254c8f79aa5c0a8546e2cc4
