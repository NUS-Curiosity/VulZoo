From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-21835: usb: gadget: f_midi: fix MIDI Streaming descriptor lengths

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

usb: gadget: f_midi: fix MIDI Streaming descriptor lengths

While the MIDI jacks are configured correctly, and the MIDIStreaming
endpoint descriptors are filled with the correct information,
bNumEmbMIDIJack and bLength are set incorrectly in these descriptors.

This does not matter when the numbers of in and out ports are equal, but
when they differ the host will receive broken descriptors with
uninitialized stack memory leaking into the descriptor for whichever
value is smaller.

The precise meaning of "in" and "out" in the port counts is not clearly
defined and can be confusing.  But elsewhere the driver consistently
uses this to match the USB meaning of IN and OUT viewed from the host,
so that "in" ports send data to the host and "out" ports receive data
from it.

The Linux kernel CVE team has assigned CVE-2025-21835 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.2 with commit c8933c3f79568263c90a46f06cf80419e6c63c97 and fixed in 5.4.291 with commit 3a983390d14e8498f303fc5cb23ab7d696b815db
	Issue introduced in 3.2 with commit c8933c3f79568263c90a46f06cf80419e6c63c97 and fixed in 5.10.235 with commit 9f36a89dcb78cb7e37f487b04a16396ac18c0636
	Issue introduced in 3.2 with commit c8933c3f79568263c90a46f06cf80419e6c63c97 and fixed in 5.15.179 with commit d8e86700c8a8cf415e300a0921acd6a8f9b494f8
	Issue introduced in 3.2 with commit c8933c3f79568263c90a46f06cf80419e6c63c97 and fixed in 6.1.129 with commit 9f6860a9c11301b052225ca8825f8d2b1a5825bf
	Issue introduced in 3.2 with commit c8933c3f79568263c90a46f06cf80419e6c63c97 and fixed in 6.6.79 with commit 6ae6dee9f005a2f3b739b85abb6f14a0935699e0
	Issue introduced in 3.2 with commit c8933c3f79568263c90a46f06cf80419e6c63c97 and fixed in 6.12.16 with commit 6b16761a928796e4b49e89a0b1ac284155172726
	Issue introduced in 3.2 with commit c8933c3f79568263c90a46f06cf80419e6c63c97 and fixed in 6.13.4 with commit a2d0694e1f111379c1efdf439dadd3cfd959fe9d
	Issue introduced in 3.2 with commit c8933c3f79568263c90a46f06cf80419e6c63c97 and fixed in 6.14-rc3 with commit da1668997052ed1cb00322e1f3b63702615c9429

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-21835
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/usb/gadget/function/f_midi.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/3a983390d14e8498f303fc5cb23ab7d696b815db
	https://git.kernel.org/stable/c/9f36a89dcb78cb7e37f487b04a16396ac18c0636
	https://git.kernel.org/stable/c/d8e86700c8a8cf415e300a0921acd6a8f9b494f8
	https://git.kernel.org/stable/c/9f6860a9c11301b052225ca8825f8d2b1a5825bf
	https://git.kernel.org/stable/c/6ae6dee9f005a2f3b739b85abb6f14a0935699e0
	https://git.kernel.org/stable/c/6b16761a928796e4b49e89a0b1ac284155172726
	https://git.kernel.org/stable/c/a2d0694e1f111379c1efdf439dadd3cfd959fe9d
	https://git.kernel.org/stable/c/da1668997052ed1cb00322e1f3b63702615c9429
