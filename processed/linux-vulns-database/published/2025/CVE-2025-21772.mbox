From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2025-21772: partitions: mac: fix handling of bogus partition table

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

partitions: mac: fix handling of bogus partition table

Fix several issues in partition probing:

 - The bailout for a bad partoffset must use put_dev_sector(), since the
   preceding read_part_sector() succeeded.
 - If the partition table claims a silly sector size like 0xfff bytes
   (which results in partition table entries straddling sector boundaries),
   bail out instead of accessing out-of-bounds memory.
 - We must not assume that the partition table contains proper NUL
   termination - use strnlen() and strncmp() instead of strlen() and
   strcmp().

The Linux kernel CVE team has assigned CVE-2025-21772 to this issue.


Affected and fixed versions
===========================

	Fixed in 5.4.291 with commit a3e77da9f843e4ab93917d30c314f0283e28c124
	Fixed in 5.10.235 with commit 213ba5bd81b7e97ac6e6190b8f3bc6ba76123625
	Fixed in 5.15.179 with commit 40a35d14f3c0dc72b689061ec72fc9b193f37d1f
	Fixed in 6.1.129 with commit 27a39d006f85e869be68c1d5d2ce05e5d6445bf5
	Fixed in 6.6.79 with commit 92527100be38ede924768f4277450dfe8a40e16b
	Fixed in 6.12.16 with commit 6578717ebca91678131d2b1f4ba4258e60536e9f
	Fixed in 6.13.4 with commit 7fa9706722882f634090bfc9af642bf9ed719e27
	Fixed in 6.14-rc3 with commit 80e648042e512d5a767da251d44132553fe04ae0

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2025-21772
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	block/partitions/mac.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/a3e77da9f843e4ab93917d30c314f0283e28c124
	https://git.kernel.org/stable/c/213ba5bd81b7e97ac6e6190b8f3bc6ba76123625
	https://git.kernel.org/stable/c/40a35d14f3c0dc72b689061ec72fc9b193f37d1f
	https://git.kernel.org/stable/c/27a39d006f85e869be68c1d5d2ce05e5d6445bf5
	https://git.kernel.org/stable/c/92527100be38ede924768f4277450dfe8a40e16b
	https://git.kernel.org/stable/c/6578717ebca91678131d2b1f4ba4258e60536e9f
	https://git.kernel.org/stable/c/7fa9706722882f634090bfc9af642bf9ed719e27
	https://git.kernel.org/stable/c/80e648042e512d5a767da251d44132553fe04ae0
