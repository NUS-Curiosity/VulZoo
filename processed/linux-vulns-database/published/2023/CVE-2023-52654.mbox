From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-52654: io_uring/af_unix: disable sending io_uring over sockets

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

io_uring/af_unix: disable sending io_uring over sockets

File reference cycles have caused lots of problems for io_uring
in the past, and it still doesn't work exactly right and races with
unix_stream_read_generic(). The safest fix would be to completely
disallow sending io_uring files via sockets via SCM_RIGHT, so there
are no possible cycles invloving registered files and thus rendering
SCM accounting on the io_uring side unnecessary.

The Linux kernel CVE team has assigned CVE-2023-52654 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.4.220 with commit 04df9719df1865f6770af9bc7880874af0e594b2 and fixed in 5.4.264 with commit 18824f592aad4124d79751bbc1500ea86ac3ff29
	Issue introduced in 5.10.150 with commit c378c479c5175833bb22ff71974cda47d7b05401 and fixed in 5.10.204 with commit 3fe1ea5f921bf5b71cbfdc4469fb96c05936610e
	Issue introduced in 5.15.75 with commit 813d8fe5d30388f73a21d3a2bf46b0a1fd72498c and fixed in 5.15.143 with commit bcedd497b3b4a0be56f3adf7c7542720eced0792
	Issue introduced in 6.1 with commit 0091bfc81741b8d3aeb3b7ab8636f911b2de6e80 and fixed in 6.1.68 with commit f2f57f51b53be153a522300454ddb3887722fb2c
	Issue introduced in 6.1 with commit 0091bfc81741b8d3aeb3b7ab8636f911b2de6e80 and fixed in 6.6.7 with commit 5a33d385eb36991a91e3dddb189d8679e2aac2be
	Issue introduced in 6.1 with commit 0091bfc81741b8d3aeb3b7ab8636f911b2de6e80 and fixed in 6.7 with commit 705318a99a138c29a512a72c3e0043b3cd7f55f4
	Issue introduced in 5.19.17 with commit b4293c01ee0d0ecdd3cb5801e13f62271144667a
	Issue introduced in 6.0.3 with commit 75e94c7e8859e58aadc15a98cc9704edff47d4f2

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-52654
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	io_uring/rsrc.h
	net/core/scm.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/18824f592aad4124d79751bbc1500ea86ac3ff29
	https://git.kernel.org/stable/c/3fe1ea5f921bf5b71cbfdc4469fb96c05936610e
	https://git.kernel.org/stable/c/bcedd497b3b4a0be56f3adf7c7542720eced0792
	https://git.kernel.org/stable/c/f2f57f51b53be153a522300454ddb3887722fb2c
	https://git.kernel.org/stable/c/5a33d385eb36991a91e3dddb189d8679e2aac2be
	https://git.kernel.org/stable/c/705318a99a138c29a512a72c3e0043b3cd7f55f4
