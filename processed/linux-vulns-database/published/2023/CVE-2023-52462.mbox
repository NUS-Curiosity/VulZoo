From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2023-52462: bpf: fix check for attempt to corrupt spilled pointer

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

bpf: fix check for attempt to corrupt spilled pointer

When register is spilled onto a stack as a 1/2/4-byte register, we set
slot_type[BPF_REG_SIZE - 1] (plus potentially few more below it,
depending on actual spill size). So to check if some stack slot has
spilled register we need to consult slot_type[7], not slot_type[0].

To avoid the need to remember and double-check this in the future, just
use is_spilled_reg() helper.

The Linux kernel CVE team has assigned CVE-2023-52462 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 5.10.163 with commit cdd73a5ed0840da88a3b9ad353f568e6f156d417 and fixed in 5.10.209 with commit 2757f17972d87773b3677777f5682510f13c66ef
	Issue introduced in 5.15.86 with commit 07c286c10a9cedbd71f20269ff3a4e73d9aab2fe and fixed in 5.15.148 with commit 67e6707f07354ed1acb4e65552e97c60cf9d69cf
	Issue introduced in 5.16 with commit 27113c59b6d0a587b29ae72d4ff3f832f58b0651 and fixed in 6.1.75 with commit fc3e3c50a0a4cac1463967c110686189e4a59104
	Issue introduced in 5.16 with commit 27113c59b6d0a587b29ae72d4ff3f832f58b0651 and fixed in 6.6.14 with commit 8dc15b0670594543c356567a1a45b0182ec63174
	Issue introduced in 5.16 with commit 27113c59b6d0a587b29ae72d4ff3f832f58b0651 and fixed in 6.7.2 with commit 40617d45ea05535105e202a8a819e388a2b1f036
	Issue introduced in 5.16 with commit 27113c59b6d0a587b29ae72d4ff3f832f58b0651 and fixed in 6.8 with commit ab125ed3ec1c10ccc36bc98c7a4256ad114a3dae

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2023-52462
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	kernel/bpf/verifier.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/2757f17972d87773b3677777f5682510f13c66ef
	https://git.kernel.org/stable/c/67e6707f07354ed1acb4e65552e97c60cf9d69cf
	https://git.kernel.org/stable/c/fc3e3c50a0a4cac1463967c110686189e4a59104
	https://git.kernel.org/stable/c/8dc15b0670594543c356567a1a45b0182ec63174
	https://git.kernel.org/stable/c/40617d45ea05535105e202a8a819e388a2b1f036
	https://git.kernel.org/stable/c/ab125ed3ec1c10ccc36bc98c7a4256ad114a3dae
