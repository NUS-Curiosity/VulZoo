From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-49685: iio: trigger: sysfs: fix use-after-free on remove

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

iio: trigger: sysfs: fix use-after-free on remove

Ensure that the irq_work has completed before the trigger is freed.

 ==================================================================
 BUG: KASAN: use-after-free in irq_work_run_list
 Read of size 8 at addr 0000000064702248 by task python3/25

 Call Trace:
  irq_work_run_list
  irq_work_tick
  update_process_times
  tick_sched_handle
  tick_sched_timer
  __hrtimer_run_queues
  hrtimer_interrupt

 Allocated by task 25:
  kmem_cache_alloc_trace
  iio_sysfs_trig_add
  dev_attr_store
  sysfs_kf_write
  kernfs_fop_write_iter
  new_sync_write
  vfs_write
  ksys_write
  sys_write

 Freed by task 25:
  kfree
  iio_sysfs_trig_remove
  dev_attr_store
  sysfs_kf_write
  kernfs_fop_write_iter
  new_sync_write
  vfs_write
  ksys_write
  sys_write

 ==================================================================

The Linux kernel CVE team has assigned CVE-2022-49685 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.7 with commit f38bc926d022ebd67baad6ac7fc22c95fbc6238c and fixed in 4.9.321 with commit d6111e7bdb8ec27eb43d01c4cd4ff1620a75f7f2
	Issue introduced in 3.7 with commit f38bc926d022ebd67baad6ac7fc22c95fbc6238c and fixed in 4.14.286 with commit fd5d8fb298a2866c337da635c79d63c3afabcaf7
	Issue introduced in 3.7 with commit f38bc926d022ebd67baad6ac7fc22c95fbc6238c and fixed in 4.19.250 with commit 31ff3309b47d98313c61b8301bf595820cc3cc33
	Issue introduced in 3.7 with commit f38bc926d022ebd67baad6ac7fc22c95fbc6238c and fixed in 5.4.202 with commit 5e39397d60dacc7f5d81d442c1c958eaaaf31128
	Issue introduced in 3.7 with commit f38bc926d022ebd67baad6ac7fc22c95fbc6238c and fixed in 5.10.127 with commit b07a30a774b3c3e584a68dc91779c68ea2da4813
	Issue introduced in 3.7 with commit f38bc926d022ebd67baad6ac7fc22c95fbc6238c and fixed in 5.15.51 with commit 4687c3f955240ca2a576bdc3f742d4d915b6272d
	Issue introduced in 3.7 with commit f38bc926d022ebd67baad6ac7fc22c95fbc6238c and fixed in 5.18.8 with commit 4ef1e521be610b720daeb7cf899fedc7db0274c4
	Issue introduced in 3.7 with commit f38bc926d022ebd67baad6ac7fc22c95fbc6238c and fixed in 5.19 with commit 78601726d4a59a291acc5a52da1d3a0a6831e4e8

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-49685
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/iio/trigger/iio-trig-sysfs.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/d6111e7bdb8ec27eb43d01c4cd4ff1620a75f7f2
	https://git.kernel.org/stable/c/fd5d8fb298a2866c337da635c79d63c3afabcaf7
	https://git.kernel.org/stable/c/31ff3309b47d98313c61b8301bf595820cc3cc33
	https://git.kernel.org/stable/c/5e39397d60dacc7f5d81d442c1c958eaaaf31128
	https://git.kernel.org/stable/c/b07a30a774b3c3e584a68dc91779c68ea2da4813
	https://git.kernel.org/stable/c/4687c3f955240ca2a576bdc3f742d4d915b6272d
	https://git.kernel.org/stable/c/4ef1e521be610b720daeb7cf899fedc7db0274c4
	https://git.kernel.org/stable/c/78601726d4a59a291acc5a52da1d3a0a6831e4e8
