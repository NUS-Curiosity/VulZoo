{
   "containers": {
      "cna": {
         "providerMetadata": {
            "orgId": "f4215fc3-5b6b-47ff-a258-f7189bd81038"
         },
         "descriptions": [
            {
               "lang": "en",
               "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nbpf: Fix request_sock leak in sk lookup helpers\n\nA customer reported a request_socket leak in a Calico cloud environment. We\nfound that a BPF program was doing a socket lookup with takes a refcnt on\nthe socket and that it was finding the request_socket but returning the parent\nLISTEN socket via sk_to_full_sk() without decrementing the child request socket\n1st, resulting in request_sock slab object leak. This patch retains the\nexisting behaviour of returning full socks to the caller but it also decrements\nthe child request_socket if one is present before doing so to prevent the leak.\n\nThanks to Curtis Taylor for all the help in diagnosing and testing this. And\nthanks to Antoine Tenart for the reproducer and patch input.\n\nv2 of this patch contains, refactor as per Daniel Borkmann's suggestions to\nvalidate RCU flags on the listen socket so that it balances with bpf_sk_release()\nand update comments as per Martin KaFai Lau's suggestion. One small change to\nDaniels suggestion, put \"sk = sk2\" under \"if (sk2 != sk)\" to avoid an extra\ninstruction."
            }
         ],
         "affected": [
            {
               "product": "Linux",
               "vendor": "Linux",
               "defaultStatus": "unaffected",
               "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
               "programFiles": [
                  "net/core/filter.c"
               ],
               "versions": [
                  {
                     "version": "edbf8c01de5a104a71ed6df2bf6421ceb2836a8e",
                     "lessThan": "8ffe2e50e9678c8373027492035f094b130437f1",
                     "status": "affected",
                     "versionType": "git"
                  },
                  {
                     "version": "edbf8c01de5a104a71ed6df2bf6421ceb2836a8e",
                     "lessThan": "516760f1d2979903eaad5b437256913c5cd98416",
                     "status": "affected",
                     "versionType": "git"
                  },
                  {
                     "version": "edbf8c01de5a104a71ed6df2bf6421ceb2836a8e",
                     "lessThan": "b03607437ea81b850599f705096b05b85e7a4a71",
                     "status": "affected",
                     "versionType": "git"
                  },
                  {
                     "version": "edbf8c01de5a104a71ed6df2bf6421ceb2836a8e",
                     "lessThan": "5a62b5ba4c0ce8315b6382cd4ace81b48cd121cd",
                     "status": "affected",
                     "versionType": "git"
                  },
                  {
                     "version": "edbf8c01de5a104a71ed6df2bf6421ceb2836a8e",
                     "lessThan": "3046a827316c0e55fc563b4fb78c93b9ca5c7c37",
                     "status": "affected",
                     "versionType": "git"
                  }
               ]
            },
            {
               "product": "Linux",
               "vendor": "Linux",
               "defaultStatus": "affected",
               "repo": "https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git",
               "programFiles": [
                  "net/core/filter.c"
               ],
               "versions": [
                  {
                     "version": "5.2",
                     "status": "affected"
                  },
                  {
                     "version": "0",
                     "lessThan": "5.2",
                     "status": "unaffected",
                     "versionType": "semver"
                  },
                  {
                     "version": "5.4.202",
                     "lessThanOrEqual": "5.4.*",
                     "status": "unaffected",
                     "versionType": "semver"
                  },
                  {
                     "version": "5.10.127",
                     "lessThanOrEqual": "5.10.*",
                     "status": "unaffected",
                     "versionType": "semver"
                  },
                  {
                     "version": "5.15.51",
                     "lessThanOrEqual": "5.15.*",
                     "status": "unaffected",
                     "versionType": "semver"
                  },
                  {
                     "version": "5.18.8",
                     "lessThanOrEqual": "5.18.*",
                     "status": "unaffected",
                     "versionType": "semver"
                  },
                  {
                     "version": "5.19",
                     "lessThanOrEqual": "*",
                     "status": "unaffected",
                     "versionType": "original_commit_for_fix"
                  }
               ]
            }
         ],
         "references": [
            {
               "url": "https://git.kernel.org/stable/c/8ffe2e50e9678c8373027492035f094b130437f1"
            },
            {
               "url": "https://git.kernel.org/stable/c/516760f1d2979903eaad5b437256913c5cd98416"
            },
            {
               "url": "https://git.kernel.org/stable/c/b03607437ea81b850599f705096b05b85e7a4a71"
            },
            {
               "url": "https://git.kernel.org/stable/c/5a62b5ba4c0ce8315b6382cd4ace81b48cd121cd"
            },
            {
               "url": "https://git.kernel.org/stable/c/3046a827316c0e55fc563b4fb78c93b9ca5c7c37"
            }
         ],
         "title": "bpf: Fix request_sock leak in sk lookup helpers",
         "x_generator": {
            "engine": "bippy-5f407fcff5a0"
         }
      }
   },
   "cveMetadata": {
      "assignerOrgId": "f4215fc3-5b6b-47ff-a258-f7189bd81038",
      "cveID": "CVE-2022-49697",
      "requesterUserId": "gregkh@kernel.org",
      "serial": "1",
      "state": "PUBLISHED"
   },
   "dataType": "CVE_RECORD",
   "dataVersion": "5.0"
}
