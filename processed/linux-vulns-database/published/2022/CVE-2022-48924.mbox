From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-48924: thermal: int340x: fix memory leak in int3400_notify()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

thermal: int340x: fix memory leak in int3400_notify()

It is easy to hit the below memory leaks in my TigerLake platform:

unreferenced object 0xffff927c8b91dbc0 (size 32):
  comm "kworker/0:2", pid 112, jiffies 4294893323 (age 83.604s)
  hex dump (first 32 bytes):
    4e 41 4d 45 3d 49 4e 54 33 34 30 30 20 54 68 65  NAME=INT3400 The
    72 6d 61 6c 00 6b 6b 6b 6b 6b 6b 6b 6b 6b 6b a5  rmal.kkkkkkkkkk.
  backtrace:
    [<ffffffff9c502c3e>] __kmalloc_track_caller+0x2fe/0x4a0
    [<ffffffff9c7b7c15>] kvasprintf+0x65/0xd0
    [<ffffffff9c7b7d6e>] kasprintf+0x4e/0x70
    [<ffffffffc04cb662>] int3400_notify+0x82/0x120 [int3400_thermal]
    [<ffffffff9c8b7358>] acpi_ev_notify_dispatch+0x54/0x71
    [<ffffffff9c88f1a7>] acpi_os_execute_deferred+0x17/0x30
    [<ffffffff9c2c2c0a>] process_one_work+0x21a/0x3f0
    [<ffffffff9c2c2e2a>] worker_thread+0x4a/0x3b0
    [<ffffffff9c2cb4dd>] kthread+0xfd/0x130
    [<ffffffff9c201c1f>] ret_from_fork+0x1f/0x30

Fix it by calling kfree() accordingly.

The Linux kernel CVE team has assigned CVE-2022-48924 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.14 with commit 38e44da591303d08b0d965a033e11ade284999d0 and fixed in 4.14.274 with commit f0ddc5184b0127038d05008e2a69f89d1e13f980
	Issue introduced in 4.14 with commit 38e44da591303d08b0d965a033e11ade284999d0 and fixed in 4.19.237 with commit c3fa6d1937a8d0828131a04ae2cd2c30d0668693
	Issue introduced in 4.14 with commit 38e44da591303d08b0d965a033e11ade284999d0 and fixed in 5.4.188 with commit 2e798814e01827871938ff172d2b2ccf1e74b355
	Issue introduced in 4.14 with commit 38e44da591303d08b0d965a033e11ade284999d0 and fixed in 5.10.103 with commit e098933866f9e1dd3ef4eebbe2e3d504f970f599
	Issue introduced in 4.14 with commit 38e44da591303d08b0d965a033e11ade284999d0 and fixed in 5.15.26 with commit ba9efbbf6745750d34c1e87c9539ce9db645ca0a
	Issue introduced in 4.14 with commit 38e44da591303d08b0d965a033e11ade284999d0 and fixed in 5.16.12 with commit 33c73a4d7e7b19313a6b417152f5365016926418
	Issue introduced in 4.14 with commit 38e44da591303d08b0d965a033e11ade284999d0 and fixed in 5.17 with commit 3abea10e6a8f0e7804ed4c124bea2d15aca977c8

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-48924
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/thermal/intel/int340x_thermal/int3400_thermal.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/f0ddc5184b0127038d05008e2a69f89d1e13f980
	https://git.kernel.org/stable/c/c3fa6d1937a8d0828131a04ae2cd2c30d0668693
	https://git.kernel.org/stable/c/2e798814e01827871938ff172d2b2ccf1e74b355
	https://git.kernel.org/stable/c/e098933866f9e1dd3ef4eebbe2e3d504f970f599
	https://git.kernel.org/stable/c/ba9efbbf6745750d34c1e87c9539ce9db645ca0a
	https://git.kernel.org/stable/c/33c73a4d7e7b19313a6b417152f5365016926418
	https://git.kernel.org/stable/c/3abea10e6a8f0e7804ed4c124bea2d15aca977c8
