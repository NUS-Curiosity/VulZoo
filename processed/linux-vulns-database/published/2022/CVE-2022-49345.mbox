From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-49345: net: xfrm: unexport __init-annotated xfrm4_protocol_init()

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

net: xfrm: unexport __init-annotated xfrm4_protocol_init()

EXPORT_SYMBOL and __init is a bad combination because the .init.text
section is freed up after the initialization. Hence, modules cannot
use symbols annotated __init. The access to a freed symbol may end up
with kernel panic.

modpost used to detect it, but it has been broken for a decade.

Recently, I fixed modpost so it started to warn it again, then this
showed up in linux-next builds.

There are two ways to fix it:

  - Remove __init
  - Remove EXPORT_SYMBOL

I chose the latter for this case because the only in-tree call-site,
net/ipv4/xfrm4_policy.c is never compiled as modular.
(CONFIG_XFRM is boolean)

The Linux kernel CVE team has assigned CVE-2022-49345 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 3.15 with commit 2f32b51b609faea1e40bb8c5bd305f1351740936 and fixed in 4.9.318 with commit c58d82a1264813e69119c13e9804e2e60b664ad5
	Issue introduced in 3.15 with commit 2f32b51b609faea1e40bb8c5bd305f1351740936 and fixed in 4.14.283 with commit e53cd3814504b2cadaba4d5a8a07eeea9ddacd03
	Issue introduced in 3.15 with commit 2f32b51b609faea1e40bb8c5bd305f1351740936 and fixed in 4.19.247 with commit 31f3c6a4dcd3260a386e62cef2d5b36e902600a1
	Issue introduced in 3.15 with commit 2f32b51b609faea1e40bb8c5bd305f1351740936 and fixed in 5.4.198 with commit ef6d2354de238b065d8799c80da4be9a6af18e39
	Issue introduced in 3.15 with commit 2f32b51b609faea1e40bb8c5bd305f1351740936 and fixed in 5.10.122 with commit be3884d5cd04ccd58294b83a02d70b7c5fca19d3
	Issue introduced in 3.15 with commit 2f32b51b609faea1e40bb8c5bd305f1351740936 and fixed in 5.15.47 with commit 85a055c03691e51499123194a14a0c249cf33227
	Issue introduced in 3.15 with commit 2f32b51b609faea1e40bb8c5bd305f1351740936 and fixed in 5.17.15 with commit e04d59cfe0c0129df7aba7ef7bb17b96be2a64f2
	Issue introduced in 3.15 with commit 2f32b51b609faea1e40bb8c5bd305f1351740936 and fixed in 5.18.4 with commit 2b253fbc9f7b5db18d716436bdcf8ecef09fd63d
	Issue introduced in 3.15 with commit 2f32b51b609faea1e40bb8c5bd305f1351740936 and fixed in 5.19 with commit 4a388f08d8784af48f352193d2b72aaf167a57a1

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-49345
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	net/ipv4/xfrm4_protocol.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/c58d82a1264813e69119c13e9804e2e60b664ad5
	https://git.kernel.org/stable/c/e53cd3814504b2cadaba4d5a8a07eeea9ddacd03
	https://git.kernel.org/stable/c/31f3c6a4dcd3260a386e62cef2d5b36e902600a1
	https://git.kernel.org/stable/c/ef6d2354de238b065d8799c80da4be9a6af18e39
	https://git.kernel.org/stable/c/be3884d5cd04ccd58294b83a02d70b7c5fca19d3
	https://git.kernel.org/stable/c/85a055c03691e51499123194a14a0c249cf33227
	https://git.kernel.org/stable/c/e04d59cfe0c0129df7aba7ef7bb17b96be2a64f2
	https://git.kernel.org/stable/c/2b253fbc9f7b5db18d716436bdcf8ecef09fd63d
	https://git.kernel.org/stable/c/4a388f08d8784af48f352193d2b72aaf167a57a1
