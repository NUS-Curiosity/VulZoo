From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-48891: regulator: da9211: Use irq handler when ready

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

regulator: da9211: Use irq handler when ready

If the system does not come from reset (like when it is kexec()), the
regulator might have an IRQ waiting for us.

If we enable the IRQ handler before its structures are ready, we crash.

This patch fixes:

[    1.141839] Unable to handle kernel read from unreadable memory at virtual address 0000000000000078
[    1.316096] Call trace:
[    1.316101]  blocking_notifier_call_chain+0x20/0xa8
[    1.322757] cpu cpu0: dummy supplies not allowed for exclusive requests
[    1.327823]  regulator_notifier_call_chain+0x1c/0x2c
[    1.327825]  da9211_irq_handler+0x68/0xf8
[    1.327829]  irq_thread+0x11c/0x234
[    1.327833]  kthread+0x13c/0x154

The Linux kernel CVE team has assigned CVE-2022-48891 to this issue.


Affected and fixed versions
===========================

	Fixed in 4.14.303 with commit 1c1afcb8839b91c09d211ea304faa269763b1f91
	Fixed in 4.19.270 with commit f75cde714e0a67f73ef169aa50d4ed77d04f7236
	Fixed in 5.4.229 with commit d443308edbfb6e9e757b478af908515110d1efd5
	Fixed in 5.10.164 with commit d4aa749e046435f054e94ebf50cad143d6229fae
	Fixed in 5.15.89 with commit 470f6a9175f13a53810734658c35cc5bba33be01
	Fixed in 6.1.7 with commit ad1336274f733a7cb1f87b5c5908165a2c14df53
	Fixed in 6.2 with commit 02228f6aa6a64d588bc31e3267d05ff184d772eb

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-48891
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/regulator/da9211-regulator.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/1c1afcb8839b91c09d211ea304faa269763b1f91
	https://git.kernel.org/stable/c/f75cde714e0a67f73ef169aa50d4ed77d04f7236
	https://git.kernel.org/stable/c/d443308edbfb6e9e757b478af908515110d1efd5
	https://git.kernel.org/stable/c/d4aa749e046435f054e94ebf50cad143d6229fae
	https://git.kernel.org/stable/c/470f6a9175f13a53810734658c35cc5bba33be01
	https://git.kernel.org/stable/c/ad1336274f733a7cb1f87b5c5908165a2c14df53
	https://git.kernel.org/stable/c/02228f6aa6a64d588bc31e3267d05ff184d772eb
