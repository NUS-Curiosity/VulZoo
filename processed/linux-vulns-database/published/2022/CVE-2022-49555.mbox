From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-49555: Bluetooth: hci_qca: Use del_timer_sync() before freeing

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

Bluetooth: hci_qca: Use del_timer_sync() before freeing

While looking at a crash report on a timer list being corrupted, which
usually happens when a timer is freed while still active. This is
commonly triggered by code calling del_timer() instead of
del_timer_sync() just before freeing.

One possible culprit is the hci_qca driver, which does exactly that.

Eric mentioned that wake_retrans_timer could be rearmed via the work
queue, so also move the destruction of the work queue before
del_timer_sync().

The Linux kernel CVE team has assigned CVE-2022-49555 to this issue.


Affected and fixed versions
===========================

	Issue introduced in 4.3 with commit 0ff252c1976da5d80db1377eb39b551931e61826 and fixed in 5.10.120 with commit 4989bb03342941f2b730b37dfa38bce27b543661
	Issue introduced in 4.3 with commit 0ff252c1976da5d80db1377eb39b551931e61826 and fixed in 5.15.45 with commit db03727b4bbbbb36e6ef4cb655c670eefb6448e9
	Issue introduced in 4.3 with commit 0ff252c1976da5d80db1377eb39b551931e61826 and fixed in 5.17.13 with commit 37d17f63d085d601011964ade7371aeebeb6ed4b
	Issue introduced in 4.3 with commit 0ff252c1976da5d80db1377eb39b551931e61826 and fixed in 5.18.2 with commit 2717654ae022e6ea959a4b7b762702fe1a4690c2
	Issue introduced in 4.3 with commit 0ff252c1976da5d80db1377eb39b551931e61826 and fixed in 5.19 with commit 72ef98445aca568a81c2da050532500a8345ad3a

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-49555
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/bluetooth/hci_qca.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/4989bb03342941f2b730b37dfa38bce27b543661
	https://git.kernel.org/stable/c/db03727b4bbbbb36e6ef4cb655c670eefb6448e9
	https://git.kernel.org/stable/c/37d17f63d085d601011964ade7371aeebeb6ed4b
	https://git.kernel.org/stable/c/2717654ae022e6ea959a4b7b762702fe1a4690c2
	https://git.kernel.org/stable/c/72ef98445aca568a81c2da050532500a8345ad3a
