From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-49429: RDMA/hfi1: Prevent panic when SDMA is disabled

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

RDMA/hfi1: Prevent panic when SDMA is disabled

If the hfi1 module is loaded with HFI1_CAP_SDMA off, a call to
hfi1_write_iter() will dereference a NULL pointer and panic. A typical
stack frame is:

  sdma_select_user_engine [hfi1]
  hfi1_user_sdma_process_request [hfi1]
  hfi1_write_iter [hfi1]
  do_iter_readv_writev
  do_iter_write
  vfs_writev
  do_writev
  do_syscall_64

The fix is to test for SDMA in hfi1_write_iter() and fail the I/O with
EINVAL.

The Linux kernel CVE team has assigned CVE-2022-49429 to this issue.


Affected and fixed versions
===========================

	Fixed in 4.14.283 with commit 33794e8e9bcb4affc0ebff9cdec85acc8b8a1762
	Fixed in 4.19.247 with commit 0e4dda8b3f4c07ee9ea670a10ea3171a5e63a86f
	Fixed in 5.4.198 with commit e60ad83f645ee6fadd5a8057ba267aeec54f08fe
	Fixed in 5.10.121 with commit cc80d3c37cec9d6ddb140483647901bc7cc6c31d
	Fixed in 5.15.46 with commit 32e6aea33944f364d51cd263e4cd236393a188b6
	Fixed in 5.17.14 with commit 29952ab85d6c3fe0b7909d9a737f10c58bf6824d
	Fixed in 5.18.3 with commit 22e7e400fd1a890db2ea13686324aff50e972f4f
	Fixed in 5.19 with commit 629e052d0c98e46dde9f0824f0aa437f678d9b8f

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-49429
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/infiniband/hw/hfi1/file_ops.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/33794e8e9bcb4affc0ebff9cdec85acc8b8a1762
	https://git.kernel.org/stable/c/0e4dda8b3f4c07ee9ea670a10ea3171a5e63a86f
	https://git.kernel.org/stable/c/e60ad83f645ee6fadd5a8057ba267aeec54f08fe
	https://git.kernel.org/stable/c/cc80d3c37cec9d6ddb140483647901bc7cc6c31d
	https://git.kernel.org/stable/c/32e6aea33944f364d51cd263e4cd236393a188b6
	https://git.kernel.org/stable/c/29952ab85d6c3fe0b7909d9a737f10c58bf6824d
	https://git.kernel.org/stable/c/22e7e400fd1a890db2ea13686324aff50e972f4f
	https://git.kernel.org/stable/c/629e052d0c98e46dde9f0824f0aa437f678d9b8f
