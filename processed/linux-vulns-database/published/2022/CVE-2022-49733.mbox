From bippy-5f407fcff5a0 Mon Sep 17 00:00:00 2001
From: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
To: <linux-cve-announce@vger.kernel.org>
Reply-to: <cve@kernel.org>, <linux-kernel@vger.kernel.org>
Subject: CVE-2022-49733: ALSA: pcm: oss: Fix race at SNDCTL_DSP_SYNC

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

ALSA: pcm: oss: Fix race at SNDCTL_DSP_SYNC

There is a small race window at snd_pcm_oss_sync() that is called from
OSS PCM SNDCTL_DSP_SYNC ioctl; namely the function calls
snd_pcm_oss_make_ready() at first, then takes the params_lock mutex
for the rest.  When the stream is set up again by another thread
between them, it leads to inconsistency, and may result in unexpected
results such as NULL dereference of OSS buffer as a fuzzer spotted
recently.

The fix is simply to cover snd_pcm_oss_make_ready() call into the same
params_lock mutex with snd_pcm_oss_make_ready_locked() variant.

The Linux kernel CVE team has assigned CVE-2022-49733 to this issue.


Affected and fixed versions
===========================

	Fixed in 5.4.215 with commit 4051324a6dafd7053c74c475e80b3ba10ae672b0
	Fixed in 5.10.148 with commit fce793a056c604b41a298317cf704dae255f1b36
	Fixed in 5.15.68 with commit 8015ef9e8a0ee5cecfd0cb6805834d007ab26f86
	Fixed in 5.19.9 with commit 723ac5ab2891b6c10dd6cc78ef5456af593490eb
	Fixed in 6.0 with commit 8423f0b6d513b259fdab9c9bf4aaa6188d054c2d

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2022-49733
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	sound/core/oss/pcm_oss.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/4051324a6dafd7053c74c475e80b3ba10ae672b0
	https://git.kernel.org/stable/c/fce793a056c604b41a298317cf704dae255f1b36
	https://git.kernel.org/stable/c/8015ef9e8a0ee5cecfd0cb6805834d007ab26f86
	https://git.kernel.org/stable/c/723ac5ab2891b6c10dd6cc78ef5456af593490eb
	https://git.kernel.org/stable/c/8423f0b6d513b259fdab9c9bf4aaa6188d054c2d
