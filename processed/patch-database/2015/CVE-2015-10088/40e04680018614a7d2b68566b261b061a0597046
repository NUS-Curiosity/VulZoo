diff --git a/libproxy/proxy.c b/libproxy/proxy.c
index 8b2bd6a..902954e 100644
--- a/libproxy/proxy.c
+++ b/libproxy/proxy.c
@@ -294,7 +294,6 @@ int http_connect(int sockfd, const char *host, int port, AyProxyData *proxy)
 	char cmd[512];
 	char *inputline = NULL;
 	char *proxy_auth = NULL;
-	char debug_buff[512];
 	int remaining = sizeof(cmd) - 1;
 
 	remaining -= snprintf(cmd, sizeof(cmd), "CONNECT %s:%d HTTP/1.1\r\n", host, port);
@@ -309,17 +308,15 @@ int http_connect(int sockfd, const char *host, int port, AyProxyData *proxy)
 		remaining -= 2;
 	}
 	strncat(cmd, "\r\n", remaining);
-#ifndef DEBUG
-	snprintf(debug_buff, sizeof(debug_buff), "<%s>\n", cmd);
-	debug_print(debug_buff);
+#ifdef DEBUG
+	debug_print("<%s>\n", cmd);
 #endif
 	if (send(sockfd, cmd, strlen(cmd), 0) < 0)
 		return AY_CONNECTION_REFUSED;
 	if (ay_recv_line(sockfd, &inputline) < 0)
 		return AY_CONNECTION_REFUSED;
-#ifndef DEBUG
-	snprintf(debug_buff, sizeof(debug_buff), "<%s>\n", inputline);
-	debug_print(debug_buff);
+#ifdef DEBUG
+	debug_print("<%s>\n", inputline);
 #endif
 	if (!strstr(inputline, "200")) {
 		/* Check if proxy authorization needed */
@@ -344,9 +341,8 @@ int http_connect(int sockfd, const char *host, int port, AyProxyData *proxy)
 		if (ay_recv_line(sockfd, &inputline) < 0) {
 			return AY_CONNECTION_REFUSED;
 		}
-#ifndef DEBUG
-		snprintf(debug_buff, sizeof(debug_buff), "<%s>\n", inputline);
-		debug_print(debug_buff);
+#ifdef DEBUG
+		debug_print("<%s>\n", inputline);
 #endif
 	}
 	free(inputline);
