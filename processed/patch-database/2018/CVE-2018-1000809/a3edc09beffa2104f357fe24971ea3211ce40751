diff --git a/Changelog b/Changelog
index d04af06893..0f5d06d55d 100644
--- a/Changelog
+++ b/Changelog
@@ -1,3 +1,8 @@
+Version 2.23.2, 2018-09-07
+
+  Fixes:
+  * Fix problem with empty username (#1227)
+
 Version 2.23.1, 2018-09-06
 
   Fixes:
diff --git a/Makefile b/Makefile
index 386933e54e..8b2efc351a 100644
--- a/Makefile
+++ b/Makefile
@@ -15,7 +15,7 @@ info:
 	@echo "make ppa          - upload to launchpad stable repo"
 	
 #VERSION=1.3~dev5
-SHORT_VERSION=2.23.1
+SHORT_VERSION=2.23.2
 #SHORT_VERSION=2.10~dev7
 VERSION_JESSIE=${SHORT_VERSION}
 VERSION=${SHORT_VERSION}
diff --git a/deploy/debian-ubuntu/changelog b/deploy/debian-ubuntu/changelog
index ec2b040d43..1a6b801669 100644
--- a/deploy/debian-ubuntu/changelog
+++ b/deploy/debian-ubuntu/changelog
@@ -1,3 +1,10 @@
+python-privacyidea (2.23.2-1trusty) trusty; urgency=medium
+
+  Fixes:
+  * Fix problem with empty username (#1227)
+
+ -- Cornelius Kölbel <cornelius.koelbel@netknights.it>  Fri, 07 Sep 2018 12:00:00 +0200
+
 python-privacyidea (2.23.1-1trusty) trusty; urgency=medium
 
   Fixes:
diff --git a/deploy/debian-virtualenv/changelog b/deploy/debian-virtualenv/changelog
index e0c528015b..4f00056f2a 100644
--- a/deploy/debian-virtualenv/changelog
+++ b/deploy/debian-virtualenv/changelog
@@ -1,3 +1,10 @@
+privacyidea-venv (2.23.2-1) jessie; urgency=medium
+
+  Fixes:
+  * Fix problem with empty username (#1227)
+
+ -- Cornelius Kölbel <cornelius.koelbel@netknights.it>  Fri, 07 Sep 2018 12:00:00 +0200
+
 privacyidea-venv (2.23.1-1) jessie; urgency=medium
 
   Fixes:
diff --git a/deploy/debian-virtualenv/rules b/deploy/debian-virtualenv/rules
index 5a7735de50..61065111a7 100755
--- a/deploy/debian-virtualenv/rules
+++ b/deploy/debian-virtualenv/rules
@@ -12,4 +12,7 @@ override_dh_virtualenv:
 override_dh_shlibdeps:
 	dh_shlibdeps --exclude=numpy --exclude=psycopg2 --exclude=libz --exclude=png16
 
+override_dh_strip:
+	dh_strip --exclude=cffi --exclude=PIL --exclude=Pillow
+
 
diff --git a/doc/conf.py b/doc/conf.py
index 9a911f3ced..9194c27852 100644
--- a/doc/conf.py
+++ b/doc/conf.py
@@ -17,7 +17,7 @@
 # built documents.
 #
 # The short X.Y version.
-version = '2.23.1'
+version = '2.23.2'
 # The full version, including alpha/beta/rc tags.
 #release = '2.16dev5'
 release = version
diff --git a/privacyidea/api/validate.py b/privacyidea/api/validate.py
index 368ada6060..7b29230dd1 100644
--- a/privacyidea/api/validate.py
+++ b/privacyidea/api/validate.py
@@ -164,6 +164,7 @@ def after_request(response):
 
 
 @validate_blueprint.route('/offlinerefill', methods=['POST'])
+@check_user_or_serial_in_request(request)
 @event("validate_offlinerefill", request, g)
 def offlinerefill():
     """
diff --git a/privacyidea/lib/decorators.py b/privacyidea/lib/decorators.py
index d01c7479bb..5bb7433ebd 100644
--- a/privacyidea/lib/decorators.py
+++ b/privacyidea/lib/decorators.py
@@ -84,10 +84,15 @@ def __init__(self, request):
     def __call__(self, func):
         @functools.wraps(func)
         def check_user_or_serial_in_request_wrapper(*args, **kwds):
-            user = self.request.all_data.get("user")
-            serial = self.request.all_data.get("serial")
+            user = self.request.all_data.get("user", "").strip()
+            serial = self.request.all_data.get("serial", "").strip()
             if not serial and not user:
                 raise ParameterError(_("You need to specify a serial or a user."))
+            if "*" in serial:
+                raise ParameterError(_("Invalid serial number."))
+            if "%" in user:
+                raise ParameterError(_("Invalid user."))
+
             f_result = func(*args, **kwds)
             return f_result
 
diff --git a/setup.py b/setup.py
index b025661a2d..9655278b4b 100644
--- a/setup.py
+++ b/setup.py
@@ -5,7 +5,7 @@
 import sys
 
 #VERSION="2.1dev4"
-VERSION="2.23.1"
+VERSION="2.23.2"
 
 # Taken from kennethreitz/requests/setup.py
 package_directory = os.path.realpath(os.path.dirname(__file__))
diff --git a/tests/test_api_validate.py b/tests/test_api_validate.py
index dbf015c4b9..8357225687 100644
--- a/tests/test_api_validate.py
+++ b/tests/test_api_validate.py
@@ -2193,6 +2193,40 @@ def test_30_challenge_text(self):
         remove_token("CHAL3")
         remove_token("CHAL4")
 
+    def test_01_check_invalid_input(self):
+        # Empty username
+        with self.app.test_request_context('/validate/check',
+                                           method='POST',
+                                           data={"user": " ",
+                                                 "pass": ""}):
+            res = self.app.full_dispatch_request()
+            self.assertTrue(res.status_code == 400, res)
+            result = json.loads(res.data).get("result")
+            error_msg = result.get("error").get("message")
+            self.assertEqual("ERR905: You need to specify a serial or a user.", error_msg)
+
+        # wrong username
+        with self.app.test_request_context('/validate/check',
+                                           method='POST',
+                                           data={"user": "h%h",
+                                                 "pass": ""}):
+            res = self.app.full_dispatch_request()
+            self.assertTrue(res.status_code == 400, res)
+            result = json.loads(res.data).get("result")
+            error_msg = result.get("error").get("message")
+            self.assertEqual("ERR905: Invalid user.", error_msg)
+
+        # wrong serial
+        with self.app.test_request_context('/validate/check',
+                                           method='POST',
+                                           data={"serial": "*",
+                                                 "pass": ""}):
+            res = self.app.full_dispatch_request()
+            self.assertTrue(res.status_code == 400, res)
+            result = json.loads(res.data).get("result")
+            error_msg = result.get("error").get("message")
+            self.assertEqual("ERR905: Invalid serial number.", error_msg)
+
 
 class AChallengeResponse(MyTestCase):
 
