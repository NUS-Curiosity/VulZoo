diff --git a/data/inc/editpage.php b/data/inc/editpage.php
index 656b8d51..e5cb4590 100755
--- a/data/inc/editpage.php
+++ b/data/inc/editpage.php
@@ -39,10 +39,10 @@
 			$title = $_POST['title'];
 		//If we are editing an existing page, pass current seo-name.
 		if (isset($_GET['page'])) {
-			$seoname = save_page($title, $_POST['content'], $_POST['hidden'], $_POST['sub_page'], $_POST['description'], $_POST['keywords'], $module_additional_data, $_GET['page']);
+			$seoname = latinOnlyInput(save_page($title, $_POST['content'], $_POST['hidden'], $_POST['sub_page'], $_POST['description'], $_POST['keywords'], $module_additional_data, $_GET['page']));
 		} else {
 		//If we are creating a new page, don't pass seo-name.
-			$seoname = save_page($title, $_POST['content'], $_POST['hidden'], $_POST['sub_page'], $_POST['description'], $_POST['keywords'], $module_additional_data);
+			$seoname = latinOnlyInput(save_page($title, $_POST['content'], $_POST['hidden'], $_POST['sub_page'], $_POST['description'], $_POST['keywords'], $module_additional_data));
 		}
 		//If seoname is false, a file already exists with the same name
 		if (empty($seoname)) {
diff --git a/data/inc/files.php b/data/inc/files.php
index 0f945ee1..d7c9739b 100755
--- a/data/inc/files.php
+++ b/data/inc/files.php
@@ -32,24 +32,27 @@
 </div>
 <?php
 if (isset($_POST['submit'])) {
-		if (!copy($_FILES['filefile']['tmp_name'], 'files/'.$_FILES['filefile']['name']))
+		if (!copy($_FILES['filefile']['tmp_name'], 'files/'.latinOnlyInput(latinOnlyInput($_FILES['filefile']['name']))))
 			show_error($lang['general']['upload_failed'], 1);
 		else {
-			if (strcasecmp(substr($_FILES['filefile']['name'], -3),'php') == 0){
-				if (!rename('files/'.$_FILES['filefile']['name'], 'files/'.$_FILES['filefile']['name'].'.txt')){
+			$lastfour = strtolower(substr(latinOnlyInput($_FILES['filefile']['name']), -4));
+			$lastfive = strtolower(substr(latinOnlyInput($_FILES['filefile']['name']), -5));
+			$blockedExtentions = array('.php','php3','php4','php5','php6','php7','phtml');
+			if (in_array($lastfour, $blockedExtentions) or in_array($lastfive, $blockedExtentions) ){
+				if (!rename('files/'.latinOnlyInput($_FILES['filefile']['name']), 'files/'.latinOnlyInput($_FILES['filefile']['name']).'.txt')){
 					show_error($lang['general']['upload_failed'], 1);
 				}
-				chmod('files/'.$_FILES['filefile']['name'].'.txt', 0775);
+				chmod('files/'.latinOnlyInput($_FILES['filefile']['name']).'.txt', 0775);
 			}else{
-				chmod('files/'.$_FILES['filefile']['name'], 0775);
+				chmod('files/'.latinOnlyInput($_FILES['filefile']['name']), 0775);
 			}
 			?>
 				<div class="menudiv">
-					<strong><?php echo $lang['files']['name']; ?></strong> <?php echo $_FILES['filefile']['name']; ?>
+					<strong><?php echo $lang['files']['name']; ?></strong> <?php echo latinOnlyInput($_FILES['filefile']['name']); ?>
 					<br />
-					<strong><?php echo $lang['files']['size']; ?></strong> <?php echo $_FILES['filefile']['size'].' '.$lang['images']['bytes']; ?>
+					<strong><?php echo $lang['files']['size']; ?></strong> <?php echo latinOnlyInput($_FILES['filefile']['size']).' '.$lang['images']['bytes']; ?>
 					<br />
-					<strong><?php echo $lang['files']['type']; ?></strong> <?php echo $_FILES['filefile']['type']; ?>
+					<strong><?php echo $lang['files']['type']; ?></strong> <?php echo latinOnlyInput($_FILES['filefile']['type']); ?>
 					<br />
 					<strong><?php echo $lang['files']['success']; //TODO: Need to show this message another place, and with show_error(). ?></strong>
 				</div>
@@ -66,6 +69,7 @@
 	if ($files) {
 		natcasesort($files);
 		foreach ($files as $file) {
+			if (!($file == '.htaccess')){
 		?>
 			<div class="menudiv">
 				<span>
@@ -84,6 +88,7 @@
 				</span>
 			</div>
 			<?php
+			}
 		}
 		unset($files);
 	}
diff --git a/data/inc/functions.all.php b/data/inc/functions.all.php
index 31802e2d..fbf9ee21 100644
--- a/data/inc/functions.all.php
+++ b/data/inc/functions.all.php
@@ -215,10 +215,28 @@ function sanitize($var, $html = true) {
  */
 function preventXSS($var) {
 	$var = str_replace('\'', '', $var);
+	$var = htmlspecialchars($var, ENT_COMPAT, 'UTF-8', false);
 
 	return $var;
 }
 
+/**
+ * latinOnlyInput from a URL, to make it ready for saving in a file.
+ *
+ * @since 4.7.5
+ * @package all
+ * @param string $var Variable 
+ * @return string The sanitized variable.
+ * 
+ * Added as bugfix for XSS and backdoor file upload found by s7acktrac3
+ */
+function latinOnlyInput($var) {
+	$var = str_replace(chr(0), '', $var);
+	$var = preg_replace("/[^a-zA-Z0-9.\ -_]+/", "", $var);;
+	return $var;
+}
+
+
 /**
  * Displays or returns an error, notice or success message.
  *
diff --git a/data/inc/images.php b/data/inc/images.php
index 6f09d068..c0067591 100644
--- a/data/inc/images.php
+++ b/data/inc/images.php
@@ -39,17 +39,17 @@
         if (!in_array(strtolower(substr($_FILES['imagefile']['name'], -4)), $imagewhitelist))
 			show_error($lang['general']['upload_failed'], 1);
 		/* end of fix issue 44. Thanks to Klaus.  */
-		if (!copy($_FILES['imagefile']['tmp_name'], 'images/'.$_FILES['imagefile']['name']))
+		if (!copy($_FILES['imagefile']['tmp_name'], 'images/'.latinOnlyInput($_FILES['imagefile']['name'])))
 			show_error($lang['general']['upload_failed'], 1);
 		else {
 			chmod('images/'.$_FILES['imagefile']['name'], 0666);
 			?>
 				<div class="menudiv">
-					<strong><?php echo $lang['images']['name']; ?></strong> <?php echo $_FILES['imagefile']['name']; ?>
+					<strong><?php echo $lang['images']['name']; ?></strong> <?php echo latinOnlyInput($_FILES['imagefile']['name']); ?>
 					<br />
-					<strong><?php echo $lang['images']['size']; ?></strong> <?php echo $_FILES['imagefile']['size'].' '.$lang['images']['bytes']; ?>
+					<strong><?php echo $lang['images']['size']; ?></strong> <?php echo latinOnlyInput($_FILES['imagefile']['size']).' '.$lang['images']['bytes']; ?>
 					<br />
-					<strong><?php echo $lang['images']['type']; ?></strong> <?php echo $_FILES['imagefile']['type']; ?>
+					<strong><?php echo $lang['images']['type']; ?></strong> <?php echo latinOnlyInput($_FILES['imagefile']['type']); ?>
 					<br />
 					<strong><?php echo $lang['images']['success']; //TODO: Need to show this message another place, and with show_error(). ?></strong>
 				</div>
@@ -67,6 +67,7 @@
 	if ($images) {
 		natcasesort($images);
 		foreach ($images as $image) {
+			if (!($image == '.htaccess')){
 		?>
 			<div class="menudiv">
 				<span>
@@ -85,6 +86,7 @@
 				</span>
 			</div>
 			<?php
+			}
 		}
 		unset($images);
 	}
diff --git a/data/modules/.htaccess b/data/modules/.htaccess
new file mode 100644
index 00000000..76635f2d
--- /dev/null
+++ b/data/modules/.htaccess
@@ -0,0 +1,9 @@
+<FilesMatch \.php$>
+    SetHandler None
+</FilesMatch>
+
+<FilesMatch \.phtml>
+    SetHandler None
+</FilesMatch>
+
+Options -ExecCGI
diff --git a/data/themes/.htaccess b/data/themes/.htaccess
new file mode 100644
index 00000000..76635f2d
--- /dev/null
+++ b/data/themes/.htaccess
@@ -0,0 +1,9 @@
+<FilesMatch \.php$>
+    SetHandler None
+</FilesMatch>
+
+<FilesMatch \.phtml>
+    SetHandler None
+</FilesMatch>
+
+Options -ExecCGI
diff --git a/files/.files b/files/.files
deleted file mode 100644
index e69de29b..00000000
diff --git a/files/.htaccess b/files/.htaccess
new file mode 100644
index 00000000..76635f2d
--- /dev/null
+++ b/files/.htaccess
@@ -0,0 +1,9 @@
+<FilesMatch \.php$>
+    SetHandler None
+</FilesMatch>
+
+<FilesMatch \.phtml>
+    SetHandler None
+</FilesMatch>
+
+Options -ExecCGI
diff --git a/images/.htaccess b/images/.htaccess
new file mode 100644
index 00000000..76635f2d
--- /dev/null
+++ b/images/.htaccess
@@ -0,0 +1,9 @@
+<FilesMatch \.php$>
+    SetHandler None
+</FilesMatch>
+
+<FilesMatch \.phtml>
+    SetHandler None
+</FilesMatch>
+
+Options -ExecCGI
diff --git a/images/.images b/images/.images
deleted file mode 100644
index e69de29b..00000000
