diff --git a/hphp/runtime/ext/gd/ext_gd.cpp b/hphp/runtime/ext/gd/ext_gd.cpp
index 3ff392a41c6ad..96db385c0a42f 100644
--- a/hphp/runtime/ext/gd/ext_gd.cpp
+++ b/hphp/runtime/ext/gd/ext_gd.cpp
@@ -7117,6 +7117,10 @@ static int exif_scan_JPEG_header(image_info_type *ImageInfo) {
       case M_SOF13:
       case M_SOF14:
       case M_SOF15:
+        if ((itemlen - 2) < 6) {
+          return 0;
+        }
+
         exif_process_SOFn(Data, marker, &sof_info);
         ImageInfo->Width  = sof_info.width;
         ImageInfo->Height = sof_info.height;
diff --git a/hphp/test/slow/ext_gd/exifreaddata.php b/hphp/test/slow/ext_gd/exifreaddata.php
new file mode 100644
index 0000000000000..e51c9e83da1b3
--- /dev/null
+++ b/hphp/test/slow/ext_gd/exifreaddata.php
@@ -0,0 +1,8 @@
+<?hh
+
+<<__EntryPoint>>
+function main_exifreaddata() {
+  $jpeg = "\xff\xd8\xc9\x00\x03\x04\x03\xf8";
+  $data_stream = "data://text/plain;base64," . base64_encode($jpeg);
+  var_dump(exif_read_data($data_stream));
+}
diff --git a/hphp/test/slow/ext_gd/exifreaddata.php.expectf b/hphp/test/slow/ext_gd/exifreaddata.php.expectf
new file mode 100644
index 0000000000000..34519709efb4e
--- /dev/null
+++ b/hphp/test/slow/ext_gd/exifreaddata.php.expectf
@@ -0,0 +1,2 @@
+Warning: Invalid JPEG file in %s/ext_gd/exifreaddata.php on line 7
+bool(false)
