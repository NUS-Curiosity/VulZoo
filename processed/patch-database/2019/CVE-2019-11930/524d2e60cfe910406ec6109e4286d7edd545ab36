diff --git a/hphp/runtime/ext/mbstring/ext_mbstring.cpp b/hphp/runtime/ext/mbstring/ext_mbstring.cpp
index 0766bfd210e72..7a8d15ed2f352 100644
--- a/hphp/runtime/ext/mbstring/ext_mbstring.cpp
+++ b/hphp/runtime/ext/mbstring/ext_mbstring.cpp
@@ -908,7 +908,7 @@ static bool php_mb_parse_encoding(const Variant& encoding,
   }
   if (!ret) {
     if (return_list && *return_list) {
-      free(*return_list);
+      req::free(*return_list);
       *return_list = nullptr;
     }
     return_size = 0;
diff --git a/hphp/test/slow/ext_mb/mb_detect_order_t54638796.php b/hphp/test/slow/ext_mb/mb_detect_order_t54638796.php
new file mode 100644
index 0000000000000..15bea3e341e06
--- /dev/null
+++ b/hphp/test/slow/ext_mb/mb_detect_order_t54638796.php
@@ -0,0 +1,7 @@
+<?hh
+// Copyright 2004-present Facebook. All Rights Reserved.
+
+<<__EntryPoint>>
+function main() {
+  var_dump(mb_detect_order("UTF-8,\x2c"));
+}
diff --git a/hphp/test/slow/ext_mb/mb_detect_order_t54638796.php.expect b/hphp/test/slow/ext_mb/mb_detect_order_t54638796.php.expect
new file mode 100644
index 0000000000000..5c0c0681d9c1e
--- /dev/null
+++ b/hphp/test/slow/ext_mb/mb_detect_order_t54638796.php.expect
@@ -0,0 +1 @@
+bool(false)
