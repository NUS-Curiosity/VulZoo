diff --git a/files-edit.php b/files-edit.php
index c6efaa57..53dcf196 100644
--- a/files-edit.php
+++ b/files-edit.php
@@ -6,6 +6,7 @@
 
 $allowed_levels = array(9, 8, 7, 0);
 require_once 'bootstrap.php';
+log_in_required($allowed_levels);
 
 $active_nav = 'files';
 
diff --git a/groups-add.php b/groups-add.php
index d5973440..a8884b90 100644
--- a/groups-add.php
+++ b/groups-add.php
@@ -4,6 +4,7 @@
  */
 $allowed_levels = array(9, 8);
 require_once 'bootstrap.php';
+log_in_required($allowed_levels);
 
 $active_nav = 'groups';
 
diff --git a/groups-edit.php b/groups-edit.php
index 0cc35a69..a9c2f1aa 100644
--- a/groups-edit.php
+++ b/groups-edit.php
@@ -4,6 +4,7 @@
  */
 $allowed_levels = array(9, 8);
 require_once 'bootstrap.php';
+log_in_required($allowed_levels);
 
 $active_nav = 'groups';
 
diff --git a/groups.php b/groups.php
index c7d2a49f..d32f3fb7 100644
--- a/groups.php
+++ b/groups.php
@@ -4,6 +4,7 @@
  */
 $allowed_levels = array(9, 8);
 require_once 'bootstrap.php';
+log_in_required($allowed_levels);
 
 $active_nav = 'groups';
 
diff --git a/header.php b/header.php
index 26a2bebe..f85b66a4 100644
--- a/header.php
+++ b/header.php
@@ -8,12 +8,6 @@
  */
 if (!defined('VIEW_TYPE')) define('VIEW_TYPE', 'private');
 
-// Check for an active session
-redirect_if_not_logged_in();
-
-// Check if the current user has permission to view this page.
-redirect_if_role_not_allowed($allowed_levels);
-
 global $flash;
 
 /** If no page title is defined, revert to a default one */
diff --git a/import-orphans.php b/import-orphans.php
index 49578433..dcb99f0d 100644
--- a/import-orphans.php
+++ b/import-orphans.php
@@ -9,6 +9,7 @@
  */
 $allowed_levels = array(9, 8, 7);
 require_once 'bootstrap.php';
+log_in_required($allowed_levels);
 
 $active_nav = 'files';
 $this_page = 'import-orphans.php';
diff --git a/includes/actions.log.export.php b/includes/actions.log.export.php
index 1e57449e..fcacac94 100644
--- a/includes/actions.log.export.php
+++ b/includes/actions.log.export.php
@@ -4,8 +4,7 @@
  */
 $allowed_levels = array(9);
 require_once '../bootstrap.php';
-
-redirect_if_role_not_allowed($allowed_levels);
+log_in_required($allowed_levels);
 
 header('Content-Type: text/csv; charset=utf-8');
 header('Content-Disposition: attachment; filename=data.csv');
diff --git a/includes/cron.log.export.php b/includes/cron.log.export.php
index c56e6e61..7ab03749 100644
--- a/includes/cron.log.export.php
+++ b/includes/cron.log.export.php
@@ -4,8 +4,7 @@
  */
 $allowed_levels = array(9);
 require_once '../bootstrap.php';
-
-redirect_if_role_not_allowed($allowed_levels);
+log_in_required($allowed_levels);
 
 header('Content-Type: text/csv; charset=utf-8');
 header('Content-Disposition: attachment; filename=cron-log.csv');
diff --git a/includes/functions.session.permissions.php b/includes/functions.session.permissions.php
index 90f0d593..a5544902 100644
--- a/includes/functions.session.permissions.php
+++ b/includes/functions.session.permissions.php
@@ -4,7 +4,16 @@
  * client or user.
  */
 
- function extend_session()
+function log_in_required($allowed_levels)
+{
+    // Check for an active session
+    redirect_if_not_logged_in();
+
+    // Check if the current user has permission to view this page.
+    redirect_if_role_not_allowed($allowed_levels);
+}
+
+function extend_session()
 {
     $_SESSION['last_call'] = time();
 }
diff --git a/manage-downloads.php b/manage-downloads.php
index db7fa2cb..6316c3d9 100644
--- a/manage-downloads.php
+++ b/manage-downloads.php
@@ -6,6 +6,8 @@
  */
 $allowed_levels = array(9, 8, 7, 0);
 require_once 'bootstrap.php';
+log_in_required($allowed_levels);
+
 $active_nav = 'files';
 
 $page_title = __('Manage downloads', 'cftp_admin');
diff --git a/manage-files.php b/manage-files.php
index 72acd47a..b7626418 100644
--- a/manage-files.php
+++ b/manage-files.php
@@ -6,6 +6,8 @@
  */
 $allowed_levels = array(9, 8, 7, 0);
 require_once 'bootstrap.php';
+log_in_required($allowed_levels);
+
 $active_nav = 'files';
 
 $page_title = __('Manage files', 'cftp_admin');
diff --git a/options.php b/options.php
index e05cd364..a7e05d31 100644
--- a/options.php
+++ b/options.php
@@ -4,6 +4,7 @@
  */
 $allowed_levels = array(9);
 require_once 'bootstrap.php';
+log_in_required($allowed_levels);
 
 $section = (!empty($_GET['section'])) ? $_GET['section'] : $_POST['section'];
 
@@ -16,6 +17,7 @@
             'xsendfile_enable',
             'footer_custom_enable',
             'files_default_expire',
+            'files_default_public',
             'uploads_organize_folders_by_date',
             'files_descriptions_use_ckeditor',
             'use_browser_lang',
@@ -121,6 +123,7 @@
     /** Values that can be empty */
     $allowed_empty_values = [
         'footer_custom_content',
+        'custom_download_uri',
         'mail_copy_addresses',
         'mail_smtp_host',
         'mail_smtp_port',
diff --git a/process.php b/process.php
index 5de6a7b9..6a52e09d 100644
--- a/process.php
+++ b/process.php
@@ -6,6 +6,7 @@
 /** Process an action */
 $allowed_levels = array(9, 8, 7, 0);
 require_once 'bootstrap.php';
+log_in_required($allowed_levels);
 
 global $auth;
 global $logger;
diff --git a/templates.php b/templates.php
index 16cfbf11..1a512cef 100644
--- a/templates.php
+++ b/templates.php
@@ -4,6 +4,7 @@
  */
 $allowed_levels = array(9);
 require_once 'bootstrap.php';
+log_in_required($allowed_levels);
 
 $page_title    = __("Templates", 'cftp_admin');
 
diff --git a/unblock-ip.php b/unblock-ip.php
index e57c54f1..469efec1 100644
--- a/unblock-ip.php
+++ b/unblock-ip.php
@@ -4,6 +4,7 @@
  */
 $allowed_levels = array(9);
 require_once 'bootstrap.php';
+log_in_required($allowed_levels);
 
 $page_title = __('Unblock IP', 'cftp_admin');
 
diff --git a/upload.php b/upload.php
index 893d39a6..1ecd70de 100644
--- a/upload.php
+++ b/upload.php
@@ -18,6 +18,7 @@
 if (get_option('clients_can_upload') == 1) {
     $allowed_levels[] = 0;
 }
+log_in_required($allowed_levels);
 
 if (LOADED_LANG != 'en') {
     $plupload_lang_file = 'vendor/moxiecode/plupload/js/i18n/' . LOADED_LANG . '.js';
diff --git a/users-add.php b/users-add.php
index 4d4818ca..a64801a5 100644
--- a/users-add.php
+++ b/users-add.php
@@ -4,6 +4,7 @@
  */
 $allowed_levels = array(9);
 require_once 'bootstrap.php';
+log_in_required($allowed_levels);
 
 $active_nav = 'users';
 
diff --git a/users-edit.php b/users-edit.php
index e53cdb88..9329e1f3 100644
--- a/users-edit.php
+++ b/users-edit.php
@@ -4,6 +4,7 @@
  */
 $allowed_levels = array(9, 8, 7);
 require_once 'bootstrap.php';
+log_in_required($allowed_levels);
 
 $active_nav = 'users';
 
diff --git a/users.php b/users.php
index 68bc0c86..59a42ae2 100644
--- a/users.php
+++ b/users.php
@@ -4,6 +4,7 @@
  */
 $allowed_levels = array(9);
 require_once 'bootstrap.php';
+log_in_required($allowed_levels);
 
 $active_nav = 'users';
 
