diff --git a/server/fm-includes/version.php b/server/fm-includes/version.php
index 5f70e762..a564c65a 100644
--- a/server/fm-includes/version.php
+++ b/server/fm-includes/version.php
@@ -24,7 +24,7 @@
  *
  * @global string $fm_version
  */
-$fm_version = '4.5.0';
+$fm_version = '4.5.1';
 
 /**
  * Holds the facileManager DB revision, increments when changes are made to the facileManager DB schema.
diff --git a/server/fm-modules/facileManager/change.log b/server/fm-modules/facileManager/change.log
index 58c88f45..af8da5d1 100644
--- a/server/fm-modules/facileManager/change.log
+++ b/server/fm-modules/facileManager/change.log
@@ -1,3 +1,9 @@
+4.5.1 (2024-01-30)
+==================
+* Server - [security] Fixed authenticated variable manipulation leading to SQL Injection. (Issue #599)
+* Server - [security] Fixed privilege escalation via mass assignment. (Issue #599)
+* Server - [security] Fixed systemic cross-site scripting (XSS). (Issue #599)
+
 4.5.0 (2023-04-19)
 ==================
 * Server - [improvement] The settings now displays the timestamp of the last software update check.
diff --git a/server/fm-modules/facileManager/classes/class_logins.php b/server/fm-modules/facileManager/classes/class_logins.php
index 630ce727..bb8bef15 100644
--- a/server/fm-modules/facileManager/classes/class_logins.php
+++ b/server/fm-modules/facileManager/classes/class_logins.php
@@ -262,7 +262,7 @@ function checkPassword($user_login, $user_password) {
 		if ($auth_method) {
 			/** Use Builtin Auth when Default Auth Method is LDAP but user is defined with 'facileManager/Builtin' */
 			$result = $fmdb->query("SELECT * FROM `fm_users` WHERE `user_login` = '$user_login' and `user_auth_type`=1 and `user_status`='active'");
-			if (is_array($fmdb->last_result) && $fmdb->last_result[0]->user_login == $user_login) {
+			if (isset($fmdb->last_result) && is_array($fmdb->last_result) && $fmdb->last_result[0]->user_login == $user_login) {
 				$auth_method = 1;
 			}
 
diff --git a/server/fm-modules/facileManager/classes/class_users.php b/server/fm-modules/facileManager/classes/class_users.php
index 024222ac..375e12f9 100644
--- a/server/fm-modules/facileManager/classes/class_users.php
+++ b/server/fm-modules/facileManager/classes/class_users.php
@@ -253,8 +253,11 @@ function updateUser($post) {
 		$post['user_id'] = (!isset($post['user_id']) || !$post['user_id']) ? $_SESSION['user']['id'] : intval($post['user_id']);
 
 		/** Authorized to update users? */
-		if ((!currentUserCan('manage_users') && $_SESSION['user']['id'] != $post['user_id']) || isset($post['user_login'])) {
-			return _('You do not have permission to make these changes.');
+		if ((!currentUserCan('manage_users') && ($_SESSION['user']['id'] != $post['user_id'] || isset($post['user_caps']))) 
+			|| ($_SESSION['user']['id'] != $post['user_id'] && $post['user_id'] == getDefaultAdminID()) 
+			|| isset($post['user_login'])
+			|| (isset($post['user_caps']) && $_SESSION['user']['id'] == $post['user_id'] && $_SESSION['user']['id'] == getDefaultAdminID())) {
+				return _('You do not have permission to make these changes.');
 		}
 
 		if (!empty($post['user_password'])) {
diff --git a/server/fm-modules/facileManager/functions.php b/server/fm-modules/facileManager/functions.php
index 08e3ab4f..d3e8ebe0 100644
--- a/server/fm-modules/facileManager/functions.php
+++ b/server/fm-modules/facileManager/functions.php
@@ -216,11 +216,12 @@ function sanitize($data, $replace = null) {
 
 		$data = str_replace($strip_chars, '', $data);
 		$data = str_replace($replace_chars, $replace, $data);
-		$data = str_replace('--', '-', $data);
+		$data = str_replace($replace . $replace, $replace, $data);
 		
 		return $data;
 	} else {
 		if (is_string($data)) {
+			$data = htmlspecialchars(strip_tags($data), ENT_NOQUOTES);
 			if ($fmdb->use_mysqli) {
 				return @mysqli_real_escape_string($fmdb->dbh, $data);
 			} else {
diff --git a/server/fm-modules/facileManager/pages/admin-logs.php b/server/fm-modules/facileManager/pages/admin-logs.php
index 80b0d36e..28e717e2 100644
--- a/server/fm-modules/facileManager/pages/admin-logs.php
+++ b/server/fm-modules/facileManager/pages/admin-logs.php
@@ -28,8 +28,8 @@
 
 $response = isset($response) ? $response : null;
 
-$search_sql = $list = $log_search_query = $log_search_date_b = $log_search_date_e = null;
 extract($_REQUEST);
+$search_sql = null;
 
 /** Module search */
 if (isset($log_search_module) && is_array($log_search_module) && !in_array('All Modules', $log_search_module)) {
@@ -37,7 +37,6 @@
 }
 /** User search */
 $default_timezone = getOption('timezone', $_SESSION['user']['account_id']);
-$list = null;
 if (isset($log_search_user) && is_array($log_search_user) && !in_array('0', $log_search_user)) {
 	$search_sql .= 'AND user_login IN ("' . join('","', $log_search_user) . '") ';
 }
