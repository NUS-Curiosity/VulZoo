diff --git a/app/controllers/application_controller.rb b/app/controllers/application_controller.rb
index 202746bb585..7ebe33d91fa 100644
--- a/app/controllers/application_controller.rb
+++ b/app/controllers/application_controller.rb
@@ -134,7 +134,7 @@ def request_host
   end
 
   def request_path
-    request.env["REQUEST_PATH"] || request.path
+    @request_path ||= SS.request_path(request)
   end
 
   def protect_csrf?
diff --git a/app/controllers/cms/form/columns_controller.rb b/app/controllers/cms/form/columns_controller.rb
index 1fc587372a1..44f8a33ba95 100644
--- a/app/controllers/cms/form/columns_controller.rb
+++ b/app/controllers/cms/form/columns_controller.rb
@@ -153,7 +153,7 @@ def destroy_all
     raise '403' unless @cur_form.allowed?(:delete, @cur_user, site: @cur_site, node: @cur_node)
 
     if params[:destroy_all]
-      render_destroy_all(destroy_items, location: request.path)
+      render_destroy_all(destroy_items, location: SS.request_path(request))
       return
     end
 
diff --git a/app/controllers/cms/search_contents/pages_controller.rb b/app/controllers/cms/search_contents/pages_controller.rb
index c6acb0de51a..fc3e62ab20a 100644
--- a/app/controllers/cms/search_contents/pages_controller.rb
+++ b/app/controllers/cms/search_contents/pages_controller.rb
@@ -83,7 +83,7 @@ def destroy_all
     raise "400" if @selected_items.blank?
 
     if params[:destroy_all]
-      render_confirmed_all(destroy_items, location: request.path)
+      render_confirmed_all(destroy_items, location: SS.request_path(request))
       return
     end
 
diff --git a/app/controllers/cms/users_controller.rb b/app/controllers/cms/users_controller.rb
index c2960f8c123..44ee6b0b0bb 100644
--- a/app/controllers/cms/users_controller.rb
+++ b/app/controllers/cms/users_controller.rb
@@ -70,7 +70,7 @@ def destroy_all
     raise "400" if @selected_items.blank?
 
     if params[:destroy_all]
-      render_destroy_all(disable_all, location: request.path)
+      render_destroy_all(disable_all, location: SS.request_path(request))
       return
     end
 
diff --git a/app/controllers/concerns/cms/crud_filter.rb b/app/controllers/concerns/cms/crud_filter.rb
index dd75d1fd8a5..a43e029243a 100644
--- a/app/controllers/concerns/cms/crud_filter.rb
+++ b/app/controllers/concerns/cms/crud_filter.rb
@@ -137,7 +137,7 @@ def destroy_all
     raise "400" if @selected_items.blank?
 
     if params[:destroy_all]
-      render_confirmed_all(destroy_items, location: request.path)
+      render_confirmed_all(destroy_items, location: SS.request_path(request))
       return
     end
 
@@ -173,7 +173,7 @@ def change_state_all
 
     @change_state = params[:state]
     if params[:change_state_all]
-      render_confirmed_all(change_items_state, location: request.path)
+      render_confirmed_all(change_items_state, location: SS.request_path(request))
       return
     end
 
diff --git a/app/controllers/concerns/cms/public_filter.rb b/app/controllers/concerns/cms/public_filter.rb
index 4ec377d2450..a76049d30a8 100644
--- a/app/controllers/concerns/cms/public_filter.rb
+++ b/app/controllers/concerns/cms/public_filter.rb
@@ -71,7 +71,7 @@ def set_main_path
 
   def redirect_slash
     return unless request.get? || request.head?
-    redirect_to "#{request.path}/"
+    redirect_to "#{SS.request_path(request)}/"
   end
 
   def deny_path
diff --git a/app/controllers/concerns/gws/base_filter.rb b/app/controllers/concerns/gws/base_filter.rb
index b558c3574d6..e1fcfc287f5 100644
--- a/app/controllers/concerns/gws/base_filter.rb
+++ b/app/controllers/concerns/gws/base_filter.rb
@@ -60,7 +60,7 @@ def set_gws_logged_in
     gws_session[@cur_site.id.to_s]['last_logged_in'] ||= begin
       Gws::History.info!(
         :controller, @cur_user, @cur_site,
-        path: request.path, controller: self.class.name.underscore, action: action_name,
+        path: SS.request_path(request), controller: self.class.name.underscore, action: action_name,
         model: Gws::User.name.underscore, item_id: @cur_user.id, mode: 'login', name: @cur_user.name
       ) rescue nil
       Time.zone.now.to_i
@@ -86,7 +86,7 @@ def rescue_action(exception)
     if history_method
       Gws::History.send(
         history_method, :controller, @cur_user, @cur_site,
-        path: request.path, controller: self.class.name.underscore, action: action_name,
+        path: SS.request_path(request), controller: self.class.name.underscore, action: action_name,
         message: "#{exception.class} (#{exception.message})"
       ) rescue nil
     end
diff --git a/app/controllers/concerns/gws/column_filter2.rb b/app/controllers/concerns/gws/column_filter2.rb
index 7a285ff3e17..bb37c0fefd9 100644
--- a/app/controllers/concerns/gws/column_filter2.rb
+++ b/app/controllers/concerns/gws/column_filter2.rb
@@ -93,7 +93,7 @@ def create
     end
 
     @frame_id = "item-#{@item.id}"
-    locals = { ref: request.path, model: @model, item: @item, new_item: true }
+    locals = { ref: SS.request_path(request), model: @model, item: @item, new_item: true }
     render template: "gws/frames/columns/edit", locals: locals, layout: "ss/item_frame"
   end
 
diff --git a/app/controllers/concerns/ss/catch_all_filter.rb b/app/controllers/concerns/ss/catch_all_filter.rb
index dec59fee941..5e6efd6f7f3 100644
--- a/app/controllers/concerns/ss/catch_all_filter.rb
+++ b/app/controllers/concerns/ss/catch_all_filter.rb
@@ -2,6 +2,6 @@ module SS::CatchAllFilter
   extend ActiveSupport::Concern
 
   def index
-    raise ActionController::RoutingError, "No route matches #{request.path}"
+    raise ActionController::RoutingError, "No route matches #{SS.request_path(request)}"
   end
 end
diff --git a/app/controllers/concerns/webmail/base_filter.rb b/app/controllers/concerns/webmail/base_filter.rb
index 04936073d55..d0c07abbc90 100644
--- a/app/controllers/concerns/webmail/base_filter.rb
+++ b/app/controllers/concerns/webmail/base_filter.rb
@@ -43,7 +43,7 @@ def set_webmail_logged_in
     webmail_session['last_logged_in'] ||= begin
       Webmail::History.info!(
         :controller, @cur_user,
-        path: request.path, controller: self.class.name.underscore, action: action_name,
+        path: SS.request_path(request), controller: self.class.name.underscore, action: action_name,
         model: Webmail::User.name.underscore, item_id: @cur_user.id, mode: 'login', name: @cur_user.name
       )
       Time.zone.now.to_i
diff --git a/app/controllers/gws/apis/columns_controller.rb b/app/controllers/gws/apis/columns_controller.rb
index 7c9aa5eac84..f7abd651014 100644
--- a/app/controllers/gws/apis/columns_controller.rb
+++ b/app/controllers/gws/apis/columns_controller.rb
@@ -18,8 +18,8 @@ def cur_form
 
   def ref
     ret = params[:ref]
-    return request.path if ret.blank?
-    return request.path unless trusted_url?(ret)
+    return SS.request_path(request) if ret.blank?
+    return SS.request_path(request) unless trusted_url?(ret)
     ret
   end
 
diff --git a/app/controllers/gws/workflow/columns2_controller.rb b/app/controllers/gws/workflow/columns2_controller.rb
index 4ad092479be..fdd81340a2a 100644
--- a/app/controllers/gws/workflow/columns2_controller.rb
+++ b/app/controllers/gws/workflow/columns2_controller.rb
@@ -89,7 +89,7 @@ def create
     end
 
     @frame_id = "item-#{@item.id}"
-    render template: "gws/frames/columns/edit", locals: { ref: request.path, model: @model, item: @item }, layout: "ss/item_frame"
+    render template: "gws/frames/columns/edit", locals: { ref: SS.request_path(request), model: @model, item: @item }, layout: "ss/item_frame"
   end
 
   def reorder
diff --git a/app/controllers/gws/workflow2/form/columns2_controller.rb b/app/controllers/gws/workflow2/form/columns2_controller.rb
index 47b51584c05..86445dede5c 100644
--- a/app/controllers/gws/workflow2/form/columns2_controller.rb
+++ b/app/controllers/gws/workflow2/form/columns2_controller.rb
@@ -89,7 +89,7 @@ def create
     end
 
     @frame_id = "item-#{@item.id}"
-    render template: "gws/frames/columns/edit", locals: { ref: request.path, model: @model, item: @item }, layout: "ss/item_frame"
+    render template: "gws/frames/columns/edit", locals: { ref: SS.request_path(request), model: @model, item: @item }, layout: "ss/item_frame"
   end
 
   def reorder
diff --git a/app/controllers/uploader/files_controller.rb b/app/controllers/uploader/files_controller.rb
index c780e9f946f..637a4453d16 100644
--- a/app/controllers/uploader/files_controller.rb
+++ b/app/controllers/uploader/files_controller.rb
@@ -157,7 +157,7 @@ def file
 
   def index
     raise "403" unless @cur_node.allowed?(:read, @cur_user, site: @cur_site)
-    return redirect_to("#{request.path}?do=show") unless @item.directory?
+    return redirect_to("#{SS.request_path(request)}?do=show") unless @item.directory?
     set_items(@item.path)
     Uploader::File.set_sanitizer_state(@items, { site_id: @cur_site.id })
     render :index
diff --git a/app/models/cms/api_token.rb b/app/models/cms/api_token.rb
index 84d2a3f5ef3..4f1ed89faac 100644
--- a/app/models/cms/api_token.rb
+++ b/app/models/cms/api_token.rb
@@ -42,7 +42,7 @@ def authenticate(request, opts = {})
       yield api_token.audience if block_given?
 
       History::Log.create_log!(
-        request, nil, controller: request.path, action: action,
+        request, nil, controller: SS.request_path(request), action: action,
         cur_site: site, cur_user: api_token.audience, item: api_token
       ) rescue nil
 
diff --git a/app/models/gws/history.rb b/app/models/gws/history.rb
index aa7a4e0770d..46186764c9b 100644
--- a/app/models/gws/history.rb
+++ b/app/models/gws/history.rb
@@ -133,7 +133,7 @@ def create_controller_log!(request, response, options)
 
       write!(
         severity, :controller, options[:cur_user], options[:cur_site],
-        path: request.path, controller: options[:controller], action: options[:action]
+        path: SS.request_path(request), controller: options[:controller], action: options[:action]
       )
     end
 
diff --git a/app/models/history/log.rb b/app/models/history/log.rb
index 62fc2b6e07c..bf520b10943 100644
--- a/app/models/history/log.rb
+++ b/app/models/history/log.rb
@@ -67,7 +67,7 @@ def create_log!(request, _response, options)
       log              = new
       log.session_id   = request.session.id
       log.request_id   = request.uuid
-      log.url          = request.path
+      log.url          = SS.request_path(request)
       log.controller   = options[:controller]
       log.action       = options[:action]
       log.cur_user     = options[:cur_user]
diff --git a/app/models/ss.rb b/app/models/ss.rb
index 9acce8e31fb..95cb0cfa4de 100644
--- a/app/models/ss.rb
+++ b/app/models/ss.rb
@@ -91,4 +91,8 @@ def each_locale_in_order(&block)
   def deprecator
     @deprecator ||= ActiveSupport::Deprecation.new(SS.version, "SHIRASAGI")
   end
+
+  def request_path(request)
+    Addressable::URI.parse(request.env["REQUEST_PATH"] || request.path).normalize.request_uri
+  end
 end
diff --git a/app/models/ss/oauth2/token_request/jwt_bearer.rb b/app/models/ss/oauth2/token_request/jwt_bearer.rb
index c09657d036f..182e7553520 100644
--- a/app/models/ss/oauth2/token_request/jwt_bearer.rb
+++ b/app/models/ss/oauth2/token_request/jwt_bearer.rb
@@ -112,7 +112,7 @@ def validate_aud
       return
     end
 
-    unless aud.path == @controller.request.path
+    unless aud.path == SS.request_path(@controller.request)
       respond_error :bad_request, "invalid_aud", "malformed aud"
       return
     end
diff --git a/app/models/translate/access_log.rb b/app/models/translate/access_log.rb
index b5fe352af9a..8a04316cc9a 100644
--- a/app/models/translate/access_log.rb
+++ b/app/models/translate/access_log.rb
@@ -27,7 +27,7 @@ class << self
     def create_log!(site, request)
       item = self.new
       item.cur_site = site
-      item.path = request.path
+      item.path = SS.request_path(request)
       item.user_agent = request.user_agent
       item.remote_addr = request.remote_addr
       item.referer = request.referer
diff --git a/app/models/webmail/history.rb b/app/models/webmail/history.rb
index 8e1d09162d6..6425a5557ab 100644
--- a/app/models/webmail/history.rb
+++ b/app/models/webmail/history.rb
@@ -126,7 +126,7 @@ def create_controller_log!(request, response, options)
 
       write!(
         severity, :controller, options[:cur_user],
-        path: request.path, controller: options[:controller], action: options[:action]
+        path: SS.request_path(request), controller: options[:controller], action: options[:action]
       )
     end
 
diff --git a/app/views/article/agents/nodes/map_search/_modal.html.erb b/app/views/article/agents/nodes/map_search/_modal.html.erb
index d678187e143..6a6eadce093 100644
--- a/app/views/article/agents/nodes/map_search/_modal.html.erb
+++ b/app/views/article/agents/nodes/map_search/_modal.html.erb
@@ -7,7 +7,7 @@
   });
 <% end %>
 
-<%= form_tag request.path, multipart: true, method: "get", class: "map-search-settings" do %>
+<%= form_tag SS.request_path(request), multipart: true, method: "get", class: "map-search-settings" do %>
   <%= render "settings" %>
   <footer class="send">
     <%= submit_tag t('facility.submit.search'), name: nil %>
diff --git a/app/views/chorg/results/show.html.erb b/app/views/chorg/results/show.html.erb
index 35444fd1b63..5337ece5906 100644
--- a/app/views/chorg/results/show.html.erb
+++ b/app/views/chorg/results/show.html.erb
@@ -1,12 +1,15 @@
-<% addons = @addons || @item.try(:addons) || [] %>
+<%
+  addons = @addons || @item.try(:addons) || []
+  request_path = SS.request_path(request)
+%>
 
 <div class="cms-tabs">
   <% path = url_for(controller: :run, action: :confirmation) %>
-  <%= link_to(path, class: [ params[:type], request.path.start_with?(path) ? 'current' : nil ]) do %>
+  <%= link_to(path, class: [ params[:type], request_path.start_with?(path) ? 'current' : nil ]) do %>
     <span class="tab-name">実行</span>
   <% end %>
   <% path = url_for(controller: :results, action: :show) %>
-  <%= link_to(path, class: [ params[:type], request.path.start_with?(path) ? 'current' : nil ]) do %>
+  <%= link_to(path, class: [ params[:type], request_path.start_with?(path) ? 'current' : nil ]) do %>
     <span class="tab-name">結果</span>
   <% end %>
 </div>
diff --git a/app/views/chorg/run/confirmation.html.erb b/app/views/chorg/run/confirmation.html.erb
index 498b2d768d3..873beea788d 100644
--- a/app/views/chorg/run/confirmation.html.erb
+++ b/app/views/chorg/run/confirmation.html.erb
@@ -1,10 +1,11 @@
 <div class="cms-tabs">
+  <% request_path = SS.request_path(request) %>
   <% path = url_for(controller: :run, action: :confirmation) %>
-  <%= link_to(path, class: [ params[:type], request.path.start_with?(path) ? 'current' : nil ]) do %>
+  <%= link_to(path, class: [ params[:type], request_path.start_with?(path) ? 'current' : nil ]) do %>
       <span class="tab-name">実行</span>
   <% end %>
   <% path = url_for(controller: :results, action: :show) %>
-  <%= link_to(path, class: [ params[:type], request.path.start_with?(path) ? 'current' : nil ]) do %>
+  <%= link_to(path, class: [ params[:type], request_path.start_with?(path) ? 'current' : nil ]) do %>
       <span class="tab-name">結果</span>
   <% end %>
 </div>
diff --git a/app/views/cms/agents/addons/opendata_ref/resource/_show_edit.html.erb b/app/views/cms/agents/addons/opendata_ref/resource/_show_edit.html.erb
index 4599c5d4e60..a6daba343ab 100644
--- a/app/views/cms/agents/addons/opendata_ref/resource/_show_edit.html.erb
+++ b/app/views/cms/agents/addons/opendata_ref/resource/_show_edit.html.erb
@@ -50,7 +50,7 @@
 </div>
 
 <%
-  update_opendata_resources_path = request.path.dup
+  update_opendata_resources_path = SS.request_path(request).dup
   update_opendata_resources_path << "/" unless update_opendata_resources_path.end_with?("/")
   update_opendata_resources_path << "update_opendata_resources.json"
 %>
diff --git a/app/views/cms/apis/preview/workflow/wizard/frame.html.erb b/app/views/cms/apis/preview/workflow/wizard/frame.html.erb
index 547aad1397d..b732d1fca5d 100644
--- a/app/views/cms/apis/preview/workflow/wizard/frame.html.erb
+++ b/app/views/cms/apis/preview/workflow/wizard/frame.html.erb
@@ -2,7 +2,7 @@
   var options = {};
   options.request_url = SS_Preview.workflowPath.request;
   if (!options.request_url) {
-    options.request_url = "<%= request.path %>";
+    options.request_url = "<%= SS.request_path(request) %>";
   }
   options.workflow_node = "workflow" + "<%= @item.parent ? @item.parent.id : "" %>";
   options.user_id = <%= @cur_user.id %>;
diff --git a/app/views/cms/preview/_tool.html.erb b/app/views/cms/preview/_tool.html.erb
index 832162b890b..f4a2d1de54b 100644
--- a/app/views/cms/preview/_tool.html.erb
+++ b/app/views/cms/preview/_tool.html.erb
@@ -1,5 +1,6 @@
 <%
   cms_form = nil
+  request_path = SS.request_path(request)
 %>
 <% head_for(self) do %>
   <%= stylesheet_link_tag("application", media: "all") %>
@@ -56,7 +57,7 @@
     <% end %>
     SS_Preview.mobile_path = <%== @cur_site.mobile_path.to_json %>;
     <% if @preview_page %>
-      SS_Preview.request_path = <%== request.path.to_json %>;
+      SS_Preview.request_path = <%== request_path.to_json %>;
       SS_Preview.form_item = <%== @preview_item.to_json %>;
     <% end %>
     <% if mode == :preview && rendered %>
@@ -77,7 +78,7 @@
 
       SS_Preview.workflowPath.wizard = <%== cms_apis_preview_workflow_wizard_path(site: @cur_site, preview_date: params[:preview_date], id: ":id").to_json %>;
       SS_Preview.workflowPath.pages = <%== "/.s#{@cur_site.id}/workflow/pages/:id".to_json %>;
-      SS_Preview.workflowPath.request = <%== request.path.to_json %>;
+      SS_Preview.workflowPath.request = <%== request_path.to_json %>;
       SS_Preview.previewPath = <%== cms_preview_path(path: ":path").to_json %>;
       SS_Preview.redirectorPath.newPage = <%== new_page_cms_apis_preview_node_path(site: @cur_site, cid: ":nodeId").to_json %>;
 
diff --git a/app/views/gws/affair/main/_navi.html.erb b/app/views/gws/affair/main/_navi.html.erb
index 4bf78049f90..02c4edda479 100644
--- a/app/views/gws/affair/main/_navi.html.erb
+++ b/app/views/gws/affair/main/_navi.html.erb
@@ -1,6 +1,6 @@
 <%
   def current_navi
-    case request.path
+    case SS.request_path(request)
     when /affair\/overtime\/management\/aggregate/
       "overtime-aggregate"
     when /working_time\/management\/aggregate/
diff --git a/app/views/gws/agents/addons/affair/overtime_result/_show.html.erb b/app/views/gws/agents/addons/affair/overtime_result/_show.html.erb
index 6b387d29edb..028137f447a 100644
--- a/app/views/gws/agents/addons/affair/overtime_result/_show.html.erb
+++ b/app/views/gws/agents/addons/affair/overtime_result/_show.html.erb
@@ -157,13 +157,13 @@
       <%= button_tag t("gws/affair.links.closed_results"), disabled: "disabled" %>
     <% else %>
       <% if @item.allowed?(:edit, @cur_user, site: @cur_site) %>
-        <%= link_to t("gws/affair.links.edit_results"), edit_gws_affair_overtime_result_path(id: @item.id, ref: request.path), class: "ajax-box" %>
+        <%= link_to t("gws/affair.links.edit_results"), edit_gws_affair_overtime_result_path(id: @item.id, ref: SS.request_path(request)), class: "ajax-box" %>
       <% end %>
       <% if @item.result_closeable(@cur_user) %>
-        <%= link_to t("gws/affair.links.close_results"), close_gws_affair_overtime_result_path(id: @item.id, ref: request.path), method: :post, class: "btn close-results", data: { confirm: "結果を確認済みにしてもよろしいですか？" } %>
+        <%= link_to t("gws/affair.links.close_results"), close_gws_affair_overtime_result_path(id: @item.id, ref: SS.request_path(request)), method: :post, class: "btn close-results", data: { confirm: "結果を確認済みにしてもよろしいですか？" } %>
       <% end %>
     <% end %>
   <% else %>
-    <%= link_to t("gws/affair.links.set_results"), edit_gws_affair_overtime_result_path(id: @item.id, ref: request.path), class: "ajax-box" %>
+    <%= link_to t("gws/affair.links.set_results"), edit_gws_affair_overtime_result_path(id: @item.id, ref: SS.request_path(request)), class: "ajax-box" %>
   <% end %>
 </dl>
diff --git a/app/views/gws/agents/addons/workflow2/approver/_show.html.erb b/app/views/gws/agents/addons/workflow2/approver/_show.html.erb
index c1eacd4b979..0055a2dd8c6 100644
--- a/app/views/gws/agents/addons/workflow2/approver/_show.html.erb
+++ b/app/views/gws/agents/addons/workflow2/approver/_show.html.erb
@@ -1,5 +1,5 @@
 <% return unless @cur_form %>
 
-<turbo-frame id="workflow-approver-frame" src="<%= gws_workflow2_frames_approver_path(id: @item, ref: request.path) %>">
+<turbo-frame id="workflow-approver-frame" src="<%= gws_workflow2_frames_approver_path(id: @item, ref: SS.request_path(request)) %>">
   <%= loading %>
 </turbo-frame>
diff --git a/app/views/gws/agents/addons/workflow2/circulation/_show.html.erb b/app/views/gws/agents/addons/workflow2/circulation/_show.html.erb
index f43a727a22a..53085302b8c 100644
--- a/app/views/gws/agents/addons/workflow2/circulation/_show.html.erb
+++ b/app/views/gws/agents/addons/workflow2/circulation/_show.html.erb
@@ -16,5 +16,5 @@
 %>
 
 <turbo-frame id="workflow-circulation-frame">
-  <%= render template: "gws/workflow2/frames/circulations/edit", locals: local_assigns.merge(ref: request.path, workflow_circulation: workflow_circulation) %>
+  <%= render template: "gws/workflow2/frames/circulations/edit", locals: local_assigns.merge(ref: SS.request_path(request), workflow_circulation: workflow_circulation) %>
 </turbo-frame>
diff --git a/app/views/gws/agents/addons/workflow2/inspection/_show.html.erb b/app/views/gws/agents/addons/workflow2/inspection/_show.html.erb
index 60bbcb65a50..667869aef98 100644
--- a/app/views/gws/agents/addons/workflow2/inspection/_show.html.erb
+++ b/app/views/gws/agents/addons/workflow2/inspection/_show.html.erb
@@ -11,5 +11,5 @@
 %>
 
 <turbo-frame id="workflow-inspection-frame">
-  <%= render template: "gws/workflow2/frames/inspections/edit", locals: local_assigns.merge(ref: request.path) %>
+  <%= render template: "gws/workflow2/frames/inspections/edit", locals: local_assigns.merge(ref: SS.request_path(request)) %>
 </turbo-frame>
diff --git a/app/views/gws/chorg/run/confirmation.html.erb b/app/views/gws/chorg/run/confirmation.html.erb
index 8ccf0d3bc2f..484f0cc4fda 100644
--- a/app/views/gws/chorg/run/confirmation.html.erb
+++ b/app/views/gws/chorg/run/confirmation.html.erb
@@ -1,10 +1,11 @@
 <div class="gws-tabs">
+  <% request_path = SS.request_path(request) %>
   <% path = url_for(action: :confirmation) %>
-  <%= link_to(path, class: [ params[:type], request.path.start_with?(path) ? 'current' : nil ]) do %>
+  <%= link_to(path, class: [ params[:type], request_path.start_with?(path) ? 'current' : nil ]) do %>
     <span class="tab-name">実行</span>
   <% end %>
   <% path = url_for(controller: :results, action: :show) %>
-  <%= link_to(path, class: [ params[:type], request.path.start_with?(path) ? 'current' : nil ]) do %>
+  <%= link_to(path, class: [ params[:type], request_path.start_with?(path) ? 'current' : nil ]) do %>
     <span class="tab-name">結果</span>
   <% end %>
 </div>
diff --git a/app/views/gws/columns2/index.html.erb b/app/views/gws/columns2/index.html.erb
index b2e755938db..fd985718ea7 100644
--- a/app/views/gws/columns2/index.html.erb
+++ b/app/views/gws/columns2/index.html.erb
@@ -37,7 +37,7 @@
 <%= ss_stimulus_tag({ "gws/column/drag_drop" => { reorder: url_for(action: :reorder) } }, class: "gws-column-item-list") do %>
   <% items.each do |item| %>
     <turbo-frame id="item-<%= item.id %>">
-      <%= render template: "gws/frames/columns/show", locals: { ref: request.path, model: item.class, item: item } %>
+      <%= render template: "gws/frames/columns/show", locals: { ref: SS.request_path(request), model: item.class, item: item } %>
     </turbo-frame>
   <% end %>
 <% end %>
diff --git a/app/views/gws/elasticsearch/search/main/_tabs.html.erb b/app/views/gws/elasticsearch/search/main/_tabs.html.erb
index 70ceba6e2e9..768f97b658d 100644
--- a/app/views/gws/elasticsearch/search/main/_tabs.html.erb
+++ b/app/views/gws/elasticsearch/search/main/_tabs.html.erb
@@ -14,7 +14,7 @@ end
     <% setting = "Gws::Elasticsearch::Setting::#{type.classify}".constantize.new(cur_site: @cur_site, cur_user: @cur_user) %>
     <% if setting.search_types.present? %>
       <% path = gws_elasticsearch_search_search_path(type: type) %>
-      <%= link_to "#{path}#{params}", class: [ type, (::File.basename(request.path) == type) ? 'current' : nil ] do %>
+      <%= link_to "#{path}#{params}", class: [ type, (::File.basename(SS.request_path(request)) == type) ? 'current' : nil ] do %>
         <span class="tab-name"><%= setting.menu_label %></span>
       <% end %>
     <% end %>
diff --git a/app/views/gws/schedule/todo/main/_category_navi.html.erb b/app/views/gws/schedule/todo/main/_category_navi.html.erb
index 8ab5489591f..34dc2a66c0b 100644
--- a/app/views/gws/schedule/todo/main/_category_navi.html.erb
+++ b/app/views/gws/schedule/todo/main/_category_navi.html.erb
@@ -4,7 +4,7 @@
   <% render_tree_item = proc do |cate| %>
     <% url = url_for(category: cate.id) %>
     <% css_class = %w(tree-item is-open) %>
-    <% css_class << "is-current" if request.path.start_with?(url) %>
+    <% css_class << "is-current" if SS.request_path(request).start_with?(url) %>
     <%= content_tag("div", class: css_class, data: { id: cate.id, filename: cate.name }) do %>
       <%= link_to cate.trailing_name, url, class: "item-name" %>
     <% end %>
diff --git a/app/views/gws/workload/graphs/index.html.erb b/app/views/gws/workload/graphs/index.html.erb
index b35ba2b96bf..8c9f4ef38cf 100644
--- a/app/views/gws/workload/graphs/index.html.erb
+++ b/app/views/gws/workload/graphs/index.html.erb
@@ -8,7 +8,7 @@
       <% render_tree_item = proc do |cate| %>
         <% url = url_for(action: :index, category: cate.id) %>
         <% css_class = %w(tree-item is-open) %>
-        <% css_class << "is-current" if request.path.start_with?(url) %>
+        <% css_class << "is-current" if SS.request_path(request).start_with?(url) %>
         <%= content_tag("div", class: css_class, data: { id: cate.id, filename: cate.id }) do %>
           <%= link_to cate.name, url, class: "item-name" %>
         <% end %>
diff --git a/app/views/history/agents/addons/backup/_show.html.erb b/app/views/history/agents/addons/backup/_show.html.erb
index 0873eed63e4..305ea593de3 100644
--- a/app/views/history/agents/addons/backup/_show.html.erb
+++ b/app/views/history/agents/addons/backup/_show.html.erb
@@ -1,6 +1,6 @@
 <%
   return render(plain: "") if @item.backups.size == 0
-  source = ERB::Util.url_encode(request.path)
+  source = ERB::Util.url_encode(SS.request_path(request))
   top_backups = @item.backups.limit(History.max_histories).to_a
 %>
 <dl class="see">
diff --git a/app/views/opendata/agents/nodes/dataset/resource/graph/bar_content.html.erb b/app/views/opendata/agents/nodes/dataset/resource/graph/bar_content.html.erb
index ddf529b1065..52377e4215e 100644
--- a/app/views/opendata/agents/nodes/dataset/resource/graph/bar_content.html.erb
+++ b/app/views/opendata/agents/nodes/dataset/resource/graph/bar_content.html.erb
@@ -32,7 +32,7 @@ graph.render("bar", name, labels, datasets);
 var types = <%== @item.preview_graph_types.to_json %>;
 var headers = <%== graph.headers.to_json %>;
 graph.renderController(types, headers, function(type) {
-  var url = "<%= request.path %>";
+  var url = "<%= SS.request_path(request) %>";
   url += "?type=" + type + "&graph=1";
 
   graph.destroy();
diff --git a/app/views/opendata/agents/nodes/dataset/resource/graph/line_content.html.erb b/app/views/opendata/agents/nodes/dataset/resource/graph/line_content.html.erb
index 8dcd04cd8f0..19c5d854616 100644
--- a/app/views/opendata/agents/nodes/dataset/resource/graph/line_content.html.erb
+++ b/app/views/opendata/agents/nodes/dataset/resource/graph/line_content.html.erb
@@ -32,7 +32,7 @@ graph.render("line", name, labels, datasets);
 var types = <%== @item.preview_graph_types.to_json %>;
 var headers = <%== graph.headers.to_json %>;
 graph.renderController(types, headers, function(type) {
-  var url = "<%= request.path %>";
+  var url = "<%= SS.request_path(request) %>";
   url += "?type=" + type + "&graph=1";
 
   graph.destroy();
diff --git a/app/views/opendata/agents/nodes/dataset/resource/graph/pie_content.html.erb b/app/views/opendata/agents/nodes/dataset/resource/graph/pie_content.html.erb
index c2cb2c0ed75..19e35b57029 100644
--- a/app/views/opendata/agents/nodes/dataset/resource/graph/pie_content.html.erb
+++ b/app/views/opendata/agents/nodes/dataset/resource/graph/pie_content.html.erb
@@ -35,7 +35,7 @@ graph.render("pie", name, labels, datasets, { headerIndex: <%== @header_index.to
 var types = <%== @item.preview_graph_types.to_json %>;
 var headers = <%== @headers.to_json %>;
 graph.renderController(types, headers, function(type, headerIndex) {
-  var url = "<%= request.path %>";
+  var url = "<%= SS.request_path(request) %>";
   url += "?type=" + type + "&graph=1&headerIndex=" + headerIndex;
 
   graph.destroy();
diff --git a/app/views/opendata/dataset/resource_report_main/index.html.erb b/app/views/opendata/dataset/resource_report_main/index.html.erb
index 235c49f3c74..48ee758a48f 100644
--- a/app/views/opendata/dataset/resource_report_main/index.html.erb
+++ b/app/views/opendata/dataset/resource_report_main/index.html.erb
@@ -1,18 +1,19 @@
 <div class="cms-tabs">
+  <% request_path = SS.request_path(request) %>
   <% if Opendata::ResourceDownloadReport.allowed?(:read, @cur_user, site: @cur_site, node: @cur_node) %>
-    <% css_classes = request.path.start_with?(opendata_dataset_report_downloads_path) ? %w(current) : nil %>
+    <% css_classes = request_path.start_with?(opendata_dataset_report_downloads_path) ? %w(current) : nil %>
     <%= link_to opendata_dataset_report_downloads_path, class: css_classes do %>
       <span class="tab-name"><%= t("opendata.reports.download_reports") %></span>
     <% end %>
   <% end %>
   <% if Opendata::DatasetAccessReport.allowed?(:read, @cur_user, site: @cur_site, node: @cur_node) %>
-    <% css_classes = request.path.start_with?(opendata_dataset_report_accesses_path) ? %w(current) : nil %>
+    <% css_classes = request_path.start_with?(opendata_dataset_report_accesses_path) ? %w(current) : nil %>
     <%= link_to opendata_dataset_report_accesses_path, class: css_classes do %>
       <span class="tab-name"><%= t("opendata.reports.access_reports") %></span>
     <% end %>
   <% end %>
   <% if Opendata::ResourcePreviewReport.allowed?(:read, @cur_user, site: @cur_site, node: @cur_node) %>
-    <% css_classes = request.path.start_with?(opendata_dataset_report_previews_path) ? %w(current) : nil %>
+    <% css_classes = request_path.start_with?(opendata_dataset_report_previews_path) ? %w(current) : nil %>
     <%= link_to opendata_dataset_report_previews_path, class: css_classes do %>
       <span class="tab-name"><%= t("opendata.reports.preview_reports") %></span>
     <% end %>
@@ -60,7 +61,7 @@
   <% end %>
 </div>
 
-<% if request.path.start_with?(opendata_dataset_report_downloads_path) %>
+<% if request_path.start_with?(opendata_dataset_report_downloads_path) %>
   <div class="main-box">
     <div class="markdown-body">
       <%= SS::Addon::Markdown.text_to_html(t("opendata.notice.download_report_notice_md")) %>
diff --git a/app/views/sns/login/_notices.html.erb b/app/views/sns/login/_notices.html.erb
index e048b4938e8..f2dbd2d9711 100644
--- a/app/views/sns/login/_notices.html.erb
+++ b/app/views/sns/login/_notices.html.erb
@@ -9,7 +9,7 @@
     <li class="list-item">
       <div class="info">
         <%= link_to item.name,
-              sns_public_notice_path(id: item, login_path: request.path),
+              sns_public_notice_path(id: item, login_path: SS.request_path(request)),
               class: "title notice-severity-#{item.notice_severity}" %>
         <span class="datetime"><%= ss_time_tag item.released %></span>
       </div>
diff --git a/app/views/sns/login/login.html.erb b/app/views/sns/login/login.html.erb
index 4e911804a82..11de2cc0367 100644
--- a/app/views/sns/login/login.html.erb
+++ b/app/views/sns/login/login.html.erb
@@ -49,7 +49,7 @@
         <% ssos.each do |sso| %>
           <% sso = sso.becomes_with_model %>
           <li class="<%= sso.filename %>">
-            <%= link_to(sso.url(ref: params[:ref].try { |ref| ref.to_s } || default_logged_in_path, login_path: request.path), class: "btn-default") do %>
+            <%= link_to(sso.url(ref: params[:ref].try { |ref| ref.to_s } || default_logged_in_path, login_path: SS.request_path(request)), class: "btn-default") do %>
               <h2 class="name"><%= sso.name %></h2>
               <p class="text"><%= br sso.text %></p>
             <% end %>
diff --git a/app/views/sys/db/colls/index.html.erb b/app/views/sys/db/colls/index.html.erb
index 49c28d6c737..e3a21305927 100644
--- a/app/views/sys/db/colls/index.html.erb
+++ b/app/views/sys/db/colls/index.html.erb
@@ -1,10 +1,11 @@
 <div class="cms-tabs">
+  <% request_path = SS.request_path(request) %>
   <% path = url_for(action: :index) %>
-  <%= link_to(path, class: [ params[:type], request.path.start_with?(path) ? 'current' : nil ]) do %>
+  <%= link_to(path, class: [ params[:type], request_path.start_with?(path) ? 'current' : nil ]) do %>
     <span class="tab-name">Collections</span>
   <% end %>
   <% path = url_for(action: :info) %>
-  <%= link_to(path, class: [ params[:type], request.path.start_with?(path) ? 'current' : nil ]) do %>
+  <%= link_to(path, class: [ params[:type], request_path.start_with?(path) ? 'current' : nil ]) do %>
     <span class="tab-name">Server</span>
   <% end %>
 </div>
diff --git a/app/views/workflow/agents/addons/approver/_show.html.erb b/app/views/workflow/agents/addons/approver/_show.html.erb
index 56f57597e6b..ac2f2ddae25 100644
--- a/app/views/workflow/agents/addons/approver/_show.html.erb
+++ b/app/views/workflow/agents/addons/approver/_show.html.erb
@@ -1,6 +1,6 @@
 <%= jquery do %>
   var options = {};
-  options.request_url = "<%= request.path %>";
+  options.request_url = "<%= SS.request_path(request) %>";
   options.workflow_node = "workflow" + "<%= @cur_node? @cur_node.id : "" %>";
   options.user_id = <%= @cur_user.id %>;
   options.errors = {};
diff --git a/spec/requests/cms/public_controller_spec.rb b/spec/requests/cms/public_controller_spec.rb
new file mode 100644
index 00000000000..cd91d0b86af
--- /dev/null
+++ b/spec/requests/cms/public_controller_spec.rb
@@ -0,0 +1,14 @@
+require 'spec_helper'
+
+describe Cms::PublicController, type: :request, dbscope: :example do
+  let!(:site) { cms_site }
+
+  it do
+    components = %w(docs)
+    components += Array.new(site.path.count("/") + 1) { ".." }
+    components << Rails.root.to_s
+    components << "README.md"
+    path = File.join(*components)
+    expect { get "#{site.full_url}#{path}" }.to raise_error RuntimeError
+  end
+end
