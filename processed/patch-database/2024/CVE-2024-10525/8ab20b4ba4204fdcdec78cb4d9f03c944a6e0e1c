diff --git a/ChangeLog.txt b/ChangeLog.txt
index f328bef72..df6b58396 100644
--- a/ChangeLog.txt
+++ b/ChangeLog.txt
@@ -14,10 +14,11 @@ Broker:
 - Fix mismatched subscribe/unsubscribe with normal/shared topics.
 - Fix crash on bridge using remapped topic being sent a crafted packet.
 
-Library:
+Client library:
 - Fix some error codes being converted to string as "unknown". Closes #2579.
 - Clear SSL error state to avoid spurious error reporting. Closes #3054.
 - Fix "payload format invalid" not being allowed as a PUBREC reason code.
+- Don't allow SUBACK with missing reason codes.
 
 Build:
 - Thread support is re-enabled on Windows.
diff --git a/lib/handle_suback.c b/lib/handle_suback.c
index 64a90135b..09f5d7c49 100644
--- a/lib/handle_suback.c
+++ b/lib/handle_suback.c
@@ -73,6 +73,7 @@ int handle__suback(struct mosquitto *mosq)
 	}
 
 	qos_count = (int)(mosq->in_packet.remaining_length - mosq->in_packet.pos);
+	if(qos_count == 0) return MOSQ_ERR_PROTOCOL;
 	granted_qos = mosquitto__malloc((size_t)qos_count*sizeof(int));
 	if(!granted_qos){
 #ifdef WITH_BROKER
