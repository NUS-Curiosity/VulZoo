diff --git a/includes/core_functions_include.php b/includes/core_functions_include.php
index 37383fb858..7288486b9f 100644
--- a/includes/core_functions_include.php
+++ b/includes/core_functions_include.php
@@ -1973,7 +1973,7 @@ function fusion_get_username($user_id) {
 function fusion_get_userdata($key = NULL) {
     global $userdata;
     if (empty($userdata)) {
-        $userdata = ["user_level" => 0, "user_rights" => "", "user_groups" => "", "user_theme" => 'Default'];
+        $userdata = ["user_level" => 0, "user_rights" => "", "user_groups" => "", "user_theme" => 'Default', "user_ip"=>USER_IP];
     }
     $userdata = $userdata + [
             "user_id"     => 0,
diff --git a/infusions/member_poll_panel/poll_classes.php b/infusions/member_poll_panel/poll_classes.php
index 47729bb842..5c4ad696a3 100644
--- a/infusions/member_poll_panel/poll_classes.php
+++ b/infusions/member_poll_panel/poll_classes.php
@@ -455,9 +455,10 @@ public function DisplayPoll() {
                     $render['poll_table'][0]['poll_option'][] = form_checkbox('check', $data1, '-1', ['reverse_label' => TRUE, 'type' => 'radio', 'value' => $im1, 'input_id' => 'check-'.$im1]);
                 }
 
-                $render['poll_table'][0]['openform'] = openform('voteform', 'post', clean_request(), ['enctype' => TRUE]).form_hidden('poll_id', '', $data['poll_id']);
+                $render['poll_table'][0]['openform'] = openform('voteform', 'post', clean_request(), ['max_tokens'=>1]).form_hidden('poll_id', '', $data['poll_id']);
                 $render['poll_table'][0]['button'] = form_button("cast_vote", self::$locale['POLL_020'], self::$locale['POLL_020'], ['class' => 'btn-primary']);
                 $render['poll_table'][0]['closeform'] = closeform();
+
             } else {
                 if (!empty($data['poll_title']) && $data['poll_started'] < time()) {
                     $render['poll_table'][0]['max_vote'] = $this->_countVote("poll_id='".$data['poll_id']."'");
