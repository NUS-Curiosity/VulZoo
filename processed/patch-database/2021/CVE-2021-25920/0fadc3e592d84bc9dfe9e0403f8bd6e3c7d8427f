diff --git a/interface/orders/patient_match_dialog.php b/interface/orders/patient_match_dialog.php
index 85a96126920..f5f06fbc656 100644
--- a/interface/orders/patient_match_dialog.php
+++ b/interface/orders/patient_match_dialog.php
@@ -52,7 +52,7 @@ function myRestoreSession() {
 
     function openPatient(ptid) {
         var f = opener.document.forms[0];
-        var ename = '<?php echo addslashes("select[$form_key]"); ?>';
+        var ename = <?php echo js_escape("select[$form_key]"); ?>;
         if (f[ename]) {
             f[ename].value = ptid;
             window.close();
diff --git a/interface/patient_file/report/patient_report.php b/interface/patient_file/report/patient_report.php
index fed7fcd533f..c87167cef03 100644
--- a/interface/patient_file/report/patient_report.php
+++ b/interface/patient_file/report/patient_report.php
@@ -329,7 +329,7 @@ function show_date_fun(){
                                                 echo attr($ierow['encounter']) . "/";
                                             }
 
-                                            echo "' />$disptitle</td>\n";
+                                            echo "' />" . text($disptitle) . "</td>\n";
                                             echo "     <td>" . text($prow['begdate']);
 
                                             if ($prow['enddate']) {
diff --git a/interface/usergroup/mfa_registrations.php b/interface/usergroup/mfa_registrations.php
index 87f386fc13a..19b98830987 100644
--- a/interface/usergroup/mfa_registrations.php
+++ b/interface/usergroup/mfa_registrations.php
@@ -136,7 +136,7 @@ function addclick(sel) {
                     <input type="hidden" name="csrf_token_form" value="<?php echo attr(CsrfUtils::collectCsrfToken()); ?>" />
                     <div>
                         <fieldset>
-                            <legend><?php echo xlt('Current Authentication Method for') . " " . $user_full_name; ?></legend>
+                            <legend><?php echo xlt('Current Authentication Method for') . " " . text($user_full_name); ?></legend>
                             <table class='table'>
                                 <tr>
                                   <th align='left'>&nbsp;<?php echo xlt('Method'); ?>&nbsp;</th>
@@ -165,7 +165,7 @@ function addclick(sel) {
                     </div>
                     <div>
                         <fieldset>
-                            <legend><?php echo xlt('Select/Add New Authentication Method for') . " " . $user_full_name; ?></legend>
+                            <legend><?php echo xlt('Select/Add New Authentication Method for') . " " . text($user_full_name); ?></legend>
                             <div class='col-sm-4 offset-sm-4'>
                                 <select name='form_add' onchange='addclick(this)'class='col-sm-12'>
                                     <option value=''><?php echo xlt('Add New...'); ?></option>
diff --git a/interface/usergroup/mfa_totp.php b/interface/usergroup/mfa_totp.php
index 92b8c3dfa80..81bc932a2b5 100644
--- a/interface/usergroup/mfa_totp.php
+++ b/interface/usergroup/mfa_totp.php
@@ -109,7 +109,7 @@ function docancel() {
                             ?>
                             <div>
                                 <fieldset>
-                                    <legend><?php echo xlt('Provide Password for') . " " . $user_full_name; ?></legend>
+                                    <legend><?php echo xlt('Provide Password for') . " " . text($user_full_name); ?></legend>
                                     <div class="row">
                                         <div class="col-sm-12">
                                             <?php if ($error == "auth") { ?>
@@ -170,7 +170,7 @@ function docancel() {
                             }
                             ?>
                             <fieldset>
-                                <legend><?php echo xlt('Register TOTP Key for') . " " . $user_full_name; ?></legend>
+                                <legend><?php echo xlt('Register TOTP Key for') . " " . text($user_full_name); ?></legend>
                                 <div class="row">
                                     <div class="col-sm-12">
                                         <?php if (!$doesExist) { ?>
diff --git a/interface/usergroup/mfa_u2f.php b/interface/usergroup/mfa_u2f.php
index 262707a53ca..9989e5aeecf 100644
--- a/interface/usergroup/mfa_u2f.php
+++ b/interface/usergroup/mfa_u2f.php
@@ -101,7 +101,7 @@ function docancel() {
         <div class="row">
             <div class="col-sm-12">
                 <fieldset>
-                    <legend><?php echo xlt('Register U2F Key for') . " " . $user_full_name; ?></legend>
+                    <legend><?php echo xlt('Register U2F Key for') . " " . text($user_full_name); ?></legend>
                     <div class='col-sm-12'>
                         <p><?php echo xlt("Instructions");?>:
                             <ul>
diff --git a/interface/usergroup/usergroup_admin.php b/interface/usergroup/usergroup_admin.php
index debb1d2bbe9..feb4936b008 100644
--- a/interface/usergroup/usergroup_admin.php
+++ b/interface/usergroup/usergroup_admin.php
@@ -277,12 +277,10 @@
         $calvar = (!empty($_POST["calendar"])) ? 1 : 0;
         $portalvar = (!empty($_POST["portal_user"])) ? 1 : 0;
 
-        $res = sqlStatement("select distinct username from users where username != ''");
+        $res = sqlQuery("select username from users where username = ?", [trim($_POST['rumple'])]);
         $doit = true;
-        while ($row = sqlFetchArray($res)) {
-            if ($doit == true && $row['username'] == trim($_POST['rumple'])) {
-                $doit = false;
-            }
+        if (!empty($res['username'])) {
+            $doit = false;
         }
 
         if ($doit == true) {
