diff --git a/RELEASE_NOTES.txt b/RELEASE_NOTES.txt
index 6f10b92393..75e990c92a 100644
--- a/RELEASE_NOTES.txt
+++ b/RELEASE_NOTES.txt
@@ -26,6 +26,9 @@ What's New in Revive Adserver 5.1.1
  * Fixed reflected XSS vulnerability in userlog-index.php via the
    period_preset parameter.
 
+ * Fixed reflected XSS vulnerability in stats.php via the setPerPage
+   parameter.
+
 
  New Features
  ------------
diff --git a/lib/OA/Admin/Statistics/Common.php b/lib/OA/Admin/Statistics/Common.php
index a883a215eb..63bea3078e 100644
--- a/lib/OA/Admin/Statistics/Common.php
+++ b/lib/OA/Admin/Statistics/Common.php
@@ -1193,12 +1193,14 @@ function _loadParams($aMergeArray = null, $clearParams = false)
 
         // Add new params from $_GET/session
         foreach ($aVarArray as $k => $v) {
-            $this->aPageParams[$v] = htmlspecialchars(MAX_getStoredValue($v, ''));
+            $this->aPageParams[$v] = htmlspecialchars(MAX_getStoredValue($v, ''), ENT_QUOTES);
         }
 
         // Ensure the setPerPage value is set
         if (empty($this->aPageParams['setPerPage'])) {
             $this->aPageParams['setPerPage'] = 15;
+        } else {
+            $this->aPageParams['setPerPage'] = (int) $this->aPageParams['setPerPage'];
         }
 
         // Merge params with optional array, if required
diff --git a/lib/OA/Admin/Statistics/Delivery/CommonHistory.php b/lib/OA/Admin/Statistics/Delivery/CommonHistory.php
index 8d039198c3..a0d0492460 100644
--- a/lib/OA/Admin/Statistics/Delivery/CommonHistory.php
+++ b/lib/OA/Admin/Statistics/Delivery/CommonHistory.php
@@ -164,7 +164,7 @@ function prepare(&$aParams, $link = '')
         if ($use_pager) {
             $params = array(
                 'itemData' => $stats,
-                'perPage' => htmlspecialchars(MAX_getStoredValue('setPerPage', $per_page)),
+                'perPage' => (int) MAX_getStoredValue('setPerPage', $per_page),
                 'delta' => 8,
                 'append' => true,
                 'clearIfVoid' => false,
diff --git a/www/admin/connections-modify.php b/www/admin/connections-modify.php
index 0705720d95..be9e1afcde 100644
--- a/www/admin/connections-modify.php
+++ b/www/admin/connections-modify.php
@@ -41,8 +41,8 @@
 $hour          = MAX_getValue('hour');
 $returnurl     = MAX_getValue('returnurl');
 $statusIds     = MAX_getValue('statusIds');
-$pageID        = MAX_getValue('pageID');
-$setPerPage    = MAX_getValue('setPerPage');
+$pageID        = (int) MAX_getValue('pageID');
+$setPerPage    = (int) MAX_getValue('setPerPage', 15);
 
 $aParams = array();
 
diff --git a/www/admin/stats-conversions.php b/www/admin/stats-conversions.php
index ed39410468..6d8d663bb8 100644
--- a/www/admin/stats-conversions.php
+++ b/www/admin/stats-conversions.php
@@ -36,8 +36,8 @@
 $day            = MAX_getStoredValue('day', null, 'stats-conversions.php');
 $howLong        = MAX_getStoredValue('howLong', 'd');
 $hour           = MAX_getStoredValue('hour', null, 'stats-conversions.php', true);
-$setPerPage     = MAX_getStoredValue('setPerPage', 15);
-$pageID         = MAX_getStoredValue('pageID', 1);
+$setPerPage     = (int) MAX_getStoredValue('setPerPage', 15);
+$pageID         = (int) MAX_getStoredValue('pageID', 1);
 
 if (!empty($day)) {
     // Reset period
@@ -225,7 +225,7 @@
 
 
 $aParams['totalItems'] = count($aConversions);
-$aParams['perPage'] = MAX_getStoredValue('setPerPage', 15);
+$aParams['perPage'] = (int) MAX_getStoredValue('setPerPage', 15);
 
 if (!isset($pageID) || $pageID == 1) {
     $aParams['startRecord'] = 0;
@@ -238,9 +238,6 @@
 $aConversions = Admin_DA::fromCache('getConversions', $aParams + $aDates);
 
 
-$aParams['perPage'] = MAX_getStoredValue('setPerPage', 15);
-//$aParams['startRecord'] = $_REQUEST['page'];
-
 $pager = & Pager::factory($aParams);
 $per_page = $pager->_perPage;
 $pager->history = $pager->getPageData();
diff --git a/www/admin/userlog-index.php b/www/admin/userlog-index.php
index d46d532ef9..f2b0a070ac 100644
--- a/www/admin/userlog-index.php
+++ b/www/admin/userlog-index.php
@@ -88,8 +88,8 @@
         $orderdirection = 'up';
     }
 }
-$setPerPage     = MAX_getStoredValue('setPerPage',      10);
-$pageID         = MAX_getStoredValue('pageID',          1);
+$setPerPage     = (int) MAX_getStoredValue('setPerPage',      10);
+$pageID         = (int) MAX_getStoredValue('pageID',          1);
 
 // Setup date selector
 $aPeriod = array(
@@ -205,7 +205,7 @@
     $aParams['startRecord'] = 0;
 }
 
-$aParams['perPage'] = MAX_getStoredValue('setPerPage', 10);
+$aParams['perPage'] = (int) MAX_getStoredValue('setPerPage', 10);
 
 // Retrieve audit details
 $aAuditData = $oUserlog->getAuditLog($aParams);
