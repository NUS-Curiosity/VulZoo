diff --git a/core/pom.xml b/core/pom.xml
index 0686f8de3..f828bec4d 100644
--- a/core/pom.xml
+++ b/core/pom.xml
@@ -63,6 +63,11 @@
       <optional>true</optional>
     </dependency>
 
+    <dependency>
+      <groupId>org.owasp.encoder</groupId>
+      <artifactId>encoder</artifactId>
+    </dependency>
+
     <!-- region - Needed for testing -->
     <dependency>
       <groupId>org.springframework</groupId>
diff --git a/core/src/main/java/pt/webdetails/cpf/packager/DependenciesPackage.java b/core/src/main/java/pt/webdetails/cpf/packager/DependenciesPackage.java
index 069e5c018..1b1ea3980 100644
--- a/core/src/main/java/pt/webdetails/cpf/packager/DependenciesPackage.java
+++ b/core/src/main/java/pt/webdetails/cpf/packager/DependenciesPackage.java
@@ -1,5 +1,5 @@
 /*!
- * Copyright 2002 - 2019 Webdetails, a Hitachi Vantara company.  All rights reserved.
+ * Copyright 2002 - 2021 Webdetails, a Hitachi Vantara company.  All rights reserved.
  *
  * This software was developed by Webdetails and is provided under the terms
  * of the Mozilla Public License, Version 2.0, or any later version. You may not use
@@ -12,6 +12,7 @@
  */
 package pt.webdetails.cpf.packager;
 
+import org.owasp.encoder.Encode;
 import pt.webdetails.cpf.context.api.IUrlProvider;
 import pt.webdetails.cpf.packager.dependencies.CssMinifiedDependency;
 import pt.webdetails.cpf.packager.dependencies.Dependency;
@@ -276,6 +277,7 @@ public String filter( String input ) {
           }
 
           public String filter( String input, String baseUrl ) {
+            baseUrl = Encode.forHtmlAttribute( baseUrl );
             return String.format(
               "\t\t<link href=\"%s%s\" rel=\"stylesheet\" type=\"text/css\" />\n",
               baseUrl, baseUrl.endsWith( "/" ) && input.startsWith( "/" ) ? input.replaceFirst( "/", "" ) : input );
@@ -288,6 +290,7 @@ public String filter( String input ) {
           }
 
           public String filter( String input, String baseUrl ) {
+            baseUrl = Encode.forHtmlAttribute( baseUrl );
             return String.format(
               "\t\t<script language=\"javascript\" type=\"text/javascript\" src=\"%s%s\"></script>\n",
               baseUrl, baseUrl.endsWith( "/" ) && input.startsWith( "/" ) ? input.replaceFirst( "/", "" ) : input );
@@ -312,7 +315,7 @@ public String filter( String input ) {
           }
 
           public String filter( String input, String baseUrl ) {
-            return baseUrl + input + "\n";
+            return Encode.forHtmlAttribute( baseUrl ) + input + "\n";
           }
         };
     }
diff --git a/core/src/test/java/pt/webdetails/cpf/packager/DependenciesPackageTest.java b/core/src/test/java/pt/webdetails/cpf/packager/DependenciesPackageTest.java
index f2afc603f..7217f300a 100644
--- a/core/src/test/java/pt/webdetails/cpf/packager/DependenciesPackageTest.java
+++ b/core/src/test/java/pt/webdetails/cpf/packager/DependenciesPackageTest.java
@@ -1,5 +1,5 @@
 /*!
- * Copyright 2002 - 2017 Webdetails, a Hitachi Vantara company.  All rights reserved.
+ * Copyright 2002 - 2021 Webdetails, a Hitachi Vantara company.  All rights reserved.
  *
  * This software was developed by Webdetails and is provided under the terms
  * of the Mozilla Public License, Version 2.0, or any later version. You may not use
@@ -172,6 +172,23 @@ public void testGetDefaultFilter() {
     assertEquals( "", mapFilter.filter( "MAP-FILTER" ) );
   }
 
+  @Test
+  public void testGetDefaultFilterEscapesUntrustedBaseUrl() {
+    StringFilter jsFilter = jsDepPackage.getDefaultFilter();
+    StringFilter cssFilter = cssDepPackage.getDefaultFilter();
+    StringFilter mapFilter = mapDepPackage.getDefaultFilter();
+
+    String untrustedBaseUrl = "http://foo\"/";
+
+    assertEquals( "<script language=\"javascript\" type=\"text/javascript\" src=\"http://foo&#34;/JS-FILTER\"></script>",
+            jsFilter.filter( "JS-FILTER", untrustedBaseUrl ).trim() );
+
+    assertEquals( "<link href=\"http://foo&#34;/CSS-FILTER\" rel=\"stylesheet\" type=\"text/css\" />",
+            cssFilter.filter( "CSS-FILTER", untrustedBaseUrl ).trim() );
+
+    assertEquals( "", mapFilter.filter( "MAP-FILTER", untrustedBaseUrl ) );
+  }
+
   private static void addFileDependencies( String[] filePaths ) {
     String[] fileNames = new String[]{"file1", "file2"};
     String[] fileVersions = new String[]{"v1", "v2"};
diff --git a/pom.xml b/pom.xml
index 140cb985c..b91a6ee88 100644
--- a/pom.xml
+++ b/pom.xml
@@ -62,6 +62,7 @@
     <google-collections.version>1.0</google-collections.version>
     <jersey.version>1.19.1</jersey.version>
     <jcr.version>2.0</jcr.version>
+    <owasp.encoder.version>1.2</owasp.encoder.version>
   </properties>
 
   <dependencyManagement>
@@ -96,6 +97,18 @@
         <artifactId>json</artifactId>
         <version>${pentaho-json.version}</version>
       </dependency>
+      <dependency>
+        <groupId>org.owasp.encoder</groupId>
+        <artifactId>encoder</artifactId>
+        <version>${owasp.encoder.version}</version>
+        <scope>compile</scope>
+        <exclusions>
+          <exclusion>
+            <artifactId>*</artifactId>
+            <groupId>*</groupId>
+          </exclusion>
+        </exclusions>
+      </dependency>
       <dependency>
         <groupId>junit</groupId>
         <artifactId>junit</artifactId>
