diff --git a/system/core/uploader.php b/system/core/uploader.php
index bad651838..279f34de3 100755
--- a/system/core/uploader.php
+++ b/system/core/uploader.php
@@ -341,8 +341,25 @@ public function uploadFromLink($post_filename, $allowed_size = 0, $destination =
 
         $link = $file_name = trim($_POST[$post_filename]);
 
+
+        if (
+            // Валидный URL с PATH
+            filter_var($link, FILTER_VALIDATE_URL, FILTER_FLAG_PATH_REQUIRED) !== $link ||
+            // По IP адресу не разрешаем
+            preg_match('#^(?:(?:https?):\/\/)([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}).*#ui', $link)
+            ) {
+
+            return [
+                'success' => false,
+                'error'   => 'Not allowed',
+                'name'    => '',
+                'path'    => ''
+            ];
+        }
+
         // проверяем редирект и имя файла
         $curl = curl_init();
+        curl_setopt($curl, CURLOPT_PROTOCOLS, CURLPROTO_HTTPS | CURLPROTO_HTTP);
         curl_setopt($curl, CURLOPT_URL, $link);
         curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
         curl_setopt($curl, CURLOPT_HEADER, true);
diff --git a/system/libs/files.helper.php b/system/libs/files.helper.php
index 3b548079d..fa41b13ea 100755
--- a/system/libs/files.helper.php
+++ b/system/libs/files.helper.php
@@ -315,6 +315,11 @@ function file_get_contents_from_url($url, $timeout = 5, $json_decode = false, $p
         return null;
     }
 
+    // По IP адресу не разрешаем
+    if (preg_match('#^(?:(?:https?):\/\/)([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}).*#ui', $url)) {
+        return null;
+    }
+
     $curl = curl_init();
 
     if (strpos($url, 'https') === 0) {
@@ -342,6 +347,7 @@ function file_get_contents_from_url($url, $timeout = 5, $json_decode = false, $p
             $headers[] = $key . ': ' . $value;
         }
     }
+    curl_setopt($curl, CURLOPT_PROTOCOLS, CURLPROTO_HTTPS | CURLPROTO_HTTP);
     curl_setopt($curl, CURLOPT_HTTPHEADER, $headers);
     curl_setopt($curl, CURLOPT_URL, $url);
     curl_setopt($curl, CURLOPT_CONNECTTIMEOUT, $timeout);
@@ -368,17 +374,20 @@ function file_get_contents_from_url($url, $timeout = 5, $json_decode = false, $p
  * @param string $destination Полный путь куда сохраненить файл
  * @return boolean
  */
-function file_save_from_url($url, $destination){
+function file_save_from_url($url, $destination) {
 
-    if (!function_exists('curl_init')){ return false; }
+    if (!function_exists('curl_init')) {
+        return false;
+    }
 
     $dest_file = @fopen($destination, "w");
 
     $curl = curl_init();
-    if(strpos($url, 'https') === 0){
+    if (strpos($url, 'https') === 0) {
         curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, 0);
         curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false);
     }
+    curl_setopt($curl, CURLOPT_PROTOCOLS, CURLPROTO_HTTPS | CURLPROTO_HTTP);
     curl_setopt($curl, CURLOPT_URL, $url);
     curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
     curl_setopt($curl, CURLOPT_FILE, $dest_file);
@@ -388,8 +397,8 @@ function file_save_from_url($url, $destination){
     fclose($dest_file);
 
     return true;
-
 }
+
 /**
  * Накладывает ваттермарк на изображение
  *
