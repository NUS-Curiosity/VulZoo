diff --git a/src/jwe.c b/src/jwe.c
index 2400d2e..5ddb8b7 100644
--- a/src/jwe.c
+++ b/src/jwe.c
@@ -364,6 +364,11 @@ rsa_oaep_sha1_decrypt(const struct rsa_private_key *key,
   int res;
   struct sha1_ctx ctx;
 
+  if (nettle_mpz_sizeinbase_256_u (gibberish) > key->size ||
+      key->size < (2*SHA1_DIGEST_SIZE)+2) {
+    return 0;
+  }
+
   mpz_init(m);
   rsa_compute_root(key, m, gibberish);
 
@@ -384,6 +389,11 @@ rsa_oaep_sha256_decrypt(const struct rsa_private_key *key,
   int res;
   struct sha256_ctx ctx;
 
+  if (nettle_mpz_sizeinbase_256_u (gibberish) > key->size ||
+      key->size < (2*SHA1_DIGEST_SIZE)+2) {
+    return 0;
+  }
+
   mpz_init(m);
   rsa_compute_root(key, m, gibberish);
 
