diff --git a/src/term.c b/src/term.c
index c1440d850f57a..b365831146d17 100644
--- a/src/term.c
+++ b/src/term.c
@@ -3366,6 +3366,12 @@ check_shellsize(void)
     if (Rows < min_rows())	// need room for one window and command line
 	Rows = min_rows();
     limit_screen_size();
+
+    // make sure these values are not invalid
+    if (cmdline_row >= Rows)
+	cmdline_row = Rows - 1;
+    if (msg_row >= Rows)
+	msg_row = Rows - 1;
 }
 
 /*
diff --git a/src/version.c b/src/version.c
index e0a9768de181b..acf84d1d2d426 100644
--- a/src/version.c
+++ b/src/version.c
@@ -735,6 +735,8 @@ static char *(features[]) =
 
 static int included_patches[] =
 {   /* Add new patch number below this line */
+/**/
+    5160,
 /**/
     5159,
 /**/
