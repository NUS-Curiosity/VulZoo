diff --git a/src/textobject.c b/src/textobject.c
index 9a8a91626042c..153c14ddddb67 100644
--- a/src/textobject.c
+++ b/src/textobject.c
@@ -1798,11 +1798,17 @@ current_quote(
 
 	// Find out if we have a quote in the selection.
 	while (i <= col_end)
+	{
+	    // check for going over the end of the line, which can happen if
+	    // the line was changed after the Visual area was selected.
+	    if (line[i] == NUL)
+		break;
 	    if (line[i++] == quotechar)
 	    {
 		selected_quote = TRUE;
 		break;
 	    }
+	}
     }
 
     if (!vis_empty && line[col_start] == quotechar)
diff --git a/src/version.c b/src/version.c
index b9b3347856771..df9d576ad44f5 100644
--- a/src/version.c
+++ b/src/version.c
@@ -734,6 +734,8 @@ static char *(features[]) =
 
 static int included_patches[] =
 {   /* Add new patch number below this line */
+/**/
+    5120,
 /**/
     5119,
 /**/
