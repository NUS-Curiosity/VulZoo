diff --git a/lib/nav-bar.adp b/lib/nav-bar.adp
index de91122..d63d666 100644
--- a/lib/nav-bar.adp
+++ b/lib/nav-bar.adp
@@ -10,7 +10,8 @@
       <form action="@form_search_url@" method="get" name="search">
         <input name="q" type="text" size="15" class="bt_navbar" value="#bug-tracker.Search#" 
           onFocus="javascript:this.value='';">
-        <input name="search_package_id" type="hidden" value="@package_id@">
+          <input name="search_package_id" type="hidden" value="@package_id@">
+          <if @::__csrf_token@ defined><input type="hidden" name="__csrf_token" value="@::__csrf_token;literal@"></if>
           <input type="submit" value="#bug-tracker.Search#" class="bt_navbar_btn">
       </form>
   </if>
diff --git a/lib/one-bug.adp b/lib/one-bug.adp
index 40907d0..3a403b4 100644
--- a/lib/one-bug.adp
+++ b/lib/one-bug.adp
@@ -9,7 +9,7 @@
   @param style string (either "feed" or "display" -- default is display)
   @param base_url url to the package (ok for this to be empty if in the package, trailing / expected)
 </contract>
-<h1>Bug @bug.bug_number_display@ - @bug.summary@ [@bug.component_name@]</h1>
+<h1>Bug @bug.bug_number_display@ - @bug.summary;noi18n@ [@bug.component_name@]</h1>
 <p>State: @bug.pretty_state@</p>
 <if @bug.found_in_version_name@ not nil><p>Found in version: @bug.found_in_version_name@</p></if>
 <if @bug.fix_for_version_name@ not nil><p>Fix for version: @bug.fix_for_version_name@</p></if>
@@ -17,4 +17,4 @@
 
 <multiple name="roles"><p>@roles.role_pretty@: <a href="@roles.user_url@">@roles.user_name@</a></p></multiple>
 
-@comments;noquote@
\ No newline at end of file
+@comments;literal@
\ No newline at end of file
diff --git a/www/bug.tcl b/www/bug.tcl
index 9388223..e4a152f 100644
--- a/www/bug.tcl
+++ b/www/bug.tcl
@@ -14,6 +14,11 @@ ad_page_contract {
 	    ad_complain "invalid value for show_patch_status"
 	}
     }
+    check_bug_number -requires bug_number:integer {
+	if {$bug_number > 2**31} {
+	    ad_complain "invalid bug number"
+	}
+    }
 }
 
 #####
diff --git a/www/patch.adp b/www/patch.adp
index 675b9a7..34250e9 100644
--- a/www/patch.adp
+++ b/www/patch.adp
@@ -1,7 +1,7 @@
 <master src="../lib/master">
 <property name="doc(title)">@page_title;literal@</property>
 <property name="context">@context;literal@</property>
-<property name="displayed_object_id">@patch.patch_id;literal@</property>
+<if @patch.patch_id@ defined><property name="displayed_object_id">@patch.patch_id;literal@</property></if>
 
 <formtemplate id="patch"></formtemplate>
 
diff --git a/www/patch.tcl b/www/patch.tcl
index 715dda9..6336900 100644
--- a/www/patch.tcl
+++ b/www/patch.tcl
@@ -6,7 +6,7 @@ ad_page_contract {
     @cvs-id $Id$
 } {
     patch_number:integer,notnull
-    mode:optional
+    mode:word,optional
     cancel_edit:optional    
     edit:optional
     accept:optional
@@ -40,7 +40,7 @@ set patch_status [db_string patch_status {}]
 set versions_p [bug_tracker::versions_p]
 
 # Abort editing and return to view mode if the user hit cancel on the edit form
-if { ([info exists cancel_edit] && $cancel_edit ne "") } {
+if { [info exists cancel_edit] && $cancel_edit ne "" } {
     ad_returnredirect $view_patch_url
     ad_script_abort
 }
@@ -58,17 +58,17 @@ if { ([info exists download] && $download ne "") } {
 # Initialize the page mode variable
 # We are in view mode per default
 if { ![info exists mode] } {
-    if { ([info exists edit] && $edit ne "") } {
+    if { [info exists edit] && $edit ne "" } {
         set mode edit
-    } elseif { ([info exists accept] && $accept ne "") } {        
+    } elseif { [info exists accept] && $accept ne "" } {        
         set mode accept
-    } elseif { ([info exists refuse] && $refuse ne "") } {
+    } elseif { [info exists refuse] && $refuse ne "" } {
         set mode refuse
-    } elseif { ([info exists delete] && $delete ne "") } {
+    } elseif { [info exists delete] && $delete ne "" } {
         set mode delete
-    } elseif { ([info exists reopen] && $reopen ne "") } {
+    } elseif { [info exists reopen] && $reopen ne "" } {
         set mode reopen
-    } elseif { ([info exists comment] && $comment ne "") } {
+    } elseif { [info exists comment] && $comment ne "" } {
         set mode comment
     } else {
         set mode view
@@ -416,7 +416,7 @@ if { [form is_request patch] } {
     }
 }
 
-if { [form is_valid patch] } {
+if { [form is_valid patch] && $mode ne "view"} {
     # A valid submit of the form
 
     set update_exprs [list]
