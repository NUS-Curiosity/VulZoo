diff --git a/Piwik.hooks.php b/Piwik.hooks.php
index ee4e593..5272004 100644
--- a/Piwik.hooks.php
+++ b/Piwik.hooks.php
@@ -82,8 +82,8 @@ public static function AddPiwik ($title) {
         // name for anonymous visitors is their IP address which Piwik already
         // records.
         if ($wgPiwikTrackUsernames && $wgUser->isLoggedIn()) {
-            $username = $wgUser->getName();
-            $customJs .= PHP_EOL . "  _paq.push(['setUserId','{$username}']);";
+            $username = Xml::encodeJsVar( $wgUser->getName() );
+            $customJs .= PHP_EOL . "  _paq.push([\"setUserId\",{$username}]);";
         }
 
 		// Check if server uses https
