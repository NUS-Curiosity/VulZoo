diff --git a/include/inc_lib/revision/revision.php b/include/inc_lib/revision/revision.php
index fd5d87cfe..8ffa75fee 100644
--- a/include/inc_lib/revision/revision.php
+++ b/include/inc_lib/revision/revision.php
@@ -10,5 +10,5 @@
  **/
 
 define('PHPWCMS_VERSION', '1.8.9');
-define('PHPWCMS_RELEASE_DATE', '2017/09/14');
+define('PHPWCMS_RELEASE_DATE', '2017/10/23');
 define('PHPWCMS_REVISION', '547');
diff --git a/include/inc_tmpl/admin.edituser.tmpl.php b/include/inc_tmpl/admin.edituser.tmpl.php
index 3cffa8cf8..142caaf01 100755
--- a/include/inc_tmpl/admin.edituser.tmpl.php
+++ b/include/inc_tmpl/admin.edituser.tmpl.php
@@ -12,118 +12,118 @@
 // ----------------------------------------------------------------
 // obligate check for phpwcms constants
 if (!defined('PHPWCMS_ROOT')) {
-	die("You Cannot Access This Script Directly, Have a Nice Day.");
+    die("You Cannot Access This Script Directly, Have a Nice Day.");
 }
 // ----------------------------------------------------------------
 
 if(isset($_GET["u"]) && intval($_GET["u"])) {
 
-	if(empty($_POST["form_aktion"]) || $_POST["form_aktion"] != "edit_account") {
-		$new_user_id = intval($_GET["u"]);
-		$sql = "SELECT * FROM ".DB_PREPEND."phpwcms_user WHERE usr_id=".$new_user_id." AND usr_aktiv<>9;";
-		if($result = mysql_query($sql, $db) or die("error")) {
-			if($row = mysql_fetch_array($result)) {
-				$new_login = $row["usr_login"];
-				$new_email = $row["usr_email"];
-				$new_name = $row["usr_name"];
-				$set_user_aktiv = $row["usr_aktiv"];
-				$set_user_admin = $row["usr_admin"];
-				$set_user_fe	= $row["usr_fe"];
-				$set_user_var	= @unserialize($row["usr_vars"]);
-				$send_verification = 0;
-				$new_password = '';
-			}
-		}
-	}
-
-	$set_allowed_cp = isset($set_user_var['allowed_cp']) && is_array($set_user_var['allowed_cp']) ? $set_user_var['allowed_cp'] : array();
-
-	if(isset($_POST["form_aktion"]) && $_POST["form_aktion"] == "edit_account") {
-
-		// Handle account data
-
-		$new_user_id = intval($_POST["form_uid"]);
-		$new_login = slweg($_POST["form_newloginname"]);
-		$new_password = slweg($_POST["form_newpassword"]);
-		$new_email = clean_slweg($_POST["form_newemail"]);
-		$new_name = clean_slweg($_POST["form_newrealname"]);
-		$set_user_aktiv = isset($_POST["form_active"]) ? 1 : 0;
-		$set_user_admin = isset($_POST["form_admin"]) ? 1 : 0;
-		$set_user_fe = isset($_POST["form_feuser"]) ? intval($_POST["form_feuser"]) : 0;
-		$set_allowed_cp = isset($_POST["allowed_cp"]) && is_array($_POST["allowed_cp"]) && count($_POST["allowed_cp"]) ? $_POST["allowed_cp"] : array();
-		$set_allowed_cp_total = count($set_allowed_cp);
-		$cp_total = empty($_POST["cp_total"]) ? 0 : intval($_POST["cp_total"]);
-		if(!$set_allowed_cp_total || $cp_total == $set_allowed_cp_total) {
-			$set_allowed_cp = array();
-		}
-		if($set_user_admin) {
-			$set_user_fe = 2;
-		}
-		$send_verification = isset($_POST["verification_email"]) ? 1 : 0;
-		$user_err = '';
-		if(empty($new_login)) {
-			$user_err = $BL['be_admin_usr_err2']."\n";
-		} else {
-			$sql = "SELECT usr_id, usr_vars, COUNT(*) AS anzahl FROM ".DB_PREPEND."phpwcms_user WHERE usr_login='".aporeplace($new_login)."' GROUP BY usr_id";
-			if($result = mysql_query($sql, $db)) {
-				if($check_anzahl = mysql_fetch_array($result)) {
-					if($check_anzahl["usr_id"] != $new_user_id && $check_anzahl["anzahl"]) {
-						$user_err .= $BL['be_admin_usr_err1']."\n";
-					}
-
-					if(empty($user_err)) {
-						$set_user_var = @unserialize($check_anzahl["usr_vars"]);
-						if(!is_array($set_user_var)) {
-							$set_user_var = array();
-						}
-						$set_user_var['allowed_cp'] = $set_allowed_cp;
-					}
-				}
-			}
-		}
-
-		if(!is_valid_email($new_email)) {
-			$user_err .= $BL['be_admin_usr_err4']."\n";
-		}
-		if(empty($user_err)) { //Insert new User
-
-			$sql =	"UPDATE ".DB_PREPEND."phpwcms_user SET usr_login='".aporeplace($new_login)."', ";
-			if($new_password) {
-				$sql .= "usr_pass='".aporeplace(md5(makeCharsetConversion($new_password, PHPWCMS_CHARSET, 'utf-8')))."', ";
-			}
-			$sql .= "usr_email='".aporeplace($new_email)."', ".
-					"usr_admin='".$set_user_admin."', ".
-					"usr_aktiv='".$set_user_aktiv."', ".
-					"usr_name='".aporeplace($new_name)."', ";
-			if(isset($set_user_var['allowed_cp'])) {
-				$sql .= "usr_vars="._dbEscape(serialize($set_user_var)).", ";
-			}
-			$sql .= "usr_fe='".$set_user_fe."' WHERE usr_id=".$new_user_id;
-
-			if($result = mysql_query($sql, $db) or die("error")) {
-				$user_ok = 1;
-				$new_user_id = NULL;
-				if($send_verification) {
-					$emailbody = str_replace('{LOGIN}',			$new_login, $BL['be_admin_usr_emailbody']);
-					$emailbody = str_replace('{PASSWORD}',		(($new_password) ? $new_password : $BL['be_admin_usr_passnochange']), $emailbody);
-					$emailbody = str_replace('{SITE}',			PHPWCMS_URL, $emailbody);
-					$emailbody = str_replace('{LOGIN_PAGE}',	PHPWCMS_URL.get_login_file(), $emailbody);
-
-					sendEmail(	array(
-						'recipient'	=> $new_email,
-						'toName'	=> $new_name,
-						'subject'	=> $BL['be_admin_usr_mailsubject'],
-						'isHTML'	=> 0,
-						'text'		=> $emailbody,
-						'from'		=> $phpwcms["admin_email"],
-						'sender'	=> $phpwcms["admin_email"]
-				        ));
-				}
-			}
-		}
-	}
-
-	if(empty($user_ok)) {
+    if(empty($_POST["form_aktion"]) || $_POST["form_aktion"] != "edit_account") {
+        $new_user_id = intval($_GET["u"]);
+        $sql = "SELECT * FROM ".DB_PREPEND."phpwcms_user WHERE usr_id=".$new_user_id." AND usr_aktiv<>9";
+        $result = _dbQuery($sql);
+        if(isset($result[0]['usr_id'])) {
+            $new_login = $result[0]["usr_login"];
+            $new_email = $result[0]["usr_email"];
+            $new_name = $result[0]["usr_name"];
+            $set_user_aktiv = $result[0]["usr_aktiv"];
+            $set_user_admin = $result[0]["usr_admin"];
+            $set_user_fe    = $result[0]["usr_fe"];
+            $set_user_var   = @unserialize($result[0]["usr_vars"]);
+            $send_verification = 0;
+            $new_password = '';
+        }
+    }
+
+    $set_allowed_cp = isset($set_user_var['allowed_cp']) && is_array($set_user_var['allowed_cp']) ? $set_user_var['allowed_cp'] : array();
+
+    if(isset($_POST["form_aktion"]) && $_POST["form_aktion"] == "edit_account") {
+
+        // Handle account data
+
+        $new_user_id = intval($_POST["form_uid"]);
+        $new_login = slweg($_POST["form_newloginname"]);
+        $new_password = slweg($_POST["form_newpassword"]);
+        $new_email = clean_slweg($_POST["form_newemail"]);
+        $new_name = clean_slweg($_POST["form_newrealname"]);
+        $set_user_aktiv = isset($_POST["form_active"]) ? 1 : 0;
+        $set_user_admin = isset($_POST["form_admin"]) ? 1 : 0;
+        $set_user_fe = isset($_POST["form_feuser"]) ? intval($_POST["form_feuser"]) : 0;
+        $set_allowed_cp = isset($_POST["allowed_cp"]) && is_array($_POST["allowed_cp"]) && count($_POST["allowed_cp"]) ? $_POST["allowed_cp"] : array();
+        $set_allowed_cp_total = count($set_allowed_cp);
+        $cp_total = empty($_POST["cp_total"]) ? 0 : intval($_POST["cp_total"]);
+        if(!$set_allowed_cp_total || $cp_total == $set_allowed_cp_total) {
+            $set_allowed_cp = array();
+        }
+        if($set_user_admin) {
+            $set_user_fe = 2;
+        }
+        $send_verification = isset($_POST["verification_email"]) ? 1 : 0;
+        $user_err = '';
+        if(empty($new_login)) {
+            $user_err = $BL['be_admin_usr_err2']."\n";
+        } else {
+            $sql = "SELECT usr_id, usr_vars, COUNT(*) AS anzahl FROM ".DB_PREPEND."phpwcms_user WHERE usr_login='".aporeplace($new_login)."' GROUP BY usr_id";
+            $result = _dbQuery($sql);
+            if(isset($result[0]['anzahl'])) {
+
+                if($result[0]["usr_id"] != $new_user_id && $result[0]["anzahl"]) {
+                    $user_err .= $BL['be_admin_usr_err1']."\n";
+                }
+
+                if(empty($user_err)) {
+                    $set_user_var = @unserialize($result[0]["usr_vars"]);
+                    if(!is_array($set_user_var)) {
+                        $set_user_var = array();
+                    }
+                    $set_user_var['allowed_cp'] = $set_allowed_cp;
+                }
+
+            }
+        }
+
+        if(!is_valid_email($new_email)) {
+            $user_err .= $BL['be_admin_usr_err4']."\n";
+        }
+        if(empty($user_err)) { //Insert new User
+
+            $sql =  "UPDATE ".DB_PREPEND."phpwcms_user SET usr_login='".aporeplace($new_login)."', ";
+            if($new_password) {
+                $sql .= "usr_pass='".aporeplace(md5(makeCharsetConversion($new_password, PHPWCMS_CHARSET, 'utf-8')))."', ";
+            }
+            $sql .= "usr_email='".aporeplace($new_email)."', ".
+                    "usr_admin='".$set_user_admin."', ".
+                    "usr_aktiv='".$set_user_aktiv."', ".
+                    "usr_name='".aporeplace($new_name)."', ";
+            if(isset($set_user_var['allowed_cp'])) {
+                $sql .= "usr_vars="._dbEscape(serialize($set_user_var)).", ";
+            }
+            $sql .= "usr_fe='".$set_user_fe."' WHERE usr_id=".$new_user_id;
+            $result = _dbQuery($sql, 'UPDATE');
+            if(isset($result['AFFECTED_ROWS'])) {
+                $user_ok = 1;
+                $new_user_id = NULL;
+                if($send_verification) {
+                    $emailbody = str_replace('{LOGIN}',         $new_login, $BL['be_admin_usr_emailbody']);
+                    $emailbody = str_replace('{PASSWORD}',      (($new_password) ? $new_password : $BL['be_admin_usr_passnochange']), $emailbody);
+                    $emailbody = str_replace('{SITE}',          PHPWCMS_URL, $emailbody);
+                    $emailbody = str_replace('{LOGIN_PAGE}',    PHPWCMS_URL.get_login_file(), $emailbody);
+
+                    sendEmail(array(
+                        'recipient' => $new_email,
+                        'toName'    => $new_name,
+                        'subject'   => $BL['be_admin_usr_mailsubject'],
+                        'isHTML'    => 0,
+                        'text'      => $emailbody,
+                        'from'      => $phpwcms["admin_email"],
+                        'sender'    => $phpwcms["admin_email"]
+                    ));
+                }
+            }
+        }
+    }
+
+    if(empty($user_ok)) {
 
 ?><form action="phpwcms.php?do=admin&amp;s=2&amp;u=<?php echo $new_user_id ?>" method="post" name="edituser"><table border="0" cellpadding="0" cellspacing="0" summary="">
 
@@ -132,49 +132,49 @@
             <td><img src="img/leer.gif" alt="" width="105" height="1"></td>
             <td><img src="img/leer.gif" alt="" width="1" height="7"></td>
           </tr>
-		  <?php
-		  if(!empty($user_err)) {
-		  ?>
+          <?php
+          if(!empty($user_err)) {
+          ?>
           <tr valign="top">
-            <td align="right"><strong style="color:#FF3300"><?php echo $BL['be_admin_usr_err'] ?>:</strong>&nbsp;</td>
-            <td><strong style="color:#FF3300"><?php echo nl2br(chop($user_err)) ?></strong></td>
+            <td align="right" class="error"><strong><?php echo $BL['be_admin_usr_err'] ?>:</strong>&nbsp;</td>
+            <td class="error"><strong><?php echo nl2br(chop($user_err)) ?></strong></td>
           </tr>
           <tr valign="top"><td colspan="2" align="right" class="chatlist"><img src="img/leer.gif" alt="" width="1" height="7"></td></tr>
-		  <?php
-		  } //Ende Fehler New User
-		  ?>
+          <?php
+          } //Ende Fehler New User
+          ?>
           <tr>
             <td align="right" class="chatlist"><?php echo $BL["login_username"]  ?>:&nbsp;</td>
-            <td><input name="form_newloginname" type="text" id="form_newloginname" class="width250 f11b" value="<?php echo $new_login ?>" size="30" maxlength="30" autocomplete="off"></td>
+            <td><input name="form_newloginname" type="text" id="form_newloginname" class="width250" value="<?php echo html($new_login); ?>" size="30" maxlength="200" autocomplete="off" /></td>
           </tr>
           <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="1"></td></tr>
           <tr>
             <td align="right" class="chatlist"><?php echo $BL["login_userpass"] ?>:&nbsp;</td>
-            <td><input name="form_newpassword" type="text" id="form_newpassword" class="width250 f11b" value="<?php echo $new_password ?>" size="30" maxlength="50" autocomplete="off"></td>
+            <td><input name="form_newpassword" type="text" id="form_newpassword" class="width250" value="<?php echo html($new_password); ?>" size="30" maxlength="200" autocomplete="off" /></td>
           </tr>
           <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="1"></td></tr>
           <tr>
             <td align="right" class="chatlist"><?php echo $BL['be_profile_label_email'] ?>:&nbsp;</td>
-            <td><input name="form_newemail" type="text" id="form_newemail" class="width250 f11b" value="<?php echo $new_email ?>" size="30" maxlength="150"></td>
+            <td><input name="form_newemail" type="text" id="form_newemail" class="width250" value="<?php echo html($new_email); ?>" size="30" maxlength="250" autocomplete="off" /></td>
           </tr>
           <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="1"></td></tr>
           <tr>
             <td align="right" class="chatlist"><?php echo $BL['be_admin_usr_realname'] ?>:&nbsp;</td>
-            <td><input name="form_newrealname" type="text" id="form_newrealname" class="width250 f11b" value="<?php echo $new_name ?>" size="30" maxlength="80"></td>
+            <td><input name="form_newrealname" type="text" id="form_newrealname" class="width250" value="<?php echo html($new_name); ?>" size="30" maxlength="200" autocomplete="off" /></td>
           </tr>
 
-		  <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="6"></td></tr>
+          <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="6"></td></tr>
           <tr>
             <td align="right" class="chatlist"><?php echo $BL['be_admin_usr_issection']  ?>:&nbsp;</td>
             <td><table border="0" cellpadding="0" cellspacing="0" bgcolor="#E7E8EB" summary="">
                 <tr>
-                  <td><input name="form_feuser" type="radio" id="form_feuser0" value="0"<?php is_checked($set_user_fe, 0); ?>></td>
+                  <td><input name="form_feuser" type="radio" id="form_feuser0" value="0"<?php is_checked($set_user_fe, 0); ?> /></td>
                   <td><label for="form_feuser0"><?php echo $BL['be_admin_usr_ifsection0'] ?></label>&nbsp;&nbsp;</td>
-				  <td><input name="form_feuser" type="radio" id="form_feuser1" value="1"<?php is_checked($set_user_fe, 1); ?>></td>
+                  <td><input name="form_feuser" type="radio" id="form_feuser1" value="1"<?php is_checked($set_user_fe, 1); ?> /></td>
                   <td><label for="form_feuser1"><?php echo $BL['be_admin_usr_ifsection1'] ?></label>&nbsp;&nbsp;</td>
-				  <td><input name="form_feuser" type="radio" id="form_feuser2" value="2"<?php is_checked($set_user_fe, 2); ?>></td>
+                  <td><input name="form_feuser" type="radio" id="form_feuser2" value="2"<?php is_checked($set_user_fe, 2); ?> /></td>
                   <td><label for="form_feuser2"><?php echo $BL['be_admin_usr_ifsection2'] ?></label></td>
-				  <td><img src="img/leer.gif" alt="" width="4" height="21"></td>
+                  <td><img src="img/leer.gif" alt="" width="4" height="21"></td>
                 </tr>
               </table></td>
           </tr>
@@ -184,7 +184,7 @@
             <td align="right" class="chatlist"><?php echo $BL['be_admin_usr_setactive'] ?>:&nbsp;</td>
             <td><table border="0" cellpadding="0" cellspacing="0" summary="">
                 <tr>
-                  <td><input name="form_active" type="checkbox" id="form_active" value="1"<?php is_checked($set_user_aktiv, 1); ?>></td>
+                  <td><input name="form_active" type="checkbox" id="form_active" value="1"<?php is_checked($set_user_aktiv, 1); ?> /></td>
                   <td><label for="form_active"><?php echo $BL['be_admin_usr_iflogin'] ?></label></td>
                 </tr>
               </table></td>
@@ -195,8 +195,8 @@
             <td align="right" class="chatlist" style="color:#FF0000"><?php echo $BL['be_admin_usr_isadmin'] ?>:&nbsp;</td>
             <td><table border="0" cellpadding="0" cellspacing="0" summary="">
                 <tr>
-                  <td><input name="form_admin" type="checkbox" id="form_admin" value="1"<?php is_checked(1, $set_user_admin); ?>></td>
-                  <td><label for="form_admin"><?php echo $BL['be_admin_usr_ifadmin'] ?> <strong style="color:#FF0000">!!!</strong></label></td>
+                  <td><input name="form_admin" type="checkbox" id="form_admin" value="1"<?php is_checked(1, $set_user_admin); ?> /></td>
+                  <td><label for="form_admin"><?php echo $BL['be_admin_usr_ifadmin'] ?> <strong class="error">!!!</strong></label></td>
                 </tr>
               </table></td>
           </tr>
@@ -205,43 +205,43 @@
             <td><table border="0" cellpadding="0" cellspacing="0" summary="">
                 <tr><td colspan="3"><img src="img/leer.gif" alt="" width="1" height="6"></td></tr>
                 <tr bgcolor="#E7E8EB">
-                  <td><input name="verification_email" type="checkbox" id="verification_email" value="1"<?php is_checked(1, $send_verification); ?>></td>
-				  <td><label for="verification_email"><?php echo $BL['be_admin_usr_sendemail'] ?></label></td>
+                  <td><input name="verification_email" type="checkbox" id="verification_email" value="1"<?php is_checked(1, $send_verification); ?> /></td>
+                  <td><label for="verification_email"><?php echo $BL['be_admin_usr_sendemail'] ?></label></td>
                   <td><img src="img/leer.gif" alt="" width="4" height="21"></td>
                 </tr>
                 <tr><td colspan="3"><img src="img/leer.gif" alt="" width="1" height="6"></td></tr>
               </table></td>
           </tr>
 
-          	<tr>
-          		<td align="right" class="chatlist tdtop6 nowrap"><?php echo $BL['be_structform_select_cp'] ?>:&nbsp;</td>
-          		<td class="checkbox-list v11">
+            <tr>
+                <td align="right" class="chatlist tdtop6 nowrap"><?php echo $BL['be_structform_select_cp'] ?>:&nbsp;</td>
+                <td class="checkbox-list v11">
           <?php
-          		$has_allowed_cp = isset($set_allowed_cp) ? count($set_allowed_cp) : 0;
+                $has_allowed_cp = isset($set_allowed_cp) ? count($set_allowed_cp) : 0;
 
-				foreach($wcs_content_type as $key => $value):
+                foreach($wcs_content_type as $key => $value):
 
-					// count used CPs so it is easier to decide if needed or not
-					$used_count = _dbCount('SELECT COUNT(*) FROM '.DB_PREPEND.'phpwcms_articlecontent WHERE acontent_trash=0 AND acontent_type='._dbEscape($key));
+                    // count used CPs so it is easier to decide if needed or not
+                    $used_count = _dbCount('SELECT COUNT(*) FROM '.DB_PREPEND.'phpwcms_articlecontent WHERE acontent_trash=0 AND acontent_type='._dbEscape($key));
           ?>
 
-          			<label>
-          				<input type="checkbox" name="allowed_cp[<?php echo $key ?>]" value="<?php echo $key ?>"<?php if(!$has_allowed_cp || isset($set_allowed_cp[$key])): ?> checked="checked"<?php endif; ?> />
-          				<?php echo html($value).' ('.$used_count.')' ?>
-          			</label>
+                    <label>
+                        <input type="checkbox" name="allowed_cp[<?php echo $key ?>]" value="<?php echo $key ?>"<?php if(!$has_allowed_cp || isset($set_allowed_cp[$key])): ?> checked="checked"<?php endif; ?> />
+                        <?php echo html($value).' ('.$used_count.')' ?>
+                    </label>
 
-          <?php	endforeach;	?>
-          			<input type="hidden" name="cp_total" value="<?php echo count($wcs_content_type) ?>" />
-          		</td>
-          	</tr>
+          <?php endforeach; ?>
+                    <input type="hidden" name="cp_total" value="<?php echo count($wcs_content_type) ?>" />
+                </td>
+            </tr>
 
 
           <tr>
             <td>&nbsp;</td>
             <td class="tdbottom10 tdtop6">
-            	<input name="Submit" type="submit" class="button" value="<?php echo $BL['be_admin_usr_ebutton'] ?>">
-            	<input name="form_aktion" type="hidden" value="edit_account" />
-            	<input name="form_uid" type="hidden" value="<?php echo $new_user_id ?>" />
+                <input name="Submit" type="submit" class="button" value="<?php echo $BL['be_admin_usr_ebutton'] ?>" />
+                <input name="form_aktion" type="hidden" value="edit_account" />
+                <input name="form_uid" type="hidden" value="<?php echo html($new_user_id) ?>" />
             </td>
           </tr>
       </table>
@@ -255,11 +255,9 @@
       <?php
 
 
- 	} else {
+    } else {
 
-		echo "<script type=\"text/JavaScript\"> timer=setTimeout(\"self.location.href='phpwcms.php'+'?".CSRF_GET_TOKEN."&do=admin'\", 0); </script>";
+        echo "<script type=\"text/JavaScript\"> timer=setTimeout(\"self.location.href='phpwcms.php'+'?".CSRF_GET_TOKEN."&do=admin'\", 0); </script>";
 
-	}
+    }
 }
-
-?>
\ No newline at end of file
diff --git a/include/inc_tmpl/admin.groups.tmpl.php b/include/inc_tmpl/admin.groups.tmpl.php
index 138e0024d..440e3372f 100644
--- a/include/inc_tmpl/admin.groups.tmpl.php
+++ b/include/inc_tmpl/admin.groups.tmpl.php
@@ -12,12 +12,12 @@
 // ----------------------------------------------------------------
 // obligate check for phpwcms constants
 if (!defined('PHPWCMS_ROOT')) {
-	die("You Cannot Access This Script Directly, Have a Nice Day.");
+    die("You Cannot Access This Script Directly, Have a Nice Day.");
 }
 // ----------------------------------------------------------------
 
-	//user group
-	$GLOBALS['BE']['HEADER']['optionselect.js']	= getJavaScriptSourceLink('include/inc_js/optionselect.js');
+//user group
+$GLOBALS['BE']['HEADER']['optionselect.js'] = getJavaScriptSourceLink('include/inc_js/optionselect.js');
 
 ?>
 
@@ -29,26 +29,26 @@
 
 <?php
 
-	$bg_color1 = "#FFFFFF";
-	$bg_color2 = "#F3F5F8";
-	$zaehler = 0;
-	if(empty($new_group_id)) {
-		$new_group_id = 0;
-	}
-	//Liste aller Gruppen erzeugen
-	$result = _dbGet('phpwcms_usergroup', '*', 'group_active != 9', '', 'group_name');
+    $bg_color1 = "#FFFFFF";
+    $bg_color2 = "#F3F5F8";
+    $zaehler = 0;
+    if(empty($new_group_id)) {
+        $new_group_id = 0;
+    }
+    //Liste aller Gruppen erzeugen
+    $result = _dbGet('phpwcms_usergroup', '*', 'group_active != 9', '', 'group_name');
 
-	if(isset($result[0])) {
+    if(isset($result[0]['group_id'])) {
 
-		foreach($result as $grouplist) {
+        foreach($result as $grouplist) {
 
-			$bg_color = ($zaehler % 2) ? $bg_color2 : $bg_color1;
+            $bg_color = ($zaehler % 2) ? $bg_color2 : $bg_color1;
 
-			if($grouplist["group_id"] == $new_group_id) {
-				$bg_color = "#FFCC00";
-			}
+            if($grouplist["group_id"] == $new_group_id) {
+                $bg_color = "#FFCC00";
+            }
 
-			$goto = "phpwcms.php?do=admin&amp;p=1&amp;s=2&amp;u=".$grouplist["group_id"];
+            $goto = "phpwcms.php?do=admin&amp;p=1&amp;s=2&amp;u=".$grouplist["group_id"];
 
 ?>
         <tr><td colspan="3"><img src="img/leer.gif" alt="" width="1" height="1"></td></tr>
@@ -56,162 +56,152 @@
           <td width="19" align="center"><img src="img/usricon/group_<?php echo $grouplist["group_active"] == 1 ? 'norm' : 'inaktiv'; ?>.gif" alt="" width="19" height="16" border="0" /></td>
           <td width="458" class="<?php echo $grouplist["group_active"] ? 'dir' : 'inaktiv'; ?>"><a href="<?php echo $goto ?>"><?php
 
-		 	$grouparray = convertStringToArray($grouplist["group_member"]);
-		  	$total_member = empty($grouparray[0]) ? 0 : count($grouparray);
+            $grouparray = convertStringToArray($grouplist["group_member"]);
+            $total_member = empty($grouparray[0]) ? 0 : count($grouparray);
 
-			echo $grouplist["group_name"] ? html($grouplist["group_name"]).' <span style="color:#999999;">('.$total_member.' '.$BL['be_cnt_rssfeed_item'].')</span>' : 'n.a.';
+            echo $grouplist["group_name"] ? html($grouplist["group_name"]).' <span style="color:#999999;">('.$total_member.' '.$BL['be_cnt_rssfeed_item'].')</span>' : 'n.a.';
 
 
-		  ?></a></td>
+          ?></a></td>
           <td width="61" align="right"><a href="<?php echo $phpwcms['modules']['usergroup']['dir']; ?>include/inc_act/act_usergroup.php?aktiv=<?php
 
-          	echo $grouplist["group_id"].':'.($grouplist["group_active"] ? "0" : "1");
-
-			?>"><img src="img/button/<?php
-				if(empty($grouplist["group_active"])) echo "in";
-			?>aktiv_mini.gif" alt="" width="14" height="15" border="0" /></a><a href="<?php echo $goto ?>"><img src="img/button/edit.gif" alt="" width="24" height="15" border="0" title="<?php
-				echo $BL['modules']['usergroup']['be_admin_group_edit'].": ".html($grouplist["group_name"])
-			?>"></a><a href="<?php echo $phpwcms['modules']['usergroup']['dir']; ?>include/inc_act/act_usergroup.php?del=<?php
-				echo urlencode($grouplist["group_id"].":".$grouplist["group_name"]);
-			?>" onclick="return confirm('Delete group <?php echo js_singlequote($grouplist["group_name"]) ?>');"><img src="img/button/del_message_final.gif" alt="" width="22" height="15" border="0" title="<?php
-				echo $BL['modules']['usergroup']['be_admin_group_ldel']." ".html($grouplist["group_login"])
-			?>"></a></td>
+            echo $grouplist["group_id"].':'.($grouplist["group_active"] ? "0" : "1");
+
+            ?>"><img src="img/button/<?php
+                if(empty($grouplist["group_active"])) echo "in";
+            ?>aktiv_mini.gif" alt="" width="14" height="15" border="0" /></a><a href="<?php echo $goto ?>"><img src="img/button/edit.gif" alt="" width="24" height="15" border="0" title="<?php
+                echo $BL['modules']['usergroup']['be_admin_group_edit'].": ".html($grouplist["group_name"])
+            ?>"></a><a href="<?php echo $phpwcms['modules']['usergroup']['dir']; ?>include/inc_act/act_usergroup.php?del=<?php
+                echo urlencode($grouplist["group_id"].":".$grouplist["group_name"]);
+            ?>" onclick="return confirm('Delete group <?php echo js_singlequote($grouplist["group_name"]) ?>');"><img src="img/button/del_message_final.gif" alt="" width="22" height="15" border="0" title="<?php
+                echo $BL['modules']['usergroup']['be_admin_group_ldel']." ".html($grouplist["group_login"])
+            ?>"></a></td>
         </tr>
         <?php
 
+        }
 
-		}
+    } else {
+            echo '<tr><td colspan="3">'.$BL['be_admin_group_nogroup'].': <a href="phpwcms.php?do=admin&amp;p=1&amp;create_group=1">'.$BL['be_admin_group_add'].'</a></td></tr>';
 
-	} else {
-			echo '<tr><td colspan="3">'.$BL['be_admin_group_nogroup'].': <a href="phpwcms.php?do=admin&amp;p=1&amp;create_group=1">'.$BL['be_admin_group_add'].'</a></td></tr>';
+    }
 
-	}
-
-		?>
-			<tr><td colspan="3"><img src="img/leer.gif" alt="" width="1" height="6"></td></tr>
-			<tr><td colspan="3" bgcolor="#92A1AF"><img src="img/leer.gif" alt="" width="1" height="1"></td></tr>
-			<tr><td colspan="3"><img src="img/leer.gif" alt="" width="1" height="8"></td></tr>
-			<tr><td colspan="3"><form action="phpwcms.php?do=admin&amp;p=1&amp;create_group=1" method="post"><input type="submit" value="<?php echo $BL['be_admin_group_add'] ?>" class="button" title="<?php echo $BL['be_admin_group_add'] ?>"></form></td></tr>
-		</table>
+        ?>
+            <tr><td colspan="3"><img src="img/leer.gif" alt="" width="1" height="6"></td></tr>
+            <tr><td colspan="3" bgcolor="#92A1AF"><img src="img/leer.gif" alt="" width="1" height="1"></td></tr>
+            <tr><td colspan="3"><img src="img/leer.gif" alt="" width="1" height="8"></td></tr>
+            <tr><td colspan="3"><form action="phpwcms.php?do=admin&amp;p=1&amp;create_group=1" method="post"><input type="submit" value="<?php echo $BL['be_admin_group_add'] ?>" class="button" title="<?php echo $BL['be_admin_group_add'] ?>"></form></td></tr>
+        </table>
 
 <!-- CREATE GROUP -->
 
 
-		  <?php
-			//enym was groupid
-		  if(isset($_GET["create_group"]) || isset($_GET["u"])) {
-		  ?>
-			<br /><table width="538" border="0" cellpadding="0" cellspacing="0" summary="">
+          <?php
+            //enym was groupid
+          if(isset($_GET["create_group"]) || isset($_GET["u"])) {
+          ?>
+            <br /><table width="538" border="0" cellpadding="0" cellspacing="0" summary="">
           <tr><td colspan="2" class="title"><?php echo isset($_GET["create_group"]) ? $BL['be_admin_group_add'] : $BL['be_subnav_admin_groups'] ." ". $BL['be_cnt_guestbook_edit']; ?></td></tr>
 
-		  <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="4" /></td></tr>
-  	 	  <tr><td colspan="2"><img src="img/lines/l538_70.gif" alt="" width="538" height="1" /></td>
+          <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="4" /></td></tr>
+          <tr><td colspan="2"><img src="img/lines/l538_70.gif" alt="" width="538" height="1" /></td>
     </tr>
           <tr bgcolor="#F0F2F4"><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="10" /></td>
     </tr>
-		  <?php
-
-		  	$group["id"] 		= empty($_GET["u"]) ? 0 : intval($_GET["u"]);
-		  	$group["name"]		= '';
-		  	$group["member"]	= array();
-		  	$group["value"]		= '';
-		  	$group["trash"]		= 0;
-		  	$group["active"]	= 1;
-
-			if($group["id"]) {
-
-				$sql = "SELECT * FROM ".DB_PREPEND."phpwcms_usergroup WHERE group_id=".$group["id"]." LIMIT 1";
-
-		       	if($result = mysql_query($sql, $db) or die("error while getting group infos")) {
-
-					if($row = mysql_fetch_array($result)) {
-						$group["name"]		= $row["group_name"];
-						$group["member"]	= empty($row["group_member"]) ? array() : explode(',', $row["group_member"]);
-						$group["value"]		= $row["group_value"];
-						$group["trash"]		= $row["group_trash"];
-            			$group["active"]	= $row["group_active"];
-					}
-					mysql_free_result($result);
-				}
-
-				$sendbutton = $BL['be_admin_fcat_button1']; //UPDATE GROUP
+          <?php
 
-			} else {
+            $group["id"]        = empty($_GET["u"]) ? 0 : intval($_GET["u"]);
+            $group["name"]      = '';
+            $group["member"]    = array();
+            $group["value"]     = '';
+            $group["trash"]     = 0;
+            $group["active"]    = 1;
 
-				$sendbutton = $BL['be_admin_fcat_button2'];   //create group
-			}
+            if($group["id"]) {
 
-			if(!empty($_POST["group_aktion"])) {
+                $sql = "SELECT * FROM ".DB_PREPEND."phpwcms_usergroup WHERE group_id=".$group["id"]." LIMIT 1";
+                $result = _dbQuery($sql);
+                if(isset($result[0]['group_id'])) {
+                    $group["name"]      = $result[0]["group_name"];
+                    $group["member"]    = empty($result[0]["group_member"]) ? array() : explode(',', $result[0]["group_member"]);
+                    $group["value"]     = $result[0]["group_value"];
+                    $group["trash"]     = $result[0]["group_trash"];
+                    $group["active"]    = $result[0]["group_active"];
+                }
 
-				$group["id"]		= intval($_POST["group_id"]);
-       			$group["name"]		= clean_slweg($_POST["group_name"], 250);
-				$group["member"]	= isset($_POST["acat_access"]) && is_array($_POST["acat_access"]) ? implode(',', $_POST["acat_access"]) : '';
-        		$group["value"]		= clean_slweg($_POST["group_value"]);
-				$group["trash"]		= empty($_POST["group_trash"]) ? 0 : intval($_POST["group_trash"]);
-				$group["active"]	= empty($_POST["group_active"]) ? 0 : 1;
+                $sendbutton = $BL['be_admin_fcat_button1']; //UPDATE GROUP
 
-				if(empty($group["name"])) {
+            } else {
 
-					$group["error"] = 1;
+                $sendbutton = $BL['be_admin_fcat_button2'];   //create group
+            }
 
-				} else {
+            if(!empty($_POST["group_aktion"])) {
 
-					$data = array(
+                $group["id"]        = intval($_POST["group_id"]);
+                $group["name"]      = clean_slweg($_POST["group_name"], 250);
+                $group["member"]    = isset($_POST["acat_access"]) && is_array($_POST["acat_access"]) ? implode(',', $_POST["acat_access"]) : '';
+                $group["value"]     = clean_slweg($_POST["group_value"]);
+                $group["trash"]     = empty($_POST["group_trash"]) ? 0 : intval($_POST["group_trash"]);
+                $group["active"]    = empty($_POST["group_active"]) ? 0 : 1;
 
-						'group_name'	=> $group["name"],
-						'group_member'	=> $group["member"],
-						'group_value'	=> $group["value"],
-						'group_trash'	=> $group["trash"],
-						'group_active'	=> $group["active"]
-					);
+                if(empty($group["name"])) {
 
-					$result = $group["id"] ? _dbUpdate('phpwcms_usergroup', $data, 'group_id='.$group["id"]) : _dbInsert('phpwcms_usergroup', $data);
+                    $group["error"] = 1;
 
-					if(isset($result['AFFECTED_ROWS']) || isset($result['INSERT_ID'])) {
-						headerRedirect(PHPWCMS_URL.'phpwcms.php?'.get_token_get_string('csrftoken').'&do=admin&p=1');
-					} else {
-						echo mysql_error();
-					}
+                } else {
 
-				}
+                    $data = array(
 
-				$group["member"] = convertStringToArray($group["member"]);
+                        'group_name'    => $group["name"],
+                        'group_member'  => $group["member"],
+                        'group_value'   => $group["value"],
+                        'group_trash'   => $group["trash"],
+                        'group_active'  => $group["active"]
+                    );
 
-			}
-		  ?>
+                    $result = $group["id"] ? _dbUpdate('phpwcms_usergroup', $data, 'group_id='.$group["id"]) : _dbInsert('phpwcms_usergroup', $data);
 
+                    if(isset($result['AFFECTED_ROWS']) || isset($result['INSERT_ID'])) {
+                        headerRedirect(PHPWCMS_URL.'phpwcms.php?'.get_token_get_string('csrftoken').'&do=admin&p=1');
+                    } else {
+                        echo _dbError();
+                    }
 
+                }
 
-		  <form action="phpwcms.php?do=admin&amp;p=1&amp;create_group=1" method="post" name="editsitestructure" id="editsitestructure" onsubmit="selectAllOptions(this.acat_access);selectAllOptions(this.acat_cp);var x = wordcount(this.acat_name.value);if(x&lt;1) {alert('Fill in a category title! \n\n('+x+' words total)');this.acat_name.focus();return false;}">
-		  <tr align="center" bgcolor="#F0F2F4"><td colspan="2"><table border="0" cellpadding="0" cellspacing="0" summary="">
-		  	<?php if(!empty($group["error"])) { ?>
-		    <tr>
-		      <td align="right" class="chatlist"><font color="#FF3300"><?php echo $BL['be_admin_usr_err'] ?>:</font>&nbsp;</td>
-		      <td class="error"><strong><?php echo $BL['be_fpriv_name'] ?></strong></td>
-		    </tr>
-			<tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="3" /></td>
-			</tr>
-			<?php } ?>
-		    <tr>
-		      <td align="right" class="chatlist"><?php echo $BL['be_fpriv_name'] ?>:&nbsp;</td>
-		      <td><input name="group_name" type="text" id="group_name" class="width400" value="<?php echo  empty($group["name"]) ? '' : html($group["name"]) ?>" size="40" maxlength="250" /></td>
-		    </tr>
+                $group["member"] = convertStringToArray($group["member"]);
 
+            }
+          ?>
 
-		    <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="6" /></td></tr>
-
+          <form action="phpwcms.php?do=admin&amp;p=1&amp;create_group=1" method="post" name="editsitestructure" id="editsitestructure" onsubmit="selectAllOptions(this.acat_access);selectAllOptions(this.acat_cp);var x = wordcount(this.acat_name.value);if(x&lt;1) {alert('Fill in a category title! \n\n('+x+' words total)');this.acat_name.focus();return false;}">
+          <tr align="center" bgcolor="#F0F2F4"><td colspan="2"><table border="0" cellpadding="0" cellspacing="0" summary="">
+            <?php if(!empty($group["error"])) { ?>
+            <tr>
+              <td align="right" class="chatlist" style="color:#FF3300;"><?php echo $BL['be_admin_usr_err'] ?>:&nbsp;</td>
+              <td class="error"><strong><?php echo $BL['be_fpriv_name'] ?></strong></td>
+            </tr>
+            <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="3" /></td>
+            </tr>
+            <?php } ?>
+            <tr>
+              <td align="right" class="chatlist"><?php echo $BL['be_fpriv_name'] ?>:&nbsp;</td>
+              <td><input name="group_name" type="text" id="group_name" class="width400" value="<?php echo empty($group["name"]) ? '' : html($group["name"]) ?>" size="40" maxlength="250" /></td>
+            </tr>
 
+            <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="6" /></td></tr>
 
         <tr>
-		      <td align="right" class="chatlist"><?php echo $BL['be_cnt_description'] ?>:&nbsp;</td>
-		      <td><textarea name="group_value" id="group_value" class="width400" rows="3"><?php echo html($group["value"]) ?></textarea></td>
-		    </tr>
+              <td align="right" class="chatlist"><?php echo $BL['be_cnt_description'] ?>:&nbsp;</td>
+              <td><textarea name="group_value" id="group_value" class="width400" rows="3"><?php echo html($group["value"]) ?></textarea></td>
+            </tr>
 
         <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="6" /></td></tr>
 
-		  <!-- USER RIGHTS enym.com   -->
+          <!-- USER RIGHTS enym.com   -->
 
-		<tr>
+        <tr>
     <td align="right" class="chatlist"><?php echo $BL['be_selection'] ?>:&nbsp;</td>
 
     <td valign="top">
@@ -219,103 +209,97 @@
 
 // list all available frontend users and put into temp array
 $sql = "SELECT * FROM ".DB_PREPEND."phpwcms_user WHERE usr_aktiv != 9 ORDER BY usr_fe, usr_name, usr_login";
-if($result = mysql_query($sql, $db) or die("error while listing frontend users")) {
-	$_temp_usr = array();
-	while($row = mysql_fetch_assoc($result)) {
-		$_temp_usr[$row['usr_id']]['name']   = html($row['usr_name']);
-		$_temp_usr[$row['usr_id']]['login']  = html($row['usr_login']);
-		$_temp_usr[$row['usr_id']]['fe']     = $row['usr_fe'];
-		$_temp_usr[$row['usr_id']]['active'] = $row['usr_aktiv'];
-		$_temp_usr[$row['usr_id']]['admin'] = $row['usr_admin'];
-	}
-	mysql_free_result($result);
+$result = _dbQuery($sql);
+$_temp_usr = array();
+if(isset($result[0]['usr_id'])) {
+    foreach($result as $row) {
+        $_temp_usr[$row['usr_id']]['name']   = html($row['usr_name']);
+        $_temp_usr[$row['usr_id']]['login']  = html($row['usr_login']);
+        $_temp_usr[$row['usr_id']]['fe']     = $row['usr_fe'];
+        $_temp_usr[$row['usr_id']]['active'] = $row['usr_aktiv'];
+        $_temp_usr[$row['usr_id']]['admin'] = $row['usr_admin'];
+    }
 }
 
 ?>
-			<table border="0" cellspacing="0" cellpadding="0">
+            <table border="0" cellspacing="0" cellpadding="0">
               <tr>
                 <td><select name="acat_access[]" id="acat_access" size="12" multiple="multiple" class="width185" onDblClick="moveSelectedOptions(document.editsitestructure.acat_access,document.editsitestructure.acat_feusers,true);">
 <?php
-
-// list all fe_users
-foreach($_temp_usr as $key => $value) {
-	if (isset($group["member"]) && empty($group["error"])) {
-    if(in_array($key, $group["member"])) {
-  		echo '<option value="'.$key.'"';
-  		if(!$_temp_usr[$key]['active']) {
-  			echo ' style="color:#999999;"';
-  		} else if($_temp_usr[$key]['admin']) {
-  			echo ' style="color:#3F61BF;"';
-  		}
-  		echo '>'.trim($_temp_usr[$key]['name']. ' ('.$_temp_usr[$key]['login'].')')."</option>\n";
-  		unset($_temp_usr[$key]);
-  	}
-  }
-}
+    if(count($_temp_usr)) {
+        // list all fe_users
+        foreach($_temp_usr as $key => $value) {
+            if(isset($group["member"]) && empty($group["error"])) {
+                if(in_array($key, $group["member"])) {
+                    echo '<option value="'.$key.'"';
+                    if(!$_temp_usr[$key]['active']) {
+                        echo ' style="color:#999999;"';
+                    } else if($_temp_usr[$key]['admin']) {
+                        echo ' style="color:#3F61BF;"';
+                    }
+                    echo '>'.trim($_temp_usr[$key]['name']. ' ('.$_temp_usr[$key]['login'].')')."</option>\n";
+                    unset($_temp_usr[$key]);
+                }
+            }
+        }
+    }
 
 ?>
-		</select></td>
+        </select></td>
                 <td valign="top" style="padding-left:5px;padding-right:5px;"><img src="img/button/put_left.gif" width="15" height="15" title="<?php echo $BL['be_admin_struct_adduser_all']?>" onClick="moveAllOptions(document.editsitestructure.acat_feusers,document.editsitestructure.acat_access);selectAllOptions(document.editsitestructure.acat_access);"><br><img src="img/leer.gif" width="1" height="3"><br><img src="img/button/put_left_a.gif" width="15" height="15" title="<?php echo $BL['be_admin_struct_adduser_this']?>" onClick="moveSelectedOptions(document.editsitestructure.acat_feusers,document.editsitestructure.acat_access,true);selectAllOptions(document.editsitestructure.acat_access);"><br><img src="img/leer.gif" width="1" height="6"><br><img src="img/button/put_right_a.gif" width="15" height="15" title="<?php echo $BL['be_admin_struct_remove_this']?>" onClick="moveSelectedOptions(document.editsitestructure.acat_access,document.editsitestructure.acat_feusers,true);"><br><img src="img/leer.gif" width="1" height="3"><br><img src="img/button/put_right.gif" width="15" height="15" title="<?php echo $BL['be_admin_struct_remove_all']?>" onClick="moveAllOptions(document.editsitestructure.acat_access,document.editsitestructure.acat_feusers);"></td>
                 <td><select name="acat_feusers" size="12" multiple="multiple" id="acat_feusers" class="width185" onDblClick="moveSelectedOptions(document.editsitestructure.acat_feusers,document.editsitestructure.acat_access,true);selectAllOptions(document.editsitestructure.acat_access);">
 <?php
 
-// list all available fe_users
-if(isset($_temp_usr) && is_array($_temp_usr)) {
-	foreach($_temp_usr as $key => $value) {
-		echo '<option value="'.$key.'"';
-		if(!$_temp_usr[$key]['active']) {
-			echo ' style="color:#999999"';
-		} else if($_temp_usr[$key]['admin']) {
-			echo ' style="color:#3F61BF"';
-		}
-		echo '>'.trim($_temp_usr[$key]['name']. ' ('.$_temp_usr[$key]['login'].')')."</option>\n";
-	}
-}
+    // list all available fe_users
+    if(count($_temp_usr)) {
+        foreach($_temp_usr as $key => $value) {
+            echo '<option value="'.$key.'"';
+            if(!$_temp_usr[$key]['active']) {
+                echo ' style="color:#999999"';
+            } else if($_temp_usr[$key]['admin']) {
+                echo ' style="color:#3F61BF"';
+            }
+            echo '>'.trim($_temp_usr[$key]['name']. ' ('.$_temp_usr[$key]['login'].')')."</option>\n";
+        }
+    }
 
 ?>
-		</select></td>
+        </select></td>
               </tr>
             </table></td>
           </tr>
 
-
-
      <!-- USER RIGHTS -->
 
-
-
-
-
-
-			<tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="6" /></td></tr>
-		    <tr>
-		      <td align="right" class="chatlist"><?php echo $BL['be_ftptakeover_status'] ?>:&nbsp;</td>
-		      <td><table border="0" cellpadding="0" cellspacing="0" bgcolor="#D9DEE3" summary="">
+            <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="6" /></td></tr>
+            <tr>
+              <td align="right" class="chatlist"><?php echo $BL['be_ftptakeover_status'] ?>:&nbsp;</td>
+              <td><table border="0" cellpadding="0" cellspacing="0" bgcolor="#D9DEE3" summary="">
                <tr>
                   <td><input name="group_active" type="checkbox" id="group_active" value="1"<?php is_checked(1, empty($group["active"]) ? 0 : $group["active"]); ?> /></td>
                   <td><label for="group_active"><?php echo $BL['be_ftptakeover_active'] ?></label>&nbsp;&nbsp;</td>
                 </tr>
               </table></td>
-		      </tr>
-		    <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="10" /></td>
-		    </tr>
-		    <tr>
-		      <td>
-			  &nbsp;
-			  <input name="group_id" type="hidden" id="group_id" value="<?php echo $group["id"] ?>" />
-			  <input name="group_aktion" type="hidden" id="group_aktion" value="1" />
-			  </td>
-		      <td>
-			  <input name="Submit" type="submit" class="button" value="<?php echo $sendbutton ?>" />
-		      &nbsp;&nbsp;
-		      <input name="donotsubmit" type="button" class="button" value="<?php echo $BL['be_admin_fcat_exit'] ?>" onclick="location.href='phpwcms.php?do=admin&amp;p=1';" /></td>
-		      </tr>
-		    </table></td>
-		  </tr>
-		  <tr bgcolor="#F0F2F4"><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="15" /></td>
-		  </tr>
-		  </form>
+              </tr>
+            <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="10" /></td>
+            </tr>
+            <tr>
+              <td>
+              &nbsp;
+              <input name="group_id" type="hidden" id="group_id" value="<?php echo $group["id"] ?>" />
+              <input name="group_aktion" type="hidden" id="group_aktion" value="1" />
+              </td>
+              <td>
+              <input name="Submit" type="submit" class="button" value="<?php echo $sendbutton ?>" />
+              &nbsp;&nbsp;
+              <input name="donotsubmit" type="button" class="button" value="<?php echo $BL['be_admin_fcat_exit'] ?>" onclick="location.href='phpwcms.php?do=admin&amp;p=1';" /></td>
+              </tr>
+            </table></td>
+          </tr>
+          <tr bgcolor="#F0F2F4"><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="15" /></td>
+          </tr>
+          </form>
       </table>
 <?php
-		  }
+}
 ?>
\ No newline at end of file
diff --git a/include/inc_tmpl/admin.newuser.tmpl.php b/include/inc_tmpl/admin.newuser.tmpl.php
index 483433b37..e29a314b2 100644
--- a/include/inc_tmpl/admin.newuser.tmpl.php
+++ b/include/inc_tmpl/admin.newuser.tmpl.php
@@ -12,83 +12,82 @@
 // ----------------------------------------------------------------
 // obligate check for phpwcms constants
 if (!defined('PHPWCMS_ROOT')) {
-	die("You Cannot Access This Script Directly, Have a Nice Day.");
+    die("You Cannot Access This Script Directly, Have a Nice Day.");
 }
 // ----------------------------------------------------------------
 
-
-$new_login 			= genlogname();
-$new_password 		= generic_string(8);
-$new_email			= '';
-$new_name			= '';
-$set_user_aktiv 	= 0;
-$set_user_admin 	= 0;
-$set_user_fe		= 0;
-$send_verification	= 1;
-$user_err			= '';
+$new_login          = genlogname();
+$new_password       = generic_string(8);
+$new_email          = '';
+$new_name           = '';
+$set_user_aktiv     = 0;
+$set_user_admin     = 0;
+$set_user_fe        = 0;
+$send_verification  = 1;
+$user_err           = '';
 
 if(isset($_POST["form_aktion"]) && $_POST["form_aktion"] == "create_account") {
-	//Create Account Daten verarbeiten
-	$new_login 			= slweg($_POST["form_newloginname"]);
-	$new_password 		= slweg($_POST["form_newpassword"]);
-	$new_email 			= clean_slweg($_POST["form_newemail"]);
-	$new_name 			= clean_slweg($_POST["form_newrealname"]);
-	$set_user_aktiv 	= isset($_POST["form_active"]) ? 1 : 0;
-	$set_user_admin 	= isset($_POST["form_admin"]) ? 1 : 0;
-	$set_user_fe 		= isset($_POST["form_feuser"]) ? intval($_POST["form_feuser"]) : 0;
-	if($set_user_admin) {
-		$set_user_fe 	= 2;
-	}
-	$send_verification 	= isset($_POST["verification_email"]) ? 1 : 0;
-	if(str_empty($new_login)) {
-		$user_err = $BL['be_admin_usr_err2']."\n";
-	} else {
-		$sql = "SELECT COUNT(*) AS anzahl FROM ".DB_PREPEND."phpwcms_user WHERE usr_login='".aporeplace($new_login)."'";
-		if($result = mysql_query($sql, $db)) {
-			if($check_anzahl = mysql_fetch_array($result)) {
-				if($check_anzahl["anzahl"]) $user_err .= $BL['be_admin_usr_err1']."\n";
-			}
-			mysql_free_result($result);
-		}
-	}
-	if(str_empty($new_password)) $user_err .= $BL['be_admin_usr_err3']."\n";
-	if(!is_valid_email($new_email) && $send_verification) $user_err .= $BL['be_admin_usr_err4']."\n";
-	if(empty($user_err)) { //Insert new User
-		$sql =	"INSERT INTO ".DB_PREPEND."phpwcms_user (usr_login, usr_pass, usr_email, ".
-				"usr_admin, usr_aktiv, usr_name, usr_wysiwyg, usr_fe ) VALUES ('".
-				aporeplace($new_login)."', '".
-				aporeplace(md5(makeCharsetConversion($new_password, PHPWCMS_CHARSET, 'utf-8')))."', '".
-				aporeplace($new_email)."', '".
-				$set_user_admin."', '".
-				$set_user_aktiv."', '".
-				aporeplace($new_name)."', 1, '".
-				$set_user_fe."')";
-		if(mysql_query($sql, $db) or die('error while creating new user')) {
-			$new_user_id = mysql_insert_id($db);
-			$user_ok = 1;
-			if($send_verification) {
-				$emailbody = str_replace('{LOGIN}', $new_login, $BL['be_admin_usr_mailbody']);
-				$emailbody = str_replace('{PASSWORD}', $new_password, $emailbody);
-				$emailbody = str_replace('{SITE}', PHPWCMS_URL, $emailbody);
-				$emailbody = str_replace('{LOGIN_PAGE}', PHPWCMS_URL.get_login_file(), $emailbody);
+    //Create Account Daten verarbeiten
+    $new_login          = slweg($_POST["form_newloginname"]);
+    $new_password       = slweg($_POST["form_newpassword"]);
+    $new_email          = clean_slweg($_POST["form_newemail"]);
+    $new_name           = clean_slweg($_POST["form_newrealname"]);
+    $set_user_aktiv     = isset($_POST["form_active"]) ? 1 : 0;
+    $set_user_admin     = isset($_POST["form_admin"]) ? 1 : 0;
+    $set_user_fe        = isset($_POST["form_feuser"]) ? intval($_POST["form_feuser"]) : 0;
+    if($set_user_admin) {
+        $set_user_fe = 2;
+    }
+    $send_verification  = isset($_POST["verification_email"]) ? 1 : 0;
+    if(empty($new_login)) {
+        $user_err .= $BL['be_admin_usr_err2']."\n";
+    } elseif(($check_anzahl = _dbQuery("SELECT COUNT(*) FROM ".DB_PREPEND."phpwcms_user WHERE usr_login='".aporeplace($new_login)."'", 'COUNT'))) {
+        $user_err .= $BL['be_admin_usr_err1']."\n";
+    }
+    if(empty($new_password)) {
+        $user_err .= $BL['be_admin_usr_err3']."\n";
+    }
+    if(!is_valid_email($new_email) && $send_verification) {
+        $user_err .= $BL['be_admin_usr_err4']."\n";
+    }
+    if(empty($user_err)) { //Insert new User
+        $sql =  "INSERT INTO ".DB_PREPEND."phpwcms_user (usr_login, usr_pass, usr_email, ".
+                "usr_admin, usr_aktiv, usr_name, usr_wysiwyg, usr_fe ) VALUES ('".
+                aporeplace($new_login)."', '".
+                aporeplace(md5(makeCharsetConversion($new_password, PHPWCMS_CHARSET, 'utf-8')))."', '".
+                aporeplace($new_email)."', '".
+                $set_user_admin."', '".
+                $set_user_aktiv."', '".
+                aporeplace($new_name)."', 1, '".
+                $set_user_fe."')";
+        $result = _dbQuery($sql, 'INSERT');
+
+        if(!empty($result['INSERT_ID'])) {
+            $new_user_id = $result['INSERT_ID'];
+            $user_ok = 1;
+            if($send_verification) {
+                $emailbody = str_replace('{LOGIN}', $new_login, $BL['be_admin_usr_mailbody']);
+                $emailbody = str_replace('{PASSWORD}', $new_password, $emailbody);
+                $emailbody = str_replace('{SITE}', PHPWCMS_URL, $emailbody);
+                $emailbody = str_replace('{LOGIN_PAGE}', PHPWCMS_URL.get_login_file(), $emailbody);
 
-				sendEmail(	array(
-					'recipient'	=> $new_email,
-					'toName'	=> $new_name,
-					'subject'	=> $BL['be_admin_usr_mailsubject'],
-					'isHTML'	=> 0,
-					'text'		=> $emailbody,
-					'from'		=> $phpwcms["admin_email"],
-					'sender'	=> $phpwcms["admin_email"]
-				));
-			}
-		}
-	}
+                sendEmail(  array(
+                    'recipient' => $new_email,
+                    'toName'    => $new_name,
+                    'subject'   => $BL['be_admin_usr_mailsubject'],
+                    'isHTML'    => 0,
+                    'text'      => $emailbody,
+                    'from'      => $phpwcms["admin_email"],
+                    'sender'    => $phpwcms["admin_email"]
+                ));
+            }
+        }
+    }
 }
 
 if(empty($user_ok)) {
 
-?><form action="phpwcms.php?do=admin&amp;s=1" method="post" name="edituser"><table border="0" cellpadding="0" cellspacing="0" summary="">
+?><form action="phpwcms.php?do=admin&amp;s=1" method="post" name="edituser" autocomplete="off"><table border="0" cellpadding="0" cellspacing="0" summary="">
           <tr>
             <td colspan="2"><table border="0" cellpadding="0" cellspacing="0" summary="">
                 <tr>
@@ -101,49 +100,49 @@
             <td><img src="img/leer.gif" alt="" width="105" height="1"></td>
             <td><img src="img/leer.gif" alt="" width="1" height="5"></td>
           </tr>
-		  <?php
-		  if(!empty($user_err)) {
-		  ?>
+          <?php
+          if(!empty($user_err)) {
+          ?>
           <tr valign="top">
-            <td align="right"><strong style="color:#FF3300"><?php echo $BL['be_admin_usr_err'] ?>:</strong>&nbsp;</td>
-            <td><strong style="color:#FF3300"><?php echo nl2br(chop($user_err)) ?></strong></td>
+            <td align="right" class="error"><strong><?php echo $BL['be_admin_usr_err'] ?>:</strong>&nbsp;</td>
+            <td class="error"><strong><?php echo nl2br(chop($user_err)) ?></strong></td>
           </tr>
           <tr valign="top"><td colspan="2" align="right" class="chatlist"><img src="img/leer.gif" alt="" width="1" height="7"></td></tr>
-		  <?php
-		  } //Ende Fehler New User
-		  ?>
+          <?php
+          } //Ende Fehler New User
+          ?>
           <tr>
             <td align="right" class="chatlist"><?php echo $BL["login_username"]  ?>:&nbsp;</td>
-            <td><input name="form_newloginname" type="text" id="form_newloginname" style="font-family: Verdana, Arial, Helvetica, sans-serif; width:250px; font-size: 11px; font-weight: bold;" value="<?php echo $new_login ?>" size="30" maxlength="30" autocomplete="off"></td>
+            <td><input name="form_newloginname" type="text" id="form_newloginname" value="<?php echo html($new_login); ?>" size="30" maxlength="200" autocomplete="off" class="width250" /></td>
           </tr>
           <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="1"></td></tr>
           <tr>
             <td align="right" class="chatlist"><?php echo $BL["login_userpass"] ?>:&nbsp;</td>
-            <td><input name="form_newpassword" type="text" id="form_newpassword" style="font-family: Verdana, Arial, Helvetica, sans-serif; width:250px; font-size: 11px; font-weight: bold;" value="<?php echo $new_password ?>" size="30" maxlength="50" autocomplete="off"></td>
+            <td><input name="form_newpassword" type="text" id="form_newpassword" value="<?php echo html($new_password); ?>" size="30" maxlength="200" autocomplete="off" class="width250" /></td>
           </tr>
           <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="1"></td></tr>
           <tr>
             <td align="right" class="chatlist"><?php echo $BL['be_profile_label_email'] ?>:&nbsp;</td>
-            <td><input name="form_newemail" type="text" id="form_newemail" style="font-family: Verdana, Arial, Helvetica, sans-serif; width:250px; font-size: 11px; font-weight: bold;" value="<?php echo $new_email ?>" size="30" maxlength="150"></td>
+            <td><input name="form_newemail" type="text" id="form_newemail" value="<?php echo html($new_email); ?>" size="30" maxlength="250" autocomplete="off" class="width250" /></td>
           </tr>
           <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="1"></td></tr>
           <tr>
             <td align="right" class="chatlist"><?php echo $BL['be_admin_usr_realname'] ?>:&nbsp;</td>
-            <td><input name="form_newrealname" type="text" id="form_newrealname" style="font-family: Verdana, Arial, Helvetica, sans-serif; width:250px; font-size: 11px; font-weight: bold;" value="<?php echo $new_name ?>" size="30" maxlength="80"></td>
+            <td><input name="form_newrealname" type="text" id="form_newrealname" value="<?php echo html($new_name); ?>" size="30" maxlength="200" autocomplete="off" class="width250" /></td>
           </tr>
 
-		  <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="6"></td></tr>
+          <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="6"></td></tr>
           <tr>
             <td align="right" class="chatlist"><?php echo $BL['be_admin_usr_issection']  ?>:&nbsp;</td>
             <td><table border="0" cellpadding="0" cellspacing="0" bgcolor="#E7E8EB" summary="">
                 <tr>
-                  <td><input name="form_feuser" type="radio" id="form_feuser0" value="0"<?php is_checked($set_user_fe, 0); ?>></td>
+                  <td><input name="form_feuser" type="radio" id="form_feuser0" value="0"<?php is_checked($set_user_fe, 0); ?> /></td>
                   <td><label for="form_feuser0"><?php echo $BL['be_admin_usr_ifsection0'] ?></label>&nbsp;&nbsp;</td>
-				  <td><input name="form_feuser" type="radio" id="form_feuser1" value="1"<?php is_checked($set_user_fe, 1); ?>></td>
+                  <td><input name="form_feuser" type="radio" id="form_feuser1" value="1"<?php is_checked($set_user_fe, 1); ?> /></td>
                   <td><label for="form_feuser1"><?php echo $BL['be_admin_usr_ifsection1'] ?></label>&nbsp;&nbsp;</td>
-				  <td><input name="form_feuser" type="radio" id="form_feuser2" value="2"<?php is_checked($set_user_fe, 2); ?>></td>
+                  <td><input name="form_feuser" type="radio" id="form_feuser2" value="2"<?php is_checked($set_user_fe, 2); ?> /></td>
                   <td><label for="form_feuser2"><?php echo $BL['be_admin_usr_ifsection2'] ?></label></td>
-				  <td><img src="img/leer.gif" alt="" width="4" height="21"></td>
+                  <td><img src="img/leer.gif" alt="" width="4" height="21"></td>
                 </tr>
               </table></td>
           </tr>
@@ -153,7 +152,7 @@
             <td align="right" class="chatlist"><?php echo $BL['be_admin_usr_setactive'] ?>:&nbsp;</td>
             <td><table border="0" cellpadding="0" cellspacing="0" summary="">
                 <tr>
-                  <td><input name="form_active" type="checkbox" id="form_active" value="1"<?php is_checked($set_user_aktiv, 1); ?>></td>
+                  <td><input name="form_active" type="checkbox" id="form_active" value="1"<?php is_checked($set_user_aktiv, 1); ?> /></td>
                   <td><label for="form_active"><?php echo  $BL['be_admin_usr_iflogin'] ?></label></td>
                 </tr>
               </table></td>
@@ -164,8 +163,8 @@
             <td align="right" class="chatlist" style="color:#FF0000"><?php echo $BL['be_admin_usr_isadmin']  ?>:&nbsp;</td>
             <td><table border="0" cellpadding="0" cellspacing="0" summary="">
                 <tr>
-                  <td><input name="form_admin" type="checkbox" id="form_admin" value="1"<?php is_checked($set_user_admin, 1); ?>></td>
-                  <td><label for="form_admin"><?php echo  $BL['be_admin_usr_ifadmin'] ?> <strong style="color:#FF0000">!!!</strong></label></td>
+                  <td><input name="form_admin" type="checkbox" id="form_admin" value="1"<?php is_checked($set_user_admin, 1); ?> /></td>
+                  <td><label for="form_admin"><?php echo  $BL['be_admin_usr_ifadmin'] ?> <strong class="error">!!!</strong></label></td>
                 </tr>
               </table></td>
           </tr>
@@ -181,17 +180,15 @@
                 <tr><td colspan="3"><img src="img/leer.gif" alt="" width="1" height="6"></td></tr>
               </table></td>
           </tr>
-          <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="6"><input name="form_aktion" type="hidden" value="create_account"></td></tr>
+          <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="6"><input name="form_aktion" type="hidden" value="create_account" /></td></tr>
           <tr>
             <td>&nbsp;</td>
-            <td><input name="Submit" type="submit" class="button" value="<?php echo $BL['be_admin_usr_button'] ?>"></td>
+            <td><input name="Submit" type="submit" class="button" value="<?php echo $BL['be_admin_usr_button'] ?>" /></td>
           </tr>
           <tr><td colspan="2"><img src="img/leer.gif" alt="" width="1" height="15"></td></tr>
       </table></form><img src="img/lines/l538_70.gif" alt="" width="538" height="1"><br /><img src="img/leer.gif" alt="" width="1" height="5"><?php
 
 
 } else {
-	echo "<script type=\"text/javascript\"> timer=setTimeout(\"self.location.href='phpwcms.php'+'?".CSRF_GET_TOKEN."&do=admin'\", 0); </script>";
+    echo "<script type=\"text/javascript\"> timer=setTimeout(\"self.location.href='phpwcms.php'+'?".CSRF_GET_TOKEN."&do=admin'\", 0); </script>";
 }
-
-?>
\ No newline at end of file
