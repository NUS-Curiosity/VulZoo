
Date: 10 Jan 2008 23:29:25 -0000
From: sp3x@...urityreason.com
To: bugtraq@...urityfocus.com
Subject: SecurityReason - Apache2 CSRF, XSS, Memory Corruption and Denial
 of Service Vulnerability

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

[Apache2 CSRF, XSS, Memory Corruption and Denial of Service Vulnerability ]

Author: sp3x

Date:
- - Written: 06.12.2007
- - Public: 09.01.2008

SecurityReason Research
SecurityAlert Id: 48

CVE: CVE-2007-6420
     CVE-2007-6421
     CVE-2007-6422
     CVE-2007-6423

SecurityRisk: Low

Affected Software: Apache 2.2.x (mod_proxy_balancer)
Advisory URL:
http://securityreason.com/achievement_securityalert/48
Vendor: http://httpd.apache.org

- --- 0.Description ---

The Apache HTTP Server Project is an effort to develop and maintain an open-source HTTP server for modern operating systems including UNIX and Windows NT. The goal of this project is to provide a secure, efficient and extensible server that provides HTTP services in sync with the current  HTTP standards.

Apache has been the most popular web server on the Internet since April 1996. The November 2005 Netcraft Web Server Survey found that more than 70% of the web sites on the Internet are using Apache, thus making it more widely used than all other web servers combined.

mod_proxy_balancer : http://httpd.apache.org/docs/2.2/mod/mod_proxy_balancer.html

- From apache site : "Balancer manager enables dynamic update of balancer members. You can use balancer manager to change the balance factor or a particular member, or put it in the off line mode"

balancer-manager is an administrative interface which should only be accessible to trusted users. Due to the fact the SecurityRisk is Low.

- --- 1. Apache2 Cross-Site Request Forgery (CSRF) Vulnerability ---

During the fact that all actions are performed by GET method there exist "CSRF" .

The balancer-manager should use POST for requests which have side-effects 
which would significantly mitigate the "CSRF" issue.

- --- 2. Apache2 HTML Injection (XSS) Vulnerability ---

- --- First XSS ---

The HTML Injection (XSS) vulnerability exist in "mod_proxy_balancer.c" .

By Enabling Balancer Manager Support we can trigger XSS vulnerability . 

Input passed to the :
"ss" - called ""StickySession Identifier",  
"wr" - called "Route",
"rr" - called "Route Redirect", 
parametrs in balancer-manager are not properly sanitised leading to execute arbitrary HTML and script code in a victim's browser.

- --- Second XSS ---

Input passed in the URL to "balancer-mamanger" is not properly sanitised leading to execute arbitrary HTML and script code in a victim's browser.


- --- 3. Apache2 Denial of Service Vulnerability ---

The Denial of Service is caused due to an error in the "balancer_handler()" function that manages the loadfactors and member status. When attacker input invalid "bb" variable while editing worker settings leads to "Denial of Service Vulnerability".

- --- 4. Apache2 Memory Corruption ---

The Memory corruption is caused due to an error in the "mod_proxy_balancer" when attacker input in the URL 7390 or 7506 or 7622 "A" chars.

Only for Windows.

- --- 4. Exploit ---

SecurityReason is not going to release a exploit to the general public.
Exploit was provided and tested for Apache Team .

- --- 5. How to fix ---

Update to Apache 2.2.7-dev

http://httpd.apache.org/security/vulnerabilities_22.html

- --- 6. References ---

CSRF : http://www.owasp.org/index.php/Testing_for_CSRF

- --- 7. Greets ---

For: Maksymilian Arciemowicz ( cXIb8O3 ), Infospec, pi3, p_e_a, mpp

- --- 8. Contact ---

Author: sp3x
Email: sp3x [at] securityreason [dot] com
GPG: http://securityreason.com/key/sp3x.gpg
http://securityreason.com
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.7 (GNU/Linux)

iD8DBQFHhUo6haZ93YsJSwQRAuYmAKCF5gOZ4P804moV5ybi8yjpbnvqNwCeNr9O
+2Taez4t5p+5O7BZ9Yol2eg=
=v0YB
-----END PGP SIGNATURE-----
