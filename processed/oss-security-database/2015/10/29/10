
Date: Thu, 29 Oct 2015 12:00:27 +0000
From: Xen.org security team <security@....org>
To: xen-announce@...ts.xen.org, xen-devel@...ts.xen.org,
 xen-users@...ts.xen.org, oss-security@...ts.openwall.com
CC: Xen.org security team <security@....org>
Subject: Xen Security Advisory 148 (CVE-2015-7835) - x86: Uncontrolled
 creation of large page mappings by PV guests

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

            Xen Security Advisory CVE-2015-7835 / XSA-148
                              version 4

      x86: Uncontrolled creation of large page mappings by PV guests

UPDATES IN VERSION 4
====================

Public release.

ISSUE DESCRIPTION
=================

The code to validate level 2 page table entries is bypassed when
certain conditions are satisfied.  This means that a PV guest can
create writeable mappings using super page mappings.

Such writeable mappings can violate Xen intended invariants for pages
which Xen is supposed to keep read-only.

This is possible even if the "allowsuperpage" command line option is
not used.

IMPACT
======

Malicious PV guest administrators can escalate privilege so as to
control the whole system.

VULNERABLE SYSTEMS
==================

Xen 3.4 and onward are vulnerable.

Only x86 systems are vulnerable.  ARM systems are not vulnerable.

Only PV guests can exploit the vulnerability.  Both 32-bit and 64-bit
PV guests can do so.

MITIGATION
==========

Running only HVM guests will avoid this vulnerability.

On systems where the guest kernel is controlled by the host rather
than guest administrator, running only kernels which do not call these
hypercalls will also prevent untrusted guest users from exploiting
this issue. However untrusted guest administrators can still trigger
it unless further steps are taken to prevent them from loading code
into the kernel (e.g. by disabling loadable modules etc) or from using
other mechanisms which allow them to run code at kernel privilege.

CREDITS
=======

This issue was discovered by 栾尚聪 (好风) of Alibaba.

RESOLUTION
==========

Applying the appropriate attached patch resolves this issue.

xsa148.patch                 xen-unstable, Xen 4.6.x
xsa148-4.5.patch             Xen 4.5.x
xsa148-4.4.patch             Xen 4.4.x, Xen 4.3.x

$ sha256sum xsa148*.patch
f320d105a4832124910f46c50acd4803fe289bd7c4702ec15f97fb611b70944d  xsa148.patch
7f78efd001f041a0e5502546664d28011cb881d72c94ea564585efb3ca01ddfe  xsa148-4.4.patch
272a729048471cea851d4a881f3f2c32c7be101e2a452d2b2ceb9d66908ee4a3  xsa148-4.5.patch
$

DEPLOYMENT DURING EMBARGO
=========================

Deployment of the patches and/or mitigations described above (or
others which are substantially similar) is permitted during the
embargo, even on public-facing systems with untrusted guest users and
administrators.

But: Distribution of updated software is prohibited (except to other
members of the predisclosure list).

Predisclosure list members who wish to deploy significantly different
patches and/or mitigations, please contact the Xen Project Security
Team.


(Note: this during-embargo deployment notice is retained in
post-embargo publicly released Xen Project advisories, even though it
is then no longer applicable.  This is to enable the community to have
oversight of the Xen Project Security Team's decisionmaking.)

For more information about permissible uses of embargoed information,
consult the Xen Project community's agreed Security Policy:
  http://www.xenproject.org/security-policy.html
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)

iQEcBAEBAgAGBQJWMgm4AAoJEIP+FMlX6CvZPl0IAI7uPHn9OiDqQlKnvuF5DJkx
WkmX6lNgIXd9arkZ2gUvlenPArfJV2Rv75TP/0LLuITrv+AcylFEBd7T7rdbXeAT
w5TaYI1wnixu8D+klyMGDjIt8Oy0gG1D8tpJYB4SETmT/Knv9FmFmUrShPD5kEVW
6W3j3PulCpPX6+8rpmD+1CD8DDH/FHvr3xc/mK9gaWTSfPvYX0wcUbVR5GK63SHy
6smdmcbyMz6RLlq9MRSs1ifYuAOFel3bFi0NaUm+w3luVozgg6MiEopmnmLZXgbu
93iMDiKbQmr6XdsqvqWexJ7hAiWD5Sp+ztUW0iyNLKpj482VU9wSm0vwneZpgCg=
=WDZi
-----END PGP SIGNATURE-----

Download attachment "xsa148.patch" of type "application/octet-stream" (1666 bytes)

Download attachment "xsa148-4.4.patch" of type "application/octet-stream" (1568 bytes)

Download attachment "xsa148-4.5.patch" of type "application/octet-stream" (1663 bytes)
