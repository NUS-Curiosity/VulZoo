
Date: Wed, 09 Dec 2009 16:32:51 -0500
From: iDefense Labs <labs-no-reply@...fense.com>
To: bugtraq@...urityfocus.com, vulnwatch@...nwatch.org, 
	full-disclosure@...ts.grok.org.uk
Subject: iDefense Security Advisory 12.08.09: Microsoft
 WordPad Word97 Converter Integer Overflow Vulnerability

iDefense Security Advisory 12.08.09
http://labs.idefense.com/intelligence/vulnerabilities/
Dec 08, 2009

I. BACKGROUND

WordPad is the default text editing application included with nearly all
Windows versions since Windows 95. The Word97 converter is used to
convert Word documents into the format used by WordPad, and is present
in all current versions of WordPad except Vista and Server 2008.

II. DESCRIPTION

Remote exploitation of an integer overflow vulnerability in Microsoft
Corp.'s WordPad could allow an attacker to execute arbitrary code with
the privileges of the current user.

The vulnerability occurs when parsing the DocumentSummaryInformation
stream inside of a DOC file. This stream is used to provide information
about the author of the document, date of creation, and similar data.
Part of the data in this stream is a sequence of property name and
value pairs. When reading in the names of these properties, the code
performs a calculation using a 32bit integer from the file that
represents the number of names present. The value is used without any
check on its bounds, which can lead to an integer overflow. This
results in an undersized heap buffer being allocated to store the
property data. It is then possible to overflow this buffer with data
from the file.

III. ANALYSIS

Exploitation of this vulnerability results in the execution of arbitrary
code with the privileges of the user opening the file. To exploit this
vulnerability, an attacker needs to convince a user to open a malicious
file. Usually, WordPad would not be associated with the .DOC file
extension, and would not open it when the file is double clicked.
However, by renaming the .doc file to a .wri extension (associated with
WordPad), it is possible to make WordPad open the file simply by double
clicking it.

IV. DETECTION

iDefense has confirmed the existence of this vulnerability in WordPad
version 5.1 for Windows XP SP3 and SP2. Other versions of Windows may
also be affected. However, Vista and Server 2008 are not affected as
they no longer contain the Word97 converter.

V. WORKAROUND

It is possible to disable access to the converter by changing the ACLs
on the file. This can be accomplished as follows, depending on the
version of Windows being used:

echo y| cacls "%ProgramFiles%\Common Files\Microsoft
Shared\TextConv\mswrd832.cnv" /E /P everyone:N echo y| cacls
"%ProgramFiles(x86)%\Common Files\Microsoft
Shared\TextConv\mswrd832.cnv" /E /P everyone:N echo y| cacls
"%ProgramFiles%\Windows NT\Accessories\mswrd8.wpc" /E /P everyone:N
echo y| cacls "%ProgramFiles%\Windows NT\Accessories\mswrd864.wpc" /E
/P everyone:N echo y| cacls "%ProgramFiles(x86)%\Windows
NT\Accessories\mswrd8.wpc" /E /P everyone:N

VI. VENDOR RESPONSE

Microsoft has released a patch which addresses this issue. This patch
removes the vulnerability by changing the way that the WordPad Text
Converters handle opening specially crafted Word 97 files. For more
information, consult their advisory at the following URL:

http://www.microsoft.com/technet/security/bulletin/MS09-073.mspx

VII. CVE INFORMATION

The Common Vulnerabilities and Exposures (CVE) project has assigned the
name CVE-2009-2506 to this issue. This is a candidate for inclusion in
the CVE list (http://cve.mitre.org/), which standardizes names for
security problems.

VIII. DISCLOSURE TIMELINE

12/18/2009  Initial Vendor Notification
12/19/2009  Initial Vendor Reply
12/08/2009  Coordinated Public Disclosure

IX. CREDIT

This vulnerability was discovered by Jun Mao and Sean Larsson, iDefense
Labs.

Get paid for vulnerability research
http://labs.idefense.com/methodology/vulnerability/vcp.php

Free tools, research and upcoming events
http://labs.idefense.com/

X. LEGAL NOTICES

Copyright Â© 2009 iDefense, Inc.

Permission is granted for the redistribution of this alert
electronically. It may not be edited in any way without the express
written consent of iDefense. If you wish to reprint the whole or any
part of this alert in any other medium other than electronically,
please e-mail customerservice@...fense.com for permission.

Disclaimer: The information in the advisory is believed to be accurate
at the time of publishing based on currently available information. Use
of the information constitutes acceptance for use in an AS IS condition.
 There are no warranties with regard to this information. Neither the
author nor the publisher accepts any liability for any direct,
indirect, or consequential loss or damage arising from use of, or
reliance on, this information.

_______________________________________________
Full-Disclosure - We believe in it.
Charter: http://lists.grok.org.uk/full-disclosure-charter.html
Hosted and sponsored by Secunia - http://secunia.com/
