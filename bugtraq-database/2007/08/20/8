
Date: Mon, 20 Aug 2007 11:39:27 -0400
From: iDefense Labs <labs-no-reply@...fense.com>
To: vulnwatch@...nwatch.org, full-disclosure@...ts.grok.org.uk,
	bugtraq@...urityfocus.com
Subject: iDefense Security Advisory 08.20.07: Check Point Zone Labs VSDATANT
 Multiple IOCTL Privilege Escalation Vulnerabilities

Check Point Zone Labs VSDATANT Multiple IOCTL Privilege Escalation
Vulnerabilities

iDefense Security Advisory 08.20.07
http://labs.idefense.com/intelligence/vulnerabilities/
Aug 20, 2007

I. BACKGROUND

Zone Alarm products provide security solutions such as anti-virus,
firewall, spy-ware, and ad-ware protection. The vsdatant.sys driver,
also known as the TrueVector Device Driver, is the core firewall driver
in ZoneAlarm products. More information is available at the Zone Labs
web site at the following URL.

http://www.zonelabs.com/

II. DESCRIPTION

Local exploitation of multiple input validation vulnerabilities within
multiple Check Point Zone Alarm products could allow an attacker to
execute arbitrary code in kernel (ring0) context.

The problems specifically exist within the IOCTL handling code in the
vsdatant.sys device driver. The device driver fails to validate
user-land supplied addresses passed to IOCTL 0x8400000F and IOCTL
0x84000013.

Since the Irp parameters are not correctly validated, an attacker could
utilize these IOCTLs to overwrite arbitrary memory with the constant
double-word value of 0x60001 or the contents of a buffer returned from
ZwQuerySystemInformation. This includes kernel memory as well as the
code segments of running processes.

III. ANALYSIS

Exploitation allows an attacker to gain complete control of the affected
machine. The access control mechanisms under a default installation
allow restricted accounts to access the affected device drivers.

IV. DETECTION

iDefense has confirmed the existence of these vulnerabilities within
version 6.5.737.0 of vsdatant.sys as installed with Check Point Zone
Labs Zone Alarm Free. All other products within the Zone Alarm product
line are suspected to be vulnerable. Previous versions are also
suspected to be vulnerable.

V. WORKAROUND

Changing the access control mechanisms for the affected device drivers
will prevent exploitation by restricted accounts.

VI. VENDOR RESPONSE

Check Point Zone Labs has addressed these vulnerabilities in version
7.0.362 of their ZoneAlarm products. For more information, consult the
Check Point Zone Labs download page at the following URL.

http://www.zonealarm.com/store/content/catalog/products/trial_zaFamily/trial_zaFamily.jsp

VII. CVE INFORMATION

The Common Vulnerabilities and Exposures (CVE) project has assigned the
name CVE-2007-4216 to this issue. This is a candidate for inclusion in
the CVE list (http://cve.mitre.org/), which standardizes names for
security problems.

VIII. DISCLOSURE TIMELINE

12/19/2006  Initial vendor notification
12/20/2006  Initial vendor response
08/20/2007  Coordinated public disclosure

IX. CREDIT

These vulnerabilities were reported to iDefense by Ruben Santamarta of
reversemode.com.

Get paid for vulnerability research
http://labs.idefense.com/methodology/vulnerability/vcp.php

Free tools, research and upcoming events
http://labs.idefense.com/

X. LEGAL NOTICES

Copyright Â© 2007 iDefense, Inc.

Permission is granted for the redistribution of this alert
electronically. It may not be edited in any way without the express
written consent of iDefense. If you wish to reprint the whole or any
part of this alert in any other medium other than electronically,
please e-mail customerservice@...fense.com for permission.

Disclaimer: The information in the advisory is believed to be accurate
at the time of publishing based on currently available information. Use
of the information constitutes acceptance for use in an AS IS condition.
 There are no warranties with regard to this information. Neither the
author nor the publisher accepts any liability for any direct,
indirect, or consequential loss or damage arising from use of, or
reliance on, this information.
