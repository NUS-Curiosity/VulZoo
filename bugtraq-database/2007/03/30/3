
Date: Thu, 29 Mar 2007 21:30:00 -0400
From: "M. Shirk" <shirkdog_list@...mail.com>
To: full-disclosure@...ts.grok.org.uk
Cc: bugtraq@...urityfocus.com
Subject: CA Brightstor Backup Mediasvr.exe Remote Code Vulnerability


[Shirkdog Security Advisory SHK-004]

Title:
------
Computer Associates (CA) Brightstor Backup Mediasvr.exe Remote Code 
Vulnerability

Description of Application:
---------------------------
http://www3.ca.com/solutions/ProductFamily.aspx?ID=115

Brightstor ARCserv Backup provides a complete, flexible and integrated 
backup and recovery solution for Windows, NetWare, Linux and UNIX 
environments.

Vulnerability(PoC):
-------------------
There seems to be an design error in the handling of RPC data with xdr 
procedures across several .dll's imported by Mediasvr.exe. Four bytes from 
an RPC packet are processed as a particular address (xdr_handle_t data which 
is run through multiple bit shifts, and reversing of bytes), and eventually 
loaded into ECX. The 191 (0xbf) procedure, followed by nulls (at least 8 
bytes of nulls, which may be Null Credentials and Auth?) leads to an 
exploitable condition.

.text:0040AACD 008 mov ecx, [esp+8]
.text:0040AAD1 008 mov dword_418820, esi
.text:0040AAD7 008 push offset dword_418820
.text:0040AADC 00C mov eax, [ecx]
.text:0040AADE 00C call dword ptr [eax+2Ch]

At this point, you have control of ECX (esp+8 is your address data). The 
data from the packet is stored in memory and is relatively static (see 
NOTE). The address is then loaded into EAX, and then called as EAX+2Ch, 
which is controllable data from the packet. In this code, I just jump ahead 
to the portbinding shellcode.
The following exploit opens up a shell on port 4444:

http://www.shirkdog.us/camediasvrremote.py


Impact:
----------
This vulnerability leads to remote code execution.

Risk Level:
--------------
Critical

Solution:
------------
CA has been notified

References:
--------------

[Shirkdog Security]
http://www.shirkdog.us/shk-004.html


Shirkdog
' or 1=1--
http://www.shirkdog.us

_________________________________________________________________
i'm making a difference.ï¿½Make every IM count for the cause of your choice. 
Join Now. 
http://clk.atdmt.com/MSN/go/msnnkwme0080000001msn/direct/01/?href=http://im.live.com/messenger/im/home/?source=hmtagline

