
Date: Mon, 29 Jan 2007 21:31:00 -0500
From: Clay Seaman-Kossmeyer <ckossmey@...co.com>
To: S21sec Labs <labs@...sec.com>
Cc: full-disclosure@...ts.grok.org.uk, bugtraq@...urityfocus.com,
	ckossmey@...co.com
Subject: Re: [Full-disclosure] S21sec-034-en: Cisco VTP DoS vulnerability

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


Hello -

Cisco has posted a Security Response in reference to this issue at the
following URL:

http://www.cisco.com/warp/public/707/cisco-sr-20070129-vtp.shtml

Cisco Response
==============

An issue has been reported to the Cisco PSIRT involving malformed VLAN
Trunking Protocol (VTP) packets. This attack may cause the target
device to reload, causing a Denial of Service (DoS).

Such an attack must be executed on a local ethernet segment, and the
VTP domain name must be known to the attacker. Additionally, these
attacks must be executed against a switch port that is configured for
trunking. Non-trunk access ports are not affected.

This issue is tracked as Cisco Bug ID CSCsa67294.

Details
=======

The VLAN Trunking Protocol (VTP) is a Layer 2 protocol that manages
the addition, deletion, and renaming of VLANS on a network-wide basis
in order to maintain VLAN configuration consistency.

VTP packets are exchanged by VLAN-aware switches. For more information
on VTP, consult the following link:

http://www.cisco.com/en/US/products/hw/switches/ps663/products_configuration_guide_chapter09186a00800e47e3.html.

Upon receiving a malformed VTP packet, certain devices may reload. The
attack could be executed repeatedly causing a extended Denial of
Service.

In order to successfully exploit this vulnerability, the attacker must
know the VTP domain name, as well as send the malformed VTP packet to
a port on the switch configured for trunking.

This does not affect switch ports that are configured for voice
vlans. A complete Inter-Switch Link (ISL) or 802.1q trunk port is
required for the device to be vulnerable.

These platforms are affected:

    * Cisco 2900XL Series Switches
    * Cisco 2950 Series Switches
    * Cisco 2955 Series Switches
    * Cisco 3500XL Series Switches
    * Cisco 3550 Series Switches
    * Cisco 3570 Series Switches

No other Cisco products are known to be vulnerable to this issue.

This issue was made public on 26-Jan-2007 on the Full-Disclosure and
Bugtraq mailing lists. The Cisco bug ID CSCsa67294 was made available
to registered customers in May of 2005.

We would like to thank David Barroso Berrueta and Alfredo Andres
Omella for reporting this vulnerability to us. You can find their
release here: http://www.s21sec.com/es/avisos/s21sec-034-en.txt.

We greatly appreciate the opportunity to work with researchers on
security vulnerabilities and welcome the opportunity to review and
assist in security vulnerability reports against Cisco products.

Workarounds
===========

In order to mitigate your exposure, ensure that only known, trusted
devices are connected to ports configured for ISL or 802.1q trunking.

More information on securing L2 networks can be found in the Cisco
SAFE Layer 2 Security document at this location:

http://www.cisco.com/en/US/netsol/ns340/ns394/ns171/ns128/networking_solutions_white_paper09186a008014870f.shtml

Additional Information
======================

THIS DOCUMENT IS PROVIDED ON AN "AS IS" BASIS AND DOES NOT IMPLY ANY
KIND OF GUARANTEE OR WARRANTY, INCLUDING THE WARRANTIES OF
MERCHANTABILITY OR FITNESS FOR A PARTICULAR USE. YOUR USE OF THE
INFORMATION ON THE DOCUMENT OR MATERIALS LINKED FROM THE DOCUMENT IS
AT YOUR OWN RISK. CISCO RESERVES THE RIGHT TO CHANGE OR UPDATE THIS
DOCUMENT AT ANY TIME.

Revision History
================

+--------------+------------------+------------------------+
| Revision 1.0 |  2007-January-29 | Initial public release |
+--------------+------------------+------------------------+

Cisco Security Procedures
=========================

Complete information on reporting security vulnerabilities in Cisco
products, obtaining assistance with security incidents, and
registering to receive security information from Cisco, is available
on Cisco's worldwide website at
http://www.cisco.com/en/US/products/products_security_vulnerability_policy.html.
This includes instructions for press inquiries regarding Cisco
security notices. All Cisco security advisories are available at
http://www.cisco.com/go/psirt.



On Fri, Jan 26, 2007 at 02:46:43PM -0500, S21sec Labs wrote:
> ###############################################################
> ID: S21SEC-034-en
> Title: Cisco VTP Denial Of Service
> Date: 26/01/2007
> Status: Vendor contacted, bug fixed
> Severity: Medium - DoS - remote from the local subnet
> Scope: Cisco Catalyst Switch denial of service
> Platforms: IOS
> Author: Alfredo Andres Omella, David Barroso Berrueta
> Location: http://www.s21sec.com/es/avisos/s21sec-034-en.txt
> Release: Public
> ###############################################################
> 
> 				S 2 1 S E C
> 
> 			   http://www.s21sec.com
> 
> 	           	Cisco VTP Denial Of Service
> 
> 
> About VTP
> ---------
> 
> VTP (VLAN Trunking Protocol) is a Cisco proprietary protocol used for  
> VLAN centralized management.
> For instance, when you configure a VLAN in a switch, the VLAN  
> information (the VLAN name and its identifier)
> will be configured automatically in all the switches that belong to  
> the same VTP domain.
> 
> 
> Description of vulnerability
> ----------------------------
> 
> VTP uses Subset-Advert messages to advertise the existing VLANs  
> within a VTP domain,
> sending a malformed crafted packet it is possible to force a switch  
> "crash & reload". In order to trigger the vulnerability,
> you need to previously set up the trunking (manually or using  
> Yersinia DTP attack).
> 
> 
> Affected Versions and platforms
> -------------------------------
> 
> This vulnerability has been tested against Cisco Catalyst 2950T  
> switches with IOS 12.1(22)EA3.
> Other versions are probably vulnerable.
> 
> 
> Solution
> --------
> 
> According to Cisco PSIRT, it is already fixed. We don't know all the  
> details because
> Cisco tagged (back in 2005) the issue as an "internal bug", not as a  
> security vulnerability.
> Upgrade your IOS to the latest release.
> 
> 
> Additional information
> ----------------------
> 
> This vulnerability has been found and researched by:
> 
>     David Barroso Berrueta   dbarroso@...sec.com
>     Alfredo Andres Omella     aandres@...sec.com
> 
> It was found on January 2005 and shown in a real demo at BlackHat  
> Europe Briefings 2005 (March 2005) (Yersinia, a framework for layer 2  
> attacks).
> Some months later, FX from Phenoelit found other VTP vulnerabilities:
> http://www.securityfocus.com/archive/1/445896/30/0/threaded
> Cisco released then an answer to FX (http://www.cisco.com/warp/public/ 
> 707/cisco-sr-20060913-vtp.shtml) but as there is no any comment about  
> this
> specific vulnerability we suppose that it is not related with this one.
> 
> This vulnerability has been implemented in the current Yersinia  
> version, under the VTP attacks (see the src/vtp.c file) .
> Yersinia homepage: http://www.yersinia.net
> 
> You can find this advisory at:
> http://www.s21sec.com/en/avisos/s21sec-034-en.txt
> 
> Other S21SEC advisories availabe at http://www.s21sec.com/en/avisos/
> 
> _______________________________________________
> Full-Disclosure - We believe in it.
> Charter: http://lists.grok.org.uk/full-disclosure-charter.html
> Hosted and sponsored by Secunia - http://secunia.com/
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.5 (Darwin)

iD8DBQFFvq3REHa/Ybuq8nARAlZ9AJ4zzh8a7qwluYP94oAf/WFMfmzrZwCgpiDl
JxK2NENYveWy7rIf/SL/dBo=
=IaMi
-----END PGP SIGNATURE-----
