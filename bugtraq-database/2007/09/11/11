
Date: Tue, 11 Sep 2007 15:30:43 -0400
From: iDefense Labs <labs-no-reply@...fense.com>
To: vulnwatch@...nwatch.org, full-disclosure@...ts.grok.org.uk,
	bugtraq@...urityfocus.com
Subject: iDefense Security Advisory 09.11.07: Microsoft Windows 2000 Agent
 URL Canonicalizing Stack Based Buffer Overflow Vulnerability

Microsoft Windows 2000 Agent URL Canonicalizing Stack Based Buffer
Overflow Vulnerability

iDefense Security Advisory 09.11.07
http://labs.idefense.com/intelligence/vulnerabilities/
Sep 11, 2007

I. BACKGROUND

Microsoft Agent allows websites and programs to display animated
characters that speak and move around the screen. The Microsoft Office
"Clippy" character, the animated paper clip, is an example of a
Microsoft agent character.

Agents can be created through the web browser by loading and interacting
with an ActiveX control. Once this control is loaded it will start the
Agent Service process, and pass requests from the browser to the
service. More information can be found at the following site.

http://www.microsoft.com/msagent/default.asp

II. DESCRIPTION

Remote exploitation of a stack based buffer overflow vulnerability in
Microsoft Corp's Microsoft Windows 2000 Agent service could allow an
attacker to execute arbitrary code with the privileges of the logged in
user.

The vulnerability exists within the Agent Service (agentsvr.exe). Due to
improper handling of specially crafted URLs, an attack can cause stack
based buffer overflow.

III. ANALYSIS

Exploitation of this vulnerability results in arbitrary code execution
with the privileges of the logged in user. To exploit this
vulnerability, an attacker would have to use social engineering
techniques to convince a user to visit a malicious website. No further
interaction is needed.

With default settings, Microsoft Outlook and Outlook Express can not be
used to directly exploit this vulnerability. By default, Outlook and
Outlook Express both run in Restricted mode which prevents Active
Content from being loaded. However, an attacker could send an e-mail
with a link to a malicious website. By following this link a user is
susceptible to exploitation through the browser.

IV. DETECTION

iDefense has confirmed the existence of this vulnerability in the Agent
service included in Windows 2000. Microsoft reports that newer versions
of the Agent service are not vulnerable.

V. WORKAROUND

Setting the kill bit for the following CLSID will prevent the control
from loading in the browser:

{D45FD31B-5C6E-11D1-9EC1-00C04FD7081F}

This will not fix the vulnerability, but it will prevent it from being
exploited through the web browser.

VI. VENDOR RESPONSE

Microsoft has addressed this vulnerability within MS07-051. For more
information, consult their bulletin at the following URL.

http://www.microsoft.com/technet/security/Bulletin/MS07-051.mspx

VII. CVE INFORMATION

The Common Vulnerabilities and Exposures (CVE) project has assigned the
name CVE-2007-3040 to this issue. This is a candidate for inclusion in
the CVE list (http://cve.mitre.org/), which standardizes names for
security problems.

VIII. DISCLOSURE TIMELINE

07/09/2007  Initial vendor notification
07/09/2007  Initial vendor response
09/11/2007  Coordinated public disclosure

IX. CREDIT

The discoverer of this vulnerability wishes to remain anonymous.

Get paid for vulnerability research
http://labs.idefense.com/methodology/vulnerability/vcp.php

Free tools, research and upcoming events
http://labs.idefense.com/

X. LEGAL NOTICES

Copyright Â© 2007 iDefense, Inc.

Permission is granted for the redistribution of this alert
electronically. It may not be edited in any way without the express
written consent of iDefense. If you wish to reprint the whole or any
part of this alert in any other medium other than electronically,
please e-mail customerservice@...fense.com for permission.

Disclaimer: The information in the advisory is believed to be accurate
at the time of publishing based on currently available information. Use
of the information constitutes acceptance for use in an AS IS condition.
 There are no warranties with regard to this information. Neither the
author nor the publisher accepts any liability for any direct,
indirect, or consequential loss or damage arising from use of, or
reliance on, this information.
