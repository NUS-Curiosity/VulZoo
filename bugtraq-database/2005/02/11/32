
Date: Fri, 11 Feb 2005 15:26:16 -0500
From: "iDefense Customer Service" <customerservice@...fense.com>
To: <bugtraq@...urityfocus.com>,
	<vulnwatch@...nwatch.org>
Subject: iDEFENSE Security Advisory 02.11.05: ZoneAlarm 5.1 Invalid Pointer Dereference Vulnerability


ZoneAlarm 5.1 Invalid Pointer Dereference Vulnerability

iDEFENSE Security Advisory 02.11.05
www.idefense.com/application/poi/display?id=199&type=vulnerabilities
February 11, 2005

I. BACKGROUND

Zone Labs ZoneAlarm provides personal firewall protection. More
information is available from:

    http://www.zonelabs.com/

II. DESCRIPTION

Local exploitation of an invalid pointer dereference vulnerability in
Zone Labs LLC's ZoneAlarm personal firewall allows attackers to trigger
a denial of service (DoS) condition.

ZoneAlarm offers process specific protection by hooking the kernel API
routine NtConnectPort(). NtConnectPort() is used by programs to
implement advanced inter-process communication (IPC). The
NtConnectPort() function is declared as follows:

    NtConnectPort(
        OUT PHANDLE ClientPortHandle,
        IN PUNICODE_STRING ServerPortName,
        IN PSECURITY_QUALITY_OF_SERVICE SecurityQos,
        IN OUT PLPC_SECTION_OWNER_MEMORY ClientSharedMemory OPTIONAL,
        OUT PLPC_SECTION_MEMORY ServerSharedMemory OPTIONAL,
        OUT PULONG MaximumMessageLength OPTIONAL,
        IN OUT PVOID ConnectionInfo OPTIONAL,
        IN OUT PULONG ConnectionInfoLength OPTIONAL);

The problem specifically exists within vsdatant.sys as ZoneAlarm fails
to verify the second argument. 'ServerPortName' is a valid address
prior to derefencing it as a pointer. The vulnerable section of code is
displayed here:

    0001EE93 mov esi, [esp+108h+ServerPortName]
    0001EE9A mov edi, eax
    0001EE9C test esi, esi
    0001EE9E jz short loc_1EEB6
    0001EEA0 mov edx, [esi+4]

The argument 'ServerPortName' is stored in the register ESI. A check is
made to ensure that the value is not NULL. If that check is passed, the
value is dereferenced as a pointer. Any non-zero invalid memory address
can be passed as the second argument to NtConnectPort(), resulting in a
system crash.

III. ANALYSIS

Exploitation allows local and remote attackers who have exploited
another vulnerability to trigger a DoS in kernel space, resulting in a
"blue screen of death."

IV. DETECTION

iDEFENSE has confirmed the existence of this vulnerability in ZoneAlarm
version 5.1. It is suspected that previous versions of ZoneAlarm are
vulnerable as well.

V. WORKAROUND

iDEFENSE is currently unaware of any workarounds for this issue.

VI. VENDOR RESPONSE

A vendor advisory for this issue is available at:

   http://download.zonelabs.com/bin/free/securityAlert/19.html

VII. CVE INFORMATION

The Common Vulnerabilities and Exposures (CVE) project has assigned the
names CAN-2005-0114 to these issues. This is a candidate for inclusion
in the CVE list (http://cve.mitre.org), which standardizes names for
security problems.

VIII. DISCLOSURE TIMELINE

01/06/2005      Initial vendor notification
01/07/2005      Initial vendor response
02/11/2005      Coordinated public disclosure

IX. CREDIT

iDEFENSE Labs is credited with this discovery.

Get paid for vulnerability research
http://www.idefense.com/poi/teams/vcp.jsp

X. LEGAL NOTICES

Copyright (c) 2005 iDEFENSE, Inc.

Permission is granted for the redistribution of this alert
electronically. It may not be edited in any way without the express
written consent of iDEFENSE. If you wish to reprint the whole or any
part of this alert in any other medium other than electronically, please
email customerservice@...fense.com for permission.

Disclaimer: The information in the advisory is believed to be accurate
at the time of publishing based on currently available information. Use
of the information constitutes acceptance for use in an AS IS condition.

There are no warranties with regard to this information. Neither the
author nor the publisher accepts any liability for any direct, indirect,
or consequential loss or damage arising from use of, or reliance on,
this information.


