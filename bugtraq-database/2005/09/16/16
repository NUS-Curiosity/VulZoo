
Date: Fri, 16 Sep 2005 16:06:22 +0200
From: ZATAZ Audits <exploits@...az.net>
To: vuldb@...urityfocus.com, vuln@...unia.com, vuln@...tik.com,
	moderators@...db.org, bugs@...uritytracker.com,
	submissions@...ketstormsecurity.org, news@...uriteam.com,
	xforce@....net, bugtraq@...urityfocus.com, vulnwatch@...nwatch.org,
	full-disclosure@...ts.grok.org.uk
Cc: "Eric Romang / ZATAZ.com" <eromang@...az.com>
Subject: arc insecure temporary file creation


#########################################################

arc insecure temporary file creation

Vendor:  http://arc.sourceforge.net/
Advisory: http://www.zataz.net/adviso/arc-09052005.txt
Vendor informed: yes
Exploit available: yes
Impact : low
Exploitation : low

#########################################################

The vulnerability is caused due to temporary file being created insecurely.
The temporary file used for archive creation could be read by untrusted 
users.

Secunia has reported that D1g1t4lLeech has discovered this bug the 
2005-09-16.

ZATAZ Audit has discovered this bug the 2005-09-05

D1g1t4lLeech you are a true Leecher ;)

##########
Versions:
##########

arc <= 5.21j

##########
Solution:
##########

No solutions

#########
Timeline:
#########

Discovered : 2005-09-05
Vendor notified : no time to report (Leech powa)
Vendor response : no reponse
Vendor fix : no patch
Vendor Sec report (vendor-sec@....de) :
Disclosure : 2005-09-19

#####################
Technical details :
#####################

Vulnerable code :
-----------------

In arc.c :

210         /* see where temp files go */
211 #if     !_MTS
212         arctemp = calloc(1, STRLEN);
213         if (!(arctemp2 = envfind("ARCTEMP")))
214                 arctemp2 = envfind("TMPDIR");
215         if (arctemp2) {
216                 strcpy(arctemp, arctemp2);
217                 n = strlen(arctemp);
218                 if (arctemp[n - 1] != CUTOFF)
219                         arctemp[n] = CUTOFF;
220         }
221 #if     UNIX
222         else    strcpy(arctemp, "/tmp/");
223 #endif
224 #if     !MSDOS
225         {
226                 static char tempname[] = "AXXXXXX";
227                 strcat(arctemp, mktemp(tempname));
228         }
229 #else
230         strcat(arctemp, "$ARCTEMP");
231 #endif
232 #else
233         guinfo("SHFSEP  ", gotinf);
234         sepchr[0] = gotinf[0];
235         guinfo("SCRFCHAR", gotinf);
236         tmpchr[0] = gotinf[0];
237         arctemp = "-$$$";
238         arctemp[0] = tmpchr[0];
239 #endif
240         arctemp2 = NULL;
241
242 #if     !UNIX
243         /* avoid any case problems with arguments */
244
245         for (n = 1; n < num; n++)       /* for each argument */
246                 upper(arg[n]);  /* convert it to uppercase */
247 #else
248         /* avoid case problems with command options */
249         upper(arg[1]);          /* convert to uppercase */
250 #endif
251
252         /* create archive names, supplying defaults */
253 #if     UNIX
254         if (!stat(arg[2],&sbuf)) {
255                 if ((sbuf.st_mode & S_IFMT) == S_IFDIR)
256                         makefnam(arg[2],".arc",arcname);
257                 else
258                         strcpy(arcname,arg[2]);
259         } else
260                 makefnam(arg[2],".arc",arcname);
261 #else
262         makefnam(arg[2], ".ARC", arcname);
263 #endif

Take a look on a the right off temporary files in /tmp :

-rw-r--r--   1 root root       1564 Sep  5 10:28 A3C6Zs4.arc

The file should not be world readable.

The same problem for marc.c


#########
Related :
#########

Bug report :
CVE :

#####################
Credits :
#####################

Eric Romang (eromang@...az.net - ZATAZ Audit)
Thxs to Gentoo Security Team. (Taviso, jaervosz, solar, Koon, etc.)

_______________________________________________
Full-Disclosure - We believe in it.
Charter: http://lists.grok.org.uk/full-disclosure-charter.html
Hosted and sponsored by Secunia - http://secunia.com/


