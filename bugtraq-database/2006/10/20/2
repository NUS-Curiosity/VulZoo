
Date: Thu, 19 Oct 2006 15:49:34 -0400
From: iDefense Labs <labs-no-reply@...fense.com>
To: idlabs-advisories@...fense.com, vulnwatch@...nwatch.org,
	full-disclosure@...ts.grok.org.uk, bugtraq@...urityfocus.com
Subject: iDefense Security Advisory 10.19.06: Kaspersky Labs Anti-Virus IOCTL
 Local Privilege Escalation Vulnerability

Kaspersky Labs Anti-Virus IOCTL Local Privilege Escalation Vulnerability

iDefense Security Advisory 10.19.06
http://www.idefense.com/intelligence/vulnerabilities/
Oct 19, 2006

I. BACKGROUND

Kaspersky Anti-Virus provides virus and spyware protection. More
information about Kaspersky Labs Anti-Virus can be found by visiting
http://www.kaspersky.com/

II. DESCRIPTION

Local exploitation of a design error vulnerability in Kaspersky Labs
Anti-Virus allows an attacker to execute arbitrary code with kernel
privileges.

The vulnerability specifically exists due to improper address space
validation when the KLIN and KLICK device drivers processes IOCTL
0x80052110. By passing a specially crafted Irp structure to the affected
IOCTL handler, attackers can cause the driver to execute arbitrary code
via a CALL instruction using user supplied data. Execution of data
stored in user-land buffers is trivial.

III. ANALYSIS

Exploitation allows attackers to gain elevated privileges by executing
code within kernel context. This allows attackers to gain control of the
affected system. However, local access is required for exploitation to
be successful.

IV. DETECTION

iDefense has confirmed the existence of this vulnerability within
version 2.0.0.281 of the KLICK and KLIN device drivers as shipped with
6.0.0.303 of Kaspersky Labs Anti-Virus. Previous versions are suspected
to be vulnerable as well.

V. WORKAROUND

iDefense is currently unaware of any effective workaround for this
issue.

VI. VENDOR RESPONSE

Kaspersky Labs has addressed this vulnerability with version 2.0.0.333
of the KLIN.sys and KLICK.sys device drivers.  These drivers can be
obtained by utilizing Kaspersky's Update update service.

VII. CVE INFORMATION

The Common Vulnerabilities and Exposures (CVE) project has assigned the
name CVE-2006-4926 to this issue. This is a candidate for inclusion in
the CVE list (http://cve.mitre.org), which standardizes names for
security problems.

VIII. DISCLOSURE TIMELINE

09/18/2006  Initial vendor notification
09/19/2006  Initial vendor response
10/19/2006  Coordinated public disclosure

IX. CREDIT

This vulnerability was reported to iDefense by Rubén Santamarta of
reversemode.com.

Get paid for vulnerability research
http://www.idefense.com/methodology/vulnerability/vcp.php

Free tools, research and upcoming events
http://labs.idefense.com/

X. LEGAL NOTICES

Copyright © 2006 iDefense, Inc.

Permission is granted for the redistribution of this alert
electronically. It may not be edited in any way without the express
written consent of iDefense. If you wish to reprint the whole or any
part of this alert in any other medium other than electronically, please
email customerservice@...fense.com for permission.

Disclaimer: The information in the advisory is believed to be accurate
at the time of publishing based on currently available information. Use
of the information constitutes acceptance for use in an AS IS condition.
There are no warranties with regard to this information. Neither the
author nor the publisher accepts any liability for any direct, indirect,
or consequential loss or damage arising from use of, or reliance on,
this information.


