
Date: Thu, 14 Dec 2006 12:36:08 -0500
From: iDefense Labs <labs-no-reply@...fense.com>
To: vulnwatch@...nwatch.org, full-disclosure@...ts.grok.org.uk,
	bugtraq@...urityfocus.com
Subject: iDefense Security Advisory 12.14.06: GNOME Foundation Display Manager
 gdmchooser Format String Vulnerability

GNOME Foundation Display Manager gdmchooser Format String Vulnerability

iDefense Security Advisory 12.14.06
http://labs.idefense.com/intelligence/vulnerabilities/
Dec 14, 2006

I. BACKGROUND

The gdmchooser program provides XDMCP (X Display Manager Control Protocol)
functionality to the GNOME Display Manager. This protocol allows a user to
interact remote systems via the local X11 display.

II. DESCRIPTION

Local exploitation of a format string vulnerability in GNOME Foundation's
GNOME Display Manager host chooser window (gdmchooser) could allow an
unauthenticated attacker to execute arbitrary code on the affected system.

The vulnerability specifically exists in the handling of values entered
when choosing a remote host to connect to from the current system. The
following snippet from gdmchooser.c shows the vulnerable code:

1395    msg = g_strdup_printf (_("Cannot find the host \"%s\". "
1396                             "Perhaps you have mistyped it."),
1397                           name);
1398  
1399    dialog = ve_hig_dialog_new
1400    (GTK_WINDOW (chooser) /* parent */,
1401     GTK_DIALOG_MODAL /* flags */,
1402     GTK_MESSAGE_ERROR,
1403     GTK_BUTTONS_OK,
1404     _("Cannot find host"),
1405     msg);
1406    
1407    g_free (msg);
1408  

The error dialog uses the temporary value 'msg', constructed from 'name'
when the host is not found. By supplying a sequence of formatting
operations which modify memory values, an unauthenticated attacker can
execute code with the permissions under the gdm account.

III. ANALYSIS

Successful local exploitation of this vulnerability would allow an
unauthenticated attacker to execute arbitrary code with the privileges of
the gdm service.

In order to exploit this vulnerability, the attacker would need to have
access to the system running gdmchooser. Connecting remotely to this
service will not work as the functionality is designed to connect to a
remote server already, and proxying is not allowed.

The attacker selects the option to run the gdmchooser, and then types the
format string into the dialog box. They can send a string which displays
the contents of the stack, and use there construct a format string which
will write controlled values to arbitrary memory locations, which allows
execution of code with the privileges of the gdmchooser, typically the user
'gdm'. Although this user does not have a high privilege level, once this
account has been gained, it would be relatively simple to insert a logger
into gdm processes to capture other users passwords.

The gdmchooser is not accessible from the default login screens in any of
the tested Red Hat systems, however the preferences utility does contain
some preset screens which do contain it.

IV. DETECTION

This vulnerability has been confirmed to exist in the gdm-2.14.1-1 RPM from
Red Hat Fedora Core 5. The vulnerability was introduced into the
gdmchooser.c file in version 1.78 of gdm2/gui/gdmchooser.c in the GNOME CVS
source code repository.

V. WORKAROUND

If XDMCP functionality is not required, setting the permissions on the
gdmchooser to not allow execution will prevent any attempts at
exploitation.

VI. VENDOR RESPONSE

The GNOME maintainers have addressed this problem by releasing versions
2.14.11, 2.16.4, and 2.17.4 of the GNOME Display Manager.

VII. CVE INFORMATION

A Mitre Corp. Common Vulnerabilities and Exposures (CVE) number has not
been assigned yet.

VIII. DISCLOSURE TIMELINE

12/04/2006  Initial vendor notification
12/05/2006  Initial vendor response
12/14/2006  Coordinated public disclosure

IX. CREDIT

The discoverer of this vulnerability wishes to remain anonymous.

Get paid for vulnerability research
http://labs.idefense.com/methodology/vulnerability/vcp.php

Free tools, research and upcoming events
http://labs.idefense.com/

X. LEGAL NOTICES

Copyright Â© 2006 iDefense, Inc.

Permission is granted for the redistribution of this alert electronically.
It may not be edited in any way without the express written consent of
iDefense. If you wish to reprint the whole or any part of this alert in
any other medium other than electronically, please e-mail
customerservice@...fense.com for permission.

Disclaimer: The information in the advisory is believed to be accurate at
the time of publishing based on currently available information. Use of
the information constitutes acceptance for use in an AS IS condition.
There are no warranties with regard to this information. Neither the
author nor the publisher accepts any liability for any direct, indirect,
or consequential loss or damage arising from use of, or reliance on, this
information.

