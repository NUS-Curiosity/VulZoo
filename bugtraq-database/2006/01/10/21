
Date: Mon, 09 Jan 2006 10:00:36 -0600
From: NetBSD Security Officer <security-officer@...BSD.org>
To: bugtraq@...urityfocus.com
Subject: NetBSD Security Advisory 2006-002: settimeofday() time wrap



-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


		 NetBSD Security Advisory 2006-002
		 =================================

Topic:		settimeofday() time wrap

Version:	NetBSD-current:	source prior to December 5, 2005
		NetBSD 3.0:	not affected
		NetBSD 2.1:	affected
		NetBSD 2.0.3:	affected
		NetBSD 1.6.2:	affected

Severity:	ability to set the time backwards at securelevel > 1

Fixed:		NetBSD-current:		December 5, 2005
		NetBSD-3   branch:	December 6, 2005
		NetBSD-2.1 branch:	December 6, 2005
		NetBSD-2.0 branch:	December 6, 2005
		NetBSD-2   branch:	December 6, 2005
		NetBSD-1.6 branch:	December 6, 2005

Abstract
========

The prohibition against setting the system time "backwards"
at securelevel > 1 can be circumvented.

Technical Details
=================

Setting the time backwards is not regularly allowed at securelevel > 1.
The settime() code in the kernel had no provision against wrapping.
Once the clock reached approximately "Tue Jan 19 03:14:07 UTC 2038",
it will wrap to "Fri Dec 13 20:45:52 UTC 1901". After that, a root
process can set the time to any value, since all values are greater
than that. The fixed version of the code does not allow anyone to
set the time after "Tue Jan 19 03:14:07 UTC 2037" thus one will have
to wait for a year for the time to wrap in order to take advantage
of this.


Solutions and Workarounds
=========================

For all NetBSD versions, you need to obtain fixed kernel sources,
rebuild and install the new kernel, and reboot the system.

The fixed source may be obtained from the NetBSD CVS repository.

The following instructions briefly summarise how to upgrade your
kernel.  In these instructions, replace:

  ARCH     with your architecture (from uname -m), and 
  KERNCONF with the name of your kernel configuration file.

To update from CVS, re-build, and re-install the kernel:

        # cd src
        # cvs update -d -P sys/kern/kern_time.c
	# ./build.sh kernel=KERNCONF
	# mv /netbsd /netbsd.old
	# cp sys/arch/ARCH/compile/obj/KERNCONF/netbsd /netbsd
	# shutdown -r now

For more information on how to do this, see:

   http://www.NetBSD.org/guide/en/chap-kernel.html


Thanks To
=========

Markus Vervier from RedTeam Pentesting for reporting the bug
and Christos Zoulas for the fix.


Revision History
================

	2006-01-09	Initial release


More Information
================

Advisories may be updated as new information becomes available.
The most recent version of this advisory (PGP signed) can be found at 
  ftp://ftp.NetBSD.org/pub/NetBSD/security/advisories/NetBSD-SA2006-002.txt.asc

Information about NetBSD and NetBSD security can be found at
http://www.NetBSD.org/ and http://www.NetBSD.org/Security/.


Copyright 2006, The NetBSD Foundation, Inc.  All Rights Reserved.
Redistribution permitted only in full, unmodified form.

$NetBSD: NetBSD-SA2006-002.txt,v 1.9 2006/01/09 14:48:35 gendalia Exp $

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.2 (NetBSD)

iQCVAwUBQ8J4AD5Ru2/4N2IFAQJsbQP/cTfPihdaPwhq2i8x5xSN/l+yKNFARq/I
WCsOz5JZqrohKizkEikdqbYgvkdqNEVlWW5J7aZJ6woZ8tb4gCNIn9OVM8RyIDDV
wJ1GAbCZmvtJOMIE43RYF+7vYJXekQjuSzVEnYFwRLrLgppY12cC7nUXvcjgOAqr
Dpb+LtQYYh4=
=Tg1Q
-----END PGP SIGNATURE-----


