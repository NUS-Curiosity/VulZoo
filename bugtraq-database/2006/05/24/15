
Date: Tue, 23 May 2006 12:36:13 +0200
From: Andreas Beck <becka-list-bugtraq@...atec.de>
To: bugtraq@...urityfocus.com
Subject: Re: Circumventing quarantine control in Windows 2003 and ISA 2004


Memet Anwar <mmta.gm@...il.com> wrote:
> [bypassing Windows 2003 Network Access Quarantine Control by manipulating
>  scripts or programs used to verify the baseline]
> ==========
> MSRC repeatedly stressed that according to ISA 2004 online help, the 
> quarantine control 'is not a security feature'. 

They are right. Client side checks can never be a bulletproof security
feature. They can be a way to remind benevolent users to adhere to the
security guidelines and a way to catch lazily written malware, but not 
much more.


If we are expecting an infected or otherwise malicious client, you can't
expect it to answer truthfully to the "are you a bad guy" question.

Your findings show, that is is very easy to circumvent this particular
mechanism. However, even if it were improved to check integrity of the
scripts or similar, this won't help much.

After all, you are only looking at network traffic from the possibly
malicious client. The client must know how to generate this traffic, if
it is in uncompromised state.

So the only way to reliably detect if it is compromised would be, if any
kind of compromise would destroy something in this state that makes it
impossible to generate such traffic.

This is not quite possible. At worst, put the uncompromised machine into
a virtual machine and after all checks went well, manipulate it from the
host system. However usually much simpler rootkit stealth techniques
will suffice.

After all: Who cares, if the virus definitions are current, if the
scanner can't read the infected files, as they are cleaned on the fly
in the manipulated OS calls?


> Security feature or not, it certainly not working as many admins would 
> expect. 

This expectation is, what needs to be corrected. 


> What's the purpose of having a quarantine control, if by-design, it 
> can be circumvented ? ;)

Angel on the left: To remind lazy users to adhere to the security policy.
Devil on the right: Marketing?


Kind regards,

Andreas Beck

-- 
Andreas Beck
http://www.bedatec.de/


