
Date: Wed, 19 Nov 2003 18:48:22 +0300
From: 3APA3A <3APA3A@...URITY.NNOV.RU>
To: bugtraq@...urityfocus.com
Subject: [securitylab.ru & security.nnov] Kerio Winroute Firewall Xroxy problem



Application: Kerio Winroute Firewall 5.10
Vendor: Kerio Technologies Inc.
Vendor Site: http://www.kerio.com
Remote: Yes
Exploitable: Yes
Risk level: Critical (if proxy requires authentication)
Authors: Alexander Antipov & 3APA3A (aka Pig Killer)
Authors Sites: http://www.securitylab.ru http://www.security.nnov.ru

Intro:

Winroute  is  most  popular SOHO software firewall/router/Proxy solution
for Windows platform.

Vulnerability:

During  troubleshooting  of  Winroute  a  security  related  problem was
discovered  allowing  remote  website  to  obtain  cleartext credentials
(username:password) of WinRoute user.

Details:

WinRoute  has extremely weak functionality as a proxy server. It doesn't
rebuild request sent by browser. Instead, it only changes Proxy- related
header   by   substituting   fist  character  to  X  (So,  for  example,
Proxy-Connection  header becomes Xroxy-Connection: in outgoing request).
It  leads to few troubles. First, it leaks HTTP established connections.
Every  file  (for  exmple  .gif,  html,  jpg)  from  web server requires
separate connection resulting in performance degradation. But, of cause,
security related problem is in handling Proxy-Authorization: header sent
by browser. Browser sends this header with every request in a case proxy
server  requires  authentication.  This  header  contains base64-encoded
username  and  password  of  proxy  user in cleartext (NTLM and Kerberos
probably  is  not  supported  by  WinRoute).  If  WinRoute  uses windows
authentication this credentials contain domain account information.

As  a result, any webserver visited by WinRoute user can track his proxy
username  and  password  by Xroxy-Authorization: header (X because first
character is changed). For example
 Xroxy-Authorization: Basic dGVzdDp0ZXN0aW5n
 (test:testing).

Workaround:

Disable proxy authentication

Greets:

 to Ink-Visitor who still awaiting for his document from Pig.

-- 
http://www.security.nnov.ru
         /\_/\
        { , . }     |\
+--oQQo->{ ^ }<-----+ \
|  ZARAZA  U  3APA3A   } You know my name - look up my number (The Beatles)
+-------------o66o--+ /
                    |/



