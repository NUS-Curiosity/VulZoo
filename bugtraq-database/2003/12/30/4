
Date: 30 Dec 2003 03:57:49 -0000
From: Arman Nayyeri <arman-n@...eaker.net>
To: bugtraq@...urityfocus.com
Subject: IE 5.x-6.0 allows executing arbitrary programs using showHelp()




IE 5.x-6.0 allows executing arbitrary programs using showHelp()
===============================================================
Title:    IE 5.x-6.0 allows executing arbitrary programs using showHelp()
Date:     Monday, December 29, 2003
Software: IE 5.x, 6.0
Vendor:   Microsoft Corp.
Patch:    N/A
Author:   Arman Nayyeri, arman-n[at]Phreaker[dot]net

Description:
============
I think, microsoft needs more exploits for IE, so i could help microsoft a
lot! as you may know, there is many ways to execute a file from a known
location in the victim's computer ,but there is some restrictions.(such as
file extension) that made things harder and even impossible.
my last report to bugtraq about showHelp, doesn't work on many computers
because IE 6.0 with SP1, does not allow access to file: URLs! I worked on
it about a mounth and finally I found a way to run chm files that resides
on system drive. 

this piece of code will do the work:
showHelp("mk:@MSITStore:iexplore.chm::..\\..\\..\\..\\chmfile.chm::/fileinchm.html");

some kind of directory traveling using "\..\"!

but there is some bad and good things about it (that jelmer tell them to me):

The bad:

- Microsoft tried to kill chm attacks, so when showHelp() called shortCut
  and other help commands will be disabled! so we cant use shortcut command
  in our chm attack!

- We can only run chm files in system drive (the partition that windows 
  resides)


The Good:

- Local Zone:
   and all the goodies that come associated with it like reading and
   uploading any file from disk using xmlhttp, executing code using
   adodb.stream

- The file we drop to c:\ doesn't have to have a chm extention as long
  as it has the double : following it it asumes it's a chm file, which
  is really really nice, if you for
 instance manage to drop a file on
  a known location, you typicaly dont get to choose which extention
  this file has, so this is very very nice..

Exploit:
========
Creating an exploit is very easy (but with help and advice of jelmer)!
we can use any exploit that download a file in a known location and
then open it as chm file by showHelp()!but I want to use winamp skin
file that discovered by jelmer!

this is the exploit that I provided:
http://www.freewebs.com/arman2/showamp.htm

in this exploit I do this:
1.iframe to point to a .wsz file
2.wait 5 seconds for wsz to download to our known location
3.showHelp() to run htm file in chm file (that have .wsz ext.)
4."Self-Executing HTML Part III" to execute the exe file!

Note that this exploit only work on winamp 1 & 2 and the new winamp 5
that supports wsz again after winamp 3! you can use many other
exploits in step 1 and 4 , for example ICQ sound scheme for step 1,
or any other exploit that work on my computer zone for step 4!

and also note that I changed "self-executing HTML part III" so the
windows directory will be known and make the work easy for placing
notepad.exe in windows directory. 

and sorry for my bad english!

Exploit Tested On
=================
Windows XP IE 6.0 (Fully Patched)
Windows 2003 IE 6.0 (Fully Patched)
Windows 2000 IE 5.5 (Fully Patched)

My opinion about microsoft's security problems!
===============================================
I think till microsoft do not publish software's source codes,
microsoft will have trouble!

Special Thank
=============
I would thank Jelmer, because he help me a lot.(very very thanks!)

Do I discover more vulnerabilities?
===================================
YOU AIN'T SEEN NOTHING YET!


Disclaimer:
===========
Arman Nayyeri is not responsible for the misuse of the information 
provided in this advisory. The opinions expressed are my own and not of 
any company. In no event shall the author be liable for any damages 
whatsoever arising out of or in connection with the use or spread of this 
advisory. Any use of the information is at the user's own risk.

~~~~~~~~~~~~~~
Arman Nayyeri 
        MCP, MCSA 2000, MCSE 2000 (oh! microsoft)
	
Iran
(please pray for them who lose their families by earthquake in Iran)


