
Date: Wed, 30 Sep 2015 18:09:50 +0500
From: Eugene Roshal <roshal@...lab.com>
To: "Popovici, Alejo \(LATCO - Buenos Aires\)" <apopovici@...OITTE.com>
CC: "bugtraq@...urityfocus.com" <bugtraq@...urityfocus.com>
Subject: Re: WinRAR SFX v5.21 - Remote Code Execution Vulnerability

Hello,

> But it's also true that anti-virus software is fully aware of the
> usual way of executing malicious code through SFX archives. This
> could be a way of bypassing the anti-virus software thus avoiding detection.

If we assume that anti-virus software cannot detect exe files
downloaded from Internet and started using this method,
nothing prevents an intruder to make a tool, which will download
and run exe from Internet using this method, include it to SFX archive
and start such tool using the standard SFX "Setup" command.

If we assume that for some weird reason tools started with "Setup"
SFX command are analyzed by antiviruses more carefully than other
executables, nothing prevents an intruder to use such downloader tool
instead of entire SFX module. Just take a downloader tool, append
RAR or ZIP archive to it and distribute it as SFX archive.

This vulnerability does not add any new risks for users. Everything what
it can do can be done either with standard SFX "Setup" command or with
malicious code used instead of SFX module. Exe file received from
untrustworthy source can do everything it wants on user's computer:
download files, delete files, run files.

> In my opinion it should be fixed.

It cannot be fixed. We cannot fix the dangerous nature of executable
files. Note that self-extracting modules are not digitally signed
by us and cannot be digitally signed, because users edit their resources
(icon, logo, dialogs) for their needs and because archive data is
appended to SFX module, so signature would be invalid anyway.

So antiviruses cannot use the digital signature to distinguish
genuine and fake SFX modules. Moreover, they cannot use even hash
sums, because users edit SFX module resources when building
installers. It can include even patching manifest data, so installer
runs as admin user. Also new WinRAR versions always have new SFX
modules with new hash sums, so antiviruses cannot rely on a hash sum
to prohibit SFX execution.

In other words, antiviruses cannot distinguish a genuine SFX or user
customized SFX or malicious SFX module. It means that an intruder can
always use their own exe code instead of our SFX. Moreover, UnRAR source
code is freely available, so an intruder can build SFX module, which
will actually unpack RAR archive additionally to doing something harmful.

If you start .exe from untrustworthy source, you cannot be secure.
Fixing such "vulnerabilities" would only make a false sense of
security in this case. Exe cannot be secure by design if it is not
from reliable source. We would only add unnecessary code creating
absolutely no problem for malicious hackers. Maybe only for legitimate
HTML users.

Eugene

> Well it's true what you are saying,
> But it's also true that anti-virus software is fully aware of the
> usual way of executing malicious code through SFX archives. This
> could be a way of bypassing the anti-virus software thus avoiding detection.
> In my opinion it should be fixed.

> Kind regards,

> Alejo Popovici
> Consultor | ERS | Cyber Risk Services
> Deloitte & Co. S.A.
> Pte. Gral.J.D.Perón 646, 7piso, C1038AAN, Buenos Aires Argentina
> apopovici@...oitte.com | www.deloitte.com


> -----Original Message-----
> From: dev@...lab.com [mailto:dev@...lab.com] 
> Sent: Wednesday, September 30, 2015 8:05 AM
> To: bugtraq@...urityfocus.com
> Subject: Re: WinRAR SFX v5.21 - Remote Code Execution Vulnerability

> I am WinRAR developer. We published the official comment on www.rarlab.com here:
> http://rarlab.com/vuln_sfx_html.htm

> This "vulnerability" is a non-issue. Why attempting to find some
> hackish esoteric way for a feature, which presents in SFX archives
> officially. Any SFX archive can run contained executable files, it
> is required for installers. Any SFX archive just like any exe file
> and any software installer is potentially dangerous for user
> computers and must be started only if received from a trustworthy source.

> Self-extracting archives are .exe themselves, one of their basic
> functions is code execution for executables stored in archives. They
> also allow to run any kind of web downloaders, because it is needed
> for software installers. So that researcher discovered that
> self-extracting archives, which are exe themselves and designed to
> be able to run contained exe, can actually run exe. No surprise here
> and no new risks for users. All associated risks are already present
> in standard SFX functions and exe design.

>  
> Deloitte se refiere a una o más de las firmas miembros de Deloitte
> Touche Tohmatsu Limited, una compañía privada del Reino Unido
> limitada por garantía, y su red de firmas miembros, cada una como
> una entidad única e independiente y legalmente separada. Una
> descripción detallada de la estructura legal de Deloitte Touche
> Tohmatsu Limited y sus firmas miembros puede verse en el sitio web
> http://www.deloitte.com/about.                           La
> información de este mail es confidencial y concierne únicamente a la
> persona a quien está dirigida. Si este mensaje no está dirigido a
> usted, por favor tenga presente que no tiene autorización para leer
> el resto de este e-mail, copiarlo o derivarlo a cualquier otra
> persona que no sea aquella a quien está dirigido. Si recibe este
> mail por error, por favor, avise al remitente, luego de lo cual
> rogamos a usted destruya el mensaje original. No se puede
> responsabilizar de ningún modo a Deloitte & Co. S.A. ni a sus
> subsidiarias por cualquier consecuencia o daño que pueda resultar
> del apropiado y completo envío y recepción del contenido de este e-mail.
>  
> Deloitte refers to one or more of Deloitte Touche Tohmatsu Limited,
> a UK private company limited by guarantee, and its network of member
> firms, each of which is a legally separate and independent entity.
> Please see http://www.deloitte.com/about for a detailed description
> of the legal structure of Deloitte Touche Tohmatsu Limited and its member firms. 
> The information in this e-mail is confidential and intended solely
> for the person to whom it is addressed. If this message is not
> addressed to you, please be aware that you have no authorization to
> read the rest of this e-mail, to copy it or to furnish it to any
> person other than the addressee. Should you have received this
> e-mail by mistake, please bring this to the attention of the sender,
> after which you are kindly requested to destroy the original
> message. Deloitte & Co. S.A. and subsidiaries cannot be held
> responsible or liable in any way whatsoever for and/or in connection
> with any consequences and/or damage resulting from the proper and
> complete dispatch and receipt of the content of this e-mail.

