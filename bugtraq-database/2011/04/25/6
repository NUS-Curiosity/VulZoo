
Date: Mon, 25 Apr 2011 12:21:57 +0400
From: Alexandr Polyakov <alexandr.polyakov@...c.ru>
To: bugtraq@...urityfocus.com, vuln@...unia.com,
	packet@...ketstormsecurity.org
Subject: [DSECRG-11-018] Kaspersky administration Kit - Remote code execution via SMBRelay



Digital Security Research Group [DSecRG] Advisory       #DSECRG-11-018

Application:             Kaspersky Administration Kit
Versions Affected:       from 6.0
Vendor URL:              http://www.kaspersky.com
Bug:                     Design flaw
Exploits:                YES
Reported:                22.01.2011
Vendor response:         22.01.2011
Solution:                disable IP scan
Date of Public Advisory: 14.03.2011
Authors:                 Alexey Sintsov of Digital Security Research Group [DSecRG]



Description
***********

Service account used for Kaspersky Administration Kit and it functional make possible attack on other hosts
in a corporate network.

Details
*******

Functional called "Scan IP subnets" is enabled by default in Kaspersky Administration Kit 6.
This function makes ICMP scan and also tries to use SMB protocol by using service account which can be
used to run SMBrelay attack and gain full control on secured network. By default "Scan IP subnets" 
scans  subnet every 7 hours. Attacker just needs to run SMBRelay tool and wait. Attack is possible
because  Kaspersky service account have Administrative rights on hosts in corporate network. 
It's mean that attacker can attack any server or workstation where this service account has rights. 

Fix Information
***************

1) Do not start Administration Server service under a Domain Administrator account
or a domain account member of local administrators group on other hosts.
2) Disable "Scan IP subnets"


http://support.kaspersky.com/faq/?qid=208284121 


References
*********

http://dsecrg.ru/pages/vul/show.php?id=318
http://dsecrg.blogspot.com/2011/03/smbrelay-bible-4-smbrelay-with-no.html

About DSecRG
*******
The main mission of DSecRG is to conduct researches of business critical systems such as ERP, CRM, SRM, BI, SCADA, banking software and others. The result of this work is then integrates in ERPSCAN security scanner. Being on the top edge of ERP and SAP security DSecRG research helps to improve a quality of ERPSCAN consulting services and protects you from the latest threads. 
Contact: research [at] dsecrg [dot] com
http://www.dsecrg.com 

About ERPScan
*******
ERPScan is an innovative company engaged in the research of ERP security and develops products for ERP system security assessment. Apart from this the company renders consulting services for secure configuration, development and implementation of ERP systems, and conducts comprehensive assessments and penetration testing of custom solutions.
Our flagship products are "ERPScan Security Scanner for SAP" and service "ERPScan Online" which can help customers to perform automated security assessments and compliance checks for SAP solutions.

“ERPScan Security Scanner for SAP” is an innovative product for integrated assessment of SAP platform security and standard compliance.

Contact: info [at] erpscan [dot] com
http://www.erpscan.com




Polyakov Alexandr. PCI QSA,PA-QSA
CTO Digital Security
Head of DSecRG
______________________
DIGITAL SECURITY
phone:  +7 812 703 1547
        +7 812 430 9130
e-mail: a.polyakov@...c.ru  

www.dsec.ru
www.dsecrg.com www.dsecrg.ru
www.erpscan.com www.erpscan.ru
www.pcidssru.com www.pcidss.ru


-----------------------------------
This message and any attachment are confidential and may be privileged or otherwise protected 
from disclosure. If you are not the intended recipient any use, distribution, copying or disclosure 
is strictly prohibited. If you have received this message in error, please notify the sender immediately 
either by telephone or by e-mail and delete this message and any attachment from your system. Correspondence 
via e-mail is for information purposes only. Digital Security neither makes nor accepts legally binding 
statements by e-mail unless otherwise agreed. 
-----------------------------------      

