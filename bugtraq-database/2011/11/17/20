
Date: Thu, 17 Nov 2011 20:27:01 +0400
From: Alexandr Polyakov <alexandr.polyakov@...c.ru>
To: bugtraq@...urityfocus.com, vuln@...unia.com,
  packet@...ketstormsecurity.org
Subject: [DSECRG-11-039] SAP NetWeaver TH_GREP module - Code injection vulnerability (NEW)


                
[DSECRG-11-039] SAP NetWeaver TH_GREP module - Code injection vulnerability (NEW) 

TH_GREP report is vulnerable for command execution vulnerability which is working with previous patch (note 1433101). Remote OS command execution is possible 

Application:     SAP NetWeaver 
Versions Affected:       SAP NetWeaver 
Vendor URL:      http://www.SAP.com
Bugs:    Command execution
Reported:        08.04.2011
Vendor response:         09.04.2011
Date of Public Advisory:        11.11.2011
CVSS:    6.0
CVE-number: 
Author:  Alexey Tyurin from DSecRG (research center of ERPScan)

Description
***********
TH_GREP report is vulnerable for command execution vulnerability which is working with previous patch (note 1433101). Remote OS command execution is possible

Details
*******
This vulnerability exists in patched version (note 1433101) because this note secure only linux but we found that windows is vulnerable too.
There is ability for command execution via SA "TH_GREP" RFC-function in OS Windows.
The problem contains in user input validation absence of "TH_GREP" RFC-function's parameters. An attacker can insert malicious code in "<STRING>"-parameter for command execution.
There are minimum 3 ways of command execution and attacker must have valid credentials:
1) In transaction "Se37"
2) via "startrfc" command with "TH_GREP" RFC-function
3) via a crafted "TH_GREP" RFC-SOAP-request

Example:
******
Working exploit is available in commercial scanner ERPScan Security Scanner for SAP (http://erpscan.com)

References
**********
http://erpscan.com/advisories/dsecrg-11-039-sap-netweaver-th_grep-module-code-injection-vulnerability-new/
http://www.sdn.sap.com/irj/sdn/index?rid=/webcontent/uuid/c05604f6-4eb3-2d10-eea7-ceb666083a6a
https://service.sap.com/sap/support/notes/1580017




Fix Information
*************
Solution to this issue is given in the SAP Security Note 1580017.


About DSecRG
*******
The main mission of DSecRG is to conduct researches of business critical systems such as ERP, CRM, SRM, BI, SCADA, banking software and others. The result of this work is then integrates in ERPScan Security Scanner. Being on the top edge of ERP and SAP security DSecRG research helps to improve a quality of ERPScan consulting services and protects you from the latest threads. 
Contact: research [at] dsecrg [dot] com
http://www.dsecrg.com 

About ERPScan
*******
ERPScan is an innovative company engaged in the research of ERP security and develops products for ERP system security assessment. Apart from this the company renders consulting services for secure configuration, development and implementation of ERP systems, and conducts comprehensive assessments and penetration testing of custom solutions.
Our flagship products are "ERPScan Security Scanner for SAP" and service "ERPScan Online" which can help customers to perform automated security assessments and compliance checks for SAP solutions.

Contact: info [at] erpscan [dot] com
http://www.erpscan.com 



Polyakov Alexander
CTO ERPScan
Head of DSecRG
______________________
phone:  +7 812 703 1547
        +7 812 430 9130
e-mail: a.polyakov@...scan.com

www.erpscan.com
www.dsecrg.com


-----------------------------------
This message and any attachment are confidential and may be privileged or otherwise protected 
from disclosure. If you are not the intended recipient any use, distribution, copying or disclosure 
is strictly prohibited. If you have received this message in error, please notify the sender immediately 
either by telephone or by e-mail and delete this message and any attachment from your system. Correspondence 
via e-mail is for information purposes only. Digital Security neither makes nor accepts legally binding 
statements by e-mail unless otherwise agreed. 
-----------------------------------      

