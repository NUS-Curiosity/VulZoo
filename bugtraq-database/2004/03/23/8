
Date: Tue, 23 Mar 2004 07:13:29 +0000
From: "Hugh Mann" <hughmann@...mail.com>
To: full-disclosure@...ts.netsys.com, bugtraq@...urityfocus.com
Cc: info@...witch.com, secure@...witch.com
Subject: ALLO ALLO WS_FTP Server

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Advisory Name: ALLO ALLO WS_FTP Server
Impact       : Arbitrary code execution as SYSTEM
Discovered by: Hugh Mann hughmann@...mail.com
Tested progs : Ipswitch WS_FTP Server 4.0.2.EVAL
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Description
~~~~~~~~~~~
A user who can upload files, and also has a max number of files limit or max 
total file size limit, can read any memory address the WS_FTP Server can 
read. With the right address, the user can cause a buffer overflow and 
execute arbitrary code as SYSTEM.

Details
~~~~~~~
There's a vulnerability in the ALLO handler when it sends an error string to 
the client. Instead of pushing an ASCIIZ string, it pushes a 64-bit value 
equal to total size of all files in user's dir and any sub-dirs. This is a 
value we can easily control if we exploit the WS_FTP Server REST 
vulnerability. If we change this value to a string of size equal to ~256 
bytes, we can overwrite the return address and execute arbitrary code as 
SYSTEM.

Exploit
~~~~~~~
See the attached source code.

_________________________________________________________________
Get rid of annoying pop-up ads with the new MSN Toolbar ï¿½ FREE! 
http://clk.atdmt.com/AVE/go/onm00200414ave/direct/01/

Download attachment "xp_ws_ftp_server2.zip" of type "application/x-zip-compressed" (8398 bytes)
