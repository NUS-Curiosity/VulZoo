
Date: Mon, 20 Dec 2004 19:57:25 -0600
From: Shiva Persaud <shivapd@...ibm.com>
To: cees-bart <ceesb@...ru.nl>
Cc: bugtraq@...urityfocus.com
Subject: Re: AIX 5.1/5.2/5.3 local root exploits (diag issue)


cees-bart <ceesb@...ru.nl> wrote on 12/20/2004 05:10:41 AM:


> 1) the first is a bug in all setuid diag related tools that use an 
> environment variable as a prefix to an external binary executed as root.


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

IBM SECURITY ADVISORY

First Issued: Mon Dec 20 10:44:36 CST 2004

===========================================================================
                           VULNERABILITY SUMMARY

VULNERABILITY:      An untrusted path vulnerability in the diag script
                    allows local users to execute arbitrary code if 
invoked
                    via a suid root application.

PLATFORMS:          AIX 5.1, 5.2 and 5.3.

SOLUTION:           Apply the workaround or APARs as described below.

THREAT:             A local user can execute arbitrary code with root
                    privileges.

CERT VU Number:     N/A
CVE Number:         N/A
===========================================================================
                           DETAILED INFORMATION


I.  Description
===============

A vulnerability was discovered in the diag script that may allow any user
to execute arbitrary code with root privileges. The diag script is used to
perform various diagnostic functions. Exploits for this vulnerability are
publicly available.

The script affected by this issue ships as part of the bos.rte.diag
fileset. To determine if this fileset is installed, execute the following
command:

# lslpp -L bos.rte.diag

If the fileset is installed it will be listed along with its version
information, state, type and a description.

The diag script is only executable by the root user or users in the system
group; an unprivileged user cannot exploit this vulnerability by executing
the diag script. However, various suid root AIX commands invoke the diag
script with root privileges. Unprivileged users can exploit this
vulnerability via these commands. These commands include lsmcode, 
invscout,
invscoutd and diag_exec. The following describes how to check for the
filesets containing these commands:

To determine if Inventory Scout (invscout and invscoutd) is installed,
execute the following command:

# lslpp -L invscout.rte

To determine if diag_exec is installed, execute the following command:

# lslpp -L bos.rte.diag

To determine if lsmcode is installed, execute the following command:

# lslpp -L bos.diag.util

If the fileset is installed it will be listed along with its version
information, state, type and a description.


II. Impact
==========
Local users can execute arbitrary commands with root privileges.


III.  Solutions
===============

A. Official Fix

IBM provides the following fixes:

      APAR number for AIX 5.1.0:  IY64389 (available)
      APAR number for AIX 5.2.0:  IY64523 (available)
      APAR number for AIX 5.3.0:  IY64277 (available)

NOTE: Affected customers are urged to upgrade to 5.1.0, 5.2.0 or 5.3.0 at
the latest maintenance level.


B. Workaround

Setting the file mode bits for lsmcode, invscout, invscoutd and diag_exec
to 500 will allow only the root user to execute the these commands. This
can be done by executing the following commands as root:

# chmod 500 /usr/sbin/lsmcode
# chmod 500 /usr/sbin/invscout
# chmod 500 /usr/sbin/invscoutd
# chmod 500 /usr/sbin/diag_exec

Verify that the file mode bits have been changed to 500:

# ls -la /usr/sbin/lsmcode
- -r-x------   1 root     system        10014 Sep 15 2002 
/usr/sbin/lsmcode
# ls -la /usr/sbin/invscout
- -r-x------   1 root     system       465216 Oct 13 20:58 
/usr/sbin/invscout
# ls -la /usr/sbin/invscoutd
- -r-x------   1 root     system       525131 Oct 13 20:58 
/usr/sbin/invscoutd
# ls -la /usr/sbin/diag_exec
- -r-x------   1 root     system         2796 Sep 15 2002 
/usr/sbin/diag_exec


IV. Obtaining Fixes
===================

AIX Version 5 APARs can be downloaded from the eServer pSeries Fix Central
web site:

     http://www-912.ibm.com/eserver/support/fixes/fcgui.jsp

Security related Emergency Fixes can be downloaded from:

     ftp://aix.software.ibm.com/aix/efixes/security


V.  Contact Information
========================

If you would like to receive AIX Security Advisories via email, please 
visit:
     https://techsupport.services.ibm.com/server/pseries.subscriptionSvcs

Comments regarding the content of this announcement can be directed to:

     security-alert@...tin.ibm.com

To request the PGP public key that can be used to communicate securely
with the AIX Security Team send email to security-alert@...tin.ibm.com
with a subject of "get key". The key can also be downloaded from a
PGP Public Key Server. The key id is 0x9391C1F2.

Please contact your local IBM AIX support center for any assistance.

eServer is a trademark of International Business Machines Corporation.
IBM, AIX and pSeries are registered trademarks of International Business
Machines Corporation. All other trademarks are property of their
respective holders.
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (MingW32)

iD8DBQFBx3k3xwSSvpORwfIRAk0IAJoCzN4zXLYDuiDyo3HSGuUMiM1KcACZAUJq
74UDtrgFh1l8FLkU8xpxXs0=
=xQQM
-----END PGP SIGNATURE-----



