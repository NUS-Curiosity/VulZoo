#!/usr/bin/env python3

import json

cve_poc_file = "../../processed/relationships/rel-cve-poc.json"
cve_kev_file = "../../processed/cisa-kev-database/kev.json"
cve_patch_file = "../../processed/relationships/rel-cve-patch.json"
cve_mail_file = "../../processed/relationships/rel-cve-mail.json"
cve_akb_file = "../../processed/relationships/rel-cve-akb.json"

cve_poc = set()
cve_kev = set()
cve_patch = set()
cve_mail = set()
cve_akb = set()

with open(cve_poc_file, "r") as f:
    cve_poc = set(json.load(f).keys())

with open(cve_kev_file, "r") as f:
    kev = json.load(f)
    for entry in kev["vulnerabilities"]:
        cve_kev.add(entry['cveID'])

with open(cve_patch_file, "r") as f:
    cve_patch = set(json.load(f).keys())

with open(cve_mail_file, "r") as f:
    cve_mail = set(json.load(f).keys())

with open(cve_akb_file, "r") as f:
    cve_akb = set(json.load(f).keys())

cve_interest = cve_poc.intersection(cve_kev).intersection(cve_patch).intersection(cve_mail).intersection(cve_akb)

print(json.dumps(list(cve_interest), indent=4))
