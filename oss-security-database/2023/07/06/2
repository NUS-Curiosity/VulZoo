
Date: Thu, 6 Jul 2023 14:27:48 -0700
From: Rita Zhang <rita.z.zhang@...il.com>
To: oss-security@...ts.openwall.com
Subject: [kubernetes] CVE-2023-2727: Bypassing policies imposed by the
 ImagePolicyWebhook admission plugin

Hello Kubernetes Community,

A security issue was discovered in Kubernetes where users may be able to
launch containers using images that are restricted by ImagePolicyWebhook
when using ephemeral containers. Kubernetes clusters are only affected if
the ImagePolicyWebhook admission plugin is used together with ephemeral
containers.

This issue has been rated *Medium* (
CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:N
<https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:N>),
and assigned CVE-2023-2727

*Am I vulnerable?*
Clusters are impacted by this vulnerability if all of the following are
true:

   1. The ImagePolicyWebhook admission plugin is used to restrict use of
   certain images
   2. Pods are using ephemeral containers.

*Affected Versions*

   - kube-apiserver v1.27.0 - v1.27.2
   - kube-apiserver v1.26.0 - v1.26.5
   - kube-apiserver v1.25.0 - v1.25.10
   - kube-apiserver <= v1.24.14

*How do I mitigate this vulnerability?*
This issue can be mitigated by applying the patch provided for the
kube-apiserver component. This patch prevents ephemeral containers from
using an image that is restricted by ImagePolicyWebhook.

Note: Validation webhooks (such as Gatekeeper
<https://open-policy-agent.github.io/gatekeeper-library/website/validation/allowedrepos/>
and Kyverno
<https://kyverno.io/policies/other/allowed-image-repos/allowed-image-repos/>)
can also be used to enforce the same restrictions.

*Fixed Versions*

   - kube-apiserver v1.27.3
   - kube-apiserver v1.26.6
   - kube-apiserver v1.25.11
   - kube-apiserver v1.24.15

These releases have been published today, June 14th, 2023.

*Detection*
Pod update requests using an ephemeral container with an image that should
have been restricted by an ImagePolicyWebhook will be captured in API audit
logs. You can also use `kubectl get pods` to find active pods with
ephemeral containers running an image that should have been restricted in
your cluster with this issue.

*Additional Details*
See the GitHub issue for more details:
https://github.com/kubernetes/kubernetes/issues/118640

Thank You,
Rita Zhang on behalf of the Kubernetes Security Response Committee

