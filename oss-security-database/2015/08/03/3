
Date: Mon, 03 Aug 2015 12:39:38 +0000
From: Xen.org security team <security@....org>
To: xen-announce@...ts.xen.org, xen-devel@...ts.xen.org,
 xen-users@...ts.xen.org, oss-security@...ts.openwall.com
CC: Xen.org security team <security@....org>
Subject: Xen Security Advisory 139 (CVE-2015-5166) - Use after free in
 QEMU/Xen block unplug protocol

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

            Xen Security Advisory CVE-2015-5166 / XSA-139
                              version 2

           Use after free in QEMU/Xen block unplug protocol

UPDATES IN VERSION 2
====================

CVE assigned.

Public release.

Updated status of the patches.

ISSUE DESCRIPTION
=================

When unplugging an emulated block device the device was not fully
unplugged, meaning a second unplug attempt would attempt to unplug the
device a second time using a previously freed pointer.

IMPACT
======

An HVM guest which has access to an emulated IDE disk device may be
able to exploit this vulnerability in order to take over the qemu
process elevating its privilege to that of the qemu process.

VULNERABLE SYSTEMS
==================

All Xen systems running x86 HVM guests using the upstream based
"qemu-xen" are vulnerable.

Systems using the "qemu-xen-traditional" version of the qemu device
model, either in a stubdomain or as a domain 0 process, are not vulnerable.

Systems running only PV guests are NOT vulnerable.

ARM systems are not vulnerable.

MITIGATION
==========

There is no known mitigation for this issue.

CREDITS
=======

This issue was discovered by Donghai Zhu of Alibaba.

RESOLUTION
==========

The attached patches have been proposed as fixes for the issue.
However they have not been finalised by upstream.  A revised advisory
will be issued in the event that the final patches differ from those
included here.

xsa139-qemuu-unstable.patch        qemu-upstream, xen-unstable
xsa139-qemuu-4.5.patch             qemu-upstream, Xen 4.5.x, Xen
                                   4.4.x, Xen 4.3.x, Xen 4.2.x

$ sha256sum xsa139*.patch
dead84667dd4868d0688dc4e62a54a14883e6f0352cf3318b277aa37e27c9261  xsa139-qemuu-unstable.patch
3aa775255053d1d14a3e383998240eb3520aea7de137cdb7624b169db8b06d85  xsa139-qemuu-4.5.patch
$

DEPLOYMENT DURING EMBARGO
=========================

Deployment of the patches and/or mitigations described above (or
others which are substantially similar) is permitted during the
embargo, even on public-facing systems with untrusted guest users and
administrators.

But: Distribution of updated software is prohibited (except to other
members of the predisclosure list).

Predisclosure list members who wish to deploy significantly different
patches and/or mitigations, please contact the Xen Project Security
Team.

(Note: this during-embargo deployment notice is retained in
post-embargo publicly released Xen Project advisories, even though it
is then no longer applicable.  This is to enable the community to have
oversight of the Xen Project Security Team's decisionmaking.)

For more information about permissible uses of embargoed information,
consult the Xen Project community's agreed Security Policy:
  http://www.xenproject.org/security-policy.html
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)

iQEcBAEBAgAGBQJVv2B2AAoJEIP+FMlX6CvZyOIIAJyuhk8W+BkgL8eejTfV0dlH
38QKpakRSIRXOB3Px3pyyssmk/3Qa/5HiYK3jn4/5JmKnCbXUcevBSnxBPJqbugc
iNhQC7e6um8Ah6V9YkoixdjNrRs7TAyHhR43xK4WBZ89XlbFEI8eGnG8pf/zRLp5
S5eRfqcJRo5T4uZLABN2K2Vko/sLvzeCzikDQoBIgYoIqpyC6X4svzcJre6GsEfp
gZtR+TXvcMXpbndmlEGqhLznlC8iQYA6bpI0PQ22n2ANDzmnzR3u6+nrHCmzCmoY
PNykUGi3+8OIkwoyosoZv6//L9Bx2U2iKFWqhDdqAi6p8krqhVQCxMZ18IbsyVI=
=iCoi
-----END PGP SIGNATURE-----

Download attachment "xsa139-qemuu-unstable.patch" of type "application/octet-stream" (1176 bytes)

Download attachment "xsa139-qemuu-4.5.patch" of type "application/octet-stream" (1120 bytes)
